<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>15&nbsp; Presenting spatial data without maps – Learn Crime Mapping with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../16_mapping_time/index.html" rel="next">
<link href="../14_writing_reports/index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-854d42f42d0f6b455b86ad16a464e311.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- START OF INCLUDED HEADER -->

<!--
This file contains code that will be included in the header of each page of the
quarto book
-->

<script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>

<!-- END OF INCLUDED HEADER -->


<link rel="stylesheet" href="../css/styles.css">
<link rel="stylesheet" href="../include/webex.css">
<meta name="twitter:title" content="15&nbsp; Presenting spatial data without maps – Learn Crime Mapping with R">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="../images/cover_image.png">
<meta name="twitter:image:alt" content="">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../15_no_maps/index.html"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Presenting spatial data without maps</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/cover_image.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Learn Crime Mapping with R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/mpjashby/crimemappingbook/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contents</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Install the software needed for this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_getting_started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_your_first_crime_map/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Your first crime map</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_data_wrangling/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Wrangling data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_your_second_crime_map/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Your second crime map</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_code_with_style/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Code with style</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_mapping_crime_patterns/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Mapping crime patterns</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_map_context/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Giving a map context</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08_handling_bugs/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Handling bugs in your code</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../09_mapping_areas/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Mapping area data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../10_place_data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Using data about places</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../11_mapping_hotspots/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Mapping hotspots</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../12_messy_data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Handling messy data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../13_crime_series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Mapping crime series</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../14_writing_reports/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Writing reports in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../15_no_maps/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Presenting spatial data without maps</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../16_mapping_time/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Mapping crime over time</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/read_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Functions for reading data into R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/map_checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Checklist: Making a good crime map</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/common_errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Common R errors and how to fix them</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/functions_to_avoid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Some R functions you should avoid</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/handling_errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Checklist: handling code errors</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">In this chapter</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">15.1</span> Introduction</a></li>
  <li><a href="#tables" id="toc-tables" class="nav-link" data-scroll-target="#tables"><span class="header-section-number">15.2</span> Tables</a>
  <ul class="collapse">
  <li><a href="#making-data-wider-for-presentation" id="toc-making-data-wider-for-presentation" class="nav-link" data-scroll-target="#making-data-wider-for-presentation"><span class="header-section-number">15.2.1</span> Making data wider for presentation</a></li>
  <li><a href="#using-the-gt-package-to-make-better-tables" id="toc-using-the-gt-package-to-make-better-tables" class="nav-link" data-scroll-target="#using-the-gt-package-to-make-better-tables"><span class="header-section-number">15.2.2</span> Using the gt package to make better tables</a></li>
  <li><a href="#changing-column-names" id="toc-changing-column-names" class="nav-link" data-scroll-target="#changing-column-names"><span class="header-section-number">15.2.3</span> Changing column names</a></li>
  <li><a href="#adding-summary-rows" id="toc-adding-summary-rows" class="nav-link" data-scroll-target="#adding-summary-rows"><span class="header-section-number">15.2.4</span> Adding summary rows</a></li>
  </ul></li>
  <li><a href="#bar-charts" id="toc-bar-charts" class="nav-link" data-scroll-target="#bar-charts"><span class="header-section-number">15.3</span> Bar charts</a>
  <ul class="collapse">
  <li><a href="#ordering-bar-charts-by-value" id="toc-ordering-bar-charts-by-value" class="nav-link" data-scroll-target="#ordering-bar-charts-by-value"><span class="header-section-number">15.3.1</span> Ordering bar charts by value</a></li>
  <li><a href="#colour-in-bar-charts" id="toc-colour-in-bar-charts" class="nav-link" data-scroll-target="#colour-in-bar-charts"><span class="header-section-number">15.3.2</span> Colour in bar charts</a></li>
  </ul></li>
  <li><a href="#visualising-distributions" id="toc-visualising-distributions" class="nav-link" data-scroll-target="#visualising-distributions"><span class="header-section-number">15.4</span> Visualising distributions</a>
  <ul class="collapse">
  <li><a href="#plotting-density-curves" id="toc-plotting-density-curves" class="nav-link" data-scroll-target="#plotting-density-curves"><span class="header-section-number">15.4.1</span> Plotting density curves</a></li>
  <li><a href="#small-multiple-charts" id="toc-small-multiple-charts" class="nav-link" data-scroll-target="#small-multiple-charts"><span class="header-section-number">15.4.2</span> Small-multiple charts</a></li>
  </ul></li>
  <li><a href="#comparing-continuous-variables" id="toc-comparing-continuous-variables" class="nav-link" data-scroll-target="#comparing-continuous-variables"><span class="header-section-number">15.5</span> Comparing continuous variables</a></li>
  <li><a href="#in-summary" id="toc-in-summary" class="nav-link" data-scroll-target="#in-summary"><span class="header-section-number">15.6</span> In summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/mpjashby/crimemappingbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-no-maps" class="quarto-section-identifier"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Presenting spatial data without maps</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="abstract">
<p>Maps are a powerful tool for visualizing spatial data, but they are not always the best choice. This chapter explores alternative methods for presenting spatial data effectively, including tables and charts. By understanding when to use these techniques, you will learn how to communicate spatial information clearly and concisely. The chapter covers key scenarios where maps may be less effective, such as when summarizing small datasets or comparing multiple variables.</p>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Before you start
</div>
</div>
<div class="callout-body-container callout-body">
<p>Open RStudio or – if you already have RStudio open – click <code>Session</code> then <code>Restart R</code>. Make sure you’re working inside the Crime Mapping RStudio project you created in <a href="../01_getting_started/index.html#sec-create-project" class="quarto-xref"><span>Section 1.4.2</span></a>, then you’re ready to start mapping.</p>
</div>
</div>
<section id="introduction" class="level2" data-number="15.1">
<h2 data-number="15.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">15.1</span> Introduction</h2>
<p>Making maps is the core of analysing spatial data. But just because a particular dataset has a spatial element to it does not always mean that a map is the best way to present that data. In this chapter we will learn some other techniques for presenting data that can be more effective than maps for answering certain questions about spatial data.</p>
<p>As with so much in spatial analysis, whether it is best to make a map or use some other technique to convey information will depend on the circumstances. When you decide how to communicate information about the data you are analysing, you will need to consider the questions you are trying to answer, the audience that you are communicating to, what they will be using the information for and in what circumstances they will be using it.</p>
<p>While the best choice of how to communicate spatial information will depend on the circumstances, there are a few instances in which maps are typically <em>not</em> the best way to communicate your data. These include:</p>
<section id="when-you-only-need-to-convey-a-handful-of-pieces-of-information" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="when-you-only-need-to-convey-a-handful-of-pieces-of-information">When you only need to convey a handful of pieces of information</h4>
<p>Maps are very effective for communicating detailed information, such as the density of crime across thousands of cells in a KDE grid. But to do this, maps typically encode information into aesthetics such as colour, size and so on. This is necessary for communicating large amounts of information, but it makes the connection between the data and the visual representation of the data less direct. If you only need to communicate a small amount of information, there is less justification for forcing your audience to mentally translate the aesthetic into whatever it represents.</p>
<p>For example, if you wanted to show the number of violent and sexual offences in each of the seven districts in Northamptonshire in England, a choropleth map is less clear than a bar chart (for example, in being able to decipher if there were more offences in Kettering or in Wellingborough).</p>
<p class="full-width-image">
<img src="../images/map_vs_bar_chart.png" alt="Choropleth map and bar chart both showing the frequency of violence in each district in Northamptonshire in 2020">
</p>
<p>A map might be a useful addition to the bar chart in this case <em>if</em> you are trying to communicate information to people who are not familiar with the locations of the districts. In that case, we might want to add a small reference map to help people understand which area is which:</p>
<p class="full-width-image">
<img src="../images/bar_chart_ref_map.png" alt="Bar chart showing the frequency of violence in each district in Northamptonshire in 2020, with a reference map showing the area covered by each district">
</p>
<p>But in most circumstances in which you create crime maps, you will be creating them for an audience (such as local police officers) that already has sufficient knowledge of the area and so an inset map such as this would not be needed. In that case, a bar chart will probably be more effective at showing this information than a map would be.</p>
</section>
<section id="when-you-need-to-convey-several-different-things-about-one-place" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="when-you-need-to-convey-several-different-things-about-one-place">When you need to convey several different things about one place</h4>
<p>Maps are generally most effective when they show a single piece of data about each place (e.g.&nbsp;a grid cell or a polygon representing a statistical area). For example, a choropleth map shows a single shade of colour for each area on the map to represent a single value, such as the frequency or rate of crime in that area. If you wanted to show the frequency of burglary <em>and</em> the frequency of robbery in the same area on a map, this would be quite hard. So if you need to convey multiple different things about each place, it is generally best to do this in a table or chart, rather than a map.</p>
<p>One exception to this is when you present multiple maps side by side, each showing a single thing about an area. These are called <em>small multiple</em> maps and we will learn about them in <a href="../16_mapping_time/index.html" class="quarto-xref"><span>Chapter 16</span></a>.</p>
</section>
<section id="when-the-geographic-relationship-between-places-on-the-map-is-not-the-most-important-thing-about-them" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="when-the-geographic-relationship-between-places-on-the-map-is-not-the-most-important-thing-about-them">When the geographic relationship between places on the map is not the most important thing about them</h4>
<p>Maps emphasise the spatial relationship between different places, but they do this at the expense of making non-spatial relationships between those places less obvious. If the spatial relationships are the most important thing that you want to convey, a map makes sense. For example, a hotspot map is often a very good way to communicate where crime is most concentrated. But in other cases the geographic relationships between variables will be much less important. For example, if you wanted to show the relationship between the amount of crime in an area and the level of poverty there, a scatter plot would probably be a more-effective way to do this than a map would be.</p>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Maps, charts and tables
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What is one reason why spatial relationships might not be important in some visualizations?</strong></p>
<div id="radio_VVSNGIREIM" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_VVSNGIREIM" value=""> <span>Maps are outdated and not widely used in spatial analysis</span></label><label><input type="radio" autocomplete="off" name="radio_VVSNGIREIM" value=""> <span>Charts can always show spatial relationships more clearly</span></label><label><input type="radio" autocomplete="off" name="radio_VVSNGIREIM" value="answer"> <span>The relationships between places might not matter for the question at hand</span></label><label><input type="radio" autocomplete="off" name="radio_VVSNGIREIM" value=""> <span>Maps cannot be used to display numerical data</span></label>
</div>
<p><strong>What is a key factor in deciding whether to use a map, table, or chart?</strong></p>
<div id="radio_ZOIMAYCARS" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_ZOIMAYCARS" value=""> <span>The software used to create the visualization</span></label><label><input type="radio" autocomplete="off" name="radio_ZOIMAYCARS" value="answer"> <span>The question being answered and the audience’s needs</span></label><label><input type="radio" autocomplete="off" name="radio_ZOIMAYCARS" value=""> <span>The geographic location of the data</span></label><label><input type="radio" autocomplete="off" name="radio_ZOIMAYCARS" value=""> <span>The number of colours available in the mapping tool</span></label>
</div>
</div>
</div>
</section>
</section>
<section id="tables" class="level2" data-number="15.2">
<h2 data-number="15.2" class="anchored" data-anchor-id="tables"><span class="header-section-number">15.2</span> Tables</h2>
<p>Well-designed tables can be a very effective way of communicating information, whereas badly-design tables can be confusing and even lead your audience to give up trying to engage with the information you’re trying to communicate.</p>
<p>Tables used to present information almost always show only a summary of the available data, so the first step in preparing a table is to wrangle the data into the right format. In <a href="../03_data_wrangling/index.html#sec-summarise" class="quarto-xref"><span>Section 3.6</span></a> we learned about the <code>summarise()</code> function from the dplyr package that we can use to produce summaries of rows of data.</p>
<p>To learn about creating a good table for displaying summary data in a report, we will use the example of the frequency of different types of violence in the different states of Malaysia in 2017.</p>
<p>Open a new R script file and save it as <code>chapter15a.R</code>. Copy this code into that file and run it.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter15a.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load packages</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(gt, paletteer, tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># Load annual counts of different types of violence in Malaysia, 2006 to 2017</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>violence <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/malaysia_violence_counts.rds"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="co"># Keep only counts from 2017</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>We can get a feel for the data by looking at a random sample of rows using the <code>slice_sample()</code> function function from the dplyr package (remember dplyr was loaded automatically when we loaded tidyverse).</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">slice_sample</span>(violence, <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 10 × 5
   region        state         year crime_type         count
   &lt;chr&gt;         &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
 1 West Malaysia Kelantan      2017 unarmed robbery      219
 2 West Malaysia Melaka        2017 murder                 7
 3 West Malaysia Melaka        2017 unarmed robbery      589
 4 East Malaysia Sarawak       2017 armed robbery          3
 5 West Malaysia Johor         2017 unarmed robbery     1701
 6 West Malaysia Melaka        2017 rape                  69
 7 West Malaysia Pahang        2017 rape                 163
 8 West Malaysia Kuala Lumpur  2017 aggravated assault   651
 9 West Malaysia Pulau Pinang  2017 unarmed robbery      706
10 West Malaysia Johor         2017 murder                66</code></pre>
</div>
</div>
<p>The output of <code>slice_sample()</code> looks acceptable as a table, especially if it is included in a Quarto document, but readers of our reports probably don’t want to know the type of each variable (underneath the variable names) and won’t want to page through the table if there are more rows or columns than can fit in the available space. We can make this table much more useful for readers by wrangling it into a different format.</p>
<section id="making-data-wider-for-presentation" class="level3" data-number="15.2.1">
<h3 data-number="15.2.1" class="anchored" data-anchor-id="making-data-wider-for-presentation"><span class="header-section-number">15.2.1</span> Making data wider for presentation</h3>
<p>One issue with printing the <code>violence</code> object as a table is that it has 70 rows, so it will take up a lot of space on a page or screen. We can make the data more compact by converting it from long format to wide format. In <a href="../12_messy_data/index.html" class="quarto-xref"><span>Chapter 12</span></a> we learned that data are often easier to analyse in long format. But it is often better to <em>present</em> data in a table in wide format. When you are choosing between storing data in long versus wide format, remember: analyse in long format, present in wide format.</p>
<p>To convert the table to a wider format we can use the <code>pivot_wider()</code> function from the tidyr package, just was we used the corresponding <code>pivot_longer()</code> function to tidy data in <a href="../12_messy_data/index.html" class="quarto-xref"><span>Chapter 12</span></a>. To make data wider, we specify a single column in the data to use as the <em>names</em> of multiple new columns using the <code>names_from</code> argument and a column to use as the <em>values</em> for the new columns using the <code>values_from</code> argument.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Produce table of crime counts in each Malaysian state</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="co"># Convert data to have one row per state</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb4-5"><a href="#cb4-5"></a>  <span class="co"># Convert new column names (the former values of `crime_type`) to snake case</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 14 × 8
   region        state        year aggravated_assault armed_robbery murder  rape
   &lt;chr&gt;         &lt;chr&gt;       &lt;dbl&gt;              &lt;dbl&gt;         &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1 East Malaysia Sabah        2017                230             0     36   211
 2 East Malaysia Sarawak      2017                368             3     27   150
 3 West Malaysia Johor        2017                614             1     66   196
 4 West Malaysia Kedah        2017                364             2     21   119
 5 West Malaysia Kelantan     2017                252             2     13   114
 6 West Malaysia Kuala Lump…  2017                651             4     37   132
 7 West Malaysia Melaka       2017                176             1      7    69
 8 West Malaysia Negeri Sem…  2017                241             2     14    91
 9 West Malaysia Pahang       2017                188             1     16   163
10 West Malaysia Perak        2017                380             4     35    95
11 West Malaysia Perlis       2017                 47             0      2    30
12 West Malaysia Pulau Pina…  2017                275             0     17    80
13 West Malaysia Selangor     2017               1108            14     83   321
14 West Malaysia Terengganu   2017                130             0      5    64
# ℹ 1 more variable: unarmed_robbery &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why does this code include <code>janitor::clean_names()</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You will be used to seeing <code>janitor::clean_names()</code> used to clean the column names in a dataset that has just been loaded. In this case, the new columns created by <code>pivot_wider()</code> will have spaces in them, because the names are taken from the values of the <code>crime_type</code> column in the original dataset. Column names with spaces in them a harder to work with, so this code converts them to snake case so that they are easier to work with.</p>
<p>Later in the code we will replace these column names with labels that are suitable for displaying the data in a table.</p>
</div>
</div>
</div>
<p>Now the table has only 14 rows, which makes it much easier to present both on screen and in print. We can also see that the <code>year</code> column is <em>constant</em> (all the values are the same), so we can remove this using the <code>select()</code> function from dplyr. We can also use <code>select()</code> to change the order of the columns from left to right so that the two types of robbery appear next to each other.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Produce table of crime counts in each Malaysian state</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="co"># Convert data to have one row per state</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="co"># Convert new column names (the former values of `crime_type`) to snake case</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="co"># Choose only the columns we want to show in the table</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="fu">select</span>(</span>
<span id="cb6-9"><a href="#cb6-9"></a>    region, state, murder, rape, aggravated_assault, armed_robbery, </span>
<span id="cb6-10"><a href="#cb6-10"></a>    unarmed_robbery</span>
<span id="cb6-11"><a href="#cb6-11"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 14 × 7
   region    state murder  rape aggravated_assault armed_robbery unarmed_robbery
   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;              &lt;dbl&gt;         &lt;dbl&gt;           &lt;dbl&gt;
 1 East Mal… Sabah     36   211                230             0             284
 2 East Mal… Sara…     27   150                368             3             328
 3 West Mal… Johor     66   196                614             1            1701
 4 West Mal… Kedah     21   119                364             2             490
 5 West Mal… Kela…     13   114                252             2             219
 6 West Mal… Kual…     37   132                651             4            3175
 7 West Mal… Mela…      7    69                176             1             589
 8 West Mal… Nege…     14    91                241             2             536
 9 West Mal… Paha…     16   163                188             1             288
10 West Mal… Perak     35    95                380             4             626
11 West Mal… Perl…      2    30                 47             0              53
12 West Mal… Pula…     17    80                275             0             706
13 West Mal… Sela…     83   321               1108            14            4944
14 West Mal… Tere…      5    64                130             0             155</code></pre>
</div>
</div>
</section>
<section id="using-the-gt-package-to-make-better-tables" class="level3" data-number="15.2.2">
<h3 data-number="15.2.2" class="anchored" data-anchor-id="using-the-gt-package-to-make-better-tables"><span class="header-section-number">15.2.2</span> Using the gt package to make better tables</h3>
<p><a href="https://gt.rstudio.com/"><img src="../images/gt.png" alt="gt package hex sticker" class="right-side-image"></a></p>
<p>The table we created in the last section was better than simply showing the raw data to readers of a report. But we can create much better display tables with the <a href="https://gt.rstudio.com/">gt package</a>, which is designed to format data for display. The gt package works in a similar way to the <code>ggplot2</code> package, in that tables are made up of stacks of functions that contribute to the appearance of the final table. One difference is that the layers in a gt stack are joined using the pipe operator (<code>|&gt;</code>) rather than the plus operator (<code>+</code>).</p>
<p>We can create a very basic gt table by just passing a data frame or tibble to the <code>gt()</code> function. So we can add <code>gt()</code> to the end of the pipeline of functions we have already started to build to create a good display table. At this point, the only argument we will add to <code>gt()</code> is the <code>rowname_col</code> argument, which we use to specify which column in the data holds the row labels (in this case, the name of each state).</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Produce table of crime counts in each Malaysian state</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="co"># Convert data to have one row per state</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="co"># Convert new column names (the former values of `crime_type`) to snake case</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb8-7"><a href="#cb8-7"></a>  <span class="co"># Choose only the columns we want to show in the table</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>  <span class="fu">select</span>(</span>
<span id="cb8-9"><a href="#cb8-9"></a>    region, state, murder, rape, aggravated_assault, armed_robbery, </span>
<span id="cb8-10"><a href="#cb8-10"></a>    unarmed_robbery</span>
<span id="cb8-11"><a href="#cb8-11"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb8-12"><a href="#cb8-12"></a>  <span class="co"># Functions from tidyverse above and functions from gt below</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"state"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="ijmcuohvvw" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ijmcuohvvw table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ijmcuohvvw thead, #ijmcuohvvw tbody, #ijmcuohvvw tfoot, #ijmcuohvvw tr, #ijmcuohvvw td, #ijmcuohvvw th {
  border-style: none;
}

#ijmcuohvvw p {
  margin: 0;
  padding: 0;
}

#ijmcuohvvw .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ijmcuohvvw .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ijmcuohvvw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ijmcuohvvw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ijmcuohvvw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ijmcuohvvw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ijmcuohvvw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ijmcuohvvw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ijmcuohvvw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ijmcuohvvw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ijmcuohvvw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ijmcuohvvw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ijmcuohvvw .gt_spanner_row {
  border-bottom-style: hidden;
}

#ijmcuohvvw .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ijmcuohvvw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ijmcuohvvw .gt_from_md > :first-child {
  margin-top: 0;
}

#ijmcuohvvw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ijmcuohvvw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ijmcuohvvw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ijmcuohvvw .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ijmcuohvvw .gt_row_group_first td {
  border-top-width: 2px;
}

#ijmcuohvvw .gt_row_group_first th {
  border-top-width: 2px;
}

#ijmcuohvvw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ijmcuohvvw .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ijmcuohvvw .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ijmcuohvvw .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ijmcuohvvw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ijmcuohvvw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ijmcuohvvw .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ijmcuohvvw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ijmcuohvvw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ijmcuohvvw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ijmcuohvvw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ijmcuohvvw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ijmcuohvvw .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ijmcuohvvw .gt_left {
  text-align: left;
}

#ijmcuohvvw .gt_center {
  text-align: center;
}

#ijmcuohvvw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ijmcuohvvw .gt_font_normal {
  font-weight: normal;
}

#ijmcuohvvw .gt_font_bold {
  font-weight: bold;
}

#ijmcuohvvw .gt_font_italic {
  font-style: italic;
}

#ijmcuohvvw .gt_super {
  font-size: 65%;
}

#ijmcuohvvw .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ijmcuohvvw .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ijmcuohvvw .gt_indent_1 {
  text-indent: 5px;
}

#ijmcuohvvw .gt_indent_2 {
  text-indent: 10px;
}

#ijmcuohvvw .gt_indent_3 {
  text-indent: 15px;
}

#ijmcuohvvw .gt_indent_4 {
  text-indent: 20px;
}

#ijmcuohvvw .gt_indent_5 {
  text-indent: 25px;
}

#ijmcuohvvw .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ijmcuohvvw div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="region" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">region</th>
<th id="murder" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">murder</th>
<th id="rape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rape</th>
<th id="aggravated_assault" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">aggravated_assault</th>
<th id="armed_robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">armed_robbery</th>
<th id="unarmed_robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">unarmed_robbery</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Sabah</td>
<td class="gt_row gt_left" headers="stub_1_1 region">East Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_1 murder">36</td>
<td class="gt_row gt_right" headers="stub_1_1 rape">211</td>
<td class="gt_row gt_right" headers="stub_1_1 aggravated_assault">230</td>
<td class="gt_row gt_right" headers="stub_1_1 armed_robbery">0</td>
<td class="gt_row gt_right" headers="stub_1_1 unarmed_robbery">284</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Sarawak</td>
<td class="gt_row gt_left" headers="stub_1_2 region">East Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_2 murder">27</td>
<td class="gt_row gt_right" headers="stub_1_2 rape">150</td>
<td class="gt_row gt_right" headers="stub_1_2 aggravated_assault">368</td>
<td class="gt_row gt_right" headers="stub_1_2 armed_robbery">3</td>
<td class="gt_row gt_right" headers="stub_1_2 unarmed_robbery">328</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Johor</td>
<td class="gt_row gt_left" headers="stub_1_3 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_3 murder">66</td>
<td class="gt_row gt_right" headers="stub_1_3 rape">196</td>
<td class="gt_row gt_right" headers="stub_1_3 aggravated_assault">614</td>
<td class="gt_row gt_right" headers="stub_1_3 armed_robbery">1</td>
<td class="gt_row gt_right" headers="stub_1_3 unarmed_robbery">1701</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kedah</td>
<td class="gt_row gt_left" headers="stub_1_4 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_4 murder">21</td>
<td class="gt_row gt_right" headers="stub_1_4 rape">119</td>
<td class="gt_row gt_right" headers="stub_1_4 aggravated_assault">364</td>
<td class="gt_row gt_right" headers="stub_1_4 armed_robbery">2</td>
<td class="gt_row gt_right" headers="stub_1_4 unarmed_robbery">490</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kelantan</td>
<td class="gt_row gt_left" headers="stub_1_5 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_5 murder">13</td>
<td class="gt_row gt_right" headers="stub_1_5 rape">114</td>
<td class="gt_row gt_right" headers="stub_1_5 aggravated_assault">252</td>
<td class="gt_row gt_right" headers="stub_1_5 armed_robbery">2</td>
<td class="gt_row gt_right" headers="stub_1_5 unarmed_robbery">219</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kuala Lumpur</td>
<td class="gt_row gt_left" headers="stub_1_6 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_6 murder">37</td>
<td class="gt_row gt_right" headers="stub_1_6 rape">132</td>
<td class="gt_row gt_right" headers="stub_1_6 aggravated_assault">651</td>
<td class="gt_row gt_right" headers="stub_1_6 armed_robbery">4</td>
<td class="gt_row gt_right" headers="stub_1_6 unarmed_robbery">3175</td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Melaka</td>
<td class="gt_row gt_left" headers="stub_1_7 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_7 murder">7</td>
<td class="gt_row gt_right" headers="stub_1_7 rape">69</td>
<td class="gt_row gt_right" headers="stub_1_7 aggravated_assault">176</td>
<td class="gt_row gt_right" headers="stub_1_7 armed_robbery">1</td>
<td class="gt_row gt_right" headers="stub_1_7 unarmed_robbery">589</td>
</tr>
<tr class="even">
<td id="stub_1_8" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Negeri Sembilan</td>
<td class="gt_row gt_left" headers="stub_1_8 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_8 murder">14</td>
<td class="gt_row gt_right" headers="stub_1_8 rape">91</td>
<td class="gt_row gt_right" headers="stub_1_8 aggravated_assault">241</td>
<td class="gt_row gt_right" headers="stub_1_8 armed_robbery">2</td>
<td class="gt_row gt_right" headers="stub_1_8 unarmed_robbery">536</td>
</tr>
<tr class="odd">
<td id="stub_1_9" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Pahang</td>
<td class="gt_row gt_left" headers="stub_1_9 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_9 murder">16</td>
<td class="gt_row gt_right" headers="stub_1_9 rape">163</td>
<td class="gt_row gt_right" headers="stub_1_9 aggravated_assault">188</td>
<td class="gt_row gt_right" headers="stub_1_9 armed_robbery">1</td>
<td class="gt_row gt_right" headers="stub_1_9 unarmed_robbery">288</td>
</tr>
<tr class="even">
<td id="stub_1_10" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Perak</td>
<td class="gt_row gt_left" headers="stub_1_10 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_10 murder">35</td>
<td class="gt_row gt_right" headers="stub_1_10 rape">95</td>
<td class="gt_row gt_right" headers="stub_1_10 aggravated_assault">380</td>
<td class="gt_row gt_right" headers="stub_1_10 armed_robbery">4</td>
<td class="gt_row gt_right" headers="stub_1_10 unarmed_robbery">626</td>
</tr>
<tr class="odd">
<td id="stub_1_11" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Perlis</td>
<td class="gt_row gt_left" headers="stub_1_11 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_11 murder">2</td>
<td class="gt_row gt_right" headers="stub_1_11 rape">30</td>
<td class="gt_row gt_right" headers="stub_1_11 aggravated_assault">47</td>
<td class="gt_row gt_right" headers="stub_1_11 armed_robbery">0</td>
<td class="gt_row gt_right" headers="stub_1_11 unarmed_robbery">53</td>
</tr>
<tr class="even">
<td id="stub_1_12" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Pulau Pinang</td>
<td class="gt_row gt_left" headers="stub_1_12 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_12 murder">17</td>
<td class="gt_row gt_right" headers="stub_1_12 rape">80</td>
<td class="gt_row gt_right" headers="stub_1_12 aggravated_assault">275</td>
<td class="gt_row gt_right" headers="stub_1_12 armed_robbery">0</td>
<td class="gt_row gt_right" headers="stub_1_12 unarmed_robbery">706</td>
</tr>
<tr class="odd">
<td id="stub_1_13" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Selangor</td>
<td class="gt_row gt_left" headers="stub_1_13 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_13 murder">83</td>
<td class="gt_row gt_right" headers="stub_1_13 rape">321</td>
<td class="gt_row gt_right" headers="stub_1_13 aggravated_assault">1108</td>
<td class="gt_row gt_right" headers="stub_1_13 armed_robbery">14</td>
<td class="gt_row gt_right" headers="stub_1_13 unarmed_robbery">4944</td>
</tr>
<tr class="even">
<td id="stub_1_14" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Terengganu</td>
<td class="gt_row gt_left" headers="stub_1_14 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_14 murder">5</td>
<td class="gt_row gt_right" headers="stub_1_14 rape">64</td>
<td class="gt_row gt_right" headers="stub_1_14 aggravated_assault">130</td>
<td class="gt_row gt_right" headers="stub_1_14 armed_robbery">0</td>
<td class="gt_row gt_right" headers="stub_1_14 unarmed_robbery">155</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This table is already better than the default table produced by Quarto if we just print a data frame or tibble. The gt table does not take up the whole width of the page unnecessarily (which can make it harder to read across rows) and has hidden the type of each column.</p>
<p>We can add more functions to the <code>gt()</code> stack to adjust the appearance of the table. For example, we can format the numeric columns as numbers using the <code>fmt_number()</code> function. This adds thousand separators (in British English, commas) to make it easier to read the large numeric values and can make various other changes such as adding a prefix or suffix to numbers (useful for showing units), scaling numbers (useful for very large numbers) or automatically formatting numbers according to the conventions of the language your computer is set to use (referred to in R help pages as the <em>locale</em> of your computer).</p>
<p>We choose which columns <code>fmt_number()</code> should format using the <code>columns</code> argument. In this case, we want to format all the numeric columns in the data, so we will set <code>columns = where(is.numeric)</code>.</p>
<p>We don’t want the numbers in the table to have any decimal places (since the crime counts are all whole numbers), so we also set <code>decimals = 0</code>. We can use the default values of all the other arguments to <code>fmt_number()</code> – type <code>?gt::fmt_number</code> in the R console to find out more about the different options available on the help page for the <code>fmt_number()</code> function.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Produce table of crime counts in each Malaysian state</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="co"># Convert data to have one row per state</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb9-5"><a href="#cb9-5"></a>  <span class="co"># Convert new column names (the former values of `crime_type`) to snake case</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb9-7"><a href="#cb9-7"></a>  <span class="co"># Choose only the columns we want to show in the table</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>  <span class="fu">select</span>(</span>
<span id="cb9-9"><a href="#cb9-9"></a>    region, state, murder, rape, aggravated_assault, armed_robbery, </span>
<span id="cb9-10"><a href="#cb9-10"></a>    unarmed_robbery</span>
<span id="cb9-11"><a href="#cb9-11"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb9-12"><a href="#cb9-12"></a>  <span class="co"># Functions from tidyverse above and functions from gt below</span></span>
<span id="cb9-13"><a href="#cb9-13"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"state"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-14"><a href="#cb9-14"></a>  <span class="co"># Format numbers with thousand separators and no decimals</span></span>
<span id="cb9-15"><a href="#cb9-15"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">where</span>(is.numeric), <span class="at">decimals =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="hyaevidpjl" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hyaevidpjl table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hyaevidpjl thead, #hyaevidpjl tbody, #hyaevidpjl tfoot, #hyaevidpjl tr, #hyaevidpjl td, #hyaevidpjl th {
  border-style: none;
}

#hyaevidpjl p {
  margin: 0;
  padding: 0;
}

#hyaevidpjl .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hyaevidpjl .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hyaevidpjl .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hyaevidpjl .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hyaevidpjl .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hyaevidpjl .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hyaevidpjl .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hyaevidpjl .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hyaevidpjl .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hyaevidpjl .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hyaevidpjl .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hyaevidpjl .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hyaevidpjl .gt_spanner_row {
  border-bottom-style: hidden;
}

#hyaevidpjl .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hyaevidpjl .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hyaevidpjl .gt_from_md > :first-child {
  margin-top: 0;
}

#hyaevidpjl .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hyaevidpjl .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hyaevidpjl .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hyaevidpjl .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hyaevidpjl .gt_row_group_first td {
  border-top-width: 2px;
}

#hyaevidpjl .gt_row_group_first th {
  border-top-width: 2px;
}

#hyaevidpjl .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hyaevidpjl .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hyaevidpjl .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hyaevidpjl .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hyaevidpjl .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hyaevidpjl .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hyaevidpjl .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hyaevidpjl .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hyaevidpjl .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hyaevidpjl .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hyaevidpjl .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hyaevidpjl .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hyaevidpjl .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hyaevidpjl .gt_left {
  text-align: left;
}

#hyaevidpjl .gt_center {
  text-align: center;
}

#hyaevidpjl .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hyaevidpjl .gt_font_normal {
  font-weight: normal;
}

#hyaevidpjl .gt_font_bold {
  font-weight: bold;
}

#hyaevidpjl .gt_font_italic {
  font-style: italic;
}

#hyaevidpjl .gt_super {
  font-size: 65%;
}

#hyaevidpjl .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hyaevidpjl .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hyaevidpjl .gt_indent_1 {
  text-indent: 5px;
}

#hyaevidpjl .gt_indent_2 {
  text-indent: 10px;
}

#hyaevidpjl .gt_indent_3 {
  text-indent: 15px;
}

#hyaevidpjl .gt_indent_4 {
  text-indent: 20px;
}

#hyaevidpjl .gt_indent_5 {
  text-indent: 25px;
}

#hyaevidpjl .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#hyaevidpjl div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="region" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">region</th>
<th id="murder" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">murder</th>
<th id="rape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rape</th>
<th id="aggravated_assault" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">aggravated_assault</th>
<th id="armed_robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">armed_robbery</th>
<th id="unarmed_robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">unarmed_robbery</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Sabah</td>
<td class="gt_row gt_left" headers="stub_1_1 region">East Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_1 murder">36</td>
<td class="gt_row gt_right" headers="stub_1_1 rape">211</td>
<td class="gt_row gt_right" headers="stub_1_1 aggravated_assault">230</td>
<td class="gt_row gt_right" headers="stub_1_1 armed_robbery">0</td>
<td class="gt_row gt_right" headers="stub_1_1 unarmed_robbery">284</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Sarawak</td>
<td class="gt_row gt_left" headers="stub_1_2 region">East Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_2 murder">27</td>
<td class="gt_row gt_right" headers="stub_1_2 rape">150</td>
<td class="gt_row gt_right" headers="stub_1_2 aggravated_assault">368</td>
<td class="gt_row gt_right" headers="stub_1_2 armed_robbery">3</td>
<td class="gt_row gt_right" headers="stub_1_2 unarmed_robbery">328</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Johor</td>
<td class="gt_row gt_left" headers="stub_1_3 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_3 murder">66</td>
<td class="gt_row gt_right" headers="stub_1_3 rape">196</td>
<td class="gt_row gt_right" headers="stub_1_3 aggravated_assault">614</td>
<td class="gt_row gt_right" headers="stub_1_3 armed_robbery">1</td>
<td class="gt_row gt_right" headers="stub_1_3 unarmed_robbery">1,701</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kedah</td>
<td class="gt_row gt_left" headers="stub_1_4 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_4 murder">21</td>
<td class="gt_row gt_right" headers="stub_1_4 rape">119</td>
<td class="gt_row gt_right" headers="stub_1_4 aggravated_assault">364</td>
<td class="gt_row gt_right" headers="stub_1_4 armed_robbery">2</td>
<td class="gt_row gt_right" headers="stub_1_4 unarmed_robbery">490</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kelantan</td>
<td class="gt_row gt_left" headers="stub_1_5 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_5 murder">13</td>
<td class="gt_row gt_right" headers="stub_1_5 rape">114</td>
<td class="gt_row gt_right" headers="stub_1_5 aggravated_assault">252</td>
<td class="gt_row gt_right" headers="stub_1_5 armed_robbery">2</td>
<td class="gt_row gt_right" headers="stub_1_5 unarmed_robbery">219</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kuala Lumpur</td>
<td class="gt_row gt_left" headers="stub_1_6 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_6 murder">37</td>
<td class="gt_row gt_right" headers="stub_1_6 rape">132</td>
<td class="gt_row gt_right" headers="stub_1_6 aggravated_assault">651</td>
<td class="gt_row gt_right" headers="stub_1_6 armed_robbery">4</td>
<td class="gt_row gt_right" headers="stub_1_6 unarmed_robbery">3,175</td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Melaka</td>
<td class="gt_row gt_left" headers="stub_1_7 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_7 murder">7</td>
<td class="gt_row gt_right" headers="stub_1_7 rape">69</td>
<td class="gt_row gt_right" headers="stub_1_7 aggravated_assault">176</td>
<td class="gt_row gt_right" headers="stub_1_7 armed_robbery">1</td>
<td class="gt_row gt_right" headers="stub_1_7 unarmed_robbery">589</td>
</tr>
<tr class="even">
<td id="stub_1_8" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Negeri Sembilan</td>
<td class="gt_row gt_left" headers="stub_1_8 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_8 murder">14</td>
<td class="gt_row gt_right" headers="stub_1_8 rape">91</td>
<td class="gt_row gt_right" headers="stub_1_8 aggravated_assault">241</td>
<td class="gt_row gt_right" headers="stub_1_8 armed_robbery">2</td>
<td class="gt_row gt_right" headers="stub_1_8 unarmed_robbery">536</td>
</tr>
<tr class="odd">
<td id="stub_1_9" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Pahang</td>
<td class="gt_row gt_left" headers="stub_1_9 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_9 murder">16</td>
<td class="gt_row gt_right" headers="stub_1_9 rape">163</td>
<td class="gt_row gt_right" headers="stub_1_9 aggravated_assault">188</td>
<td class="gt_row gt_right" headers="stub_1_9 armed_robbery">1</td>
<td class="gt_row gt_right" headers="stub_1_9 unarmed_robbery">288</td>
</tr>
<tr class="even">
<td id="stub_1_10" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Perak</td>
<td class="gt_row gt_left" headers="stub_1_10 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_10 murder">35</td>
<td class="gt_row gt_right" headers="stub_1_10 rape">95</td>
<td class="gt_row gt_right" headers="stub_1_10 aggravated_assault">380</td>
<td class="gt_row gt_right" headers="stub_1_10 armed_robbery">4</td>
<td class="gt_row gt_right" headers="stub_1_10 unarmed_robbery">626</td>
</tr>
<tr class="odd">
<td id="stub_1_11" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Perlis</td>
<td class="gt_row gt_left" headers="stub_1_11 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_11 murder">2</td>
<td class="gt_row gt_right" headers="stub_1_11 rape">30</td>
<td class="gt_row gt_right" headers="stub_1_11 aggravated_assault">47</td>
<td class="gt_row gt_right" headers="stub_1_11 armed_robbery">0</td>
<td class="gt_row gt_right" headers="stub_1_11 unarmed_robbery">53</td>
</tr>
<tr class="even">
<td id="stub_1_12" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Pulau Pinang</td>
<td class="gt_row gt_left" headers="stub_1_12 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_12 murder">17</td>
<td class="gt_row gt_right" headers="stub_1_12 rape">80</td>
<td class="gt_row gt_right" headers="stub_1_12 aggravated_assault">275</td>
<td class="gt_row gt_right" headers="stub_1_12 armed_robbery">0</td>
<td class="gt_row gt_right" headers="stub_1_12 unarmed_robbery">706</td>
</tr>
<tr class="odd">
<td id="stub_1_13" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Selangor</td>
<td class="gt_row gt_left" headers="stub_1_13 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_13 murder">83</td>
<td class="gt_row gt_right" headers="stub_1_13 rape">321</td>
<td class="gt_row gt_right" headers="stub_1_13 aggravated_assault">1,108</td>
<td class="gt_row gt_right" headers="stub_1_13 armed_robbery">14</td>
<td class="gt_row gt_right" headers="stub_1_13 unarmed_robbery">4,944</td>
</tr>
<tr class="even">
<td id="stub_1_14" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Terengganu</td>
<td class="gt_row gt_left" headers="stub_1_14 region">West Malaysia</td>
<td class="gt_row gt_right" headers="stub_1_14 murder">5</td>
<td class="gt_row gt_right" headers="stub_1_14 rape">64</td>
<td class="gt_row gt_right" headers="stub_1_14 aggravated_assault">130</td>
<td class="gt_row gt_right" headers="stub_1_14 armed_robbery">0</td>
<td class="gt_row gt_right" headers="stub_1_14 unarmed_robbery">155</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><code>fmt_number()</code> is one of several formatting functions available in gt. For example, we could use <code>fmt_currency()</code> to format columns according to the conventions for currency values, <code>fmt_date()</code> for dates or <code>fmt_percent()</code> for percentages.</p>
<p>The <code>region</code> column only has two values: <code>West Malaysia</code> for states and territories in Peninsular Malaysia and <code>East Malaysia</code> for states on the island of Borneo. Rather than repeat these two values on every row of the table – which is a waste of space and makes the table more cluttered than necessary – we can instead group the rows according to these two regions and then only show the region names once at the top of each group.</p>
<p><code>gt()</code> will automatically create group headings in a table if the data frame or tibble passed to <code>gt()</code> contains groups created by the <code>group_by()</code> function from the dplyr package. All we have to do is use <code>group_by()</code> to specify which column (in this case, <code>region</code>) contains the values that we should use to determine which group each row is in.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Produce table of crime counts in each Malaysian state</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="co"># Convert data to have one row per state</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="co"># Convert new column names (the former values of `crime_type`) to snake case</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb10-7"><a href="#cb10-7"></a>  <span class="co"># Choose only the columns we want to show in the table</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>  <span class="fu">select</span>(</span>
<span id="cb10-9"><a href="#cb10-9"></a>    region, state, murder, rape, aggravated_assault, armed_robbery, </span>
<span id="cb10-10"><a href="#cb10-10"></a>    unarmed_robbery</span>
<span id="cb10-11"><a href="#cb10-11"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb10-12"><a href="#cb10-12"></a>  <span class="co"># Specify the table rows should be grouped by the values of `region`</span></span>
<span id="cb10-13"><a href="#cb10-13"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span> </span>
<span id="cb10-14"><a href="#cb10-14"></a>  <span class="co"># Functions from tidyverse above and functions from gt below</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"state"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-16"><a href="#cb10-16"></a>  <span class="co"># Format numbers with thousand separators and no decimals</span></span>
<span id="cb10-17"><a href="#cb10-17"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">where</span>(is.numeric), <span class="at">decimals =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="axadieewec" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#axadieewec table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#axadieewec thead, #axadieewec tbody, #axadieewec tfoot, #axadieewec tr, #axadieewec td, #axadieewec th {
  border-style: none;
}

#axadieewec p {
  margin: 0;
  padding: 0;
}

#axadieewec .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#axadieewec .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#axadieewec .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#axadieewec .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#axadieewec .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#axadieewec .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#axadieewec .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#axadieewec .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#axadieewec .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#axadieewec .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#axadieewec .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#axadieewec .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#axadieewec .gt_spanner_row {
  border-bottom-style: hidden;
}

#axadieewec .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#axadieewec .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#axadieewec .gt_from_md > :first-child {
  margin-top: 0;
}

#axadieewec .gt_from_md > :last-child {
  margin-bottom: 0;
}

#axadieewec .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#axadieewec .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#axadieewec .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#axadieewec .gt_row_group_first td {
  border-top-width: 2px;
}

#axadieewec .gt_row_group_first th {
  border-top-width: 2px;
}

#axadieewec .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#axadieewec .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#axadieewec .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#axadieewec .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#axadieewec .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#axadieewec .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#axadieewec .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#axadieewec .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#axadieewec .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#axadieewec .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#axadieewec .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#axadieewec .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#axadieewec .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#axadieewec .gt_left {
  text-align: left;
}

#axadieewec .gt_center {
  text-align: center;
}

#axadieewec .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#axadieewec .gt_font_normal {
  font-weight: normal;
}

#axadieewec .gt_font_bold {
  font-weight: bold;
}

#axadieewec .gt_font_italic {
  font-style: italic;
}

#axadieewec .gt_super {
  font-size: 65%;
}

#axadieewec .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#axadieewec .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#axadieewec .gt_indent_1 {
  text-indent: 5px;
}

#axadieewec .gt_indent_2 {
  text-indent: 10px;
}

#axadieewec .gt_indent_3 {
  text-indent: 15px;
}

#axadieewec .gt_indent_4 {
  text-indent: 20px;
}

#axadieewec .gt_indent_5 {
  text-indent: 25px;
}

#axadieewec .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#axadieewec div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="murder" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">murder</th>
<th id="rape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rape</th>
<th id="aggravated_assault" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">aggravated_assault</th>
<th id="armed_robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">armed_robbery</th>
<th id="unarmed_robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">unarmed_robbery</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row odd">
<td colspan="6" id="East Malaysia" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">East Malaysia</td>
</tr>
<tr class="gt_row_group_first even">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Sabah</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 murder">36</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 rape">211</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 aggravated_assault">230</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 armed_robbery">0</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 unarmed_robbery">284</td>
</tr>
<tr class="odd">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Sarawak</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 murder">27</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 rape">150</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 aggravated_assault">368</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 armed_robbery">3</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 unarmed_robbery">328</td>
</tr>
<tr class="gt_group_heading_row even">
<td colspan="6" id="West Malaysia" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">West Malaysia</td>
</tr>
<tr class="gt_row_group_first odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Johor</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 murder">66</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 rape">196</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 aggravated_assault">614</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 armed_robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 unarmed_robbery">1,701</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kedah</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 murder">21</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 rape">119</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 aggravated_assault">364</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 armed_robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 unarmed_robbery">490</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kelantan</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 murder">13</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 rape">114</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 aggravated_assault">252</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 armed_robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 unarmed_robbery">219</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kuala Lumpur</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 murder">37</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 rape">132</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 aggravated_assault">651</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 armed_robbery">4</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 unarmed_robbery">3,175</td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Melaka</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 murder">7</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 rape">69</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 aggravated_assault">176</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 armed_robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 unarmed_robbery">589</td>
</tr>
<tr class="even">
<td id="stub_1_8" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Negeri Sembilan</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 murder">14</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 rape">91</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 aggravated_assault">241</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 armed_robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 unarmed_robbery">536</td>
</tr>
<tr class="odd">
<td id="stub_1_9" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Pahang</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 murder">16</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 rape">163</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 aggravated_assault">188</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 armed_robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 unarmed_robbery">288</td>
</tr>
<tr class="even">
<td id="stub_1_10" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Perak</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 murder">35</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 rape">95</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 aggravated_assault">380</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 armed_robbery">4</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 unarmed_robbery">626</td>
</tr>
<tr class="odd">
<td id="stub_1_11" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Perlis</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 murder">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 rape">30</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 aggravated_assault">47</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 armed_robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 unarmed_robbery">53</td>
</tr>
<tr class="even">
<td id="stub_1_12" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Pulau Pinang</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 murder">17</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 rape">80</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 aggravated_assault">275</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 armed_robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 unarmed_robbery">706</td>
</tr>
<tr class="odd">
<td id="stub_1_13" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Selangor</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 murder">83</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 rape">321</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 aggravated_assault">1,108</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 armed_robbery">14</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 unarmed_robbery">4,944</td>
</tr>
<tr class="even">
<td id="stub_1_14" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Terengganu</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 murder">5</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 rape">64</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 aggravated_assault">130</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 armed_robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 unarmed_robbery">155</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In tables containing lots of numbers it can be difficult to see patterns. One way to help readers to understand patterns is to map the numbers to an aesthetic property such as colour that people can easily see patterns in. To do this, we can colour the cells in a column according to the value of each cell using the <code>data_color()</code> function (note the spelling of ‘color’ in this function). To use <code>data_color()</code>, we specify the columns we want to shade using the <code>columns</code> argument and the colour palette we want to use using the <code>palette</code> argument.</p>
<p>In this example, we will only colour the values in two columns, so we will pass the column names to the <code>columns</code> argument.</p>
<p>The easiest way to specify a colour palette is to use one of the built-in colour palettes that the gt package understands automatically. These use the same colour palette names we have used in previous chapters when using functions such as <code>scale_fill_distiller()</code>.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb11" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Produce table of crime counts in each Malaysian state</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="co"># Convert data to have one row per state</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="co"># Convert new column names (the former values of `crime_type`) to snake case</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb11-7"><a href="#cb11-7"></a>  <span class="co"># Choose only the columns we want to show in the table</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>  <span class="fu">select</span>(</span>
<span id="cb11-9"><a href="#cb11-9"></a>    region, state, murder, rape, aggravated_assault, armed_robbery, </span>
<span id="cb11-10"><a href="#cb11-10"></a>    unarmed_robbery</span>
<span id="cb11-11"><a href="#cb11-11"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb11-12"><a href="#cb11-12"></a>  <span class="co"># Specify the table rows should be grouped by the values of `region`</span></span>
<span id="cb11-13"><a href="#cb11-13"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span> </span>
<span id="cb11-14"><a href="#cb11-14"></a>  <span class="co"># Functions from tidyverse above and functions from gt below</span></span>
<span id="cb11-15"><a href="#cb11-15"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"state"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-16"><a href="#cb11-16"></a>  <span class="co"># Format numbers with thousand separators and no decimals</span></span>
<span id="cb11-17"><a href="#cb11-17"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">where</span>(is.numeric), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-18"><a href="#cb11-18"></a>  <span class="co"># Show distribution of values in some columns using colour</span></span>
<span id="cb11-19"><a href="#cb11-19"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> unarmed_robbery, <span class="at">palette =</span> <span class="st">"Oranges"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-20"><a href="#cb11-20"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> rape, <span class="at">palette =</span> <span class="st">"Blues"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="dxmaipqhaf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#dxmaipqhaf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#dxmaipqhaf thead, #dxmaipqhaf tbody, #dxmaipqhaf tfoot, #dxmaipqhaf tr, #dxmaipqhaf td, #dxmaipqhaf th {
  border-style: none;
}

#dxmaipqhaf p {
  margin: 0;
  padding: 0;
}

#dxmaipqhaf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dxmaipqhaf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#dxmaipqhaf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dxmaipqhaf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dxmaipqhaf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dxmaipqhaf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dxmaipqhaf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dxmaipqhaf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dxmaipqhaf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dxmaipqhaf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dxmaipqhaf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dxmaipqhaf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dxmaipqhaf .gt_spanner_row {
  border-bottom-style: hidden;
}

#dxmaipqhaf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#dxmaipqhaf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dxmaipqhaf .gt_from_md > :first-child {
  margin-top: 0;
}

#dxmaipqhaf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dxmaipqhaf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dxmaipqhaf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dxmaipqhaf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dxmaipqhaf .gt_row_group_first td {
  border-top-width: 2px;
}

#dxmaipqhaf .gt_row_group_first th {
  border-top-width: 2px;
}

#dxmaipqhaf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dxmaipqhaf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dxmaipqhaf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dxmaipqhaf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dxmaipqhaf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dxmaipqhaf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dxmaipqhaf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#dxmaipqhaf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dxmaipqhaf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dxmaipqhaf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dxmaipqhaf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dxmaipqhaf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dxmaipqhaf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dxmaipqhaf .gt_left {
  text-align: left;
}

#dxmaipqhaf .gt_center {
  text-align: center;
}

#dxmaipqhaf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dxmaipqhaf .gt_font_normal {
  font-weight: normal;
}

#dxmaipqhaf .gt_font_bold {
  font-weight: bold;
}

#dxmaipqhaf .gt_font_italic {
  font-style: italic;
}

#dxmaipqhaf .gt_super {
  font-size: 65%;
}

#dxmaipqhaf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#dxmaipqhaf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dxmaipqhaf .gt_indent_1 {
  text-indent: 5px;
}

#dxmaipqhaf .gt_indent_2 {
  text-indent: 10px;
}

#dxmaipqhaf .gt_indent_3 {
  text-indent: 15px;
}

#dxmaipqhaf .gt_indent_4 {
  text-indent: 20px;
}

#dxmaipqhaf .gt_indent_5 {
  text-indent: 25px;
}

#dxmaipqhaf .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#dxmaipqhaf div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="murder" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">murder</th>
<th id="rape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rape</th>
<th id="aggravated_assault" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">aggravated_assault</th>
<th id="armed_robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">armed_robbery</th>
<th id="unarmed_robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">unarmed_robbery</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row odd">
<td colspan="6" id="East Malaysia" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">East Malaysia</td>
</tr>
<tr class="gt_row_group_first even">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Sabah</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 murder">36</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 rape" style="background-color: #4393C6; color: #FFFFFF">211</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 aggravated_assault">230</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 armed_robbery">0</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 unarmed_robbery" style="background-color: #FFEFE0; color: #000000">284</td>
</tr>
<tr class="odd">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Sarawak</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 murder">27</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 rape" style="background-color: #90C2DE; color: #000000">150</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 aggravated_assault">368</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 armed_robbery">3</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 unarmed_robbery" style="background-color: #FFEEDE; color: #000000">328</td>
</tr>
<tr class="gt_group_heading_row even">
<td colspan="6" id="West Malaysia" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">West Malaysia</td>
</tr>
<tr class="gt_row_group_first odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Johor</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 murder">66</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 rape" style="background-color: #559ECD; color: #FFFFFF">196</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 aggravated_assault">614</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 armed_robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 unarmed_robbery" style="background-color: #FEB87C; color: #000000">1,701</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kedah</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 murder">21</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 rape" style="background-color: #B4D3E9; color: #000000">119</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 aggravated_assault">364</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 armed_robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 unarmed_robbery" style="background-color: #FEEAD6; color: #000000">490</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kelantan</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 murder">13</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 rape" style="background-color: #BAD6EB; color: #000000">114</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 aggravated_assault">252</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 armed_robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 unarmed_robbery" style="background-color: #FFF1E3; color: #000000">219</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kuala Lumpur</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 murder">37</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 rape" style="background-color: #A6CDE4; color: #000000">132</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 aggravated_assault">651</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 armed_robbery">4</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 unarmed_robbery" style="background-color: #EE6611; color: #FFFFFF">3,175</td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Melaka</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 murder">7</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 rape" style="background-color: #DCEAF6; color: #000000">69</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 aggravated_assault">176</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 armed_robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 unarmed_robbery" style="background-color: #FEE8D2; color: #000000">589</td>
</tr>
<tr class="even">
<td id="stub_1_8" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Negeri Sembilan</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 murder">14</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 rape" style="background-color: #CEE0F2; color: #000000">91</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 aggravated_assault">241</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 armed_robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 unarmed_robbery" style="background-color: #FEE9D4; color: #000000">536</td>
</tr>
<tr class="odd">
<td id="stub_1_9" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Pahang</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 murder">16</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 rape" style="background-color: #7EB8DA; color: #000000">163</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 aggravated_assault">188</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 armed_robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 unarmed_robbery" style="background-color: #FFEFE0; color: #000000">288</td>
</tr>
<tr class="even">
<td id="stub_1_10" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Perak</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 murder">35</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 rape" style="background-color: #CBDEF1; color: #000000">95</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 aggravated_assault">380</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 armed_robbery">4</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 unarmed_robbery" style="background-color: #FEE7D0; color: #000000">626</td>
</tr>
<tr class="odd">
<td id="stub_1_11" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Perlis</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 murder">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 rape" style="background-color: #F7FBFF; color: #000000">30</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 aggravated_assault">47</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 armed_robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 unarmed_robbery" style="background-color: #FFF5EB; color: #000000">53</td>
</tr>
<tr class="even">
<td id="stub_1_12" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Pulau Pinang</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 murder">17</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 rape" style="background-color: #D5E5F4; color: #000000">80</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 aggravated_assault">275</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 armed_robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 unarmed_robbery" style="background-color: #FEE4CB; color: #000000">706</td>
</tr>
<tr class="odd">
<td id="stub_1_13" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Selangor</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 murder">83</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 rape" style="background-color: #08306B; color: #FFFFFF">321</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 aggravated_assault">1,108</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 armed_robbery">14</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 unarmed_robbery" style="background-color: #7F2704; color: #FFFFFF">4,944</td>
</tr>
<tr class="even">
<td id="stub_1_14" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Terengganu</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 murder">5</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 rape" style="background-color: #E0ECF8; color: #000000">64</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 aggravated_assault">130</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 armed_robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 unarmed_robbery" style="background-color: #FFF2E6; color: #000000">155</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Avoid using the same colour across multiple columns
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this table we use two different colours to show the patterns in the frequency of murder and unarmed robbery. This is because we want readers to remember that different types of crime are <em>different</em> and so comparisons that treat crimes as being equivalent to one another are likely to be flawed. If we used the same colour across columns, readers might end up seeing that the shade used for unarmed robberies in Kuala Lumpur was darker than the shade showing the number of murders and conclude that unarmed robberies were a bigger problem than murders. This would be a potentially false conclusion because a single murder and a single unarmed robbery are not the same in terms of their seriousness.</p>
<p>For the same reason the table does not include a column showing the total number of crimes in each state – when we total all types of crime together, we are implicitly assuming that all types of crime are the same when that is obviously untrue.</p>
</div>
</div>
</section>
<section id="changing-column-names" class="level3" data-number="15.2.3">
<h3 data-number="15.2.3" class="anchored" data-anchor-id="changing-column-names"><span class="header-section-number">15.2.3</span> Changing column names</h3>
<p>Now that we have formatted the data, we can move onto changing the column labels. At the moment these are taken from the column names in the data, which means we have column labels such as <code>aggravated_assault</code>. Underscore characters (<code>_</code>) aren’t standard in English text, so we can should change the labels to remove them. We can do this by adding the <code>cols_label()</code> function to the <code>gt()</code> stack. As well as removing the underscores, we can also use <code>cols_label()</code> to abbreviate labels or split them over multiple lines so that the column labels don’t force the columns to be wider than necessary.</p>
<p>We can use the <code>md()</code> helper function to use Markdown formatting to control the appearance of the labels. As well as using markup such as asterisks to create <code>**strongly emphasised text**</code> we can also use HTML markup to add more-advanced formatting. For example, we can use the code <code>&lt;br&gt;</code> to insert a line break to split labels over multiple lines.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Produce table of crime counts in each Malaysian state</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="co"># Convert data to have one row per state</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="co"># Convert new column names (the former values of `crime_type`) to snake case</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb12-7"><a href="#cb12-7"></a>  <span class="co"># Choose only the columns we want to show in the table</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>  <span class="fu">select</span>(</span>
<span id="cb12-9"><a href="#cb12-9"></a>    region, state, murder, rape, aggravated_assault, armed_robbery, </span>
<span id="cb12-10"><a href="#cb12-10"></a>    unarmed_robbery</span>
<span id="cb12-11"><a href="#cb12-11"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb12-12"><a href="#cb12-12"></a>  <span class="co"># Specify the table rows should be grouped by the values of `region`</span></span>
<span id="cb12-13"><a href="#cb12-13"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span> </span>
<span id="cb12-14"><a href="#cb12-14"></a>  <span class="co"># Functions from tidyverse above and functions from gt below</span></span>
<span id="cb12-15"><a href="#cb12-15"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"state"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-16"><a href="#cb12-16"></a>  <span class="co"># Format numbers with thousand separators and no decimals</span></span>
<span id="cb12-17"><a href="#cb12-17"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">where</span>(is.numeric), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-18"><a href="#cb12-18"></a>  <span class="co"># Show distribution of values in some columns using colour</span></span>
<span id="cb12-19"><a href="#cb12-19"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> unarmed_robbery, <span class="at">palette =</span> <span class="st">"Oranges"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-20"><a href="#cb12-20"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> rape, <span class="at">palette =</span> <span class="st">"Blues"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-21"><a href="#cb12-21"></a>  <span class="co"># Add column labels</span></span>
<span id="cb12-22"><a href="#cb12-22"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb12-23"><a href="#cb12-23"></a>    <span class="st">"aggravated_assault"</span> <span class="sc">~</span> <span class="st">"agg. assault"</span>,</span>
<span id="cb12-24"><a href="#cb12-24"></a>    <span class="st">"armed_robbery"</span> <span class="sc">~</span> <span class="fu">md</span>(<span class="st">"robbery&lt;br&gt;(armed)"</span>),</span>
<span id="cb12-25"><a href="#cb12-25"></a>    <span class="st">"unarmed_robbery"</span> <span class="sc">~</span> <span class="fu">md</span>(<span class="st">"robbery&lt;br&gt;(unarmed)"</span>)</span>
<span id="cb12-26"><a href="#cb12-26"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fymmlhjywj" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#fymmlhjywj table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#fymmlhjywj thead, #fymmlhjywj tbody, #fymmlhjywj tfoot, #fymmlhjywj tr, #fymmlhjywj td, #fymmlhjywj th {
  border-style: none;
}

#fymmlhjywj p {
  margin: 0;
  padding: 0;
}

#fymmlhjywj .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fymmlhjywj .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#fymmlhjywj .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fymmlhjywj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fymmlhjywj .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fymmlhjywj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fymmlhjywj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fymmlhjywj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fymmlhjywj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fymmlhjywj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fymmlhjywj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fymmlhjywj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fymmlhjywj .gt_spanner_row {
  border-bottom-style: hidden;
}

#fymmlhjywj .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#fymmlhjywj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fymmlhjywj .gt_from_md > :first-child {
  margin-top: 0;
}

#fymmlhjywj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fymmlhjywj .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fymmlhjywj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#fymmlhjywj .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#fymmlhjywj .gt_row_group_first td {
  border-top-width: 2px;
}

#fymmlhjywj .gt_row_group_first th {
  border-top-width: 2px;
}

#fymmlhjywj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fymmlhjywj .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#fymmlhjywj .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#fymmlhjywj .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fymmlhjywj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fymmlhjywj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fymmlhjywj .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#fymmlhjywj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fymmlhjywj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fymmlhjywj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fymmlhjywj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fymmlhjywj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fymmlhjywj .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fymmlhjywj .gt_left {
  text-align: left;
}

#fymmlhjywj .gt_center {
  text-align: center;
}

#fymmlhjywj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fymmlhjywj .gt_font_normal {
  font-weight: normal;
}

#fymmlhjywj .gt_font_bold {
  font-weight: bold;
}

#fymmlhjywj .gt_font_italic {
  font-style: italic;
}

#fymmlhjywj .gt_super {
  font-size: 65%;
}

#fymmlhjywj .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#fymmlhjywj .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#fymmlhjywj .gt_indent_1 {
  text-indent: 5px;
}

#fymmlhjywj .gt_indent_2 {
  text-indent: 10px;
}

#fymmlhjywj .gt_indent_3 {
  text-indent: 15px;
}

#fymmlhjywj .gt_indent_4 {
  text-indent: 20px;
}

#fymmlhjywj .gt_indent_5 {
  text-indent: 25px;
}

#fymmlhjywj .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#fymmlhjywj div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="murder" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">murder</th>
<th id="rape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rape</th>
<th id="aggravated_assault" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">agg. assault</th>
<th id="armed_robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">robbery<br>(armed)</th>
<th id="unarmed_robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">robbery<br>(unarmed)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row odd">
<td colspan="6" id="East Malaysia" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">East Malaysia</td>
</tr>
<tr class="gt_row_group_first even">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Sabah</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 murder">36</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 rape" style="background-color: #4393C6; color: #FFFFFF">211</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 aggravated_assault">230</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 armed_robbery">0</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 unarmed_robbery" style="background-color: #FFEFE0; color: #000000">284</td>
</tr>
<tr class="odd">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Sarawak</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 murder">27</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 rape" style="background-color: #90C2DE; color: #000000">150</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 aggravated_assault">368</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 armed_robbery">3</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 unarmed_robbery" style="background-color: #FFEEDE; color: #000000">328</td>
</tr>
<tr class="gt_group_heading_row even">
<td colspan="6" id="West Malaysia" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">West Malaysia</td>
</tr>
<tr class="gt_row_group_first odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Johor</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 murder">66</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 rape" style="background-color: #559ECD; color: #FFFFFF">196</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 aggravated_assault">614</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 armed_robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 unarmed_robbery" style="background-color: #FEB87C; color: #000000">1,701</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kedah</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 murder">21</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 rape" style="background-color: #B4D3E9; color: #000000">119</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 aggravated_assault">364</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 armed_robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 unarmed_robbery" style="background-color: #FEEAD6; color: #000000">490</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kelantan</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 murder">13</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 rape" style="background-color: #BAD6EB; color: #000000">114</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 aggravated_assault">252</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 armed_robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 unarmed_robbery" style="background-color: #FFF1E3; color: #000000">219</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kuala Lumpur</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 murder">37</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 rape" style="background-color: #A6CDE4; color: #000000">132</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 aggravated_assault">651</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 armed_robbery">4</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 unarmed_robbery" style="background-color: #EE6611; color: #FFFFFF">3,175</td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Melaka</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 murder">7</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 rape" style="background-color: #DCEAF6; color: #000000">69</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 aggravated_assault">176</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 armed_robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 unarmed_robbery" style="background-color: #FEE8D2; color: #000000">589</td>
</tr>
<tr class="even">
<td id="stub_1_8" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Negeri Sembilan</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 murder">14</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 rape" style="background-color: #CEE0F2; color: #000000">91</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 aggravated_assault">241</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 armed_robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 unarmed_robbery" style="background-color: #FEE9D4; color: #000000">536</td>
</tr>
<tr class="odd">
<td id="stub_1_9" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Pahang</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 murder">16</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 rape" style="background-color: #7EB8DA; color: #000000">163</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 aggravated_assault">188</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 armed_robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 unarmed_robbery" style="background-color: #FFEFE0; color: #000000">288</td>
</tr>
<tr class="even">
<td id="stub_1_10" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Perak</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 murder">35</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 rape" style="background-color: #CBDEF1; color: #000000">95</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 aggravated_assault">380</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 armed_robbery">4</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 unarmed_robbery" style="background-color: #FEE7D0; color: #000000">626</td>
</tr>
<tr class="odd">
<td id="stub_1_11" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Perlis</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 murder">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 rape" style="background-color: #F7FBFF; color: #000000">30</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 aggravated_assault">47</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 armed_robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 unarmed_robbery" style="background-color: #FFF5EB; color: #000000">53</td>
</tr>
<tr class="even">
<td id="stub_1_12" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Pulau Pinang</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 murder">17</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 rape" style="background-color: #D5E5F4; color: #000000">80</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 aggravated_assault">275</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 armed_robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 unarmed_robbery" style="background-color: #FEE4CB; color: #000000">706</td>
</tr>
<tr class="odd">
<td id="stub_1_13" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Selangor</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 murder">83</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 rape" style="background-color: #08306B; color: #FFFFFF">321</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 aggravated_assault">1,108</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 armed_robbery">14</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 unarmed_robbery" style="background-color: #7F2704; color: #FFFFFF">4,944</td>
</tr>
<tr class="even">
<td id="stub_1_14" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Terengganu</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 murder">5</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 rape" style="background-color: #E0ECF8; color: #000000">64</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 aggravated_assault">130</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 armed_robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 unarmed_robbery" style="background-color: #FFF2E6; color: #000000">155</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="adding-summary-rows" class="level3" data-number="15.2.4">
<h3 data-number="15.2.4" class="anchored" data-anchor-id="adding-summary-rows"><span class="header-section-number">15.2.4</span> Adding summary rows</h3>
<p>The final thing we will add to this table is a summary row containing the total number of each type of crime across all the states and territories. We do this using the <code>summary_rows()</code> function from gt. We specify the columns we want to summarise using the <code>columns</code> argument as we did for <code>fmt_number()</code>.</p>
<p>Summary rows can be produced using lots of different R functions. For example, we could use the <code>mean()</code> function to produce a summary row showing the mean (average) number of crimes of each time across the states. In this case, we want to know the total number of each type of crime across all states, so we will use the <code>sum()</code> function. To specify this, we pass the <code>fns</code> argument to <code>summary_rows()</code>. The <code>fns</code> argument has two parts, separated by a tilde (<code>~</code>). On the left-hand side we specify the label we want the summary row to have, and on the right-hand side we specify the function we want to use to calculate the summary. In this case, we can specify <code>fns = "regional total" ~ sum(.)</code> to say we want the summary row to have the label ‘total’ and that we want to summarise the rows using the <code>sum()</code> function. The <code>.</code> in the code <code>fns = "regional total" ~ sum(.)</code> is a place-holder that represent the data we want to summarise.</p>
<p>As well as summarising the data in each column, we want to specify how the summary values should be formatted. To do that, we use the <code>fmt</code> argument of <code>summary_rows()</code>. This is also a two-sided (‘formula’) argument, with the two sides separated by a <code>~</code>. On the left-hand side we specify which summary values we want to format. In this case we want all the summary values to be formatted as numbers, so we can use the <code>everything()</code> helper function. On the right-hand side we use a call to one of the <code>fmt_*()</code> family of functions we used earlier: in this case, we use <code>fmt_number()</code>. Looking at the code below, you’ll notice that the code <code>fmt = everything() ~ fmt_number(., decimals = 0)</code> again uses the <code>.</code> place-holder to specify that we want to format the summary value produced by <code>sum()</code>.</p>
<p>The <code>summary_rows()</code> function produces a summary for each group of rows (in the case of this table, one summary for each region). As well as having a regional total, it would also be useful to have a total for all the groups together (i.e.&nbsp;for the whole country of Malaysia). To do that, we add the <code>grand_summary_rows()</code> function to our <code>gt()</code> stack, using the same arguments as for the <code>summary_rows()</code> function.</p>
<p>Paste this code into the <code>chapter15a.R</code> file and run it.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter15a.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb13" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Produce table of crime counts in each Malaysian state</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="co"># Convert data to have one row per state</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="co"># Convert new column names (the former values of `crime_type`) to snake case</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb13-7"><a href="#cb13-7"></a>  <span class="co"># Choose only the columns we want to show in the table</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>  <span class="fu">select</span>(</span>
<span id="cb13-9"><a href="#cb13-9"></a>    region, state, murder, rape, aggravated_assault, armed_robbery, </span>
<span id="cb13-10"><a href="#cb13-10"></a>    unarmed_robbery</span>
<span id="cb13-11"><a href="#cb13-11"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb13-12"><a href="#cb13-12"></a>  <span class="co"># Specify the table rows should be grouped by the values of `region`</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span> </span>
<span id="cb13-14"><a href="#cb13-14"></a>  <span class="co"># Functions from tidyverse above and functions from gt below</span></span>
<span id="cb13-15"><a href="#cb13-15"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"state"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-16"><a href="#cb13-16"></a>  <span class="co"># Format numbers with thousand separators and no decimals</span></span>
<span id="cb13-17"><a href="#cb13-17"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">where</span>(is.numeric), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-18"><a href="#cb13-18"></a>  <span class="co"># Show distribution of values in some columns using colour</span></span>
<span id="cb13-19"><a href="#cb13-19"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> unarmed_robbery, <span class="at">palette =</span> <span class="st">"Oranges"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-20"><a href="#cb13-20"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> rape, <span class="at">palette =</span> <span class="st">"Blues"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-21"><a href="#cb13-21"></a>  <span class="co"># Add column labels</span></span>
<span id="cb13-22"><a href="#cb13-22"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb13-23"><a href="#cb13-23"></a>    <span class="st">"aggravated_assault"</span> <span class="sc">~</span> <span class="st">"agg. assault"</span>,</span>
<span id="cb13-24"><a href="#cb13-24"></a>    <span class="st">"armed_robbery"</span> <span class="sc">~</span> <span class="fu">md</span>(<span class="st">"robbery&lt;br&gt;(armed)"</span>),</span>
<span id="cb13-25"><a href="#cb13-25"></a>    <span class="st">"unarmed_robbery"</span> <span class="sc">~</span> <span class="fu">md</span>(<span class="st">"robbery&lt;br&gt;(unarmed)"</span>)</span>
<span id="cb13-26"><a href="#cb13-26"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb13-27"><a href="#cb13-27"></a>  <span class="co"># Add a summary row showing the total number of crimes in each region</span></span>
<span id="cb13-28"><a href="#cb13-28"></a>  <span class="fu">summary_rows</span>(</span>
<span id="cb13-29"><a href="#cb13-29"></a>    <span class="at">columns =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb13-30"><a href="#cb13-30"></a>    <span class="at">fns =</span> <span class="st">"regional total"</span> <span class="sc">~</span> <span class="fu">sum</span>(.),</span>
<span id="cb13-31"><a href="#cb13-31"></a>    <span class="at">fmt =</span> <span class="fu">everything</span>() <span class="sc">~</span> <span class="fu">fmt_number</span>(., <span class="at">decimals =</span> <span class="dv">0</span>)</span>
<span id="cb13-32"><a href="#cb13-32"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb13-33"><a href="#cb13-33"></a>  <span class="co"># Add a summary row showing the total number of crimes in Malaysia</span></span>
<span id="cb13-34"><a href="#cb13-34"></a>  <span class="fu">grand_summary_rows</span>(</span>
<span id="cb13-35"><a href="#cb13-35"></a>    <span class="at">columns =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb13-36"><a href="#cb13-36"></a>    <span class="at">fns =</span> <span class="st">"national total"</span> <span class="sc">~</span> <span class="fu">sum</span>(.),</span>
<span id="cb13-37"><a href="#cb13-37"></a>    <span class="at">fmt =</span> <span class="fu">everything</span>() <span class="sc">~</span> <span class="fu">fmt_number</span>(., <span class="at">decimals =</span> <span class="dv">0</span>)</span>
<span id="cb13-38"><a href="#cb13-38"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="wsqcwnqlcy" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wsqcwnqlcy table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wsqcwnqlcy thead, #wsqcwnqlcy tbody, #wsqcwnqlcy tfoot, #wsqcwnqlcy tr, #wsqcwnqlcy td, #wsqcwnqlcy th {
  border-style: none;
}

#wsqcwnqlcy p {
  margin: 0;
  padding: 0;
}

#wsqcwnqlcy .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wsqcwnqlcy .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wsqcwnqlcy .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wsqcwnqlcy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wsqcwnqlcy .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wsqcwnqlcy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wsqcwnqlcy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wsqcwnqlcy .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wsqcwnqlcy .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wsqcwnqlcy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wsqcwnqlcy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wsqcwnqlcy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wsqcwnqlcy .gt_spanner_row {
  border-bottom-style: hidden;
}

#wsqcwnqlcy .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wsqcwnqlcy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wsqcwnqlcy .gt_from_md > :first-child {
  margin-top: 0;
}

#wsqcwnqlcy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wsqcwnqlcy .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wsqcwnqlcy .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wsqcwnqlcy .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wsqcwnqlcy .gt_row_group_first td {
  border-top-width: 2px;
}

#wsqcwnqlcy .gt_row_group_first th {
  border-top-width: 2px;
}

#wsqcwnqlcy .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wsqcwnqlcy .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wsqcwnqlcy .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wsqcwnqlcy .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wsqcwnqlcy .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wsqcwnqlcy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wsqcwnqlcy .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wsqcwnqlcy .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wsqcwnqlcy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wsqcwnqlcy .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wsqcwnqlcy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wsqcwnqlcy .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wsqcwnqlcy .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wsqcwnqlcy .gt_left {
  text-align: left;
}

#wsqcwnqlcy .gt_center {
  text-align: center;
}

#wsqcwnqlcy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wsqcwnqlcy .gt_font_normal {
  font-weight: normal;
}

#wsqcwnqlcy .gt_font_bold {
  font-weight: bold;
}

#wsqcwnqlcy .gt_font_italic {
  font-style: italic;
}

#wsqcwnqlcy .gt_super {
  font-size: 65%;
}

#wsqcwnqlcy .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wsqcwnqlcy .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wsqcwnqlcy .gt_indent_1 {
  text-indent: 5px;
}

#wsqcwnqlcy .gt_indent_2 {
  text-indent: 10px;
}

#wsqcwnqlcy .gt_indent_3 {
  text-indent: 15px;
}

#wsqcwnqlcy .gt_indent_4 {
  text-indent: 20px;
}

#wsqcwnqlcy .gt_indent_5 {
  text-indent: 25px;
}

#wsqcwnqlcy .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#wsqcwnqlcy div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="murder" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">murder</th>
<th id="rape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rape</th>
<th id="aggravated_assault" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">agg. assault</th>
<th id="armed_robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">robbery<br>(armed)</th>
<th id="unarmed_robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">robbery<br>(unarmed)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row odd">
<td colspan="6" id="East Malaysia" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">East Malaysia</td>
</tr>
<tr class="gt_row_group_first even">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Sabah</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 murder">36</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 rape" style="background-color: #4393C6; color: #FFFFFF">211</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 aggravated_assault">230</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 armed_robbery">0</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 unarmed_robbery" style="background-color: #FFEFE0; color: #000000">284</td>
</tr>
<tr class="odd">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Sarawak</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 murder">27</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 rape" style="background-color: #90C2DE; color: #000000">150</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 aggravated_assault">368</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 armed_robbery">3</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 unarmed_robbery" style="background-color: #FFEEDE; color: #000000">328</td>
</tr>
<tr class="even">
<td id="summary_stub_East Malaysia_1" class="gt_row gt_left gt_stub gt_summary_row gt_first_summary_row thick gt_last_summary_row" data-quarto-table-cell-role="th" scope="row">regional total</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="East Malaysia summary_stub_East Malaysia_1 murder">63</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="East Malaysia summary_stub_East Malaysia_1 rape">361</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="East Malaysia summary_stub_East Malaysia_1 aggravated_assault">598</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="East Malaysia summary_stub_East Malaysia_1 armed_robbery">3</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="East Malaysia summary_stub_East Malaysia_1 unarmed_robbery">612</td>
</tr>
<tr class="gt_group_heading_row odd">
<td colspan="6" id="West Malaysia" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">West Malaysia</td>
</tr>
<tr class="gt_row_group_first even">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Johor</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 murder">66</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 rape" style="background-color: #559ECD; color: #FFFFFF">196</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 aggravated_assault">614</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 armed_robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 unarmed_robbery" style="background-color: #FEB87C; color: #000000">1,701</td>
</tr>
<tr class="odd">
<td id="stub_1_4" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kedah</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 murder">21</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 rape" style="background-color: #B4D3E9; color: #000000">119</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 aggravated_assault">364</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 armed_robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 unarmed_robbery" style="background-color: #FEEAD6; color: #000000">490</td>
</tr>
<tr class="even">
<td id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kelantan</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 murder">13</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 rape" style="background-color: #BAD6EB; color: #000000">114</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 aggravated_assault">252</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 armed_robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 unarmed_robbery" style="background-color: #FFF1E3; color: #000000">219</td>
</tr>
<tr class="odd">
<td id="stub_1_6" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kuala Lumpur</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 murder">37</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 rape" style="background-color: #A6CDE4; color: #000000">132</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 aggravated_assault">651</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 armed_robbery">4</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 unarmed_robbery" style="background-color: #EE6611; color: #FFFFFF">3,175</td>
</tr>
<tr class="even">
<td id="stub_1_7" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Melaka</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 murder">7</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 rape" style="background-color: #DCEAF6; color: #000000">69</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 aggravated_assault">176</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 armed_robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 unarmed_robbery" style="background-color: #FEE8D2; color: #000000">589</td>
</tr>
<tr class="odd">
<td id="stub_1_8" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Negeri Sembilan</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 murder">14</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 rape" style="background-color: #CEE0F2; color: #000000">91</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 aggravated_assault">241</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 armed_robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 unarmed_robbery" style="background-color: #FEE9D4; color: #000000">536</td>
</tr>
<tr class="even">
<td id="stub_1_9" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Pahang</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 murder">16</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 rape" style="background-color: #7EB8DA; color: #000000">163</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 aggravated_assault">188</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 armed_robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 unarmed_robbery" style="background-color: #FFEFE0; color: #000000">288</td>
</tr>
<tr class="odd">
<td id="stub_1_10" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Perak</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 murder">35</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 rape" style="background-color: #CBDEF1; color: #000000">95</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 aggravated_assault">380</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 armed_robbery">4</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 unarmed_robbery" style="background-color: #FEE7D0; color: #000000">626</td>
</tr>
<tr class="even">
<td id="stub_1_11" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Perlis</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 murder">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 rape" style="background-color: #F7FBFF; color: #000000">30</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 aggravated_assault">47</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 armed_robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 unarmed_robbery" style="background-color: #FFF5EB; color: #000000">53</td>
</tr>
<tr class="odd">
<td id="stub_1_12" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Pulau Pinang</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 murder">17</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 rape" style="background-color: #D5E5F4; color: #000000">80</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 aggravated_assault">275</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 armed_robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 unarmed_robbery" style="background-color: #FEE4CB; color: #000000">706</td>
</tr>
<tr class="even">
<td id="stub_1_13" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Selangor</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 murder">83</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 rape" style="background-color: #08306B; color: #FFFFFF">321</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 aggravated_assault">1,108</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 armed_robbery">14</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 unarmed_robbery" style="background-color: #7F2704; color: #FFFFFF">4,944</td>
</tr>
<tr class="odd">
<td id="stub_1_14" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Terengganu</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 murder">5</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 rape" style="background-color: #E0ECF8; color: #000000">64</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 aggravated_assault">130</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 armed_robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 unarmed_robbery" style="background-color: #FFF2E6; color: #000000">155</td>
</tr>
<tr class="even">
<td id="summary_stub_West Malaysia_1" class="gt_row gt_left gt_stub gt_summary_row gt_first_summary_row thick gt_last_summary_row" data-quarto-table-cell-role="th" scope="row">regional total</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="West Malaysia summary_stub_West Malaysia_1 murder">316</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="West Malaysia summary_stub_West Malaysia_1 rape">1,474</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="West Malaysia summary_stub_West Malaysia_1 aggravated_assault">4,426</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="West Malaysia summary_stub_West Malaysia_1 armed_robbery">31</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="West Malaysia summary_stub_West Malaysia_1 unarmed_robbery">13,482</td>
</tr>
<tr class="odd">
<td id="grand_summary_stub_1" class="gt_row gt_left gt_stub gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" data-quarto-table-cell-role="th" scope="row">national total</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_1 murder">379</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_1 rape">1,835</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_1 aggravated_assault">5,024</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_1 armed_robbery">34</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_1 unarmed_robbery">14,094</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tables are not good at showing patterns
</div>
</div>
<div class="callout-body-container callout-body">
<p>Tables are good for showing detailed information, particularly when we want to present multiple pieces of information about a single place. But it can be hard to spot patterns in tables even with coloured cells. For this reason, <strong>do not use tables when you are primarily trying to show the relationship between two or more variables</strong>. In the next section, we will learn to create bar chart in R to show patterns more effectively.</p>
</div>
</div>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tables
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>In which of these circumstances is a table typically more effective than a map?</strong></p>
<div id="radio_YMKEPWQNDP" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_YMKEPWQNDP" value="answer"> <span>When communicating multiple values about each area</span></label><label><input type="radio" autocomplete="off" name="radio_YMKEPWQNDP" value=""> <span>When displaying detailed spatial relationships</span></label><label><input type="radio" autocomplete="off" name="radio_YMKEPWQNDP" value=""> <span>When visualizing trends over time</span></label><label><input type="radio" autocomplete="off" name="radio_YMKEPWQNDP" value=""> <span>When analyzing spatial clusters</span></label>
</div>
<p><strong>Why is it often preferable to present summary data in a wide format?</strong></p>
<div id="radio_LXERDUKCIT" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_LXERDUKCIT" value=""> <span>It makes the data easier to analyze using statistical models</span></label><label><input type="radio" autocomplete="off" name="radio_LXERDUKCIT" value="answer"> <span>It allows for easier comparisons across categories in a table</span></label><label><input type="radio" autocomplete="off" name="radio_LXERDUKCIT" value=""> <span>It is the default format for spatial data in R</span></label><label><input type="radio" autocomplete="off" name="radio_LXERDUKCIT" value=""> <span>It makes maps easier to interpret</span></label>
</div>
<p><strong>Which function is used in R to convert long-format data into wide-format data?</strong></p>
<div id="radio_ZDAABNBZNE" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_ZDAABNBZNE" value=""> <span><code>pivot_longer()</code></span></label><label><input type="radio" autocomplete="off" name="radio_ZDAABNBZNE" value=""> <span><code>spread()</code></span></label><label><input type="radio" autocomplete="off" name="radio_ZDAABNBZNE" value="answer"> <span><code>pivot_wider()</code></span></label><label><input type="radio" autocomplete="off" name="radio_ZDAABNBZNE" value=""> <span><code>gather()</code></span></label>
</div>
</div>
</div>
</section>
</section>
<section id="bar-charts" class="level2" data-number="15.3">
<h2 data-number="15.3" class="anchored" data-anchor-id="bar-charts"><span class="header-section-number">15.3</span> Bar charts</h2>
<p>Bar charts are useful for showing values of one <em>continuous</em> variable (e.g.&nbsp;a count of crimes) for each value of one <em>categorical</em> variable (e.g.&nbsp;states of a country). Bar charts are very common, but there are several things we can do to make them more useful. In this section we will learn how to construct a good bar chart.</p>
<p>You’re already an expert at making maps using functions from the ggplot2 package. We can use these same functions to create many other types of graphics. For example, we can use <code>geom_bar()</code> to create bar charts just as we use <code>geom_sf()</code> to create a map using data stored in an SF object.</p>
<p><code>geom_bar()</code> calculates the length of each bar on a chart by counting the number of rows of data in each category. This isn’t what we want to do to visualise the <code>violence</code> object, since the data provided by the Royal Malaysian Police are already in the form of counts of crimes. Instead, we will use the <code>geom_col()</code> function, which creates bar charts from this type of summary data.</p>
<p>To create a simple bar chart, we will work with the original (long-format) data and filter it to show only the number of murders in each state.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Create bar chart of murder counts</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="co"># Keep only rows representing murder counts</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">filter</span>(crime_type <span class="sc">==</span> <span class="st">"murder"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="co"># Translate columns in the data to aesthetics on the chart</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>  <span class="fu">aes</span>(<span class="at">x =</span> state, <span class="at">y =</span> count) <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>  <span class="co"># Add bars</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>  <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>You might notice that this code uses the <code>aes()</code> function differently to what we’ve seen in previous chapters. As we learned in <a href="../06_mapping_crime_patterns/index.html" class="quarto-xref"><span>Chapter 6</span></a>, <code>aes()</code> is used to specify which aspects of a map or chart should be controlled by the values of particular columns in a dataset. When we use <code>aes()</code> inside a <code>geom_*()</code> function (as we have done with <code>geom_sf()</code> in previous chapters), the <em>mapping</em> between columns in a dataset and aspects of the map or chart appearance applies only to that layer. In a map, that is usually what we want because there is typically only one layer (e.g.&nbsp;a layer showing the density of crime) that represents values in a dataset. But we can also use <code>aes()</code> <em>outside</em> a <code>geom_*()</code> function by adding it to the stack directly after the call to <code>ggplot()</code> itself. In that case, the mapping between data and chart will apply to all the layers on the chart.</p>
<p>We can improve this basic chart in several ways:</p>
<ul>
<li>We can switch the order of the variables used for the <code>x</code> and <code>y</code> aesthetics so that the bars are horizontal rather than vertical, which will stop the state names from overlapping. It is almost always better for bar charts to use horizontal bars rather than vertical bars, to avoid overlapping labels.</li>
<li>We can use <code>labs()</code> to add a title and caption, as well as controlling the <code>x</code> and <code>y</code> axis titles on the chart. In the code below, we set <code>y = NULL</code> to remove the title for the vertical axis, since a title is unnecessary when it is obvious from the context what the values on that axis represent (Malaysian states).</li>
<li>We can reduce the visual clutter in the chart using <code>theme_minimal()</code>. While <code>theme_void()</code> is generally the best ggplot2 theme for maps, for charts it’s almost always best to use <code>theme_minimal()</code>.</li>
</ul>
<div class="cell" data-exercise="true">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb15" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Create bar chart of murder counts</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="co"># Keep only rows representing murder counts</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="fu">filter</span>(crime_type <span class="sc">==</span> <span class="st">"murder"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>  <span class="co"># Translate columns in the data to aesthetics on the chart</span></span>
<span id="cb15-7"><a href="#cb15-7"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> state) <span class="sc">+</span></span>
<span id="cb15-8"><a href="#cb15-8"></a>  <span class="co"># Add bars</span></span>
<span id="cb15-9"><a href="#cb15-9"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10"></a>  <span class="co"># Add labels</span></span>
<span id="cb15-11"><a href="#cb15-11"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-12"><a href="#cb15-12"></a>    <span class="at">title =</span> <span class="st">"Murders in Malaysian states, 2017"</span>,</span>
<span id="cb15-13"><a href="#cb15-13"></a>    <span class="at">caption =</span> <span class="st">"Data from the Royal Malaysian Police"</span>,</span>
<span id="cb15-14"><a href="#cb15-14"></a>    <span class="at">x =</span> <span class="st">"number of murders"</span>,</span>
<span id="cb15-15"><a href="#cb15-15"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb15-16"><a href="#cb15-16"></a>  ) <span class="sc">+</span></span>
<span id="cb15-17"><a href="#cb15-17"></a>  <span class="co"># Remove unnecessary map elements</span></span>
<span id="cb15-18"><a href="#cb15-18"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/bars-exercise2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This chart is better, but we can improve it further. For example, we can reduce the space between the state names and the bars by setting the <code>expand</code> argument to the <code>scale_x_continuous()</code> function. <code>scale_x_continuous()</code> works in a similar way to the other scale functions we have used already, such as using <code>scale_fill_brewer()</code> to control the colour of areas in a choropleth map.</p>
<p>Although we are trying to reduce the gap between the bars and labels on the <em>y</em> axis, we use a function that change the <em>x</em> axis. This is because the space we are reducing is created by R by-default adding some space to each end of any continuous axis, such as the count of murders.</p>
<p>We can specify the space at the end of each axis using the helper function <code>expansion()</code>. In this case we just want to remove the space completely, so we can set <code>expand = expansion(0)</code>.</p>
<p>At the same time, we can also remove the grid lines on the <em>y</em> axis (i.e.&nbsp;those running along the length of the bars) since they don’t really make it any easier to understand the chart. As a general principle, we want to remove anything on a chart that does not contribute to communicating information, since unnecessary chart elements can distract readers from understanding the data.</p>
<p>We can remove the grid lines by setting the <code>panel.grid.major.y</code> and <code>panel.grid.minor.y</code> arguments to the <code>theme()</code> function. The value we want to use is the helper function <code>element_blank()</code>, which sets the grid lines to be blank.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb16" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Create bar chart of murder counts</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="co"># Keep only rows representing murder counts</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">filter</span>(crime_type <span class="sc">==</span> <span class="st">"murder"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>  <span class="co"># Translate columns in the data to aesthetics on the chart</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> state) <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8"></a>  <span class="co"># Add bars</span></span>
<span id="cb16-9"><a href="#cb16-9"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10"></a>  <span class="co"># Remove space at either end of horizontal axis</span></span>
<span id="cb16-11"><a href="#cb16-11"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12"></a>  <span class="co"># Add labels</span></span>
<span id="cb16-13"><a href="#cb16-13"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-14"><a href="#cb16-14"></a>    <span class="at">title =</span> <span class="st">"Murders in Malaysian states, 2017"</span>,</span>
<span id="cb16-15"><a href="#cb16-15"></a>    <span class="at">caption =</span> <span class="st">"Data from the Royal Malaysian Police"</span>,</span>
<span id="cb16-16"><a href="#cb16-16"></a>    <span class="at">x =</span> <span class="st">"number of murders"</span>,</span>
<span id="cb16-17"><a href="#cb16-17"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb16-18"><a href="#cb16-18"></a>  ) <span class="sc">+</span></span>
<span id="cb16-19"><a href="#cb16-19"></a>  <span class="co"># Remove unnecessary map elements</span></span>
<span id="cb16-20"><a href="#cb16-20"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-21"><a href="#cb16-21"></a>  <span class="co"># Remove unnecessary horizontal grid lines</span></span>
<span id="cb16-22"><a href="#cb16-22"></a>  <span class="fu">theme</span>(</span>
<span id="cb16-23"><a href="#cb16-23"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-24"><a href="#cb16-24"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb16-25"><a href="#cb16-25"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Bars on a bar chart should always start at zero
</div>
</div>
<div class="callout-body-container callout-body">
<p>One of the reasons why bar charts are easy to interpret is that the <em>length</em> of each bar directly corresponds to the relative size of that particular value. But this direct relationship between bar length and value only applies if the bars start at zero. If you create a bar chart in which the bars don’t start at zero, readers are likely to be mislead, so remember <em>bar charts should always start at zero</em>. But don’t worry – <code>ggplot()</code> will handle this for you automatically.</p>
</div>
</div>
<section id="ordering-bar-charts-by-value" class="level3" data-number="15.3.1">
<h3 data-number="15.3.1" class="anchored" data-anchor-id="ordering-bar-charts-by-value"><span class="header-section-number">15.3.1</span> Ordering bar charts by value</h3>
<p>If you were trying to find the three Malaysian states or territories with the most murders from this chart, it would be pretty easy to see that Selangor had the most murders, followed by Johor. But at a glance, it’s not so easy to see which state or territory comes third. We can make this easier to see by changing the order of the bars from the default alphabetical order to an order based on how many murders there were.</p>
<p>To do this, we need to convert the <code>state</code> column in the data to a new type of variable: a <em>factor</em>. Factors are what R calls categorical variables that have a defined set of possible values. For example, a factor recording if a person was under or over 18 might have two possible values: ‘adult’ and ‘child’.</p>
<p>One of the benefits of storing a variable as a factor is that we can specify an order for the categories. This is useful for categories that have a meaningful order, such as ‘bad’, ‘acceptable’, ‘good’, ‘excellent’. But we can also use this feature of factors to specify that values should appear in a particular order in any charts produced from the data, whatever the order of the values in the data itself.</p>
<p><a href="https://forcats.tidyverse.org/"><img src="../images/forcats.png" alt="forcats package hex sticker" class="right-side-image"></a></p>
<p>To work with factors in R we can use the <a href="https://forcats.tidyverse.org/">forcats package</a>, so-called because it’s <em>for</em> working with <em>categories</em>. forcats is loaded as part of tidyverse, so we don’t need to load it separately.</p>
<p>All the functions in the forcats package start with the letters <code>fct_</code>, just as all the functions in the SF package start <code>st_</code>. For our bar chart, we will use the <code>fct_reorder()</code> function. This takes a factor or character variable (such as the names of the Malaysian states and territories) and sets the order of the categories according to the values of a numeric variable (such as the number of murders in a state). So to re-order the <code>state</code> variable according to the count of murders, we can use <code>fct_reorder(state, count)</code>. Since we’re changing an existing variable, we will do this inside a call to the <code>mutate()</code> function.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb17" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Create bar chart of murder counts</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="co"># Keep only rows representing murder counts</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="fu">filter</span>(crime_type <span class="sc">==</span> <span class="st">"murder"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="co"># Re-order states according to number of murders</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">fct_reorder</span>(state, count)) <span class="sc">|&gt;</span> </span>
<span id="cb17-7"><a href="#cb17-7"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>  <span class="co"># Translate columns in the data to aesthetics on the chart</span></span>
<span id="cb17-9"><a href="#cb17-9"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> state) <span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>  <span class="co"># Add bars</span></span>
<span id="cb17-11"><a href="#cb17-11"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb17-12"><a href="#cb17-12"></a>  <span class="co"># Remove space at either end of horizontal axis</span></span>
<span id="cb17-13"><a href="#cb17-13"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb17-14"><a href="#cb17-14"></a>  <span class="co"># Add labels</span></span>
<span id="cb17-15"><a href="#cb17-15"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-16"><a href="#cb17-16"></a>    <span class="at">title =</span> <span class="st">"Murders in Malaysian states, 2017"</span>,</span>
<span id="cb17-17"><a href="#cb17-17"></a>    <span class="at">caption =</span> <span class="st">"Data from the Royal Malaysian Police"</span>,</span>
<span id="cb17-18"><a href="#cb17-18"></a>    <span class="at">x =</span> <span class="st">"number of murders"</span>,</span>
<span id="cb17-19"><a href="#cb17-19"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb17-20"><a href="#cb17-20"></a>  ) <span class="sc">+</span></span>
<span id="cb17-21"><a href="#cb17-21"></a>  <span class="co"># Remove unnecessary map elements</span></span>
<span id="cb17-22"><a href="#cb17-22"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb17-23"><a href="#cb17-23"></a>  <span class="fu">theme</span>(</span>
<span id="cb17-24"><a href="#cb17-24"></a>    <span class="co"># Remove unnecessary horizontal grid lines</span></span>
<span id="cb17-25"><a href="#cb17-25"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-26"><a href="#cb17-26"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb17-27"><a href="#cb17-27"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="colour-in-bar-charts" class="level3" data-number="15.3.2">
<h3 data-number="15.3.2" class="anchored" data-anchor-id="colour-in-bar-charts"><span class="header-section-number">15.3.2</span> Colour in bar charts</h3>
<p>We can further improve our bar chart by using colour to indicate which states are in which of the two regions of Malaysia. To do this, we will:</p>
<ul>
<li>specify in the call to <code>aes()</code> that the fill colour of the bars should be controlled by the <code>region</code> column in the data,</li>
<li>specify in the call to <code>labs()</code> that we don’t want the legend to have a title, since the meaning is obvious from the values ‘East Malaysia’ and ‘West Malaysia’, and</li>
<li>specify in the call to <code>theme()</code> that we would like the legend use up some of the empty space in the bottom-right corner of the chart, rather than making the chart smaller to give space for the legend on the right-hand side.</li>
</ul>
<p>To move the legend, we need to specify several different arguments in the <code>theme()</code> function. <code>legend.position</code> determines where around the plot the legend should be placed: ‘top’, ‘right’, ‘bottom’, ‘left’ or ‘inside’. In this case we want the legend to appear in some spare space on the plot itself, so we will set <code>legend.position = "inside"</code>. We then use the <code>legend.position.inside</code> argument to <code>theme()</code> to specify exactly <em>where</em> inside the plot we want the legend to appear. We do that by specifying where the legend should appear horizontally and vertically, as a proportion of the axis length, on a scale from zero to one.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/Examples of where legends will be placed inside the chart area based on the value provided to the `legend.position.inside` argument of `theme()`-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Using this specification, we can place the legend in the right-most point on the horizontal axis and the bottom-most point on the vertical axis by specifying <code>legend.position.inside = c(1, 0)</code>.</p>
<p><code>legend.position.inside</code> sets the <em>anchor</em> point from which the legend is created, with the actual size of the legend depending on how much space is required by its contents. By default, a legend will spread out in all directions from the anchor point, i.e.&nbsp;the legend will be horizontally and vertically centred on the anchor point. As we have positioned the legend in a corner of the plot, this is probably not what we want since some of the legend will be hidden outside the plot area. Instead, we can set the <code>legend.justifcation</code> argument of <code>theme()</code> using a similar specification to that for <code>legend.position.inside</code> based on which way we want the legend to grow.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/legend-justification-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If you want the legend to grow ‘inwards’ from a corner, just set <code>legend.justification</code> to the same value as you used for <code>legend.position.inside</code>. In this case, we want the legend to be anchored in the bottom-right corner and to grow inwards from it, so we will set both arguments to <code>c(1, 0)</code>.</p>
<p>Add this code to your script file and run it.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb18" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Create bar chart of murder counts</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>malaysia_murder_bar_chart <span class="ot">&lt;-</span> violence <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="co"># Keep only rows representing murder counts</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="fu">filter</span>(crime_type <span class="sc">==</span> <span class="st">"murder"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="co"># Re-order states according to number of murders</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">fct_reorder</span>(state, count)) <span class="sc">|&gt;</span> </span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8"></a>  <span class="co"># Translate columns in the data to aesthetics on the chart</span></span>
<span id="cb18-9"><a href="#cb18-9"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> state, <span class="at">fill =</span> region) <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10"></a>  <span class="co"># Add bars</span></span>
<span id="cb18-11"><a href="#cb18-11"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12"></a>  <span class="co"># Remove space at either end of horizontal axis</span></span>
<span id="cb18-13"><a href="#cb18-13"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14"></a>  <span class="co"># Add labels</span></span>
<span id="cb18-15"><a href="#cb18-15"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-16"><a href="#cb18-16"></a>    <span class="at">title =</span> <span class="st">"Murders in Malaysian states, 2017"</span>,</span>
<span id="cb18-17"><a href="#cb18-17"></a>    <span class="at">caption =</span> <span class="st">"Data from the Royal Malaysian Police"</span>,</span>
<span id="cb18-18"><a href="#cb18-18"></a>    <span class="at">x =</span> <span class="st">"number of murders"</span>,</span>
<span id="cb18-19"><a href="#cb18-19"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb18-20"><a href="#cb18-20"></a>  ) <span class="sc">+</span></span>
<span id="cb18-21"><a href="#cb18-21"></a>  <span class="co"># Remove unnecessary map elements</span></span>
<span id="cb18-22"><a href="#cb18-22"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb18-23"><a href="#cb18-23"></a>  <span class="fu">theme</span>(</span>
<span id="cb18-24"><a href="#cb18-24"></a>    <span class="co"># Move legend to bottom-right corner and give it a solid white background</span></span>
<span id="cb18-25"><a href="#cb18-25"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="st">"white"</span>),</span>
<span id="cb18-26"><a href="#cb18-26"></a>    <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb18-27"><a href="#cb18-27"></a>    <span class="at">legend.position =</span> <span class="st">"inside"</span>,</span>
<span id="cb18-28"><a href="#cb18-28"></a>    <span class="at">legend.position.inside =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb18-29"><a href="#cb18-29"></a>    <span class="co"># Remove unnecessary horizontal grid lines</span></span>
<span id="cb18-30"><a href="#cb18-30"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb18-31"><a href="#cb18-31"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb18-32"><a href="#cb18-32"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb19" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>malaysia_murder_bar_chart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>One issue with this chart is that the default colours that <code>ggplot()</code> produces are not easy for everyone to discern. In particular, people with colour blindness may struggle to distinguish between some combinations of colours. Some colour combinations are also hard (or impossible) to distinguish even for people with normal colour vision if a chart is printed in black and white or viewed on a screen in some lighting conditions.</p>
<p>We can check how well people with different colour vision will be able to read a chart using the <code>cvd_grid()</code> function from the colorblindr package. This function takes an existing <code>ggplot()</code> stack and prints several versions of the chart that simulate how different people will see it.</p>
<p>The colorblindr package is not on CRAN, the repository we usually install R packages from. That means we need to use slightly different code to install it. Instead of installing from CRAN, we will instead install the package from GitHub, a website that programmers use to store versions of their code. To install packages from GitHub we can use the <code>p_install_gh()</code> function from the pacman package (the same package we use to load packages at the start of each R script).</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb20" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># Install the colorblindr package from GitHub</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>pacman<span class="sc">::</span><span class="fu">p_install_gh</span>(<span class="st">"clauswilke/colorblindr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Remember that because we only need to install a package once on each computer we use R on, you should never install packages inside an R script. This means you should only ever run <code>pacman::p_install_gh()</code> in the R Console, never in an R script.</p>
<p>Once you’ve installed the colorblindr package, you can use it to check how different people are likely to see the chart of murder in Malaysia.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb21" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Check if chart colours are safe for different people</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>colorblindr<span class="sc">::</span><span class="fu">cvd_grid</span>(malaysia_murder_bar_chart)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From this we can see that this combination of colours works well for people with some types of colour blindness, but is likely to be hard for some people, and indeed for everyone if the chart is printed on a black-and-white printer.</p>
<p><a href="https://emilhvitfeldt.github.io/paletteer/"><img src="../images/paletteer.png" class="right-side-image img-fluid" alt="paletteer website"></a></p>
<p>Fortunately, there are lots of different R packages that provide colour palettes that are suitable for people with different colour vision. The <a href="https://emilhvitfeldt.github.io/paletteer/">paletteer package</a> brings a lot of these colour palettes together in one place. paletteer provides three pairs of functions for different types of colour scale:</p>
<ul>
<li><code>scale_colour_paletteer_c()</code>/<code>scale_fill_paletteer_c()</code> for <em>continuous</em> scales that are suitable for representing continuous variables.</li>
<li><code>scale_colour_paletteer_d()</code>/<code>scale_fill_paletteer_d()</code> for <em>discrete</em> scales that are suitable for representing categorical variables.</li>
<li><code>scale_colour_paletteer_binned()</code>/<code>scale_fill_paletteer_binned()</code> for <em>binned</em> scales that are suitable for showing continuous variables that have been sub-divided (‘binned’) into ordered categories.</li>
</ul>
<p>We can use each of these functions in the same way we have used functions like <code>scale_fill_distiller()</code> in previous chapters. The first argument to all the main functions in the paletteer package is the name of a colour palette, of which a total of 2,759 different palettes are available. We can specify which palette to use using the same syntax we have sometimes used to refer to R functions: <code>package_name::palette_name</code>. For example, to create a discrete colour scale using the OKeeffe2 palette from the <a href="https://github.com/BlakeRMills/MetBrewer">MetBrewer package</a> (a palette inspired by the painting <a href="https://www.metmuseum.org/art/collection/search/484833"><em>Red and Yellow Cliffs</em> by Georgia O’Keeffe</a>) we could use <code>scale_colour_paletteer_d("MetBrewer::OKeeffe2")</code>.</p>
<p>There are many useful colour palettes in the <a href="https://nrennie.rbind.io/PrettyCols/">PrettyCols package</a>. Let’s use the Bright palette from this package to control the colours on the chart.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter15a.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb22" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Create bar chart of murder counts</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>malaysia_murder_bar_chart <span class="ot">&lt;-</span> violence <span class="sc">|&gt;</span> </span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="co"># Keep only rows representing murder counts</span></span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="fu">filter</span>(crime_type <span class="sc">==</span> <span class="st">"murder"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-5"><a href="#cb22-5"></a>  <span class="co"># Re-order states according to number of murders</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">fct_reorder</span>(state, count)) <span class="sc">|&gt;</span> </span>
<span id="cb22-7"><a href="#cb22-7"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb22-8"><a href="#cb22-8"></a>  <span class="co"># Translate columns in the data to aesthetics on the chart</span></span>
<span id="cb22-9"><a href="#cb22-9"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> state, <span class="at">fill =</span> region) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10"></a>  <span class="co"># Add bars</span></span>
<span id="cb22-11"><a href="#cb22-11"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12"></a>  <span class="co"># Remove space at either end of horizontal axis</span></span>
<span id="cb22-13"><a href="#cb22-13"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14"></a>  <span class="co"># Specify colour-blind-safe fill colours</span></span>
<span id="cb22-15"><a href="#cb22-15"></a>  <span class="fu">scale_fill_paletteer_d</span>(<span class="st">"PrettyCols::Bright"</span>) <span class="sc">+</span></span>
<span id="cb22-16"><a href="#cb22-16"></a>  <span class="co"># Add labels</span></span>
<span id="cb22-17"><a href="#cb22-17"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-18"><a href="#cb22-18"></a>    <span class="at">title =</span> <span class="st">"Murders in Malaysian states, 2017"</span>,</span>
<span id="cb22-19"><a href="#cb22-19"></a>    <span class="at">caption =</span> <span class="st">"Data from the Royal Malaysian Police"</span>,</span>
<span id="cb22-20"><a href="#cb22-20"></a>    <span class="at">x =</span> <span class="st">"number of murders"</span>,</span>
<span id="cb22-21"><a href="#cb22-21"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb22-22"><a href="#cb22-22"></a>  ) <span class="sc">+</span></span>
<span id="cb22-23"><a href="#cb22-23"></a>  <span class="co"># Remove unnecessary map elements</span></span>
<span id="cb22-24"><a href="#cb22-24"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb22-25"><a href="#cb22-25"></a>  <span class="fu">theme</span>(</span>
<span id="cb22-26"><a href="#cb22-26"></a>    <span class="co"># Move legend to bottom-right corner and give it a solid white background</span></span>
<span id="cb22-27"><a href="#cb22-27"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="st">"white"</span>),</span>
<span id="cb22-28"><a href="#cb22-28"></a>    <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb22-29"><a href="#cb22-29"></a>    <span class="at">legend.position =</span> <span class="st">"inside"</span>,</span>
<span id="cb22-30"><a href="#cb22-30"></a>    <span class="at">legend.position.inside =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb22-31"><a href="#cb22-31"></a>    <span class="co"># Remove unnecessary horizontal grid lines</span></span>
<span id="cb22-32"><a href="#cb22-32"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-33"><a href="#cb22-33"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb22-34"><a href="#cb22-34"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb23" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>malaysia_murder_bar_chart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To see if these colours are likely to work for different people, we can again check the colours with the colorblindr package:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb24" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Check if chart colours are safe for different people</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>colorblindr<span class="sc">::</span><span class="fu">cvd_grid</span>(malaysia_murder_bar_chart)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From this, we can see that this colour palette is going to be much more useful for people with different colour vision, as well as for everyone if the chart is printed in black and white or viewed on a screen in bad light.</p>
<div class="box reading">
<p>There are lots of other ways to control colours on charts and maps in R. For more detail, read <a href="https://nrennie.rbind.io/blog/colours-in-r/">Working with colours in R</a>.</p>
</div>
<p>Bar charts are a very common way of presenting a numeric variable for each value of a categorical variable. Bar charts are easy to interpret, even for people who are not used to interpreting charts or who only have time to look at the chart for a few seconds.</p>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Quiz
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>When creating a bar chart, why might you want to sort the bars by value?</strong></p>
<div id="radio_WVQKEFKXVZ" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_WVQKEFKXVZ" value=""> <span>To follow the alphabetical order of locations</span></label><label><input type="radio" autocomplete="off" name="radio_WVQKEFKXVZ" value=""> <span>To avoid using colors in the chart</span></label><label><input type="radio" autocomplete="off" name="radio_WVQKEFKXVZ" value="answer"> <span>To make it easier to see which rows have the highest values</span></label><label><input type="radio" autocomplete="off" name="radio_WVQKEFKXVZ" value=""> <span>To ensure a map is not needed</span></label>
</div>
<p><strong>What is one reason why a reference map might be included alongside a bar chart?</strong></p>
<div id="radio_MSTHVZXVYN" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_MSTHVZXVYN" value=""> <span>To make the bar chart look more visually appealing</span></label><label><input type="radio" autocomplete="off" name="radio_MSTHVZXVYN" value=""> <span>To display non-spatial variables</span></label><label><input type="radio" autocomplete="off" name="radio_MSTHVZXVYN" value=""> <span>To replace the need for a table</span></label><label><input type="radio" autocomplete="off" name="radio_MSTHVZXVYN" value="answer"> <span>To provide context for areas that the audience may not recognize</span></label>
</div>
<p><strong>Why might a bar chart be more effective than a choropleth map for presenting crime data?</strong></p>
<div id="radio_KJSPNZRGWM" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_KJSPNZRGWM" value="answer"> <span>Bar charts allow for direct numeric comparisons between areas</span></label><label><input type="radio" autocomplete="off" name="radio_KJSPNZRGWM" value=""> <span>Bar charts can show detailed spatial relationships</span></label><label><input type="radio" autocomplete="off" name="radio_KJSPNZRGWM" value=""> <span>Bar charts are required for all crime analysis</span></label><label><input type="radio" autocomplete="off" name="radio_KJSPNZRGWM" value=""> <span>Bar charts are easier to make than maps</span></label>
</div>
</div>
</div>
</section>
</section>
<section id="visualising-distributions" class="level2" data-number="15.4">
<h2 data-number="15.4" class="anchored" data-anchor-id="visualising-distributions"><span class="header-section-number">15.4</span> Visualising distributions</h2>
<p>Bar charts show a single piece of information about each category present in a dataset. So we might use a bar chart to show, for example, the average number of burglaries in neighbourhoods in different districts. But what if the average values masked substantial differences in the number of burglaries within each district? Averages often mask variation, and can sometimes be misleading as a result. In those circumstances it would be better to show more detail rather than a misleading average.</p>
<p>Let’s start with the simple example of showing the distribution of burglary counts within a single district. Restart R (<code>Session &gt; Restart R</code>), open a new R script file and save it as <code>chapter15b.R</code>. Use this code to load a dataset of burglaries in each lower-layer super output area (LSOA) in Northamptonshire in England in 2020.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter15b.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb25" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># Load packages</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span>
<span id="cb25-3"><a href="#cb25-3"></a></span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="co"># Load data</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>burglary <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/northants_burglary_counts.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>To show the distribution of burglary counts we can create a <em>histogram</em> using <code>geom_histogram()</code>. A histogram divides the range of values present in the data into a number of equally sized <em>bins</em>, then shows bars representing the number of observations (rows) in the data that have values fitting into each bin. We can either allow <code>geom_histogram()</code> to set the number of bins automatically, or set it ourself with the <code>binwidth</code> argument.</p>
<p>We will set the <code>binwidth</code> argument of the <code>geom_histogram()</code> function to <code>binwidth = 1</code> so that each bar on the chart will show now many LSOAs have each individual value. We will also add some labels to help readers interpret the chart.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter15b.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb26" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># Create histogram of burglary counts</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>burglary <span class="sc">|&gt;</span> </span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="co"># Specify which column in the data contains the value we're interested in</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count) <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6"></a>  <span class="co"># Add a histogram to the chart</span></span>
<span id="cb26-7"><a href="#cb26-7"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8"></a>  <span class="co"># Remove unnecessary space at either end of both axes</span></span>
<span id="cb26-9"><a href="#cb26-9"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb26-10"><a href="#cb26-10"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11"></a>  <span class="co"># Add labels</span></span>
<span id="cb26-12"><a href="#cb26-12"></a>  <span class="fu">labs</span>(</span>
<span id="cb26-13"><a href="#cb26-13"></a>    <span class="at">title =</span> <span class="st">"Number of burglaries in Northamptonshire neighbourhoods"</span>,</span>
<span id="cb26-14"><a href="#cb26-14"></a>    <span class="at">x =</span> <span class="st">"count of burglaries, 2020"</span>,</span>
<span id="cb26-15"><a href="#cb26-15"></a>    <span class="at">y =</span> <span class="st">"number of LSOAs"</span></span>
<span id="cb26-16"><a href="#cb26-16"></a>  ) <span class="sc">+</span></span>
<span id="cb26-17"><a href="#cb26-17"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb26-18"><a href="#cb26-18"></a>  <span class="fu">theme</span>(</span>
<span id="cb26-19"><a href="#cb26-19"></a>    <span class="co"># Remove unnecessary vertical grid lines</span></span>
<span id="cb26-20"><a href="#cb26-20"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-21"><a href="#cb26-21"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb26-22"><a href="#cb26-22"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Interpreting histograms can be slightly counter-intuitive. The important thing to remember is that the horizontal position of each bar represents a number of burglaries and the vertical height of the bar represents how many neighbourhoods had that number of burglaries. This is the opposite of a bar chart, where the length of the bar represents the number of burglaries.</p>
<p>In this chart, we can see on this chart that most LSOAs had only a few burglaries in 2020 (represented by the tallest bars are to the left of the chart), while a few LSOAs had a larger number (the bars to the right of the chart). This is what we would expect, since we know the crimes are generally concentrated in a few places.</p>
<section id="plotting-density-curves" class="level3" data-number="15.4.1">
<h3 data-number="15.4.1" class="anchored" data-anchor-id="plotting-density-curves"><span class="header-section-number">15.4.1</span> Plotting density curves</h3>
<p>Histograms are one way to show the distribution of a variable (in this case, the count of burglaries). Another way to show the distribution of a variable is to create a <em>density curve</em> with <code>geom_density()</code>. A density curve is a <em>smoothed</em> version of a histogram, which is useful to show the general distribution of a variable (in this case, the number of LSOAs with different numbers of burglaries) at the cost of not showing the exact data. The mathematical procedure used by <code>geom_density()</code> to calculate a density curve is the same as the kernel-density estimation process we have already learned to use to show concentrations of crime on a map.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter15b.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb27" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># Create a density plot of burglaries</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>burglary <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="co"># Specify which column in the data contains the value we're interested in</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6"></a>  <span class="co"># Add a density curve to the chart</span></span>
<span id="cb27-7"><a href="#cb27-7"></a>  <span class="fu">geom_density</span>(<span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8"></a>  <span class="co"># Remove unnecessary space at either end of both axes</span></span>
<span id="cb27-9"><a href="#cb27-9"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11"></a>  <span class="co"># Add labels</span></span>
<span id="cb27-12"><a href="#cb27-12"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-13"><a href="#cb27-13"></a>    <span class="at">title =</span> <span class="st">"Number of burglaries in Northamptonshire neighbourhoods"</span>,</span>
<span id="cb27-14"><a href="#cb27-14"></a>    <span class="at">x =</span> <span class="st">"count of burglaries, 2020"</span>,</span>
<span id="cb27-15"><a href="#cb27-15"></a>    <span class="at">y =</span> <span class="st">"percentage of LSOAs"</span></span>
<span id="cb27-16"><a href="#cb27-16"></a>  ) <span class="sc">+</span></span>
<span id="cb27-17"><a href="#cb27-17"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb27-18"><a href="#cb27-18"></a>  <span class="fu">theme</span>(</span>
<span id="cb27-19"><a href="#cb27-19"></a>    <span class="co"># Remove unnecessary vertical grid lines</span></span>
<span id="cb27-20"><a href="#cb27-20"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-21"><a href="#cb27-21"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb27-22"><a href="#cb27-22"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can use density curves to show the distribution of a variable across multiple categories at once. For example, we could show the distribution of burglary counts at the neighbourhood level for all the districts in Northamptonshire. To do this we use the <code>geom_density_ridges()</code> function from the ggridges package to create a <em>ridge plot</em>. Although this function does not come from the ggplot2 package, it is designed to be used inside a <code>ggplot()</code> stack.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter15b.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb28" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># Add ridge plot of Northamptonshire burglary</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>burglary <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="co"># Wrap the district names by replacing any space in a name with a new-line</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> <span class="fu">str_replace_all</span>(district, <span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb28-5"><a href="#cb28-5"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6"></a>  <span class="co"># Specify which columns in the data contain the values we're interested in</span></span>
<span id="cb28-7"><a href="#cb28-7"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> district) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8"></a>  <span class="co"># Add ridge plot</span></span>
<span id="cb28-9"><a href="#cb28-9"></a>  ggridges<span class="sc">::</span><span class="fu">geom_density_ridges</span>() <span class="sc">+</span></span>
<span id="cb28-10"><a href="#cb28-10"></a>  <span class="co"># Remove unnecessary space at either end of x axis</span></span>
<span id="cb28-11"><a href="#cb28-11"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb28-12"><a href="#cb28-12"></a>  <span class="co"># Add labels</span></span>
<span id="cb28-13"><a href="#cb28-13"></a>  <span class="fu">labs</span>(</span>
<span id="cb28-14"><a href="#cb28-14"></a>    <span class="at">title =</span> <span class="st">"Number of burglaries in Kettering neighbourhoods"</span>,</span>
<span id="cb28-15"><a href="#cb28-15"></a>    <span class="at">x =</span> <span class="st">"count of burglaries, 2020"</span>,</span>
<span id="cb28-16"><a href="#cb28-16"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb28-17"><a href="#cb28-17"></a>  ) <span class="sc">+</span></span>
<span id="cb28-18"><a href="#cb28-18"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>Picking joint bandwidth of 1.98</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What does the message <code>Picking joint bandwidth of 1.98</code> mean?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>As you know from previous chapters, density estimation depends on us choosing a <em>bandwidth</em> to control the degree of smoothing between data points. By default, <code>geom_density_ridges()</code> chooses a suitable bandwidth automatically and reports this in a message. The bandwidth is referred to as ‘joint’ because the same bandwidth is used for all the density curves on a chart.</p>
<p>If you wanted to include a ridge plot in a Quarto document, you would probably not want this message to appear in your report. To suppress the message, you can use the Quarto chunk option <code>#| message: false</code>.</p>
</div>
</div>
</div>
<p>The ridge plot shows the distribution of burglary counts in LSOAs within each district, with the distributions overlapping slightly to save space. From this we can see that across all districts most LSOAs have few burglaries, with a small number of LSOAs having more. We can also see there are a small number of LSOAs (probably, in fact, just one LSOA) in Wellingborough district with a much higher number of burglaries than anywhere else in Northamptonshire.</p>
</section>
<section id="small-multiple-charts" class="level3" data-number="15.4.2">
<h3 data-number="15.4.2" class="anchored" data-anchor-id="small-multiple-charts"><span class="header-section-number">15.4.2</span> Small-multiple charts</h3>
<p>Density plots can be helpful to summarise a lot of information, but they have some disadvantages. In particular, they don’t show that the number of LSOAs in each district is quite different: there are 131 LSOAs in Northampton but only 41 LSOAs in Corby. To make this clearer we can instead produce several dot plots, one for each district – what are called <em>small-multiple</em> charts.</p>
<p>We could create small-multiple charts by producing a separate histogram for each district and then combine them with the patchwork package, but that would involve a lot of repeated code. Fortunately, we can use a feature of the ggplot2 package called <em>faceting</em> to split our single histogram into multiple plots based on a column in the data (in this case, the district name).</p>
<p>Adding <code>facet_wrap()</code> to a <code>ggplot()</code> stack will cause R to create multiple plots and wrap them across multiple rows and columns so that they approximately fit into the available space. If we only want the small multiples to appear on top of each other (i.e.&nbsp;in multiple rows) or next to each other (i.e.&nbsp;in multiple columns), we can use the <code>facet_grid()</code> function. In this case we want the small multiples to appear on top of each other, so we will use <code>facet_grid()</code> and say that the small multiples (which ggplot2 calls <em>facets</em>) should be based on the <code>district</code> column in the data by specifying <code>rows = vars(district)</code> (it is necessary to wrap the name of the column that you want to use as the basis of the small multiples in the <code>vars()</code> helper function, but we do not need to go into why).</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter15b.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb30" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># Create histogram of burglary counts</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>burglary <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>  <span class="co"># Specify which column in the data contains the value we're interested in</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6"></a>  <span class="co"># Add a histogram to the chart</span></span>
<span id="cb30-7"><a href="#cb30-7"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8"></a>  <span class="co"># Split chart into small multiples, one for each district</span></span>
<span id="cb30-9"><a href="#cb30-9"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(district), <span class="at">labeller =</span> <span class="fu">label_wrap_gen</span>(<span class="at">width =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10"></a>  <span class="co"># Remove unnecessary space at either end of both axes</span></span>
<span id="cb30-11"><a href="#cb30-11"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb30-12"><a href="#cb30-12"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb30-13"><a href="#cb30-13"></a>  <span class="co"># Add labels</span></span>
<span id="cb30-14"><a href="#cb30-14"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-15"><a href="#cb30-15"></a>    <span class="at">title =</span> <span class="st">"Number of burglaries in Northamptonshire neighbourhoods"</span>,</span>
<span id="cb30-16"><a href="#cb30-16"></a>    <span class="at">x =</span> <span class="st">"count of burglaries, 2020"</span>,</span>
<span id="cb30-17"><a href="#cb30-17"></a>    <span class="at">y =</span> <span class="st">"number of LSOAs"</span></span>
<span id="cb30-18"><a href="#cb30-18"></a>  ) <span class="sc">+</span></span>
<span id="cb30-19"><a href="#cb30-19"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb30-20"><a href="#cb30-20"></a>  <span class="fu">theme</span>(</span>
<span id="cb30-21"><a href="#cb30-21"></a>    <span class="co"># Remove unnecessary vertical grid lines</span></span>
<span id="cb30-22"><a href="#cb30-22"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb30-23"><a href="#cb30-23"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb30-24"><a href="#cb30-24"></a>    <span class="co"># Control alignment of facet titles</span></span>
<span id="cb30-25"><a href="#cb30-25"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb30-26"><a href="#cb30-26"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>You might have noticed we made some other changes to our code for this chart to make it clearer:</p>
<ul>
<li>Wrapped the facet labels using the <code>label_wrap_gen()</code> helper function so that some of the longer district names don’t take up too much space horizontally.</li>
<li>Made the facet labels easier to read by making the text horizontal (rather than the default vertical text) using the <code>strip.text.y</code> attribute to <code>theme()</code> and the <code>element_text()</code> helper function. <code>angle</code> sets the rotation of the text (or in this case, specifies that there should be no rotation) and <code>hjust = 0</code> specifies that the text should be left aligned.</li>
</ul>
<p>There are many more-technical ways to show distributions, such as box plots or violin plots. However, these can be difficult to interpret for people who are not used to looking at those particular types of chart, so they should probably be avoided for communicating with general audiences.</p>
</section>
</section>
<section id="comparing-continuous-variables" class="level2" data-number="15.5">
<h2 data-number="15.5" class="anchored" data-anchor-id="comparing-continuous-variables"><span class="header-section-number">15.5</span> Comparing continuous variables</h2>
<p>So far we have used bar charts to communicate a single number (in our example, a number of murders) for each value of a categorical variable (the name of each Malaysian state or territory), and histograms to show multiple numbers (burglary counts for each neighbourhood) for each value of a categorical variable (districts in Northamptonshire).</p>
<p>Both these types of chart compare a numeric variable to a categorical one. But sometimes we may want to compare two categorical variables. We can do this with a <em>scatter plot</em>.</p>
<p>Restart R (<code>Session &gt; Restart R</code>), open a new R script file and save it as <code>chapter15c.R</code>. Use this code to load rates of thefts of and from motor vehicles per 1,000 households saying they own a vehicle for a selection of municipalities in South Africa.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter15c.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb31" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># Load packages</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggrepel, tidyverse)</span>
<span id="cb31-3"><a href="#cb31-3"></a></span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="co"># Load South African vehicle theft rates</span></span>
<span id="cb31-5"><a href="#cb31-5"></a>vehicle_theft <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/south_africa_vehicle_theft.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Since thefts <em>of</em> vehicle and thefts <em>from</em> vehicles are different but related crimes, we might want to see if there is a relationship between counts of each type.</p>
<p>To create a <code>ggplot()</code> scatter plot we use <code>geom_point()</code>, the same function we previously used to create point maps. This makes sense, since point maps are a specialised type of scatter plot in which the <em>x</em> and <em>y</em> axes of the chart show the latitude and longitude or easting and northing of each crime location.</p>
<p>The data in the <code>vehicle_theft</code> object are in long format, with each row representing a count of crime in a particular category for a particular municipality. To make a scatter plot where each point represents a municipality, we need to have all the data for a municipality in a single row of data, so we will need to transform the data with <code>pivot_wider()</code> (as we did for some of the tables at the start of this chapter). Since this converts the values of the <code>crime_category</code> column into column names. These names are quite long, so we first convert them to snake case using <code>janitor::clean_names()</code> and then use <code>rename()</code> to shorten the names so they are easier to work with.</p>
<p>Add this code to the R script file.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter15c.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb32" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># Convert vehicle theft data to wide format</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>vehicle_theft_wider <span class="ot">&lt;-</span> vehicle_theft <span class="sc">|&gt;</span> </span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_category, <span class="at">values_from =</span> theft_rate) <span class="sc">|&gt;</span> </span>
<span id="cb32-4"><a href="#cb32-4"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb32-5"><a href="#cb32-5"></a>  <span class="fu">rename</span>(</span>
<span id="cb32-6"><a href="#cb32-6"></a>    <span class="at">theft_of =</span> theft_of_motor_vehicle,</span>
<span id="cb32-7"><a href="#cb32-7"></a>    <span class="at">theft_from =</span> theft_out_of_or_from_motor_vehicle</span>
<span id="cb32-8"><a href="#cb32-8"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>We can now make a basic scatter plot.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb33" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># Create scatter plot of vehicle theft</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="fu">ggplot</span>(vehicle_theft_wider) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="co"># Specify which columns in the data should control the x and y positions of</span></span>
<span id="cb33-4"><a href="#cb33-4"></a>  <span class="co"># each point</span></span>
<span id="cb33-5"><a href="#cb33-5"></a>  <span class="fu">aes</span>(<span class="at">x =</span> theft_of, <span class="at">y =</span> theft_from) <span class="sc">+</span></span>
<span id="cb33-6"><a href="#cb33-6"></a>  <span class="co"># Add the points</span></span>
<span id="cb33-7"><a href="#cb33-7"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8"></a>  <span class="co"># Specify the format for the axis labels</span></span>
<span id="cb33-9"><a href="#cb33-9"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11"></a>  <span class="co"># Add labels</span></span>
<span id="cb33-12"><a href="#cb33-12"></a>  <span class="fu">labs</span>(</span>
<span id="cb33-13"><a href="#cb33-13"></a>    <span class="at">title =</span> <span class="st">"Vehicle thefts in South African municipalities"</span>,</span>
<span id="cb33-14"><a href="#cb33-14"></a>    <span class="at">subtitle =</span> <span class="st">"each dot represents one municipality, 2018-19"</span>,</span>
<span id="cb33-15"><a href="#cb33-15"></a>    <span class="at">x =</span> <span class="st">"rate of thefts of motor vehicles per 1,000 vehicle-owning households"</span>,</span>
<span id="cb33-16"><a href="#cb33-16"></a>    <span class="at">y =</span> <span class="st">"rate of thefts from motor vehicles per 1,000 vehicle-owning households"</span></span>
<span id="cb33-17"><a href="#cb33-17"></a>  ) <span class="sc">+</span></span>
<span id="cb33-18"><a href="#cb33-18"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From this plot we can see that most areas have low rates of both theft of and theft from motor vehicles, with a few areas having very-high rates of one type or the other (but none have high rates of both).</p>
<p>Looking at the bottom-left corner of the chart we can see that we have again encountered the problem of overlapping points making patterns less clear. We can try to deal with this by making the points semi-transparent using the <code>alpha</code> argument to <code>geom_point()</code>.</p>
<p>Scatter plots can be hard for people to interpret, especially if they are not used to interpreting charts. To help readers, we can annotate the plot to show how to interpret each region of the chart. We will add two types of annotation: lines to show the median value on each axis, and labels to help interpretation.</p>
<p>We can add median lines using the <code>geom_hline()</code> and <code>geom_vline()</code> functions, which add horizontal and vertical lines to plots. We will add these to the <code>ggplot()</code> stack <em>before</em> <code>geom_point()</code> so that the lines appear <em>behind</em> the points.</p>
<p>To add text annotations we use the <code>annotate()</code> function from ggplot2, which allows us to add data to a chart by specifying the aesthetics (<em>x</em> and <em>y</em> position, etc.) directly rather than by referencing columns in the data. To add a text annotation, we set the <code>geom</code> argument of <code>annotate()</code> to <code>"text"</code>.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb34" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># Create scatter plot of vehicle theft</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="fu">ggplot</span>(vehicle_theft_wider) <span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3"></a>  <span class="co"># Specify which columns in the data should control the x and y positions of</span></span>
<span id="cb34-4"><a href="#cb34-4"></a>  <span class="co"># each point</span></span>
<span id="cb34-5"><a href="#cb34-5"></a>  <span class="fu">aes</span>(<span class="at">x =</span> theft_of, <span class="at">y =</span> theft_from) <span class="sc">+</span></span>
<span id="cb34-6"><a href="#cb34-6"></a>  <span class="co"># Add vertical line showing median rate of theft of a vehicle</span></span>
<span id="cb34-7"><a href="#cb34-7"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb34-8"><a href="#cb34-8"></a>    <span class="at">xintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_of"</span>)),</span>
<span id="cb34-9"><a href="#cb34-9"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb34-10"><a href="#cb34-10"></a>  ) <span class="sc">+</span></span>
<span id="cb34-11"><a href="#cb34-11"></a>  <span class="co"># Add horizontal line showing median rate of theft from a vehicle</span></span>
<span id="cb34-12"><a href="#cb34-12"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb34-13"><a href="#cb34-13"></a>    <span class="at">yintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_from"</span>)),</span>
<span id="cb34-14"><a href="#cb34-14"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb34-15"><a href="#cb34-15"></a>  ) <span class="sc">+</span></span>
<span id="cb34-16"><a href="#cb34-16"></a>  <span class="co"># Add points</span></span>
<span id="cb34-17"><a href="#cb34-17"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb34-18"><a href="#cb34-18"></a>  <span class="co"># Add annotations to aid interpretation</span></span>
<span id="cb34-19"><a href="#cb34-19"></a>  <span class="fu">annotate</span>(</span>
<span id="cb34-20"><a href="#cb34-20"></a>    <span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb34-21"><a href="#cb34-21"></a>    <span class="at">x =</span> <span class="dv">20</span>, </span>
<span id="cb34-22"><a href="#cb34-22"></a>    <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb34-23"><a href="#cb34-23"></a>    <span class="at">label =</span> <span class="st">"high rate of thefts of vehicles</span><span class="sc">\n</span><span class="st">low rate of thefts from vehicles"</span>, </span>
<span id="cb34-24"><a href="#cb34-24"></a>    <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb34-25"><a href="#cb34-25"></a>    <span class="at">lineheight =</span> <span class="dv">1</span></span>
<span id="cb34-26"><a href="#cb34-26"></a>  ) <span class="sc">+</span></span>
<span id="cb34-27"><a href="#cb34-27"></a>  <span class="fu">annotate</span>(</span>
<span id="cb34-28"><a href="#cb34-28"></a>    <span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb34-29"><a href="#cb34-29"></a>    <span class="at">x =</span> <span class="dv">1</span>, </span>
<span id="cb34-30"><a href="#cb34-30"></a>    <span class="at">y =</span> <span class="dv">75</span>, </span>
<span id="cb34-31"><a href="#cb34-31"></a>    <span class="at">label =</span> <span class="st">"low rate of thefts of vehicles</span><span class="sc">\n</span><span class="st">high rate of thefts from vehicles"</span>, </span>
<span id="cb34-32"><a href="#cb34-32"></a>    <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb34-33"><a href="#cb34-33"></a>    <span class="at">lineheight =</span> <span class="dv">1</span></span>
<span id="cb34-34"><a href="#cb34-34"></a>  ) <span class="sc">+</span></span>
<span id="cb34-35"><a href="#cb34-35"></a>  <span class="co"># Specify the format for the axis labels</span></span>
<span id="cb34-36"><a href="#cb34-36"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb34-37"><a href="#cb34-37"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb34-38"><a href="#cb34-38"></a>  <span class="co"># Add labels</span></span>
<span id="cb34-39"><a href="#cb34-39"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-40"><a href="#cb34-40"></a>    <span class="at">title =</span> <span class="st">"Vehicle thefts in South African municipalities"</span>,</span>
<span id="cb34-41"><a href="#cb34-41"></a>    <span class="at">subtitle =</span> <span class="fu">str_glue</span>(</span>
<span id="cb34-42"><a href="#cb34-42"></a>      <span class="st">"each dot represents one municipality, 2018-19, dashed lines show "</span>,</span>
<span id="cb34-43"><a href="#cb34-43"></a>      <span class="st">"median values"</span></span>
<span id="cb34-44"><a href="#cb34-44"></a>    ),</span>
<span id="cb34-45"><a href="#cb34-45"></a>    <span class="at">x =</span> <span class="st">"rate of thefts of motor vehicles per 1,000 vehicle-owning households"</span>,</span>
<span id="cb34-46"><a href="#cb34-46"></a>    <span class="at">y =</span> <span class="st">"rate of thefts from motor vehicles per 1,000 vehicle-owning households"</span></span>
<span id="cb34-47"><a href="#cb34-47"></a>  ) <span class="sc">+</span></span>
<span id="cb34-48"><a href="#cb34-48"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From this plot we can now see that half of municipalities have very low rates of both types of theft (shown by the dots below and to the left of the median lines).</p>
<p>We can make some further changes to this chart. For example, instead of labelling areas on the plot we could instead label the municipalities with high rates of vehicle theft (we cannot include both types of label because they would overlap). To do that, we will create a new column in the data containing either the municipality name (for high-rate municipalities) or <code>NA</code> (meaning <code>ggplot()</code> will not create a label for that row if we set <code>na.rm = TRUE</code>). We can then use <code>geom_label_repel()</code> to add the labels to the chart, remembering to add <code>label = label</code> to the <code>aes()</code> function so <code>ggplot()</code> knows which column in the data to use for the labels.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb35" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Create scatter plot of vehicle theft</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>vehicle_theft_wider <span class="sc">|&gt;</span> </span>
<span id="cb35-3"><a href="#cb35-3"></a>  <span class="co"># Create a new column in the data, either containing the municipality name or</span></span>
<span id="cb35-4"><a href="#cb35-4"></a>  <span class="co"># `NA` depending on the values of `theft_of` and `theft_from`</span></span>
<span id="cb35-5"><a href="#cb35-5"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">if_else</span>(theft_of <span class="sc">&gt;</span> <span class="dv">17</span> <span class="sc">|</span> theft_from <span class="sc">&gt;</span> <span class="dv">65</span>, municipality, <span class="cn">NA</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb35-6"><a href="#cb35-6"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7"></a>  <span class="co"># Specify which columns in the data should control the x and y positions of</span></span>
<span id="cb35-8"><a href="#cb35-8"></a>  <span class="co"># each point and the labels (for those points that have labels)</span></span>
<span id="cb35-9"><a href="#cb35-9"></a>  <span class="fu">aes</span>(<span class="at">x =</span> theft_of, <span class="at">y =</span> theft_from, <span class="at">label =</span> label) <span class="sc">+</span></span>
<span id="cb35-10"><a href="#cb35-10"></a>  <span class="co"># Add vertical line showing median rate of theft of a vehicle</span></span>
<span id="cb35-11"><a href="#cb35-11"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb35-12"><a href="#cb35-12"></a>    <span class="at">xintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_of"</span>)),</span>
<span id="cb35-13"><a href="#cb35-13"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb35-14"><a href="#cb35-14"></a>  ) <span class="sc">+</span></span>
<span id="cb35-15"><a href="#cb35-15"></a>  <span class="co"># Add horizontal line showing median rate of theft from a vehicle</span></span>
<span id="cb35-16"><a href="#cb35-16"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb35-17"><a href="#cb35-17"></a>    <span class="at">yintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_from"</span>)),</span>
<span id="cb35-18"><a href="#cb35-18"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb35-19"><a href="#cb35-19"></a>  ) <span class="sc">+</span></span>
<span id="cb35-20"><a href="#cb35-20"></a>  <span class="co"># Add points</span></span>
<span id="cb35-21"><a href="#cb35-21"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb35-22"><a href="#cb35-22"></a>  <span class="co"># Add labels</span></span>
<span id="cb35-23"><a href="#cb35-23"></a>  <span class="fu">geom_label_repel</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">label.size =</span> <span class="dv">0</span>, <span class="at">lineheight =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-24"><a href="#cb35-24"></a>  <span class="co"># Specify the format for the axis labels</span></span>
<span id="cb35-25"><a href="#cb35-25"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb35-26"><a href="#cb35-26"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb35-27"><a href="#cb35-27"></a>  <span class="co"># Add labels</span></span>
<span id="cb35-28"><a href="#cb35-28"></a>  <span class="fu">labs</span>(</span>
<span id="cb35-29"><a href="#cb35-29"></a>    <span class="at">title =</span> <span class="st">"Vehicle thefts in South African municipalities"</span>,</span>
<span id="cb35-30"><a href="#cb35-30"></a>    <span class="at">subtitle =</span> <span class="fu">str_glue</span>(</span>
<span id="cb35-31"><a href="#cb35-31"></a>      <span class="st">"each dot represents one municipality, 2018-19, dashed lines show "</span>,</span>
<span id="cb35-32"><a href="#cb35-32"></a>      <span class="st">"median values"</span></span>
<span id="cb35-33"><a href="#cb35-33"></a>    ),</span>
<span id="cb35-34"><a href="#cb35-34"></a>    <span class="at">x =</span> <span class="st">"rate of thefts of motor vehicles per 1,000 vehicle-owning households"</span>,</span>
<span id="cb35-35"><a href="#cb35-35"></a>    <span class="at">y =</span> <span class="st">"rate of thefts from motor vehicles per 1,000 vehicle-owning households"</span></span>
<span id="cb35-36"><a href="#cb35-36"></a>  ) <span class="sc">+</span></span>
<span id="cb35-37"><a href="#cb35-37"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Finally, we can add a trend line to the plot. We do this using the <code>geom_smooth()</code> function from ggplot2. <code>geom_smooth()</code> can add different types of trend line to a plot, but in this example we will specify a simple linear trend line by setting <code>method = "lm"</code>. We will also specify <code>formula = y ~ x</code> (the default) to avoid <code>geom_smooth()</code> producing a message to tell us what formula it used to calculate the trend.</p>
<p>Add this code to the R script file and run it.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter15c.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb36" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># Create scatter plot of vehicle theft</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>vehicle_theft_wider <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="co"># Create a new column in the data, either containing the municipality name or</span></span>
<span id="cb36-4"><a href="#cb36-4"></a>  <span class="co"># `NA` depending on the values of `theft_of` and `theft_from`</span></span>
<span id="cb36-5"><a href="#cb36-5"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">if_else</span>(theft_of <span class="sc">&gt;</span> <span class="dv">17</span> <span class="sc">|</span> theft_from <span class="sc">&gt;</span> <span class="dv">65</span>, municipality, <span class="cn">NA</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb36-6"><a href="#cb36-6"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb36-7"><a href="#cb36-7"></a>  <span class="co"># Specify which columns in the data should control the x and y positions of</span></span>
<span id="cb36-8"><a href="#cb36-8"></a>  <span class="co"># each point and the labels (for those points that have labels)</span></span>
<span id="cb36-9"><a href="#cb36-9"></a>  <span class="fu">aes</span>(<span class="at">x =</span> theft_of, <span class="at">y =</span> theft_from, <span class="at">label =</span> label) <span class="sc">+</span></span>
<span id="cb36-10"><a href="#cb36-10"></a>  <span class="co"># Add vertical line showing median rate of theft of a vehicle</span></span>
<span id="cb36-11"><a href="#cb36-11"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb36-12"><a href="#cb36-12"></a>    <span class="at">xintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_of"</span>)),</span>
<span id="cb36-13"><a href="#cb36-13"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb36-14"><a href="#cb36-14"></a>  ) <span class="sc">+</span></span>
<span id="cb36-15"><a href="#cb36-15"></a>  <span class="co"># Add horizontal line showing median rate of theft from a vehicle</span></span>
<span id="cb36-16"><a href="#cb36-16"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb36-17"><a href="#cb36-17"></a>    <span class="at">yintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_from"</span>)),</span>
<span id="cb36-18"><a href="#cb36-18"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb36-19"><a href="#cb36-19"></a>  ) <span class="sc">+</span></span>
<span id="cb36-20"><a href="#cb36-20"></a>  <span class="co"># Add trend line</span></span>
<span id="cb36-21"><a href="#cb36-21"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">colour =</span> <span class="st">"grey20"</span>) <span class="sc">+</span></span>
<span id="cb36-22"><a href="#cb36-22"></a>  <span class="co"># Add points</span></span>
<span id="cb36-23"><a href="#cb36-23"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb36-24"><a href="#cb36-24"></a>  <span class="co"># Add labels</span></span>
<span id="cb36-25"><a href="#cb36-25"></a>  <span class="fu">geom_label_repel</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">label.size =</span> <span class="dv">0</span>, <span class="at">lineheight =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb36-26"><a href="#cb36-26"></a>  <span class="co"># Specify the format for the axis labels</span></span>
<span id="cb36-27"><a href="#cb36-27"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb36-28"><a href="#cb36-28"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb36-29"><a href="#cb36-29"></a>  <span class="co"># Add labels</span></span>
<span id="cb36-30"><a href="#cb36-30"></a>  <span class="fu">labs</span>(</span>
<span id="cb36-31"><a href="#cb36-31"></a>    <span class="at">title =</span> <span class="st">"Vehicle thefts in South African municipalities"</span>,</span>
<span id="cb36-32"><a href="#cb36-32"></a>    <span class="at">subtitle =</span> <span class="fu">str_glue</span>(</span>
<span id="cb36-33"><a href="#cb36-33"></a>      <span class="st">"each dot represents one municipality, 2018-19, dashed lines show "</span>,</span>
<span id="cb36-34"><a href="#cb36-34"></a>      <span class="st">"median values"</span></span>
<span id="cb36-35"><a href="#cb36-35"></a>    ),</span>
<span id="cb36-36"><a href="#cb36-36"></a>    <span class="at">x =</span> <span class="st">"rate of thefts of motor vehicles per 1,000 vehicle-owning households"</span>,</span>
<span id="cb36-37"><a href="#cb36-37"></a>    <span class="at">y =</span> <span class="st">"rate of thefts from motor vehicles per 1,000 vehicle-owning households"</span></span>
<span id="cb36-38"><a href="#cb36-38"></a>  ) <span class="sc">+</span></span>
<span id="cb36-39"><a href="#cb36-39"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>Warning: The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why does this code produce a warning <code>The following aesthetics were dropped ...</code>?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The code that produces the chart above also produces a warning saying some aesthetics were dropped during a statistical transformation. This is because <code>geom_smooth()</code> does not know how to use the <code>label</code> aesthetic. There are two options to prevent this warning appearing in a Quarto document. First, you could set the <code>#| warning: false</code> chunk option, although this will suppress any other warnings produced by this code chunk, so you should only add this chunk option once you are sure the code runs without any problems.</p>
<p>The second option is to remove <code>label = label</code> from the call to <code>aes()</code> on line 9 of the code and add <code>aes(label = label)</code> separately on line 21.</p>
</div>
</div>
</div>
<p>From this chart, we can see which municipalities have particularly unusual vehicle-theft rates. For example, we might well want to explore the rates of theft from vehicles in Beaufort West or Stellenbosch municipalities to see what makes them so different from the others, and similarly for the rate of theft of vehicles in Ethekwini.</p>
<p>One note of caution when using <code>geom_smooth()</code>: this function will show the <em>direction</em> of the relationship between two variables regardless of the <em>strength</em> of that relationship. In extreme cases, that could mean that a chart would show a trend line between two variables even if the variables had almost no relationship to one another.</p>
<p>For example, <code>geom_smooth()</code> produces a line showing the direction of the relationship between the two variables in each of these three charts, even though the relationship on the right is much stronger than the one on the left.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/geom-smooth-relationships-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Don’t try to interpret the strength of a relationship from a trend line
</div>
</div>
<div class="callout-body-container callout-body">
<p>Be very careful about trying to interpret the strength of relationships between two variables by plotting them on a chart. It is much better to measure the strength of the relationship using a statistical test such as a correlation test, but statistical tests are outside the scope of this course.</p>
</div>
</div>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Visualising distributions
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Which of these types of visualization is best used to show the distribution of a single continuous variable?</strong></p>
<div id="radio_MDNQMLLARV" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_MDNQMLLARV" value=""> <span>Pie chart</span></label><label><input type="radio" autocomplete="off" name="radio_MDNQMLLARV" value="answer"> <span>Density plot</span></label><label><input type="radio" autocomplete="off" name="radio_MDNQMLLARV" value=""> <span>Bar chart</span></label><label><input type="radio" autocomplete="off" name="radio_MDNQMLLARV" value=""> <span>Scatter plot</span></label>
</div>
<p><strong>What is an advantage of using a density plot over a histogram?</strong></p>
<div id="radio_ZWZFCVKEQA" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_ZWZFCVKEQA" value="answer"> <span>Density plots do not require binning data into categories</span></label><label><input type="radio" autocomplete="off" name="radio_ZWZFCVKEQA" value=""> <span>Density plots always provide exact numerical values</span></label><label><input type="radio" autocomplete="off" name="radio_ZWZFCVKEQA" value=""> <span>Density plots are only used for categorical data</span></label><label><input type="radio" autocomplete="off" name="radio_ZWZFCVKEQA" value=""> <span>Density plots cannot be used for crime analysis</span></label>
</div>
</div>
</div>
</section>
<section id="in-summary" class="level2" data-number="15.6">
<h2 data-number="15.6" class="anchored" data-anchor-id="in-summary"><span class="header-section-number">15.6</span> In summary</h2>
<p>In this chapter we have learned how to present data about crime at places without using maps. These techniques give us more flexibility about how to best present data to communicate the main points that we want to get across.</p>
<p>Whether to use a map or a chart, and which type of map or chart to use, are design decisions for you to make. When you make these decisions, always remember that what is most important is that your audience understands your message. This makes it very important that you understand your audience.</p>
<div class="box reading">
<p>Visualising data with charts is a very large topic and there are lots of resources available to help you learn more. To get started, you might want to look at:</p>
<ul>
<li><a href="https://uc-r.github.io/ggplot_intro">An Introduction to ggplot2</a> from the University of Cincinnati Business Analytics team.</li>
<li>The <a href="https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf">ggplot2 cheat sheet</a> by the team that develops the ggplot2 package.</li>
<li>The <a href="https://www.r-graph-gallery.com/">R Graph Gallery</a> for examples of many other types of chart that you can produce in R.</li>
</ul>
</div>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check your knowledge: Revision questions
</div>
</div>
<div class="callout-body-container callout-body">
<p>Answer these questions to check you have understood the main points covered in this chapter. Write between 50 and 100 words to answer each question.</p>
<ol type="1">
<li>Explain at least two scenarios where using a table or a chart would be more effective than a map for presenting spatial data.</li>
<li>Why might you choose to use a bar chart rather than a choropleth map for displaying crime data in some circumstances?</li>
<li>When should you use a table instead of a bar chart to convey information about a continuous variable for each of several categories?</li>
<li>When is it useful to include a reference map alongside a chart, and when is it unnecessary?</li>
<li>What factors should you consider when choosing the best way to present spatial data?</li>
</ol>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../14_writing_reports/index.html" class="pagination-link" aria-label="Writing reports in R">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Writing reports in R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../16_mapping_time/index.html" class="pagination-link" aria-label="Mapping crime over time">
        <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Mapping crime over time</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb38" data-shortcodes="false" data-code-line-numbers=""><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb38-1"><a href="#cb38-1"></a><span class="fu"># Presenting spatial data without maps {#sec-no-maps}</span></span>
<span id="cb38-2"><a href="#cb38-2"></a></span>
<span id="cb38-3"><a href="#cb38-3"></a></span>
<span id="cb38-4"><a href="#cb38-4"></a>::: {.abstract}</span>
<span id="cb38-5"><a href="#cb38-5"></a>Maps are a powerful tool for visualizing spatial data, but they are not always the best choice. This chapter explores alternative methods for presenting spatial data effectively, including tables and charts. By understanding when to use these techniques, you will learn how to communicate spatial information clearly and concisely. The chapter covers key scenarios where maps may be less effective, such as when summarizing small datasets or comparing multiple variables.</span>
<span id="cb38-6"><a href="#cb38-6"></a>:::</span>
<span id="cb38-7"><a href="#cb38-7"></a></span>
<span id="cb38-8"><a href="#cb38-8"></a></span>
<span id="cb38-9"><a href="#cb38-9"></a>::: {.callout-tip}</span>
<span id="cb38-10"><a href="#cb38-10"></a><span class="fu">#### Before you start</span></span>
<span id="cb38-11"><a href="#cb38-11"></a></span>
<span id="cb38-12"><a href="#cb38-12"></a>Open RStudio or -- if you already have RStudio open -- click <span class="in">`Session`</span> then <span class="in">`Restart R`</span>. Make sure you're working inside the Crime Mapping RStudio project you created in @sec-create-project, then you're ready to start mapping.</span>
<span id="cb38-13"><a href="#cb38-13"></a>:::</span>
<span id="cb38-14"><a href="#cb38-14"></a></span>
<span id="cb38-15"><a href="#cb38-15"></a></span>
<span id="cb38-16"><a href="#cb38-16"></a></span>
<span id="cb38-17"><a href="#cb38-17"></a><span class="fu">## Introduction</span></span>
<span id="cb38-18"><a href="#cb38-18"></a></span>
<span id="cb38-19"><a href="#cb38-19"></a>Making maps is the core of analysing spatial data. But just because a particular dataset has a spatial element to it does not always mean that a map is the best way to present that data. In this chapter we will learn some other techniques for presenting data that can be more effective than maps for answering certain questions about spatial data. </span>
<span id="cb38-20"><a href="#cb38-20"></a></span>
<span id="cb38-21"><a href="#cb38-21"></a>As with so much in spatial analysis, whether it is best to make a map or use some other technique to convey information will depend on the circumstances. When you decide how to communicate information about the data you are analysing, you will need to consider the questions you are trying to answer, the audience that you are communicating to, what they will be using the information for and in what circumstances they will be using it.</span>
<span id="cb38-22"><a href="#cb38-22"></a></span>
<span id="cb38-23"><a href="#cb38-23"></a>While the best choice of how to communicate spatial information will depend on the circumstances, there are a few instances in which maps are typically *not* the best way to communicate your data. These include:</span>
<span id="cb38-24"><a href="#cb38-24"></a></span>
<span id="cb38-25"><a href="#cb38-25"></a></span>
<span id="cb38-26"><a href="#cb38-26"></a><span class="fu">#### When you only need to convey a handful of pieces of information {.unnumbered}</span></span>
<span id="cb38-27"><a href="#cb38-27"></a>  </span>
<span id="cb38-28"><a href="#cb38-28"></a>Maps are very effective for communicating detailed information, such as the density of crime across thousands of cells in a KDE grid. But to do this, maps typically encode information into aesthetics such as colour, size and so on. This is necessary for communicating large amounts of information, but it makes the connection between the data and the visual representation of the data less direct. If you only need to communicate a small amount of information, there is less justification for forcing your audience to mentally translate the aesthetic into whatever it represents. </span>
<span id="cb38-29"><a href="#cb38-29"></a></span>
<span id="cb38-30"><a href="#cb38-30"></a>For example, if you wanted to show the number of violent and sexual offences in each of the seven districts in Northamptonshire in England, a choropleth map is less clear than a bar chart (for example, in being able to decipher if there were more offences in Kettering or in Wellingborough). </span>
<span id="cb38-31"><a href="#cb38-31"></a></span>
<span id="cb38-32"><a href="#cb38-32"></a></span>
<span id="cb38-33"><a href="#cb38-33"></a><span class="in">```{r northants-district-maps, echo=FALSE, eval=FALSE}</span></span>
<span id="cb38-34"><a href="#cb38-34"></a><span class="in">library(patchwork)</span></span>
<span id="cb38-35"><a href="#cb38-35"></a></span>
<span id="cb38-36"><a href="#cb38-36"></a><span class="in"># Load crime data</span></span>
<span id="cb38-37"><a href="#cb38-37"></a><span class="in">data_dir &lt;- str_glue("{tempdir()}/crime_data")</span></span>
<span id="cb38-38"><a href="#cb38-38"></a><span class="in">unzip(</span></span>
<span id="cb38-39"><a href="#cb38-39"></a><span class="in">  zipfile = here::here("inst/tutorials/prep/code/northamptonshire_crimes_2020.zip"),</span></span>
<span id="cb38-40"><a href="#cb38-40"></a><span class="in">  exdir = data_dir</span></span>
<span id="cb38-41"><a href="#cb38-41"></a><span class="in">)</span></span>
<span id="cb38-42"><a href="#cb38-42"></a><span class="in">violence &lt;- data_dir %&gt;%</span></span>
<span id="cb38-43"><a href="#cb38-43"></a><span class="in">  dir(pattern = ".csv", full.names = TRUE, recursive = TRUE) %&gt;%</span></span>
<span id="cb38-44"><a href="#cb38-44"></a><span class="in">  map_dfr(read_csv) %&gt;%</span></span>
<span id="cb38-45"><a href="#cb38-45"></a><span class="in">  janitor::clean_names() %&gt;%</span></span>
<span id="cb38-46"><a href="#cb38-46"></a><span class="in">  filter(crime_type == "Violence and sexual offences") %&gt;%</span></span>
<span id="cb38-47"><a href="#cb38-47"></a><span class="in">  st_as_sf(coords = c("longitude", "latitude"), crs = 4326)</span></span>
<span id="cb38-48"><a href="#cb38-48"></a></span>
<span id="cb38-49"><a href="#cb38-49"></a><span class="in"># Load boundary data</span></span>
<span id="cb38-50"><a href="#cb38-50"></a><span class="in">districts &lt;- read_sf("https://opendata.arcgis.com/datasets/0e07a8196454415eab18c40a54dfbbef_0.geojson") %&gt;%</span></span>
<span id="cb38-51"><a href="#cb38-51"></a><span class="in">  janitor::clean_names() %&gt;%</span></span>
<span id="cb38-52"><a href="#cb38-52"></a><span class="in">  filter(lad19nm %in% c(</span></span>
<span id="cb38-53"><a href="#cb38-53"></a><span class="in">    "South Northamptonshire", "Northampton", "Daventry", "Wellingborough",</span></span>
<span id="cb38-54"><a href="#cb38-54"></a><span class="in">    "Kettering", "Corby", "East Northamptonshire"</span></span>
<span id="cb38-55"><a href="#cb38-55"></a><span class="in">  )) %&gt;%</span></span>
<span id="cb38-56"><a href="#cb38-56"></a><span class="in">  select(lad19nm, geometry)</span></span>
<span id="cb38-57"><a href="#cb38-57"></a></span>
<span id="cb38-58"><a href="#cb38-58"></a><span class="in"># Calculate violence counts at district level</span></span>
<span id="cb38-59"><a href="#cb38-59"></a><span class="in">violence_counts &lt;- violence %&gt;%</span></span>
<span id="cb38-60"><a href="#cb38-60"></a><span class="in">  st_join(districts) %&gt;%</span></span>
<span id="cb38-61"><a href="#cb38-61"></a><span class="in">  st_drop_geometry() %&gt;%</span></span>
<span id="cb38-62"><a href="#cb38-62"></a><span class="in">  count(lad19nm) %&gt;%</span></span>
<span id="cb38-63"><a href="#cb38-63"></a><span class="in">  drop_na() %&gt;%</span></span>
<span id="cb38-64"><a href="#cb38-64"></a><span class="in">  right_join(districts, by = "lad19nm") %&gt;%</span></span>
<span id="cb38-65"><a href="#cb38-65"></a><span class="in">  st_as_sf() %&gt;%</span></span>
<span id="cb38-66"><a href="#cb38-66"></a><span class="in">  mutate(hjust = if_else(n == max(n), 1, 0))</span></span>
<span id="cb38-67"><a href="#cb38-67"></a></span>
<span id="cb38-68"><a href="#cb38-68"></a><span class="in"># Download base map</span></span>
<span id="cb38-69"><a href="#cb38-69"></a><span class="in">base_map &lt;- violence_counts %&gt;%</span></span>
<span id="cb38-70"><a href="#cb38-70"></a><span class="in">  st_bbox() %&gt;%</span></span>
<span id="cb38-71"><a href="#cb38-71"></a><span class="in">  set_names(c("left", "bottom", "right", "top")) %&gt;%</span></span>
<span id="cb38-72"><a href="#cb38-72"></a><span class="in">  get_stamenmap(maptype = "toner-lines")</span></span>
<span id="cb38-73"><a href="#cb38-73"></a></span>
<span id="cb38-74"><a href="#cb38-74"></a><span class="in"># Create map</span></span>
<span id="cb38-75"><a href="#cb38-75"></a><span class="in">violence_map &lt;- ggmap(base_map) +</span></span>
<span id="cb38-76"><a href="#cb38-76"></a><span class="in">  geom_sf(aes(fill = n), data = violence_counts, inherit.aes = FALSE, alpha = 0.8) +</span></span>
<span id="cb38-77"><a href="#cb38-77"></a><span class="in">  geom_sf_label(</span></span>
<span id="cb38-78"><a href="#cb38-78"></a><span class="in">    aes(label = str_replace_all(lad19nm, "\\s", "\n")),</span></span>
<span id="cb38-79"><a href="#cb38-79"></a><span class="in">    data = violence_counts,</span></span>
<span id="cb38-80"><a href="#cb38-80"></a><span class="in">    inherit.aes = FALSE,</span></span>
<span id="cb38-81"><a href="#cb38-81"></a><span class="in">    alpha = 0.7,</span></span>
<span id="cb38-82"><a href="#cb38-82"></a><span class="in">    colour = "grey20",</span></span>
<span id="cb38-83"><a href="#cb38-83"></a><span class="in">    label.size = NA,</span></span>
<span id="cb38-84"><a href="#cb38-84"></a><span class="in">    lineheight = 0.9,</span></span>
<span id="cb38-85"><a href="#cb38-85"></a><span class="in">    size = 2.5</span></span>
<span id="cb38-86"><a href="#cb38-86"></a><span class="in">  ) +</span></span>
<span id="cb38-87"><a href="#cb38-87"></a><span class="in">  scale_fill_distiller(</span></span>
<span id="cb38-88"><a href="#cb38-88"></a><span class="in">    palette = "Oranges",</span></span>
<span id="cb38-89"><a href="#cb38-89"></a><span class="in">    labels = scales::comma_format(),</span></span>
<span id="cb38-90"><a href="#cb38-90"></a><span class="in">    limits = c(0, NA),</span></span>
<span id="cb38-91"><a href="#cb38-91"></a><span class="in">    direction = 1,</span></span>
<span id="cb38-92"><a href="#cb38-92"></a><span class="in">    guide = guide_colorbar(title.position = "top", barwidth = unit(0.25, "npc"))</span></span>
<span id="cb38-93"><a href="#cb38-93"></a><span class="in">  ) +</span></span>
<span id="cb38-94"><a href="#cb38-94"></a><span class="in">  labs(</span></span>
<span id="cb38-95"><a href="#cb38-95"></a><span class="in">    fill = "number of violent and sexual offences"</span></span>
<span id="cb38-96"><a href="#cb38-96"></a><span class="in">  ) +</span></span>
<span id="cb38-97"><a href="#cb38-97"></a><span class="in">  theme_void() +</span></span>
<span id="cb38-98"><a href="#cb38-98"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb38-99"><a href="#cb38-99"></a></span>
<span id="cb38-100"><a href="#cb38-100"></a><span class="in"># Create small reference map</span></span>
<span id="cb38-101"><a href="#cb38-101"></a><span class="in">reference_map &lt;- ggmap(base_map) +</span></span>
<span id="cb38-102"><a href="#cb38-102"></a><span class="in">  # Add a 50% white mask to reduce the visibility of the base map</span></span>
<span id="cb38-103"><a href="#cb38-103"></a><span class="in">  annotate(</span></span>
<span id="cb38-104"><a href="#cb38-104"></a><span class="in">    "rect",</span></span>
<span id="cb38-105"><a href="#cb38-105"></a><span class="in">    xmin = -Inf,</span></span>
<span id="cb38-106"><a href="#cb38-106"></a><span class="in">    xmax = Inf,</span></span>
<span id="cb38-107"><a href="#cb38-107"></a><span class="in">    ymin = -Inf,</span></span>
<span id="cb38-108"><a href="#cb38-108"></a><span class="in">    ymax = Inf,</span></span>
<span id="cb38-109"><a href="#cb38-109"></a><span class="in">    alpha = 0.5,</span></span>
<span id="cb38-110"><a href="#cb38-110"></a><span class="in">    fill = "white"</span></span>
<span id="cb38-111"><a href="#cb38-111"></a><span class="in">  ) +</span></span>
<span id="cb38-112"><a href="#cb38-112"></a><span class="in">  geom_sf(</span></span>
<span id="cb38-113"><a href="#cb38-113"></a><span class="in">    data = districts,</span></span>
<span id="cb38-114"><a href="#cb38-114"></a><span class="in">    inherit.aes = FALSE,</span></span>
<span id="cb38-115"><a href="#cb38-115"></a><span class="in">    alpha = 0.8,</span></span>
<span id="cb38-116"><a href="#cb38-116"></a><span class="in">    colour = "grey50",</span></span>
<span id="cb38-117"><a href="#cb38-117"></a><span class="in">    fill = NA</span></span>
<span id="cb38-118"><a href="#cb38-118"></a><span class="in">  ) +</span></span>
<span id="cb38-119"><a href="#cb38-119"></a><span class="in">  geom_sf_label(</span></span>
<span id="cb38-120"><a href="#cb38-120"></a><span class="in">    aes(label = str_replace_all(str_to_upper(lad19nm), "\\s", "\n")),</span></span>
<span id="cb38-121"><a href="#cb38-121"></a><span class="in">    data = violence_counts,</span></span>
<span id="cb38-122"><a href="#cb38-122"></a><span class="in">    inherit.aes = FALSE,</span></span>
<span id="cb38-123"><a href="#cb38-123"></a><span class="in">    alpha = 0.7,</span></span>
<span id="cb38-124"><a href="#cb38-124"></a><span class="in">    fontface = "bold",</span></span>
<span id="cb38-125"><a href="#cb38-125"></a><span class="in">    label.size = NA,</span></span>
<span id="cb38-126"><a href="#cb38-126"></a><span class="in">    lineheight = 0.9,</span></span>
<span id="cb38-127"><a href="#cb38-127"></a><span class="in">    size = 2</span></span>
<span id="cb38-128"><a href="#cb38-128"></a><span class="in">  ) +</span></span>
<span id="cb38-129"><a href="#cb38-129"></a><span class="in">  theme_void() +</span></span>
<span id="cb38-130"><a href="#cb38-130"></a><span class="in">  theme(</span></span>
<span id="cb38-131"><a href="#cb38-131"></a><span class="in">    legend.position = "none",</span></span>
<span id="cb38-132"><a href="#cb38-132"></a><span class="in">    panel.border = element_rect(colour = "grey50", fill = NA)</span></span>
<span id="cb38-133"><a href="#cb38-133"></a><span class="in">  )</span></span>
<span id="cb38-134"><a href="#cb38-134"></a></span>
<span id="cb38-135"><a href="#cb38-135"></a><span class="in"># Create bar chart</span></span>
<span id="cb38-136"><a href="#cb38-136"></a><span class="in">violence_chart &lt;- violence_counts %&gt;%</span></span>
<span id="cb38-137"><a href="#cb38-137"></a><span class="in">  mutate(lad19nm = fct_reorder(str_replace_all(lad19nm, "\\s", "\n"), n)) %&gt;%</span></span>
<span id="cb38-138"><a href="#cb38-138"></a><span class="in">  ggplot(aes(n, lad19nm)) +</span></span>
<span id="cb38-139"><a href="#cb38-139"></a><span class="in">  geom_col(fill = "orange3") +</span></span>
<span id="cb38-140"><a href="#cb38-140"></a><span class="in">  geom_label(</span></span>
<span id="cb38-141"><a href="#cb38-141"></a><span class="in">    aes(label = scales::comma(n), fill = as_factor(hjust), hjust = hjust),</span></span>
<span id="cb38-142"><a href="#cb38-142"></a><span class="in">    label.size = NA,</span></span>
<span id="cb38-143"><a href="#cb38-143"></a><span class="in">    size = 2.5</span></span>
<span id="cb38-144"><a href="#cb38-144"></a><span class="in">  ) +</span></span>
<span id="cb38-145"><a href="#cb38-145"></a><span class="in">  scale_x_continuous(labels = scales::comma_format(), expand = c(0, 0)) +</span></span>
<span id="cb38-146"><a href="#cb38-146"></a><span class="in">  scale_fill_manual(values = c(`1` = "orange3", `0` = "white")) +</span></span>
<span id="cb38-147"><a href="#cb38-147"></a><span class="in">  labs(</span></span>
<span id="cb38-148"><a href="#cb38-148"></a><span class="in">    x = "number of violent and sexual offences",</span></span>
<span id="cb38-149"><a href="#cb38-149"></a><span class="in">    y = NULL</span></span>
<span id="cb38-150"><a href="#cb38-150"></a><span class="in">  ) +</span></span>
<span id="cb38-151"><a href="#cb38-151"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb38-152"><a href="#cb38-152"></a><span class="in">  theme(</span></span>
<span id="cb38-153"><a href="#cb38-153"></a><span class="in">    legend.position = "none",</span></span>
<span id="cb38-154"><a href="#cb38-154"></a><span class="in">    panel.grid.major.y = element_blank(),</span></span>
<span id="cb38-155"><a href="#cb38-155"></a><span class="in">    panel.grid.minor.y = element_blank()</span></span>
<span id="cb38-156"><a href="#cb38-156"></a><span class="in">  )</span></span>
<span id="cb38-157"><a href="#cb38-157"></a></span>
<span id="cb38-158"><a href="#cb38-158"></a><span class="in"># Create violence map and chart combo</span></span>
<span id="cb38-159"><a href="#cb38-159"></a><span class="in">violence_combined &lt;- violence_map + violence_chart + plot_annotation(</span></span>
<span id="cb38-160"><a href="#cb38-160"></a><span class="in">  title = "Violent and sexual offences in Northamptonshire, 2020",</span></span>
<span id="cb38-161"><a href="#cb38-161"></a><span class="in">  caption = "Contains public sector information licensed under the Open Government Licence v3.0."</span></span>
<span id="cb38-162"><a href="#cb38-162"></a><span class="in">)</span></span>
<span id="cb38-163"><a href="#cb38-163"></a></span>
<span id="cb38-164"><a href="#cb38-164"></a><span class="in"># Save violence map and chart combo</span></span>
<span id="cb38-165"><a href="#cb38-165"></a><span class="in">ggsave(</span></span>
<span id="cb38-166"><a href="#cb38-166"></a><span class="in">  filename = here::here("inst/tutorials/15_no_maps/images/map_vs_bar_chart.png"),</span></span>
<span id="cb38-167"><a href="#cb38-167"></a><span class="in">  plot = violence_combined,</span></span>
<span id="cb38-168"><a href="#cb38-168"></a><span class="in">  width = 1200 / 150,</span></span>
<span id="cb38-169"><a href="#cb38-169"></a><span class="in">  height = 800 / 150,</span></span>
<span id="cb38-170"><a href="#cb38-170"></a><span class="in">  dpi = 300</span></span>
<span id="cb38-171"><a href="#cb38-171"></a><span class="in">)</span></span>
<span id="cb38-172"><a href="#cb38-172"></a></span>
<span id="cb38-173"><a href="#cb38-173"></a><span class="in"># Create chart with reference map</span></span>
<span id="cb38-174"><a href="#cb38-174"></a><span class="in">chart_reference &lt;-</span></span>
<span id="cb38-175"><a href="#cb38-175"></a><span class="in">  # reference_map +</span></span>
<span id="cb38-176"><a href="#cb38-176"></a><span class="in">  violence_chart +</span></span>
<span id="cb38-177"><a href="#cb38-177"></a><span class="in">  inset_element(</span></span>
<span id="cb38-178"><a href="#cb38-178"></a><span class="in">    reference_map,</span></span>
<span id="cb38-179"><a href="#cb38-179"></a><span class="in">    top = 0.7,</span></span>
<span id="cb38-180"><a href="#cb38-180"></a><span class="in">    right = unit(1, "npc"),</span></span>
<span id="cb38-181"><a href="#cb38-181"></a><span class="in">    bottom = 0,</span></span>
<span id="cb38-182"><a href="#cb38-182"></a><span class="in">    left = 0.5</span></span>
<span id="cb38-183"><a href="#cb38-183"></a><span class="in">  ) +</span></span>
<span id="cb38-184"><a href="#cb38-184"></a><span class="in">  # plot_layout(widths = c(1, 2)) +</span></span>
<span id="cb38-185"><a href="#cb38-185"></a><span class="in">  plot_annotation(</span></span>
<span id="cb38-186"><a href="#cb38-186"></a><span class="in">    title = "Violent and sexual offences in Northamptonshire, 2020",</span></span>
<span id="cb38-187"><a href="#cb38-187"></a><span class="in">    caption = "Contains public sector information licensed under the Open Government Licence v3.0."</span></span>
<span id="cb38-188"><a href="#cb38-188"></a><span class="in">  )</span></span>
<span id="cb38-189"><a href="#cb38-189"></a></span>
<span id="cb38-190"><a href="#cb38-190"></a><span class="in"># Save chart with reference map</span></span>
<span id="cb38-191"><a href="#cb38-191"></a><span class="in">ggsave(</span></span>
<span id="cb38-192"><a href="#cb38-192"></a><span class="in">  filename = here::here("inst/tutorials/15_no_maps/images/bar_chart_ref_map.png"),</span></span>
<span id="cb38-193"><a href="#cb38-193"></a><span class="in">  plot = chart_reference,</span></span>
<span id="cb38-194"><a href="#cb38-194"></a><span class="in">  width = 1200 / 150,</span></span>
<span id="cb38-195"><a href="#cb38-195"></a><span class="in">  height = 800 / 150,</span></span>
<span id="cb38-196"><a href="#cb38-196"></a><span class="in">  dpi = 300</span></span>
<span id="cb38-197"><a href="#cb38-197"></a><span class="in">)</span></span>
<span id="cb38-198"><a href="#cb38-198"></a><span class="in">```</span></span>
<span id="cb38-199"><a href="#cb38-199"></a></span>
<span id="cb38-200"><a href="#cb38-200"></a></span>
<span id="cb38-201"><a href="#cb38-201"></a>&lt;p class="full-width-image"&gt;&lt;img src="../images/map_vs_bar_chart.png" alt="Choropleth map and bar chart both showing the frequency of violence in each district in Northamptonshire in 2020"&gt;&lt;/p&gt;</span>
<span id="cb38-202"><a href="#cb38-202"></a></span>
<span id="cb38-203"><a href="#cb38-203"></a>A map might be a useful addition to the bar chart in this case *if* you are trying to communicate information to people who are not familiar with the locations of the districts. In that case, we might want to add a small reference map to help people understand which area is which:</span>
<span id="cb38-204"><a href="#cb38-204"></a></span>
<span id="cb38-205"><a href="#cb38-205"></a>&lt;p class="full-width-image"&gt;&lt;img src="../images/bar_chart_ref_map.png" alt="Bar chart showing the frequency of violence in each district in Northamptonshire in 2020, with a reference map showing the area covered by each district"&gt;&lt;/p&gt;</span>
<span id="cb38-206"><a href="#cb38-206"></a></span>
<span id="cb38-207"><a href="#cb38-207"></a>But in most circumstances in which you create crime maps, you will be creating them for an audience (such as local police officers) that already has sufficient knowledge of the area and so an inset map such as this would not be needed. In that case, a bar chart will probably be more effective at showing this information than a map would be.</span>
<span id="cb38-208"><a href="#cb38-208"></a></span>
<span id="cb38-209"><a href="#cb38-209"></a></span>
<span id="cb38-210"><a href="#cb38-210"></a><span class="fu">#### When you need to convey several different things about one place {.unnumbered}</span></span>
<span id="cb38-211"><a href="#cb38-211"></a>  </span>
<span id="cb38-212"><a href="#cb38-212"></a>Maps are generally most effective when they show a single piece of data about each place (e.g. a grid cell or a polygon representing a statistical area). For example, a choropleth map shows a single shade of colour for each area on the map to represent a single value, such as the frequency or rate of crime in that area. If you wanted to show the frequency of burglary *and* the frequency of robbery in the same area on a map, this would be quite hard. So if you need to convey multiple different things about each place, it is generally best to do this in a table or chart, rather than a map. </span>
<span id="cb38-213"><a href="#cb38-213"></a></span>
<span id="cb38-214"><a href="#cb38-214"></a>One exception to this is when you present multiple maps side by side, each showing a single thing about an area. These are called *small multiple* maps and we will learn about them in @sec-mapping-time.</span>
<span id="cb38-215"><a href="#cb38-215"></a></span>
<span id="cb38-216"><a href="#cb38-216"></a></span>
<span id="cb38-217"><a href="#cb38-217"></a><span class="fu">#### When the geographic relationship between places on the map is not the most important thing about them {.unnumbered}</span></span>
<span id="cb38-218"><a href="#cb38-218"></a></span>
<span id="cb38-219"><a href="#cb38-219"></a>Maps emphasise the spatial relationship between different places, but they do this at the expense of making non-spatial relationships between those places less obvious. If the spatial relationships are the most important thing that you want to convey, a map makes sense. For example, a hotspot map is often a very good way to communicate where crime is most concentrated. But in other cases the geographic relationships between variables will be much less important. For example, if you wanted to show the relationship between the amount of crime in an area and the level of poverty there, a scatter plot would probably be a more-effective way to do this than a map would be.</span>
<span id="cb38-220"><a href="#cb38-220"></a></span>
<span id="cb38-221"><a href="#cb38-221"></a></span>
<span id="cb38-222"><a href="#cb38-222"></a>::: {.callout-quiz .callout}</span>
<span id="cb38-223"><a href="#cb38-223"></a><span class="fu">#### Maps, charts and tables</span></span>
<span id="cb38-224"><a href="#cb38-224"></a></span>
<span id="cb38-225"><a href="#cb38-225"></a><span class="in">```{r viz-type-quiz}</span></span>
<span id="cb38-226"><a href="#cb38-226"></a><span class="in">#| echo: false</span></span>
<span id="cb38-227"><a href="#cb38-227"></a></span>
<span id="cb38-228"><a href="#cb38-228"></a><span class="in">viz_type_quiz1 &lt;- c(</span></span>
<span id="cb38-229"><a href="#cb38-229"></a><span class="in">  "Maps are outdated and not widely used in spatial analysis",</span></span>
<span id="cb38-230"><a href="#cb38-230"></a><span class="in">  "Charts can always show spatial relationships more clearly",</span></span>
<span id="cb38-231"><a href="#cb38-231"></a><span class="in">  answer = "The relationships between places might not matter for the question at hand",</span></span>
<span id="cb38-232"><a href="#cb38-232"></a><span class="in">  "Maps cannot be used to display numerical data"</span></span>
<span id="cb38-233"><a href="#cb38-233"></a><span class="in">)</span></span>
<span id="cb38-234"><a href="#cb38-234"></a></span>
<span id="cb38-235"><a href="#cb38-235"></a><span class="in">viz_type_quiz2 &lt;- c(</span></span>
<span id="cb38-236"><a href="#cb38-236"></a><span class="in">  "The software used to create the visualization",</span></span>
<span id="cb38-237"><a href="#cb38-237"></a><span class="in">  answer = "The question being answered and the audience’s needs",</span></span>
<span id="cb38-238"><a href="#cb38-238"></a><span class="in">  "The geographic location of the data",</span></span>
<span id="cb38-239"><a href="#cb38-239"></a><span class="in">  "The number of colours available in the mapping tool"</span></span>
<span id="cb38-240"><a href="#cb38-240"></a><span class="in">)</span></span>
<span id="cb38-241"><a href="#cb38-241"></a><span class="in">```</span></span>
<span id="cb38-242"><a href="#cb38-242"></a></span>
<span id="cb38-243"><a href="#cb38-243"></a>**What is one reason why spatial relationships might not be important in some visualizations?**</span>
<span id="cb38-244"><a href="#cb38-244"></a></span>
<span id="cb38-245"><a href="#cb38-245"></a><span class="in">`r webexercises::longmcq(viz_type_quiz1)`</span></span>
<span id="cb38-246"><a href="#cb38-246"></a></span>
<span id="cb38-247"><a href="#cb38-247"></a></span>
<span id="cb38-248"><a href="#cb38-248"></a>**What is a key factor in deciding whether to use a map, table, or chart?**</span>
<span id="cb38-249"><a href="#cb38-249"></a></span>
<span id="cb38-250"><a href="#cb38-250"></a><span class="in">`r webexercises::longmcq(viz_type_quiz2)`</span></span>
<span id="cb38-251"><a href="#cb38-251"></a></span>
<span id="cb38-252"><a href="#cb38-252"></a></span>
<span id="cb38-253"><a href="#cb38-253"></a>:::</span>
<span id="cb38-254"><a href="#cb38-254"></a></span>
<span id="cb38-255"><a href="#cb38-255"></a></span>
<span id="cb38-256"><a href="#cb38-256"></a></span>
<span id="cb38-257"><a href="#cb38-257"></a><span class="fu">## Tables</span></span>
<span id="cb38-258"><a href="#cb38-258"></a></span>
<span id="cb38-259"><a href="#cb38-259"></a>Well-designed tables can be a very effective way of communicating information, whereas badly-design tables can be confusing and even lead your audience to give up trying to engage with the information you're trying to communicate. </span>
<span id="cb38-260"><a href="#cb38-260"></a></span>
<span id="cb38-261"><a href="#cb38-261"></a>Tables used to present information almost always show only a summary of the available data, so the first step in preparing a table is to wrangle the data into the right format. In @sec-summarise we learned about the <span class="in">`summarise()`</span> function from the dplyr package that we can use to produce summaries of rows of data.</span>
<span id="cb38-262"><a href="#cb38-262"></a></span>
<span id="cb38-263"><a href="#cb38-263"></a>To learn about creating a good table for displaying summary data in a report, we will use the example of the frequency of different types of violence in the different states of Malaysia in 2017. </span>
<span id="cb38-264"><a href="#cb38-264"></a></span>
<span id="cb38-265"><a href="#cb38-265"></a>Open a new R script file and save it as <span class="in">`chapter15a.R`</span>. Copy this code into that file and run it.</span>
<span id="cb38-266"><a href="#cb38-266"></a></span>
<span id="cb38-267"><a href="#cb38-267"></a></span>
<span id="cb38-270"><a href="#cb38-270"></a><span class="in">```{r}</span></span>
<span id="cb38-271"><a href="#cb38-271"></a><span class="co">#| filename: "chapter15a.R"</span></span>
<span id="cb38-272"><a href="#cb38-272"></a></span>
<span id="cb38-273"><a href="#cb38-273"></a><span class="co"># Load packages</span></span>
<span id="cb38-274"><a href="#cb38-274"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(gt, paletteer, tidyverse)</span>
<span id="cb38-275"><a href="#cb38-275"></a></span>
<span id="cb38-276"><a href="#cb38-276"></a><span class="co"># Load annual counts of different types of violence in Malaysia, 2006 to 2017</span></span>
<span id="cb38-277"><a href="#cb38-277"></a>violence <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/malaysia_violence_counts.rds"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-278"><a href="#cb38-278"></a>  <span class="co"># Keep only counts from 2017</span></span>
<span id="cb38-279"><a href="#cb38-279"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2017</span>)</span>
<span id="cb38-280"><a href="#cb38-280"></a><span class="in">```</span></span>
<span id="cb38-281"><a href="#cb38-281"></a></span>
<span id="cb38-282"><a href="#cb38-282"></a></span>
<span id="cb38-283"><a href="#cb38-283"></a>We can get a feel for the data by looking at a random sample of rows using the <span class="in">`slice_sample()`</span> function function from the dplyr package (remember dplyr was loaded automatically when we loaded tidyverse).</span>
<span id="cb38-284"><a href="#cb38-284"></a></span>
<span id="cb38-285"><a href="#cb38-285"></a></span>
<span id="cb38-288"><a href="#cb38-288"></a><span class="in">```{r}</span></span>
<span id="cb38-289"><a href="#cb38-289"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-290"><a href="#cb38-290"></a></span>
<span id="cb38-291"><a href="#cb38-291"></a><span class="fu">slice_sample</span>(violence, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb38-292"><a href="#cb38-292"></a><span class="in">```</span></span>
<span id="cb38-293"><a href="#cb38-293"></a></span>
<span id="cb38-294"><a href="#cb38-294"></a></span>
<span id="cb38-295"><a href="#cb38-295"></a>The output of <span class="in">`slice_sample()`</span> looks acceptable as a table, especially if it is included in a Quarto document, but readers of our reports probably don't want to know the type of each variable (underneath the variable names) and won't want to page through the table if there are more rows or columns than can fit in the available space. We can make this table much more useful for readers by wrangling it into a different format.</span>
<span id="cb38-296"><a href="#cb38-296"></a></span>
<span id="cb38-297"><a href="#cb38-297"></a></span>
<span id="cb38-298"><a href="#cb38-298"></a><span class="fu">### Making data wider for presentation</span></span>
<span id="cb38-299"><a href="#cb38-299"></a></span>
<span id="cb38-300"><a href="#cb38-300"></a>One issue with printing the <span class="in">`violence`</span> object as a table is that it has <span class="in">`r scales::comma(nrow(violence))`</span> rows, so it will take up a lot of space on a page or screen. We can make the data more compact by converting it from long format to wide format. In @sec-messy-data we learned that data are often easier to analyse in long format. But it is often better to _present_ data in a table in wide format. When you are choosing between storing data in long versus wide format, remember: analyse in long format, present in wide format.</span>
<span id="cb38-301"><a href="#cb38-301"></a></span>
<span id="cb38-302"><a href="#cb38-302"></a>To convert the table to a wider format we can use the <span class="in">`pivot_wider()`</span> function from the tidyr package, just was we used the corresponding <span class="in">`pivot_longer()`</span> function to tidy data in @sec-messy-data. To make data wider, we specify a single column in the data to use as the _names_ of multiple new columns using </span>
<span id="cb38-303"><a href="#cb38-303"></a>the <span class="in">`names_from`</span> argument and a column to use as the _values_ for the new columns using the <span class="in">`values_from`</span> argument.</span>
<span id="cb38-304"><a href="#cb38-304"></a></span>
<span id="cb38-305"><a href="#cb38-305"></a></span>
<span id="cb38-308"><a href="#cb38-308"></a><span class="in">```{r}</span></span>
<span id="cb38-309"><a href="#cb38-309"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-310"><a href="#cb38-310"></a></span>
<span id="cb38-311"><a href="#cb38-311"></a><span class="co"># Produce table of crime counts in each Malaysian state</span></span>
<span id="cb38-312"><a href="#cb38-312"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb38-313"><a href="#cb38-313"></a>  <span class="co"># Convert data to have one row per state</span></span>
<span id="cb38-314"><a href="#cb38-314"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb38-315"><a href="#cb38-315"></a>  <span class="co"># Convert new column names (the former values of `crime_type`) to snake case</span></span>
<span id="cb38-316"><a href="#cb38-316"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb38-317"><a href="#cb38-317"></a><span class="in">```</span></span>
<span id="cb38-318"><a href="#cb38-318"></a></span>
<span id="cb38-319"><a href="#cb38-319"></a></span>
<span id="cb38-320"><a href="#cb38-320"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb38-321"><a href="#cb38-321"></a><span class="fu">#### Why does this code include `janitor::clean_names()`</span></span>
<span id="cb38-322"><a href="#cb38-322"></a></span>
<span id="cb38-323"><a href="#cb38-323"></a>You will be used to seeing <span class="in">`janitor::clean_names()`</span> used to clean the column names in a dataset that has just been loaded. In this case, the new columns created by <span class="in">`pivot_wider()`</span> will have spaces in them, because the names are taken from the values of the <span class="in">`crime_type`</span> column in the original dataset. Column names with spaces in them a harder to work with, so this code converts them to snake case so that they are easier to work with. </span>
<span id="cb38-324"><a href="#cb38-324"></a></span>
<span id="cb38-325"><a href="#cb38-325"></a>Later in the code we will replace these column names with labels that are suitable for displaying the data in a table.</span>
<span id="cb38-326"><a href="#cb38-326"></a>:::</span>
<span id="cb38-327"><a href="#cb38-327"></a></span>
<span id="cb38-328"><a href="#cb38-328"></a></span>
<span id="cb38-329"><a href="#cb38-329"></a>Now the table has only <span class="in">`r nrow(pivot_wider(violence, names_from = crime_type, values_from = count))`</span> rows, which makes it much easier to present both on screen and in print. We can also see that the <span class="in">`year`</span> column is *constant* (all the values are the same), so we can remove this using the <span class="in">`select()`</span> function from dplyr. We can also use <span class="in">`select()`</span> to change the order of the columns from left to right so that the two types of robbery appear next to each other.</span>
<span id="cb38-330"><a href="#cb38-330"></a></span>
<span id="cb38-331"><a href="#cb38-331"></a></span>
<span id="cb38-334"><a href="#cb38-334"></a><span class="in">```{r}</span></span>
<span id="cb38-335"><a href="#cb38-335"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-336"><a href="#cb38-336"></a></span>
<span id="cb38-337"><a href="#cb38-337"></a><span class="co"># Produce table of crime counts in each Malaysian state</span></span>
<span id="cb38-338"><a href="#cb38-338"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb38-339"><a href="#cb38-339"></a>  <span class="co"># Convert data to have one row per state</span></span>
<span id="cb38-340"><a href="#cb38-340"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb38-341"><a href="#cb38-341"></a>  <span class="co"># Convert new column names (the former values of `crime_type`) to snake case</span></span>
<span id="cb38-342"><a href="#cb38-342"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb38-343"><a href="#cb38-343"></a>  <span class="co"># Choose only the columns we want to show in the table</span></span>
<span id="cb38-344"><a href="#cb38-344"></a>  <span class="fu">select</span>(</span>
<span id="cb38-345"><a href="#cb38-345"></a>    region, state, murder, rape, aggravated_assault, armed_robbery, </span>
<span id="cb38-346"><a href="#cb38-346"></a>    unarmed_robbery</span>
<span id="cb38-347"><a href="#cb38-347"></a>  )</span>
<span id="cb38-348"><a href="#cb38-348"></a><span class="in">```</span></span>
<span id="cb38-349"><a href="#cb38-349"></a></span>
<span id="cb38-350"><a href="#cb38-350"></a></span>
<span id="cb38-351"><a href="#cb38-351"></a><span class="fu">### Using the gt package to make better tables</span></span>
<span id="cb38-352"><a href="#cb38-352"></a></span>
<span id="cb38-353"><a href="#cb38-353"></a>&lt;a href="https://gt.rstudio.com/"&gt;&lt;img src="../images/gt.png" alt="gt package hex sticker" class="right-side-image"&gt;&lt;/a&gt;</span>
<span id="cb38-354"><a href="#cb38-354"></a></span>
<span id="cb38-355"><a href="#cb38-355"></a>The table we created in the last section was better than simply showing the raw data to readers of a report. But we can create much better display tables with the <span class="co">[</span><span class="ot">gt package</span><span class="co">](https://gt.rstudio.com/)</span>, which is designed to format data for display. The gt package works in a similar way to the <span class="in">`ggplot2`</span> package, in that tables are made up of stacks of functions that contribute to the appearance of the final table. One difference is that the layers in a gt stack are joined using the pipe operator (<span class="in">`|&gt;`</span>)</span>
<span id="cb38-356"><a href="#cb38-356"></a>rather than the plus operator (<span class="in">`+`</span>).</span>
<span id="cb38-357"><a href="#cb38-357"></a></span>
<span id="cb38-358"><a href="#cb38-358"></a>We can create a very basic gt table by just passing a data frame or tibble to the <span class="in">`gt()`</span> function. So we can add <span class="in">`gt()`</span> to the end of the pipeline of functions we have already started to build to create a good display table. At this point, the only argument we will add to <span class="in">`gt()`</span> is the <span class="in">`rowname_col`</span> argument, which we use to specify which column in the data holds the row labels (in this case, the name of each state).</span>
<span id="cb38-359"><a href="#cb38-359"></a></span>
<span id="cb38-360"><a href="#cb38-360"></a></span>
<span id="cb38-363"><a href="#cb38-363"></a><span class="in">```{r}</span></span>
<span id="cb38-364"><a href="#cb38-364"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-365"><a href="#cb38-365"></a></span>
<span id="cb38-366"><a href="#cb38-366"></a><span class="co"># Produce table of crime counts in each Malaysian state</span></span>
<span id="cb38-367"><a href="#cb38-367"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb38-368"><a href="#cb38-368"></a>  <span class="co"># Convert data to have one row per state</span></span>
<span id="cb38-369"><a href="#cb38-369"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb38-370"><a href="#cb38-370"></a>  <span class="co"># Convert new column names (the former values of `crime_type`) to snake case</span></span>
<span id="cb38-371"><a href="#cb38-371"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb38-372"><a href="#cb38-372"></a>  <span class="co"># Choose only the columns we want to show in the table</span></span>
<span id="cb38-373"><a href="#cb38-373"></a>  <span class="fu">select</span>(</span>
<span id="cb38-374"><a href="#cb38-374"></a>    region, state, murder, rape, aggravated_assault, armed_robbery, </span>
<span id="cb38-375"><a href="#cb38-375"></a>    unarmed_robbery</span>
<span id="cb38-376"><a href="#cb38-376"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb38-377"><a href="#cb38-377"></a>  <span class="co"># Functions from tidyverse above and functions from gt below</span></span>
<span id="cb38-378"><a href="#cb38-378"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"state"</span>)</span>
<span id="cb38-379"><a href="#cb38-379"></a><span class="in">```</span></span>
<span id="cb38-380"><a href="#cb38-380"></a></span>
<span id="cb38-381"><a href="#cb38-381"></a></span>
<span id="cb38-382"><a href="#cb38-382"></a>This table is already better than the default table produced by Quarto if we just print a data frame or tibble. The gt table does not take up the whole width of the page unnecessarily (which can make it harder to read across rows) and has hidden the type of each column.</span>
<span id="cb38-383"><a href="#cb38-383"></a></span>
<span id="cb38-384"><a href="#cb38-384"></a>We can add more functions to the <span class="in">`gt()`</span> stack to adjust the appearance of the table. For example, we can format the numeric columns as numbers using the <span class="in">`fmt_number()`</span> function. This adds thousand separators (in British English, commas) to make it easier to read the large numeric values and can make various other changes such as adding a prefix or suffix to numbers (useful for showing units), scaling numbers (useful for very large numbers) or automatically formatting numbers according to the conventions of the language your computer is set to use (referred to in R help pages as the *locale* of your computer).</span>
<span id="cb38-385"><a href="#cb38-385"></a></span>
<span id="cb38-386"><a href="#cb38-386"></a>We choose which columns <span class="in">`fmt_number()`</span> should format using the <span class="in">`columns`</span> argument. In this case, we want to format all the numeric columns in the data, so we will set <span class="in">`columns = where(is.numeric)`</span>.</span>
<span id="cb38-387"><a href="#cb38-387"></a></span>
<span id="cb38-388"><a href="#cb38-388"></a>We don't want the numbers in the table to have any decimal places (since the crime counts are all whole numbers), so we also set <span class="in">`decimals = 0`</span>. We can use the default values of all the other arguments to <span class="in">`fmt_number()`</span> -- type <span class="in">`?gt::fmt_number`</span> in the R console to find out more about the different options available on the help page for the <span class="in">`fmt_number()`</span> function.</span>
<span id="cb38-389"><a href="#cb38-389"></a></span>
<span id="cb38-390"><a href="#cb38-390"></a></span>
<span id="cb38-393"><a href="#cb38-393"></a><span class="in">```{r}</span></span>
<span id="cb38-394"><a href="#cb38-394"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-395"><a href="#cb38-395"></a></span>
<span id="cb38-396"><a href="#cb38-396"></a><span class="co"># Produce table of crime counts in each Malaysian state</span></span>
<span id="cb38-397"><a href="#cb38-397"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb38-398"><a href="#cb38-398"></a>  <span class="co"># Convert data to have one row per state</span></span>
<span id="cb38-399"><a href="#cb38-399"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb38-400"><a href="#cb38-400"></a>  <span class="co"># Convert new column names (the former values of `crime_type`) to snake case</span></span>
<span id="cb38-401"><a href="#cb38-401"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb38-402"><a href="#cb38-402"></a>  <span class="co"># Choose only the columns we want to show in the table</span></span>
<span id="cb38-403"><a href="#cb38-403"></a>  <span class="fu">select</span>(</span>
<span id="cb38-404"><a href="#cb38-404"></a>    region, state, murder, rape, aggravated_assault, armed_robbery, </span>
<span id="cb38-405"><a href="#cb38-405"></a>    unarmed_robbery</span>
<span id="cb38-406"><a href="#cb38-406"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb38-407"><a href="#cb38-407"></a>  <span class="co"># Functions from tidyverse above and functions from gt below</span></span>
<span id="cb38-408"><a href="#cb38-408"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"state"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-409"><a href="#cb38-409"></a>  <span class="co"># Format numbers with thousand separators and no decimals</span></span>
<span id="cb38-410"><a href="#cb38-410"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">where</span>(is.numeric), <span class="at">decimals =</span> <span class="dv">0</span>)</span>
<span id="cb38-411"><a href="#cb38-411"></a><span class="in">```</span></span>
<span id="cb38-412"><a href="#cb38-412"></a></span>
<span id="cb38-413"><a href="#cb38-413"></a></span>
<span id="cb38-414"><a href="#cb38-414"></a><span class="in">`fmt_number()`</span> is one of several formatting functions available in gt. For example, we could use <span class="in">`fmt_currency()`</span> to format columns according to the conventions for currency values, <span class="in">`fmt_date()`</span> for dates or <span class="in">`fmt_percent()`</span> for percentages.</span>
<span id="cb38-415"><a href="#cb38-415"></a></span>
<span id="cb38-416"><a href="#cb38-416"></a>The <span class="in">`region`</span> column only has two values: <span class="in">`West Malaysia`</span> for states and territories in Peninsular Malaysia and <span class="in">`East Malaysia`</span> for states on the island of Borneo. Rather than repeat these two values on every row of the table -- which is a waste of space and makes the table more cluttered than necessary -- we can instead group the rows according to these two regions and then only show the region names once at the top of each group.</span>
<span id="cb38-417"><a href="#cb38-417"></a></span>
<span id="cb38-418"><a href="#cb38-418"></a><span class="in">`gt()`</span> will automatically create group headings in a table if the data frame or tibble passed to <span class="in">`gt()`</span> contains groups created by the <span class="in">`group_by()`</span> function from the dplyr package. All we have to do is use <span class="in">`group_by()`</span> to specify which column (in this case, <span class="in">`region`</span>) contains the values that we should use to determine which group each row is in.</span>
<span id="cb38-419"><a href="#cb38-419"></a></span>
<span id="cb38-420"><a href="#cb38-420"></a></span>
<span id="cb38-423"><a href="#cb38-423"></a><span class="in">```{r}</span></span>
<span id="cb38-424"><a href="#cb38-424"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-425"><a href="#cb38-425"></a></span>
<span id="cb38-426"><a href="#cb38-426"></a><span class="co"># Produce table of crime counts in each Malaysian state</span></span>
<span id="cb38-427"><a href="#cb38-427"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb38-428"><a href="#cb38-428"></a>  <span class="co"># Convert data to have one row per state</span></span>
<span id="cb38-429"><a href="#cb38-429"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb38-430"><a href="#cb38-430"></a>  <span class="co"># Convert new column names (the former values of `crime_type`) to snake case</span></span>
<span id="cb38-431"><a href="#cb38-431"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb38-432"><a href="#cb38-432"></a>  <span class="co"># Choose only the columns we want to show in the table</span></span>
<span id="cb38-433"><a href="#cb38-433"></a>  <span class="fu">select</span>(</span>
<span id="cb38-434"><a href="#cb38-434"></a>    region, state, murder, rape, aggravated_assault, armed_robbery, </span>
<span id="cb38-435"><a href="#cb38-435"></a>    unarmed_robbery</span>
<span id="cb38-436"><a href="#cb38-436"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb38-437"><a href="#cb38-437"></a>  <span class="co"># Specify the table rows should be grouped by the values of `region`</span></span>
<span id="cb38-438"><a href="#cb38-438"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span> </span>
<span id="cb38-439"><a href="#cb38-439"></a>  <span class="co"># Functions from tidyverse above and functions from gt below</span></span>
<span id="cb38-440"><a href="#cb38-440"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"state"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-441"><a href="#cb38-441"></a>  <span class="co"># Format numbers with thousand separators and no decimals</span></span>
<span id="cb38-442"><a href="#cb38-442"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">where</span>(is.numeric), <span class="at">decimals =</span> <span class="dv">0</span>)</span>
<span id="cb38-443"><a href="#cb38-443"></a><span class="in">```</span></span>
<span id="cb38-444"><a href="#cb38-444"></a></span>
<span id="cb38-445"><a href="#cb38-445"></a></span>
<span id="cb38-446"><a href="#cb38-446"></a>In tables containing lots of numbers it can be difficult to see patterns. One way to help readers to understand patterns is to map the numbers to an aesthetic property such as colour that people can easily see patterns in. To do this, we can colour the cells in a column according to the value of each cell using the <span class="in">`data_color()`</span> function (note the spelling of 'color' in this function). To use <span class="in">`data_color()`</span>, we specify the columns we want to shade using the <span class="in">`columns`</span> argument and the colour palette we want to use using the <span class="in">`palette`</span> argument. </span>
<span id="cb38-447"><a href="#cb38-447"></a></span>
<span id="cb38-448"><a href="#cb38-448"></a>In this example, we will only colour the values in two columns, so we will pass the column names to the <span class="in">`columns`</span> argument.</span>
<span id="cb38-449"><a href="#cb38-449"></a></span>
<span id="cb38-450"><a href="#cb38-450"></a>The easiest way to specify a colour palette is to use one of the built-in colour palettes that the gt package understands automatically. These use the same colour palette names we have used in previous chapters when using functions such as <span class="in">`scale_fill_distiller()`</span>.</span>
<span id="cb38-451"><a href="#cb38-451"></a></span>
<span id="cb38-452"><a href="#cb38-452"></a></span>
<span id="cb38-455"><a href="#cb38-455"></a><span class="in">```{r}</span></span>
<span id="cb38-456"><a href="#cb38-456"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-457"><a href="#cb38-457"></a><span class="co">#| code-line-numbers: "12-13"</span></span>
<span id="cb38-458"><a href="#cb38-458"></a></span>
<span id="cb38-459"><a href="#cb38-459"></a><span class="co"># Produce table of crime counts in each Malaysian state</span></span>
<span id="cb38-460"><a href="#cb38-460"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb38-461"><a href="#cb38-461"></a>  <span class="co"># Convert data to have one row per state</span></span>
<span id="cb38-462"><a href="#cb38-462"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb38-463"><a href="#cb38-463"></a>  <span class="co"># Convert new column names (the former values of `crime_type`) to snake case</span></span>
<span id="cb38-464"><a href="#cb38-464"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb38-465"><a href="#cb38-465"></a>  <span class="co"># Choose only the columns we want to show in the table</span></span>
<span id="cb38-466"><a href="#cb38-466"></a>  <span class="fu">select</span>(</span>
<span id="cb38-467"><a href="#cb38-467"></a>    region, state, murder, rape, aggravated_assault, armed_robbery, </span>
<span id="cb38-468"><a href="#cb38-468"></a>    unarmed_robbery</span>
<span id="cb38-469"><a href="#cb38-469"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb38-470"><a href="#cb38-470"></a>  <span class="co"># Specify the table rows should be grouped by the values of `region`</span></span>
<span id="cb38-471"><a href="#cb38-471"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span> </span>
<span id="cb38-472"><a href="#cb38-472"></a>  <span class="co"># Functions from tidyverse above and functions from gt below</span></span>
<span id="cb38-473"><a href="#cb38-473"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"state"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-474"><a href="#cb38-474"></a>  <span class="co"># Format numbers with thousand separators and no decimals</span></span>
<span id="cb38-475"><a href="#cb38-475"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">where</span>(is.numeric), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-476"><a href="#cb38-476"></a>  <span class="co"># Show distribution of values in some columns using colour</span></span>
<span id="cb38-477"><a href="#cb38-477"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> unarmed_robbery, <span class="at">palette =</span> <span class="st">"Oranges"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-478"><a href="#cb38-478"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> rape, <span class="at">palette =</span> <span class="st">"Blues"</span>)</span>
<span id="cb38-479"><a href="#cb38-479"></a><span class="in">```</span></span>
<span id="cb38-480"><a href="#cb38-480"></a></span>
<span id="cb38-481"><a href="#cb38-481"></a></span>
<span id="cb38-482"><a href="#cb38-482"></a>::: {.callout-important}</span>
<span id="cb38-483"><a href="#cb38-483"></a><span class="fu">#### Avoid using the same colour across multiple columns</span></span>
<span id="cb38-484"><a href="#cb38-484"></a></span>
<span id="cb38-485"><a href="#cb38-485"></a>In this table we use two different colours to show the patterns in the frequency of murder and unarmed robbery. This is because we want readers to remember that different types of crime are *different* and so comparisons that treat crimes as being equivalent to one another are likely to be flawed. If we used the same colour across columns, readers might end up seeing that the shade used for unarmed robberies in Kuala Lumpur was darker than the shade showing the number of murders and conclude that unarmed robberies were a bigger problem than murders. This would be a potentially false conclusion because a single murder and a single unarmed robbery are not the same in terms of their seriousness.</span>
<span id="cb38-486"><a href="#cb38-486"></a></span>
<span id="cb38-487"><a href="#cb38-487"></a>For the same reason the table does not include a column showing the total number of crimes in each state -- when we total all types of crime together, we are implicitly assuming that all types of crime are the same when that is obviously untrue.</span>
<span id="cb38-488"><a href="#cb38-488"></a>:::</span>
<span id="cb38-489"><a href="#cb38-489"></a></span>
<span id="cb38-490"><a href="#cb38-490"></a></span>
<span id="cb38-491"><a href="#cb38-491"></a><span class="fu">### Changing column names</span></span>
<span id="cb38-492"><a href="#cb38-492"></a></span>
<span id="cb38-493"><a href="#cb38-493"></a>Now that we have formatted the data, we can move onto changing the column labels. At the moment these are taken from the column names in the data, which means we have column labels such as <span class="in">`aggravated_assault`</span>. Underscore characters (<span class="in">`_`</span>) aren't standard in English text, so we can should change the labels to remove them. We can do this by adding the <span class="in">`cols_label()`</span> function to the <span class="in">`gt()`</span> stack. As well as removing the underscores, we can also use <span class="in">`cols_label()`</span> to abbreviate labels or split them over multiple lines so that the column labels don't force the columns to be wider than necessary.</span>
<span id="cb38-494"><a href="#cb38-494"></a></span>
<span id="cb38-495"><a href="#cb38-495"></a>We can use the <span class="in">`md()`</span> helper function to use Markdown formatting to control the appearance of the labels. As well as using markup such as asterisks to create <span class="in">`**strongly emphasised text**`</span> we can also use HTML markup to add more-advanced formatting. For example, we can use the code <span class="in">`&lt;br&gt;`</span> to insert a line break to split labels over multiple lines.</span>
<span id="cb38-496"><a href="#cb38-496"></a></span>
<span id="cb38-497"><a href="#cb38-497"></a></span>
<span id="cb38-500"><a href="#cb38-500"></a><span class="in">```{r}</span></span>
<span id="cb38-501"><a href="#cb38-501"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-502"><a href="#cb38-502"></a></span>
<span id="cb38-503"><a href="#cb38-503"></a><span class="co"># Produce table of crime counts in each Malaysian state</span></span>
<span id="cb38-504"><a href="#cb38-504"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb38-505"><a href="#cb38-505"></a>  <span class="co"># Convert data to have one row per state</span></span>
<span id="cb38-506"><a href="#cb38-506"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb38-507"><a href="#cb38-507"></a>  <span class="co"># Convert new column names (the former values of `crime_type`) to snake case</span></span>
<span id="cb38-508"><a href="#cb38-508"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb38-509"><a href="#cb38-509"></a>  <span class="co"># Choose only the columns we want to show in the table</span></span>
<span id="cb38-510"><a href="#cb38-510"></a>  <span class="fu">select</span>(</span>
<span id="cb38-511"><a href="#cb38-511"></a>    region, state, murder, rape, aggravated_assault, armed_robbery, </span>
<span id="cb38-512"><a href="#cb38-512"></a>    unarmed_robbery</span>
<span id="cb38-513"><a href="#cb38-513"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb38-514"><a href="#cb38-514"></a>  <span class="co"># Specify the table rows should be grouped by the values of `region`</span></span>
<span id="cb38-515"><a href="#cb38-515"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span> </span>
<span id="cb38-516"><a href="#cb38-516"></a>  <span class="co"># Functions from tidyverse above and functions from gt below</span></span>
<span id="cb38-517"><a href="#cb38-517"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"state"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-518"><a href="#cb38-518"></a>  <span class="co"># Format numbers with thousand separators and no decimals</span></span>
<span id="cb38-519"><a href="#cb38-519"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">where</span>(is.numeric), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-520"><a href="#cb38-520"></a>  <span class="co"># Show distribution of values in some columns using colour</span></span>
<span id="cb38-521"><a href="#cb38-521"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> unarmed_robbery, <span class="at">palette =</span> <span class="st">"Oranges"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-522"><a href="#cb38-522"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> rape, <span class="at">palette =</span> <span class="st">"Blues"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-523"><a href="#cb38-523"></a>  <span class="co"># Add column labels</span></span>
<span id="cb38-524"><a href="#cb38-524"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb38-525"><a href="#cb38-525"></a>    <span class="st">"aggravated_assault"</span> <span class="sc">~</span> <span class="st">"agg. assault"</span>,</span>
<span id="cb38-526"><a href="#cb38-526"></a>    <span class="st">"armed_robbery"</span> <span class="sc">~</span> <span class="fu">md</span>(<span class="st">"robbery&lt;br&gt;(armed)"</span>),</span>
<span id="cb38-527"><a href="#cb38-527"></a>    <span class="st">"unarmed_robbery"</span> <span class="sc">~</span> <span class="fu">md</span>(<span class="st">"robbery&lt;br&gt;(unarmed)"</span>)</span>
<span id="cb38-528"><a href="#cb38-528"></a>  )</span>
<span id="cb38-529"><a href="#cb38-529"></a><span class="in">```</span></span>
<span id="cb38-530"><a href="#cb38-530"></a></span>
<span id="cb38-531"><a href="#cb38-531"></a></span>
<span id="cb38-532"><a href="#cb38-532"></a></span>
<span id="cb38-533"><a href="#cb38-533"></a><span class="fu">### Adding summary rows</span></span>
<span id="cb38-534"><a href="#cb38-534"></a></span>
<span id="cb38-535"><a href="#cb38-535"></a>The final thing we will add to this table is a summary row containing the total number of each type of crime across all the states and territories. We do this using the <span class="in">`summary_rows()`</span> function from gt. We specify the columns we want to summarise using the <span class="in">`columns`</span> argument as we did for <span class="in">`fmt_number()`</span>. </span>
<span id="cb38-536"><a href="#cb38-536"></a></span>
<span id="cb38-537"><a href="#cb38-537"></a>Summary rows can be produced using lots of different R functions. For example, we could use the <span class="in">`mean()`</span> function to produce a summary row showing the mean (average) number of crimes of each time across the states. In this case, we want to know the total number of each type of crime across all states, so we will use the <span class="in">`sum()`</span> function. To specify this, we pass the <span class="in">`fns`</span> argument to <span class="in">`summary_rows()`</span>. The <span class="in">`fns`</span> argument has two parts, separated by a tilde (<span class="in">`~`</span>). On the left-hand side we specify the label we want the summary row to have, and on the right-hand side we specify the function we want to use to calculate the summary. In this case, we can specify <span class="in">`fns = "regional total" ~ sum(.)`</span> to say we want the summary row to have the label 'total' and that we want to summarise the rows using the <span class="in">`sum()`</span> function. The <span class="in">`.`</span> in the code <span class="in">`fns = "regional total" ~ sum(.)`</span> is a place-holder that represent the data we want to summarise.</span>
<span id="cb38-538"><a href="#cb38-538"></a></span>
<span id="cb38-539"><a href="#cb38-539"></a>As well as summarising the data in each column, we want to specify how the summary values should be formatted. To do that, we use the <span class="in">`fmt`</span> argument of <span class="in">`summary_rows()`</span>. This is also a  two-sided ('formula') argument, with the two sides separated by a <span class="in">`~`</span>. On the left-hand side we specify which summary values we want to format. In this case we want all the summary values to be formatted as numbers, so we can use the <span class="in">`everything()`</span> helper function. On the right-hand side we use a call to one of the <span class="in">`fmt_*()`</span> family of functions we used earlier: in this case, we use <span class="in">`fmt_number()`</span>. Looking at the code below, you'll notice that the code <span class="in">`fmt = everything() ~ fmt_number(., decimals = 0)`</span> again uses the <span class="in">`.`</span> place-holder to specify that we want to format the summary value produced by <span class="in">`sum()`</span>.</span>
<span id="cb38-540"><a href="#cb38-540"></a></span>
<span id="cb38-541"><a href="#cb38-541"></a>The <span class="in">`summary_rows()`</span> function produces a summary for each group of rows (in the case of this table, one summary for each region). As well as having a regional total, it would also be useful to have a total for all the groups together (i.e. for the whole country of Malaysia). To do that, we add the <span class="in">`grand_summary_rows()`</span> function to our <span class="in">`gt()`</span> stack, using the same arguments as for the <span class="in">`summary_rows()`</span> function.</span>
<span id="cb38-542"><a href="#cb38-542"></a></span>
<span id="cb38-543"><a href="#cb38-543"></a>Paste this code into the <span class="in">`chapter15a.R`</span> file and run it.</span>
<span id="cb38-544"><a href="#cb38-544"></a></span>
<span id="cb38-545"><a href="#cb38-545"></a></span>
<span id="cb38-548"><a href="#cb38-548"></a><span class="in">```{r}</span></span>
<span id="cb38-549"><a href="#cb38-549"></a><span class="co">#| filename: "chapter15a.R"</span></span>
<span id="cb38-550"><a href="#cb38-550"></a></span>
<span id="cb38-551"><a href="#cb38-551"></a><span class="co"># Produce table of crime counts in each Malaysian state</span></span>
<span id="cb38-552"><a href="#cb38-552"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb38-553"><a href="#cb38-553"></a>  <span class="co"># Convert data to have one row per state</span></span>
<span id="cb38-554"><a href="#cb38-554"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb38-555"><a href="#cb38-555"></a>  <span class="co"># Convert new column names (the former values of `crime_type`) to snake case</span></span>
<span id="cb38-556"><a href="#cb38-556"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb38-557"><a href="#cb38-557"></a>  <span class="co"># Choose only the columns we want to show in the table</span></span>
<span id="cb38-558"><a href="#cb38-558"></a>  <span class="fu">select</span>(</span>
<span id="cb38-559"><a href="#cb38-559"></a>    region, state, murder, rape, aggravated_assault, armed_robbery, </span>
<span id="cb38-560"><a href="#cb38-560"></a>    unarmed_robbery</span>
<span id="cb38-561"><a href="#cb38-561"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb38-562"><a href="#cb38-562"></a>  <span class="co"># Specify the table rows should be grouped by the values of `region`</span></span>
<span id="cb38-563"><a href="#cb38-563"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span> </span>
<span id="cb38-564"><a href="#cb38-564"></a>  <span class="co"># Functions from tidyverse above and functions from gt below</span></span>
<span id="cb38-565"><a href="#cb38-565"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"state"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-566"><a href="#cb38-566"></a>  <span class="co"># Format numbers with thousand separators and no decimals</span></span>
<span id="cb38-567"><a href="#cb38-567"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">where</span>(is.numeric), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-568"><a href="#cb38-568"></a>  <span class="co"># Show distribution of values in some columns using colour</span></span>
<span id="cb38-569"><a href="#cb38-569"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> unarmed_robbery, <span class="at">palette =</span> <span class="st">"Oranges"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-570"><a href="#cb38-570"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> rape, <span class="at">palette =</span> <span class="st">"Blues"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-571"><a href="#cb38-571"></a>  <span class="co"># Add column labels</span></span>
<span id="cb38-572"><a href="#cb38-572"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb38-573"><a href="#cb38-573"></a>    <span class="st">"aggravated_assault"</span> <span class="sc">~</span> <span class="st">"agg. assault"</span>,</span>
<span id="cb38-574"><a href="#cb38-574"></a>    <span class="st">"armed_robbery"</span> <span class="sc">~</span> <span class="fu">md</span>(<span class="st">"robbery&lt;br&gt;(armed)"</span>),</span>
<span id="cb38-575"><a href="#cb38-575"></a>    <span class="st">"unarmed_robbery"</span> <span class="sc">~</span> <span class="fu">md</span>(<span class="st">"robbery&lt;br&gt;(unarmed)"</span>)</span>
<span id="cb38-576"><a href="#cb38-576"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb38-577"><a href="#cb38-577"></a>  <span class="co"># Add a summary row showing the total number of crimes in each region</span></span>
<span id="cb38-578"><a href="#cb38-578"></a>  <span class="fu">summary_rows</span>(</span>
<span id="cb38-579"><a href="#cb38-579"></a>    <span class="at">columns =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb38-580"><a href="#cb38-580"></a>    <span class="at">fns =</span> <span class="st">"regional total"</span> <span class="sc">~</span> <span class="fu">sum</span>(.),</span>
<span id="cb38-581"><a href="#cb38-581"></a>    <span class="at">fmt =</span> <span class="fu">everything</span>() <span class="sc">~</span> <span class="fu">fmt_number</span>(., <span class="at">decimals =</span> <span class="dv">0</span>)</span>
<span id="cb38-582"><a href="#cb38-582"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb38-583"><a href="#cb38-583"></a>  <span class="co"># Add a summary row showing the total number of crimes in Malaysia</span></span>
<span id="cb38-584"><a href="#cb38-584"></a>  <span class="fu">grand_summary_rows</span>(</span>
<span id="cb38-585"><a href="#cb38-585"></a>    <span class="at">columns =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb38-586"><a href="#cb38-586"></a>    <span class="at">fns =</span> <span class="st">"national total"</span> <span class="sc">~</span> <span class="fu">sum</span>(.),</span>
<span id="cb38-587"><a href="#cb38-587"></a>    <span class="at">fmt =</span> <span class="fu">everything</span>() <span class="sc">~</span> <span class="fu">fmt_number</span>(., <span class="at">decimals =</span> <span class="dv">0</span>)</span>
<span id="cb38-588"><a href="#cb38-588"></a>  )</span>
<span id="cb38-589"><a href="#cb38-589"></a><span class="in">```</span></span>
<span id="cb38-590"><a href="#cb38-590"></a></span>
<span id="cb38-591"><a href="#cb38-591"></a></span>
<span id="cb38-592"><a href="#cb38-592"></a>::: {.callout-important}</span>
<span id="cb38-593"><a href="#cb38-593"></a><span class="fu">#### Tables are not good at showing patterns</span></span>
<span id="cb38-594"><a href="#cb38-594"></a></span>
<span id="cb38-595"><a href="#cb38-595"></a>Tables are good for showing detailed information, particularly when we want to present multiple pieces of information about a single place. But it can be hard to spot patterns in tables even with coloured cells. For this reason, **do not use tables when you are primarily trying to show the relationship between two or more variables**. In the next section, we will learn to create bar chart in R to show patterns more effectively.</span>
<span id="cb38-596"><a href="#cb38-596"></a>:::</span>
<span id="cb38-597"><a href="#cb38-597"></a></span>
<span id="cb38-598"><a href="#cb38-598"></a></span>
<span id="cb38-599"><a href="#cb38-599"></a>::: {.callout-quiz .callout}</span>
<span id="cb38-600"><a href="#cb38-600"></a><span class="fu">#### Tables</span></span>
<span id="cb38-601"><a href="#cb38-601"></a></span>
<span id="cb38-604"><a href="#cb38-604"></a><span class="in">```{r}</span></span>
<span id="cb38-605"><a href="#cb38-605"></a><span class="co">#| echo: false</span></span>
<span id="cb38-606"><a href="#cb38-606"></a></span>
<span id="cb38-607"><a href="#cb38-607"></a>tables_quiz1 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-608"><a href="#cb38-608"></a>  <span class="at">answer =</span> <span class="st">"When communicating multiple values about each area"</span>,</span>
<span id="cb38-609"><a href="#cb38-609"></a>  <span class="st">"When displaying detailed spatial relationships"</span>,</span>
<span id="cb38-610"><a href="#cb38-610"></a>  <span class="st">"When visualizing trends over time"</span>,</span>
<span id="cb38-611"><a href="#cb38-611"></a>  <span class="st">"When analyzing spatial clusters"</span></span>
<span id="cb38-612"><a href="#cb38-612"></a>)</span>
<span id="cb38-613"><a href="#cb38-613"></a></span>
<span id="cb38-614"><a href="#cb38-614"></a>tables_quiz2 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-615"><a href="#cb38-615"></a>  <span class="st">"It makes the data easier to analyze using statistical models"</span>,</span>
<span id="cb38-616"><a href="#cb38-616"></a>  <span class="at">answer =</span> <span class="st">"It allows for easier comparisons across categories in a table"</span>,</span>
<span id="cb38-617"><a href="#cb38-617"></a>  <span class="st">"It is the default format for spatial data in R"</span>,</span>
<span id="cb38-618"><a href="#cb38-618"></a>  <span class="st">"It makes maps easier to interpret"</span></span>
<span id="cb38-619"><a href="#cb38-619"></a>)</span>
<span id="cb38-620"><a href="#cb38-620"></a></span>
<span id="cb38-621"><a href="#cb38-621"></a>tables_quiz3 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-622"><a href="#cb38-622"></a>  <span class="st">"`pivot_longer()`"</span>,</span>
<span id="cb38-623"><a href="#cb38-623"></a>  <span class="st">"`spread()`"</span>,</span>
<span id="cb38-624"><a href="#cb38-624"></a>  <span class="at">answer =</span> <span class="st">"`pivot_wider()`"</span>,</span>
<span id="cb38-625"><a href="#cb38-625"></a>  <span class="st">"`gather()`"</span></span>
<span id="cb38-626"><a href="#cb38-626"></a>)</span>
<span id="cb38-627"><a href="#cb38-627"></a><span class="in">```</span></span>
<span id="cb38-628"><a href="#cb38-628"></a></span>
<span id="cb38-629"><a href="#cb38-629"></a>**In which of these circumstances is a table typically more effective than a map?**</span>
<span id="cb38-630"><a href="#cb38-630"></a></span>
<span id="cb38-631"><a href="#cb38-631"></a><span class="in">`r webexercises::longmcq(tables_quiz1)`</span></span>
<span id="cb38-632"><a href="#cb38-632"></a></span>
<span id="cb38-633"><a href="#cb38-633"></a></span>
<span id="cb38-634"><a href="#cb38-634"></a>**Why is it often preferable to present summary data in a wide format?**</span>
<span id="cb38-635"><a href="#cb38-635"></a></span>
<span id="cb38-636"><a href="#cb38-636"></a><span class="in">`r webexercises::longmcq(tables_quiz2)`</span></span>
<span id="cb38-637"><a href="#cb38-637"></a></span>
<span id="cb38-638"><a href="#cb38-638"></a></span>
<span id="cb38-639"><a href="#cb38-639"></a>**Which function is used in R to convert long-format data into wide-format data?**</span>
<span id="cb38-640"><a href="#cb38-640"></a></span>
<span id="cb38-641"><a href="#cb38-641"></a><span class="in">`r webexercises::longmcq(tables_quiz3)`</span></span>
<span id="cb38-642"><a href="#cb38-642"></a></span>
<span id="cb38-643"><a href="#cb38-643"></a>:::</span>
<span id="cb38-644"><a href="#cb38-644"></a></span>
<span id="cb38-645"><a href="#cb38-645"></a></span>
<span id="cb38-646"><a href="#cb38-646"></a></span>
<span id="cb38-647"><a href="#cb38-647"></a><span class="fu">## Bar charts</span></span>
<span id="cb38-648"><a href="#cb38-648"></a></span>
<span id="cb38-649"><a href="#cb38-649"></a>Bar charts are useful for showing values of one _continuous_ variable (e.g. a count of crimes) for each value of one _categorical_ variable (e.g. states of a country). Bar charts are very common, but there are several things we can do to make them more useful. In this section we will learn how to construct a good bar chart.</span>
<span id="cb38-650"><a href="#cb38-650"></a></span>
<span id="cb38-651"><a href="#cb38-651"></a>You're already an expert at making maps using functions from the ggplot2 package. We can use these same functions to create many other types of graphics. For example, we can use <span class="in">`geom_bar()`</span> to create bar charts just as we use <span class="in">`geom_sf()`</span> to create a map using data stored in an SF object. </span>
<span id="cb38-652"><a href="#cb38-652"></a></span>
<span id="cb38-653"><a href="#cb38-653"></a><span class="in">`geom_bar()`</span> calculates the length of each bar on a chart by counting the number of rows of data in each category. This isn't what we want to do to visualise the <span class="in">`violence`</span> object, since the data provided by the Royal Malaysian Police are already in the form of counts of crimes. Instead, we will use the <span class="in">`geom_col()`</span> function, which creates bar charts from this type of summary data.</span>
<span id="cb38-654"><a href="#cb38-654"></a></span>
<span id="cb38-655"><a href="#cb38-655"></a>To create a simple bar chart, we will work with the original (long-format) data and filter it to show only the number of murders in each state.</span>
<span id="cb38-656"><a href="#cb38-656"></a></span>
<span id="cb38-657"><a href="#cb38-657"></a></span>
<span id="cb38-660"><a href="#cb38-660"></a><span class="in">```{r}</span></span>
<span id="cb38-661"><a href="#cb38-661"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-662"><a href="#cb38-662"></a></span>
<span id="cb38-663"><a href="#cb38-663"></a><span class="co"># Create bar chart of murder counts</span></span>
<span id="cb38-664"><a href="#cb38-664"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb38-665"><a href="#cb38-665"></a>  <span class="co"># Keep only rows representing murder counts</span></span>
<span id="cb38-666"><a href="#cb38-666"></a>  <span class="fu">filter</span>(crime_type <span class="sc">==</span> <span class="st">"murder"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-667"><a href="#cb38-667"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-668"><a href="#cb38-668"></a>  <span class="co"># Translate columns in the data to aesthetics on the chart</span></span>
<span id="cb38-669"><a href="#cb38-669"></a>  <span class="fu">aes</span>(<span class="at">x =</span> state, <span class="at">y =</span> count) <span class="sc">+</span></span>
<span id="cb38-670"><a href="#cb38-670"></a>  <span class="co"># Add bars</span></span>
<span id="cb38-671"><a href="#cb38-671"></a>  <span class="fu">geom_col</span>()</span>
<span id="cb38-672"><a href="#cb38-672"></a><span class="in">```</span></span>
<span id="cb38-673"><a href="#cb38-673"></a></span>
<span id="cb38-674"><a href="#cb38-674"></a></span>
<span id="cb38-675"><a href="#cb38-675"></a>You might notice that this code uses the <span class="in">`aes()`</span> function differently to what we've seen in previous chapters. As we learned in @sec-mapping-patterns, <span class="in">`aes()`</span> is used to specify which aspects of a map or chart should be controlled by the values of particular columns in a dataset. When we use <span class="in">`aes()`</span> inside a <span class="in">`geom_*()`</span> function (as we have done with <span class="in">`geom_sf()`</span> in previous chapters), the _mapping_ between columns in a dataset and aspects of the map or chart appearance applies only to that layer. In a map, that is usually what we want because there is typically only one layer (e.g. a layer showing the density of crime) that represents values in a dataset. But we can also use `aes()` _outside_ a `geom_*()<span class="in">` function by adding it to the stack directly after the call to `</span>ggplot()` itself. In that case, the mapping between data and chart will apply to all the layers on the chart.</span>
<span id="cb38-676"><a href="#cb38-676"></a></span>
<span id="cb38-677"><a href="#cb38-677"></a>We can improve this basic chart in several ways:</span>
<span id="cb38-678"><a href="#cb38-678"></a></span>
<span id="cb38-679"><a href="#cb38-679"></a><span class="ss">  * </span>We can switch the order of the variables used for the <span class="in">`x`</span> and <span class="in">`y`</span> aesthetics so that the bars are horizontal rather than vertical, which will stop the state names from overlapping. It is almost always better for bar charts to use horizontal bars rather than vertical bars, to avoid overlapping labels.</span>
<span id="cb38-680"><a href="#cb38-680"></a><span class="ss">  * </span>We can use <span class="in">`labs()`</span> to add a title and caption, as well as controlling the <span class="in">`x`</span> and <span class="in">`y`</span> axis titles on the chart. In the code below, we set <span class="in">`y = NULL`</span> to remove the title for the vertical axis, since a title is unnecessary when it is obvious from the context what the values on that axis represent (Malaysian states).</span>
<span id="cb38-681"><a href="#cb38-681"></a><span class="ss">  * </span>We can reduce the visual clutter in the chart using <span class="in">`theme_minimal()`</span>. While <span class="in">`theme_void()`</span> is generally the best ggplot2 theme for maps, for charts it's almost always best to use <span class="in">`theme_minimal()`</span>.</span>
<span id="cb38-682"><a href="#cb38-682"></a></span>
<span id="cb38-683"><a href="#cb38-683"></a></span>
<span id="cb38-684"><a href="#cb38-684"></a><span class="in">```{r bars-exercise2, exercise=TRUE}</span></span>
<span id="cb38-685"><a href="#cb38-685"></a><span class="in">#| filename: "R Console"</span></span>
<span id="cb38-686"><a href="#cb38-686"></a></span>
<span id="cb38-687"><a href="#cb38-687"></a><span class="in"># Create bar chart of murder counts</span></span>
<span id="cb38-688"><a href="#cb38-688"></a><span class="in">violence |&gt; </span></span>
<span id="cb38-689"><a href="#cb38-689"></a><span class="in">  # Keep only rows representing murder counts</span></span>
<span id="cb38-690"><a href="#cb38-690"></a><span class="in">  filter(crime_type == "murder") |&gt; </span></span>
<span id="cb38-691"><a href="#cb38-691"></a><span class="in">  ggplot() +</span></span>
<span id="cb38-692"><a href="#cb38-692"></a><span class="in">  # Translate columns in the data to aesthetics on the chart</span></span>
<span id="cb38-693"><a href="#cb38-693"></a><span class="in">  aes(x = count, y = state) +</span></span>
<span id="cb38-694"><a href="#cb38-694"></a><span class="in">  # Add bars</span></span>
<span id="cb38-695"><a href="#cb38-695"></a><span class="in">  geom_col() +</span></span>
<span id="cb38-696"><a href="#cb38-696"></a><span class="in">  # Add labels</span></span>
<span id="cb38-697"><a href="#cb38-697"></a><span class="in">  labs(</span></span>
<span id="cb38-698"><a href="#cb38-698"></a><span class="in">    title = "Murders in Malaysian states, 2017",</span></span>
<span id="cb38-699"><a href="#cb38-699"></a><span class="in">    caption = "Data from the Royal Malaysian Police",</span></span>
<span id="cb38-700"><a href="#cb38-700"></a><span class="in">    x = "number of murders",</span></span>
<span id="cb38-701"><a href="#cb38-701"></a><span class="in">    y = NULL</span></span>
<span id="cb38-702"><a href="#cb38-702"></a><span class="in">  ) +</span></span>
<span id="cb38-703"><a href="#cb38-703"></a><span class="in">  # Remove unnecessary map elements</span></span>
<span id="cb38-704"><a href="#cb38-704"></a><span class="in">  theme_minimal()</span></span>
<span id="cb38-705"><a href="#cb38-705"></a><span class="in">```</span></span>
<span id="cb38-706"><a href="#cb38-706"></a></span>
<span id="cb38-707"><a href="#cb38-707"></a></span>
<span id="cb38-708"><a href="#cb38-708"></a>This chart is better, but we can improve it further. For example, we can reduce the space between the state names and the bars by setting the <span class="in">`expand`</span> argument to the <span class="in">`scale_x_continuous()`</span> function. <span class="in">`scale_x_continuous()`</span> works in a similar way to the other scale functions we have used already, such as using <span class="in">`scale_fill_brewer()`</span> to control the colour of areas in a choropleth map.</span>
<span id="cb38-709"><a href="#cb38-709"></a></span>
<span id="cb38-710"><a href="#cb38-710"></a>Although we are trying to reduce the gap between the bars and labels on the *y* axis, we use a function that change the *x* axis. This is because the space we are reducing is created by R by-default adding some space to each end of any continuous axis, such as the count of murders. </span>
<span id="cb38-711"><a href="#cb38-711"></a></span>
<span id="cb38-712"><a href="#cb38-712"></a>We can specify the space at the end of each axis using the helper function <span class="in">`expansion()`</span>. In this case we just want to remove the space completely, so we can set <span class="in">`expand = expansion(0)`</span>.</span>
<span id="cb38-713"><a href="#cb38-713"></a></span>
<span id="cb38-714"><a href="#cb38-714"></a>At the same time, we can also remove the grid lines on the *y* axis (i.e. those running along the length of the bars) since they don't really make it any easier to understand the chart. As a general principle, we want to remove anything on a chart that does not contribute to communicating information, since unnecessary chart elements can distract readers from understanding the data.</span>
<span id="cb38-715"><a href="#cb38-715"></a></span>
<span id="cb38-716"><a href="#cb38-716"></a>We can remove the grid lines by setting the <span class="in">`panel.grid.major.y`</span> and <span class="in">`panel.grid.minor.y`</span> arguments to the <span class="in">`theme()`</span> function. The value we want to use is the helper function <span class="in">`element_blank()`</span>, which sets the grid lines to be blank.</span>
<span id="cb38-717"><a href="#cb38-717"></a></span>
<span id="cb38-718"><a href="#cb38-718"></a></span>
<span id="cb38-721"><a href="#cb38-721"></a><span class="in">```{r}</span></span>
<span id="cb38-722"><a href="#cb38-722"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-723"><a href="#cb38-723"></a></span>
<span id="cb38-724"><a href="#cb38-724"></a><span class="co"># Create bar chart of murder counts</span></span>
<span id="cb38-725"><a href="#cb38-725"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb38-726"><a href="#cb38-726"></a>  <span class="co"># Keep only rows representing murder counts</span></span>
<span id="cb38-727"><a href="#cb38-727"></a>  <span class="fu">filter</span>(crime_type <span class="sc">==</span> <span class="st">"murder"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-728"><a href="#cb38-728"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-729"><a href="#cb38-729"></a>  <span class="co"># Translate columns in the data to aesthetics on the chart</span></span>
<span id="cb38-730"><a href="#cb38-730"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> state) <span class="sc">+</span></span>
<span id="cb38-731"><a href="#cb38-731"></a>  <span class="co"># Add bars</span></span>
<span id="cb38-732"><a href="#cb38-732"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb38-733"><a href="#cb38-733"></a>  <span class="co"># Remove space at either end of horizontal axis</span></span>
<span id="cb38-734"><a href="#cb38-734"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb38-735"><a href="#cb38-735"></a>  <span class="co"># Add labels</span></span>
<span id="cb38-736"><a href="#cb38-736"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-737"><a href="#cb38-737"></a>    <span class="at">title =</span> <span class="st">"Murders in Malaysian states, 2017"</span>,</span>
<span id="cb38-738"><a href="#cb38-738"></a>    <span class="at">caption =</span> <span class="st">"Data from the Royal Malaysian Police"</span>,</span>
<span id="cb38-739"><a href="#cb38-739"></a>    <span class="at">x =</span> <span class="st">"number of murders"</span>,</span>
<span id="cb38-740"><a href="#cb38-740"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb38-741"><a href="#cb38-741"></a>  ) <span class="sc">+</span></span>
<span id="cb38-742"><a href="#cb38-742"></a>  <span class="co"># Remove unnecessary map elements</span></span>
<span id="cb38-743"><a href="#cb38-743"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb38-744"><a href="#cb38-744"></a>  <span class="co"># Remove unnecessary horizontal grid lines</span></span>
<span id="cb38-745"><a href="#cb38-745"></a>  <span class="fu">theme</span>(</span>
<span id="cb38-746"><a href="#cb38-746"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-747"><a href="#cb38-747"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb38-748"><a href="#cb38-748"></a>  )</span>
<span id="cb38-749"><a href="#cb38-749"></a><span class="in">```</span></span>
<span id="cb38-750"><a href="#cb38-750"></a></span>
<span id="cb38-751"><a href="#cb38-751"></a></span>
<span id="cb38-752"><a href="#cb38-752"></a>::: {.callout-important}</span>
<span id="cb38-753"><a href="#cb38-753"></a><span class="fu">#### Bars on a bar chart should always start at zero</span></span>
<span id="cb38-754"><a href="#cb38-754"></a></span>
<span id="cb38-755"><a href="#cb38-755"></a>One of the reasons why bar charts are easy to interpret is that the *length* of each bar directly corresponds to the relative size of that particular value. But this direct relationship between bar length and value only applies if the bars start at zero. If you create a bar chart in which the bars  don't start at zero, readers are likely to be mislead, so remember *bar charts should always start at zero*. But don't worry -- <span class="in">`ggplot()`</span> will handle this for you automatically.</span>
<span id="cb38-756"><a href="#cb38-756"></a>:::</span>
<span id="cb38-757"><a href="#cb38-757"></a></span>
<span id="cb38-758"><a href="#cb38-758"></a></span>
<span id="cb38-759"><a href="#cb38-759"></a><span class="fu">### Ordering bar charts by value</span></span>
<span id="cb38-760"><a href="#cb38-760"></a></span>
<span id="cb38-761"><a href="#cb38-761"></a>If you were trying to find the three Malaysian states or territories with the most murders from this chart, it would be pretty easy to see that Selangor had the most murders, followed by Johor. But at a glance, it's not so easy to see which state or territory comes third. We can make this easier to see by changing the order of the bars from the default alphabetical order to an order based on how many murders there were.</span>
<span id="cb38-762"><a href="#cb38-762"></a></span>
<span id="cb38-763"><a href="#cb38-763"></a>To do this, we need to convert the <span class="in">`state`</span> column in the data to a new type of variable: a *factor*. Factors are what R calls categorical variables that have a defined set of possible values. For example, a factor recording if a person was under or over 18 might have two possible values: 'adult' and 'child'.</span>
<span id="cb38-764"><a href="#cb38-764"></a></span>
<span id="cb38-765"><a href="#cb38-765"></a>One of the benefits of storing a variable as a factor is that we can specify an order for the categories. This is useful for categories that have a meaningful order, such as 'bad', 'acceptable', 'good', 'excellent'. But we can also use</span>
<span id="cb38-766"><a href="#cb38-766"></a>this feature of factors to specify that values should appear in a particular order in any charts produced from the data, whatever the order of the values in the data itself.</span>
<span id="cb38-767"><a href="#cb38-767"></a></span>
<span id="cb38-768"><a href="#cb38-768"></a>&lt;a href="https://forcats.tidyverse.org/"&gt;&lt;img src="../images/forcats.png" alt="forcats package hex sticker" class="right-side-image"&gt;&lt;/a&gt;</span>
<span id="cb38-769"><a href="#cb38-769"></a></span>
<span id="cb38-770"><a href="#cb38-770"></a>To work with factors in R we can use the <span class="co">[</span><span class="ot">forcats package</span><span class="co">](https://forcats.tidyverse.org/)</span>, so-called because it's *for* working with *categories*. forcats is loaded as part of tidyverse, so we don't need to load it separately. </span>
<span id="cb38-771"><a href="#cb38-771"></a></span>
<span id="cb38-772"><a href="#cb38-772"></a>All the functions in the forcats package start with the letters <span class="in">`fct_`</span>, just as all the functions in the SF package start <span class="in">`st_`</span>. For our bar chart, we will use the <span class="in">`fct_reorder()`</span> function. This takes a factor or character variable (such as the names of the Malaysian states and territories) and sets the order of the categories according to the values of a numeric variable (such as the number of murders in a state). So to re-order the <span class="in">`state`</span> variable according to the count of murders, we can use <span class="in">`fct_reorder(state, count)`</span>. Since we're changing an existing variable, we will do this inside a call to the <span class="in">`mutate()`</span> function.</span>
<span id="cb38-773"><a href="#cb38-773"></a></span>
<span id="cb38-774"><a href="#cb38-774"></a></span>
<span id="cb38-777"><a href="#cb38-777"></a><span class="in">```{r}</span></span>
<span id="cb38-778"><a href="#cb38-778"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-779"><a href="#cb38-779"></a></span>
<span id="cb38-780"><a href="#cb38-780"></a><span class="co"># Create bar chart of murder counts</span></span>
<span id="cb38-781"><a href="#cb38-781"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb38-782"><a href="#cb38-782"></a>  <span class="co"># Keep only rows representing murder counts</span></span>
<span id="cb38-783"><a href="#cb38-783"></a>  <span class="fu">filter</span>(crime_type <span class="sc">==</span> <span class="st">"murder"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-784"><a href="#cb38-784"></a>  <span class="co"># Re-order states according to number of murders</span></span>
<span id="cb38-785"><a href="#cb38-785"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">fct_reorder</span>(state, count)) <span class="sc">|&gt;</span> </span>
<span id="cb38-786"><a href="#cb38-786"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-787"><a href="#cb38-787"></a>  <span class="co"># Translate columns in the data to aesthetics on the chart</span></span>
<span id="cb38-788"><a href="#cb38-788"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> state) <span class="sc">+</span></span>
<span id="cb38-789"><a href="#cb38-789"></a>  <span class="co"># Add bars</span></span>
<span id="cb38-790"><a href="#cb38-790"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb38-791"><a href="#cb38-791"></a>  <span class="co"># Remove space at either end of horizontal axis</span></span>
<span id="cb38-792"><a href="#cb38-792"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb38-793"><a href="#cb38-793"></a>  <span class="co"># Add labels</span></span>
<span id="cb38-794"><a href="#cb38-794"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-795"><a href="#cb38-795"></a>    <span class="at">title =</span> <span class="st">"Murders in Malaysian states, 2017"</span>,</span>
<span id="cb38-796"><a href="#cb38-796"></a>    <span class="at">caption =</span> <span class="st">"Data from the Royal Malaysian Police"</span>,</span>
<span id="cb38-797"><a href="#cb38-797"></a>    <span class="at">x =</span> <span class="st">"number of murders"</span>,</span>
<span id="cb38-798"><a href="#cb38-798"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb38-799"><a href="#cb38-799"></a>  ) <span class="sc">+</span></span>
<span id="cb38-800"><a href="#cb38-800"></a>  <span class="co"># Remove unnecessary map elements</span></span>
<span id="cb38-801"><a href="#cb38-801"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb38-802"><a href="#cb38-802"></a>  <span class="fu">theme</span>(</span>
<span id="cb38-803"><a href="#cb38-803"></a>    <span class="co"># Remove unnecessary horizontal grid lines</span></span>
<span id="cb38-804"><a href="#cb38-804"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-805"><a href="#cb38-805"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb38-806"><a href="#cb38-806"></a>  )</span>
<span id="cb38-807"><a href="#cb38-807"></a><span class="in">```</span></span>
<span id="cb38-808"><a href="#cb38-808"></a></span>
<span id="cb38-809"><a href="#cb38-809"></a></span>
<span id="cb38-810"><a href="#cb38-810"></a></span>
<span id="cb38-811"><a href="#cb38-811"></a><span class="fu">### Colour in bar charts</span></span>
<span id="cb38-812"><a href="#cb38-812"></a></span>
<span id="cb38-813"><a href="#cb38-813"></a>We can further improve our bar chart by using colour to indicate which states are in which of the two regions of Malaysia. To do this, we will:</span>
<span id="cb38-814"><a href="#cb38-814"></a></span>
<span id="cb38-815"><a href="#cb38-815"></a><span class="ss">  * </span>specify in the call to <span class="in">`aes()`</span> that the fill colour of the bars should be controlled by the <span class="in">`region`</span> column in the data,</span>
<span id="cb38-816"><a href="#cb38-816"></a><span class="ss">  * </span>specify in the call to <span class="in">`labs()`</span> that we don't want the legend to have a title, since the meaning is obvious from the values 'East Malaysia' and 'West Malaysia', and</span>
<span id="cb38-817"><a href="#cb38-817"></a><span class="ss">  * </span>specify in the call to <span class="in">`theme()`</span> that we would like the legend use up some of the empty space in the bottom-right corner of the chart, rather than making the chart smaller to give space for the legend on the right-hand side.</span>
<span id="cb38-818"><a href="#cb38-818"></a>    </span>
<span id="cb38-819"><a href="#cb38-819"></a>To move the legend, we need to specify several different arguments in the <span class="in">`theme()`</span> function. <span class="in">`legend.position`</span> determines where around the plot the legend should be placed: 'top', 'right', 'bottom', 'left' or 'inside'. In this case we want the legend to appear in some spare space on the plot itself, so we will set <span class="in">`legend.position = "inside"`</span>. We then use the <span class="in">`legend.position.inside`</span> argument to <span class="in">`theme()`</span> to specify exactly _where_ inside the plot we want the legend to appear. We do that by specifying where the legend should appear horizontally and vertically, as a proportion of the axis</span>
<span id="cb38-820"><a href="#cb38-820"></a>length, on a scale from zero to one. </span>
<span id="cb38-821"><a href="#cb38-821"></a></span>
<span id="cb38-822"><a href="#cb38-822"></a></span>
<span id="cb38-823"><a href="#cb38-823"></a><span class="in">```{r legend-position-inside}</span></span>
<span id="cb38-824"><a href="#cb38-824"></a><span class="in">#| echo: false</span></span>
<span id="cb38-825"><a href="#cb38-825"></a><span class="in">#| label: "Examples of where legends will be placed inside the chart area based on the value provided to the `legend.position.inside` argument of `theme()`"</span></span>
<span id="cb38-826"><a href="#cb38-826"></a><span class="in">#| fig-align: "center"</span></span>
<span id="cb38-827"><a href="#cb38-827"></a><span class="in">#| fig.asp: 1</span></span>
<span id="cb38-828"><a href="#cb38-828"></a></span>
<span id="cb38-829"><a href="#cb38-829"></a><span class="in">tibble(</span></span>
<span id="cb38-830"><a href="#cb38-830"></a><span class="in">  x = rep(rep(seq(0, 1, by = 0.25)), each = 5), </span></span>
<span id="cb38-831"><a href="#cb38-831"></a><span class="in">  y = rep(rep(seq(0, 1, by = 0.25)), times = 5)</span></span>
<span id="cb38-832"><a href="#cb38-832"></a><span class="in">) |&gt; </span></span>
<span id="cb38-833"><a href="#cb38-833"></a><span class="in">  mutate(</span></span>
<span id="cb38-834"><a href="#cb38-834"></a><span class="in">    label = str_glue(</span></span>
<span id="cb38-835"><a href="#cb38-835"></a><span class="in">      "{scales::number(x, accuracy = 0.01)}, ",</span></span>
<span id="cb38-836"><a href="#cb38-836"></a><span class="in">      "{scales::number(y, accuracy = 0.01)}"</span></span>
<span id="cb38-837"><a href="#cb38-837"></a><span class="in">    )</span></span>
<span id="cb38-838"><a href="#cb38-838"></a><span class="in">  ) |&gt; </span></span>
<span id="cb38-839"><a href="#cb38-839"></a><span class="in">  ggplot(aes(x = x, y = y, label = label)) +</span></span>
<span id="cb38-840"><a href="#cb38-840"></a><span class="in">  geom_point() +</span></span>
<span id="cb38-841"><a href="#cb38-841"></a><span class="in">  geom_label() +</span></span>
<span id="cb38-842"><a href="#cb38-842"></a><span class="in">  scale_x_continuous(</span></span>
<span id="cb38-843"><a href="#cb38-843"></a><span class="in">    expand = expansion(0.1), </span></span>
<span id="cb38-844"><a href="#cb38-844"></a><span class="in">    position = "top", </span></span>
<span id="cb38-845"><a href="#cb38-845"></a><span class="in">    sec.axis = dup_axis(name = NULL)</span></span>
<span id="cb38-846"><a href="#cb38-846"></a><span class="in">  ) +</span></span>
<span id="cb38-847"><a href="#cb38-847"></a><span class="in">  scale_y_continuous(</span></span>
<span id="cb38-848"><a href="#cb38-848"></a><span class="in">    expand = expansion(0.1), </span></span>
<span id="cb38-849"><a href="#cb38-849"></a><span class="in">    sec.axis = dup_axis(name = NULL)</span></span>
<span id="cb38-850"><a href="#cb38-850"></a><span class="in">  ) +</span></span>
<span id="cb38-851"><a href="#cb38-851"></a><span class="in">  coord_fixed() +</span></span>
<span id="cb38-852"><a href="#cb38-852"></a><span class="in">  labs(</span></span>
<span id="cb38-853"><a href="#cb38-853"></a><span class="in">    x = "the first number gives the value on horizontal (x) axis",</span></span>
<span id="cb38-854"><a href="#cb38-854"></a><span class="in">    y = "the second number gives the value on vertical (y) axis"</span></span>
<span id="cb38-855"><a href="#cb38-855"></a><span class="in">  ) +</span></span>
<span id="cb38-856"><a href="#cb38-856"></a><span class="in">  theme_minimal()</span></span>
<span id="cb38-857"><a href="#cb38-857"></a><span class="in">```</span></span>
<span id="cb38-858"><a href="#cb38-858"></a></span>
<span id="cb38-859"><a href="#cb38-859"></a></span>
<span id="cb38-860"><a href="#cb38-860"></a>Using this specification, we can place the legend in the right-most point on the horizontal axis and the bottom-most point on the vertical axis by specifying <span class="in">`legend.position.inside = c(1, 0)`</span>.</span>
<span id="cb38-861"><a href="#cb38-861"></a></span>
<span id="cb38-862"><a href="#cb38-862"></a><span class="in">`legend.position.inside`</span> sets the _anchor_ point from which the legend is created, with the actual size of the legend depending on how much space is required by its contents. By default, a legend will spread out in all directions from the anchor point, i.e. the legend will be horizontally and vertically centred on the anchor point. As we have positioned the legend in a corner of the plot, this is probably not what we want since some of the legend will be hidden outside the</span>
<span id="cb38-863"><a href="#cb38-863"></a>plot area. Instead, we can set the <span class="in">`legend.justifcation`</span> argument of <span class="in">`theme()`</span> using a similar specification to that for <span class="in">`legend.position.inside`</span> based on which way we want the legend to grow.</span>
<span id="cb38-864"><a href="#cb38-864"></a></span>
<span id="cb38-865"><a href="#cb38-865"></a></span>
<span id="cb38-866"><a href="#cb38-866"></a><span class="in">```{r legend-justification}</span></span>
<span id="cb38-867"><a href="#cb38-867"></a><span class="in">#| echo: false</span></span>
<span id="cb38-868"><a href="#cb38-868"></a><span class="in">#| fig-align: "center"</span></span>
<span id="cb38-869"><a href="#cb38-869"></a><span class="in">#| fig-asp: 0.33</span></span>
<span id="cb38-870"><a href="#cb38-870"></a></span>
<span id="cb38-871"><a href="#cb38-871"></a><span class="in">tibble(</span></span>
<span id="cb38-872"><a href="#cb38-872"></a><span class="in">  x = c(1.1, 1.1, 0.9, 0.9, 1.1, 0.9, 1, 1),</span></span>
<span id="cb38-873"><a href="#cb38-873"></a><span class="in">  xend = c(1.25, 1.25, 0.75, 0.75, 1.25, 0.75, 1, 1),</span></span>
<span id="cb38-874"><a href="#cb38-874"></a><span class="in">  y = c(1.1, 0.9, 1.1, 0.9, 1, 1, 0.9, 1.1),</span></span>
<span id="cb38-875"><a href="#cb38-875"></a><span class="in">  yend = c(1.25, 0.75, 1.25, 0.75, 1, 1, 0.75, 1.25),</span></span>
<span id="cb38-876"><a href="#cb38-876"></a><span class="in">  h = c(0, 0, 1, 1, 0, 1, 0.5, 0.5),</span></span>
<span id="cb38-877"><a href="#cb38-877"></a><span class="in">  v = c(0, 1, 0, 1, 0.5, 0.5, 1, 0)</span></span>
<span id="cb38-878"><a href="#cb38-878"></a><span class="in">)  |&gt;  </span></span>
<span id="cb38-879"><a href="#cb38-879"></a><span class="in">  mutate(</span></span>
<span id="cb38-880"><a href="#cb38-880"></a><span class="in">    label = str_glue(</span></span>
<span id="cb38-881"><a href="#cb38-881"></a><span class="in">      "{scales::number(h, accuracy = 0.1)}, {scales::number(v, accuracy = 0.1)}"</span></span>
<span id="cb38-882"><a href="#cb38-882"></a><span class="in">    )</span></span>
<span id="cb38-883"><a href="#cb38-883"></a><span class="in">  ) |&gt; </span></span>
<span id="cb38-884"><a href="#cb38-884"></a><span class="in">  ggplot() +</span></span>
<span id="cb38-885"><a href="#cb38-885"></a><span class="in">  geom_segment(</span></span>
<span id="cb38-886"><a href="#cb38-886"></a><span class="in">    aes(x = x, y = y, xend = xend, yend = yend), </span></span>
<span id="cb38-887"><a href="#cb38-887"></a><span class="in">    linewidth = 1, </span></span>
<span id="cb38-888"><a href="#cb38-888"></a><span class="in">    arrow = arrow(length = unit(3, "mm"), type = "closed")</span></span>
<span id="cb38-889"><a href="#cb38-889"></a><span class="in">  ) +</span></span>
<span id="cb38-890"><a href="#cb38-890"></a><span class="in">  geom_label(aes(x = xend, y = yend, hjust = h, vjust = v, label = label)) +</span></span>
<span id="cb38-891"><a href="#cb38-891"></a><span class="in">  geom_point(aes(x = x, y = y), size = 4) +</span></span>
<span id="cb38-892"><a href="#cb38-892"></a><span class="in">  scale_x_continuous(expand = expansion(3)) +</span></span>
<span id="cb38-893"><a href="#cb38-893"></a><span class="in">  scale_y_continuous(expand = expansion(0.5)) +</span></span>
<span id="cb38-894"><a href="#cb38-894"></a><span class="in">  coord_fixed() +</span></span>
<span id="cb38-895"><a href="#cb38-895"></a><span class="in">  theme_void()</span></span>
<span id="cb38-896"><a href="#cb38-896"></a><span class="in">```</span></span>
<span id="cb38-897"><a href="#cb38-897"></a></span>
<span id="cb38-898"><a href="#cb38-898"></a></span>
<span id="cb38-899"><a href="#cb38-899"></a>If you want the legend to grow 'inwards' from a corner, just set <span class="in">`legend.justification`</span> to the same value as you used for <span class="in">`legend.position.inside`</span>. In this case, we want the legend to be anchored in the bottom-right corner and to grow inwards from it, so we will set both arguments to <span class="in">`c(1, 0)`</span>.</span>
<span id="cb38-900"><a href="#cb38-900"></a></span>
<span id="cb38-901"><a href="#cb38-901"></a>Add this code to your script file and run it.</span>
<span id="cb38-902"><a href="#cb38-902"></a></span>
<span id="cb38-903"><a href="#cb38-903"></a></span>
<span id="cb38-906"><a href="#cb38-906"></a><span class="in">```{r}</span></span>
<span id="cb38-907"><a href="#cb38-907"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-908"><a href="#cb38-908"></a></span>
<span id="cb38-909"><a href="#cb38-909"></a><span class="co"># Create bar chart of murder counts</span></span>
<span id="cb38-910"><a href="#cb38-910"></a>malaysia_murder_bar_chart <span class="ot">&lt;-</span> violence <span class="sc">|&gt;</span> </span>
<span id="cb38-911"><a href="#cb38-911"></a>  <span class="co"># Keep only rows representing murder counts</span></span>
<span id="cb38-912"><a href="#cb38-912"></a>  <span class="fu">filter</span>(crime_type <span class="sc">==</span> <span class="st">"murder"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-913"><a href="#cb38-913"></a>  <span class="co"># Re-order states according to number of murders</span></span>
<span id="cb38-914"><a href="#cb38-914"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">fct_reorder</span>(state, count)) <span class="sc">|&gt;</span> </span>
<span id="cb38-915"><a href="#cb38-915"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-916"><a href="#cb38-916"></a>  <span class="co"># Translate columns in the data to aesthetics on the chart</span></span>
<span id="cb38-917"><a href="#cb38-917"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> state, <span class="at">fill =</span> region) <span class="sc">+</span></span>
<span id="cb38-918"><a href="#cb38-918"></a>  <span class="co"># Add bars</span></span>
<span id="cb38-919"><a href="#cb38-919"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb38-920"><a href="#cb38-920"></a>  <span class="co"># Remove space at either end of horizontal axis</span></span>
<span id="cb38-921"><a href="#cb38-921"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb38-922"><a href="#cb38-922"></a>  <span class="co"># Add labels</span></span>
<span id="cb38-923"><a href="#cb38-923"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-924"><a href="#cb38-924"></a>    <span class="at">title =</span> <span class="st">"Murders in Malaysian states, 2017"</span>,</span>
<span id="cb38-925"><a href="#cb38-925"></a>    <span class="at">caption =</span> <span class="st">"Data from the Royal Malaysian Police"</span>,</span>
<span id="cb38-926"><a href="#cb38-926"></a>    <span class="at">x =</span> <span class="st">"number of murders"</span>,</span>
<span id="cb38-927"><a href="#cb38-927"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb38-928"><a href="#cb38-928"></a>  ) <span class="sc">+</span></span>
<span id="cb38-929"><a href="#cb38-929"></a>  <span class="co"># Remove unnecessary map elements</span></span>
<span id="cb38-930"><a href="#cb38-930"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb38-931"><a href="#cb38-931"></a>  <span class="fu">theme</span>(</span>
<span id="cb38-932"><a href="#cb38-932"></a>    <span class="co"># Move legend to bottom-right corner and give it a solid white background</span></span>
<span id="cb38-933"><a href="#cb38-933"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="st">"white"</span>),</span>
<span id="cb38-934"><a href="#cb38-934"></a>    <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb38-935"><a href="#cb38-935"></a>    <span class="at">legend.position =</span> <span class="st">"inside"</span>,</span>
<span id="cb38-936"><a href="#cb38-936"></a>    <span class="at">legend.position.inside =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb38-937"><a href="#cb38-937"></a>    <span class="co"># Remove unnecessary horizontal grid lines</span></span>
<span id="cb38-938"><a href="#cb38-938"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-939"><a href="#cb38-939"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb38-940"><a href="#cb38-940"></a>  )</span>
<span id="cb38-941"><a href="#cb38-941"></a><span class="in">```</span></span>
<span id="cb38-942"><a href="#cb38-942"></a></span>
<span id="cb38-943"><a href="#cb38-943"></a></span>
<span id="cb38-946"><a href="#cb38-946"></a><span class="in">```{r}</span></span>
<span id="cb38-947"><a href="#cb38-947"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-948"><a href="#cb38-948"></a></span>
<span id="cb38-949"><a href="#cb38-949"></a>malaysia_murder_bar_chart</span>
<span id="cb38-950"><a href="#cb38-950"></a><span class="in">```</span></span>
<span id="cb38-951"><a href="#cb38-951"></a></span>
<span id="cb38-952"><a href="#cb38-952"></a></span>
<span id="cb38-953"><a href="#cb38-953"></a>One issue with this chart is that the default colours that <span class="in">`ggplot()`</span> produces are not easy for everyone to discern. In particular, people with colour blindness may struggle to distinguish between some combinations of colours. Some colour combinations are also hard (or impossible) to distinguish even for people with normal colour vision if a chart is printed in black and white or viewed on a screen in some lighting conditions.</span>
<span id="cb38-954"><a href="#cb38-954"></a></span>
<span id="cb38-955"><a href="#cb38-955"></a>We can check how well people with different colour vision will be able to read a chart using the <span class="in">`cvd_grid()`</span> function from the colorblindr package. This function takes an existing <span class="in">`ggplot()`</span> stack and prints several versions of the chart that simulate how different people will see it.</span>
<span id="cb38-956"><a href="#cb38-956"></a></span>
<span id="cb38-957"><a href="#cb38-957"></a></span>
<span id="cb38-958"><a href="#cb38-958"></a>The colorblindr package is not on CRAN, the repository we usually install R packages from. That means we need to use slightly different code to install it. Instead of installing from CRAN, we will instead install the package from GitHub, a website that programmers use to store versions of their code. To install packages from GitHub we can use the <span class="in">`p_install_gh()`</span> function from the pacman package (the same package we use to load packages at the start of each R script).</span>
<span id="cb38-959"><a href="#cb38-959"></a></span>
<span id="cb38-960"><a href="#cb38-960"></a></span>
<span id="cb38-963"><a href="#cb38-963"></a><span class="in">```{r}</span></span>
<span id="cb38-964"><a href="#cb38-964"></a><span class="co">#| eval: false</span></span>
<span id="cb38-965"><a href="#cb38-965"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-966"><a href="#cb38-966"></a></span>
<span id="cb38-967"><a href="#cb38-967"></a><span class="co"># Install the colorblindr package from GitHub</span></span>
<span id="cb38-968"><a href="#cb38-968"></a>pacman<span class="sc">::</span><span class="fu">p_install_gh</span>(<span class="st">"clauswilke/colorblindr"</span>)</span>
<span id="cb38-969"><a href="#cb38-969"></a><span class="in">```</span></span>
<span id="cb38-970"><a href="#cb38-970"></a></span>
<span id="cb38-971"><a href="#cb38-971"></a></span>
<span id="cb38-972"><a href="#cb38-972"></a>Remember that because we only need to install a package once on each computer we use R on, you should never install packages inside an R script. This means you should only ever run <span class="in">`pacman::p_install_gh()`</span> in the R Console, never in an R script.</span>
<span id="cb38-973"><a href="#cb38-973"></a></span>
<span id="cb38-974"><a href="#cb38-974"></a>Once you've installed the colorblindr package, you can use it to check how different people are likely to see the chart of murder in Malaysia.</span>
<span id="cb38-975"><a href="#cb38-975"></a></span>
<span id="cb38-976"><a href="#cb38-976"></a></span>
<span id="cb38-979"><a href="#cb38-979"></a><span class="in">```{r}</span></span>
<span id="cb38-980"><a href="#cb38-980"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-981"><a href="#cb38-981"></a><span class="co">#| fig-asp: 1</span></span>
<span id="cb38-982"><a href="#cb38-982"></a></span>
<span id="cb38-983"><a href="#cb38-983"></a><span class="co"># Check if chart colours are safe for different people</span></span>
<span id="cb38-984"><a href="#cb38-984"></a>colorblindr<span class="sc">::</span><span class="fu">cvd_grid</span>(malaysia_murder_bar_chart)</span>
<span id="cb38-985"><a href="#cb38-985"></a><span class="in">```</span></span>
<span id="cb38-986"><a href="#cb38-986"></a></span>
<span id="cb38-987"><a href="#cb38-987"></a></span>
<span id="cb38-988"><a href="#cb38-988"></a>From this we can see that this combination of colours works well for people with some types of colour blindness, but is likely to be hard for some people, and indeed for everyone if the chart is printed on a black-and-white printer.</span>
<span id="cb38-989"><a href="#cb38-989"></a></span>
<span id="cb38-990"><a href="#cb38-990"></a></span>
<span id="cb38-991"><a href="#cb38-991"></a><span class="co">[</span><span class="al">![](../images/paletteer.png)</span><span class="ot">{.right-side-image fig-alt="paletteer website"}</span><span class="co">](https://emilhvitfeldt.github.io/paletteer/)</span></span>
<span id="cb38-992"><a href="#cb38-992"></a></span>
<span id="cb38-993"><a href="#cb38-993"></a></span>
<span id="cb38-994"><a href="#cb38-994"></a>Fortunately, there are lots of different R packages that provide colour palettes that are suitable for people with different colour vision. The <span class="co">[</span><span class="ot">paletteer package</span><span class="co">](https://emilhvitfeldt.github.io/paletteer/)</span> brings a lot of these colour palettes together in one place. paletteer provides three pairs of functions for different types of colour scale:</span>
<span id="cb38-995"><a href="#cb38-995"></a></span>
<span id="cb38-996"><a href="#cb38-996"></a><span class="ss">* </span><span class="in">`scale_colour_paletteer_c()`</span>/<span class="in">`scale_fill_paletteer_c()`</span> for _continuous_ scales that are suitable for representing continuous variables.</span>
<span id="cb38-997"><a href="#cb38-997"></a><span class="ss">* </span><span class="in">`scale_colour_paletteer_d()`</span>/<span class="in">`scale_fill_paletteer_d()`</span> for _discrete_ scales that are suitable for representing categorical variables.</span>
<span id="cb38-998"><a href="#cb38-998"></a><span class="ss">* </span><span class="in">`scale_colour_paletteer_binned()`</span>/<span class="in">`scale_fill_paletteer_binned()`</span> for _binned_ scales that are suitable for showing continuous variables that have been sub-divided ('binned') into ordered categories.</span>
<span id="cb38-999"><a href="#cb38-999"></a></span>
<span id="cb38-1000"><a href="#cb38-1000"></a>We can use each of these functions in the same way we have used functions like <span class="in">`scale_fill_distiller()`</span> in previous chapters. The first argument to all the main functions in the paletteer package is the name of a colour palette, of which a total of <span class="in">`r scales::comma(nrow(paletteer::palettes_d_names) + nrow(paletteer::palettes_c_names) + nrow(paletteer::palettes_dynamic_names))`</span> different palettes are available. We can specify which palette to use using the same syntax we have sometimes used to refer to R functions: <span class="in">`package_name::palette_name`</span>. For example, to create a discrete colour scale using the OKeeffe2 palette from the <span class="co">[</span><span class="ot">MetBrewer package</span><span class="co">](https://github.com/BlakeRMills/MetBrewer)</span> (a palette inspired by the painting <span class="co">[</span><span class="ot">_Red and Yellow Cliffs_ by Georgia O'Keeffe</span><span class="co">](https://www.metmuseum.org/art/collection/search/484833)</span>) we could use <span class="in">`scale_colour_paletteer_d("MetBrewer::OKeeffe2")`</span>.</span>
<span id="cb38-1001"><a href="#cb38-1001"></a></span>
<span id="cb38-1002"><a href="#cb38-1002"></a>There are many useful colour palettes in the <span class="co">[</span><span class="ot">PrettyCols package</span><span class="co">](https://nrennie.rbind.io/PrettyCols/)</span>. Let's use the Bright palette from this package to control the colours on the chart.</span>
<span id="cb38-1003"><a href="#cb38-1003"></a></span>
<span id="cb38-1004"><a href="#cb38-1004"></a></span>
<span id="cb38-1007"><a href="#cb38-1007"></a><span class="in">```{r}</span></span>
<span id="cb38-1008"><a href="#cb38-1008"></a><span class="co">#| filename: "chapter15a.R"</span></span>
<span id="cb38-1009"><a href="#cb38-1009"></a></span>
<span id="cb38-1010"><a href="#cb38-1010"></a><span class="co"># Create bar chart of murder counts</span></span>
<span id="cb38-1011"><a href="#cb38-1011"></a>malaysia_murder_bar_chart <span class="ot">&lt;-</span> violence <span class="sc">|&gt;</span> </span>
<span id="cb38-1012"><a href="#cb38-1012"></a>  <span class="co"># Keep only rows representing murder counts</span></span>
<span id="cb38-1013"><a href="#cb38-1013"></a>  <span class="fu">filter</span>(crime_type <span class="sc">==</span> <span class="st">"murder"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-1014"><a href="#cb38-1014"></a>  <span class="co"># Re-order states according to number of murders</span></span>
<span id="cb38-1015"><a href="#cb38-1015"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">fct_reorder</span>(state, count)) <span class="sc">|&gt;</span> </span>
<span id="cb38-1016"><a href="#cb38-1016"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-1017"><a href="#cb38-1017"></a>  <span class="co"># Translate columns in the data to aesthetics on the chart</span></span>
<span id="cb38-1018"><a href="#cb38-1018"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> state, <span class="at">fill =</span> region) <span class="sc">+</span></span>
<span id="cb38-1019"><a href="#cb38-1019"></a>  <span class="co"># Add bars</span></span>
<span id="cb38-1020"><a href="#cb38-1020"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb38-1021"><a href="#cb38-1021"></a>  <span class="co"># Remove space at either end of horizontal axis</span></span>
<span id="cb38-1022"><a href="#cb38-1022"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb38-1023"><a href="#cb38-1023"></a>  <span class="co"># Specify colour-blind-safe fill colours</span></span>
<span id="cb38-1024"><a href="#cb38-1024"></a>  <span class="fu">scale_fill_paletteer_d</span>(<span class="st">"PrettyCols::Bright"</span>) <span class="sc">+</span></span>
<span id="cb38-1025"><a href="#cb38-1025"></a>  <span class="co"># Add labels</span></span>
<span id="cb38-1026"><a href="#cb38-1026"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-1027"><a href="#cb38-1027"></a>    <span class="at">title =</span> <span class="st">"Murders in Malaysian states, 2017"</span>,</span>
<span id="cb38-1028"><a href="#cb38-1028"></a>    <span class="at">caption =</span> <span class="st">"Data from the Royal Malaysian Police"</span>,</span>
<span id="cb38-1029"><a href="#cb38-1029"></a>    <span class="at">x =</span> <span class="st">"number of murders"</span>,</span>
<span id="cb38-1030"><a href="#cb38-1030"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb38-1031"><a href="#cb38-1031"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1032"><a href="#cb38-1032"></a>  <span class="co"># Remove unnecessary map elements</span></span>
<span id="cb38-1033"><a href="#cb38-1033"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb38-1034"><a href="#cb38-1034"></a>  <span class="fu">theme</span>(</span>
<span id="cb38-1035"><a href="#cb38-1035"></a>    <span class="co"># Move legend to bottom-right corner and give it a solid white background</span></span>
<span id="cb38-1036"><a href="#cb38-1036"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="st">"white"</span>),</span>
<span id="cb38-1037"><a href="#cb38-1037"></a>    <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb38-1038"><a href="#cb38-1038"></a>    <span class="at">legend.position =</span> <span class="st">"inside"</span>,</span>
<span id="cb38-1039"><a href="#cb38-1039"></a>    <span class="at">legend.position.inside =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb38-1040"><a href="#cb38-1040"></a>    <span class="co"># Remove unnecessary horizontal grid lines</span></span>
<span id="cb38-1041"><a href="#cb38-1041"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-1042"><a href="#cb38-1042"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb38-1043"><a href="#cb38-1043"></a>  )</span>
<span id="cb38-1044"><a href="#cb38-1044"></a><span class="in">```</span></span>
<span id="cb38-1045"><a href="#cb38-1045"></a></span>
<span id="cb38-1046"><a href="#cb38-1046"></a></span>
<span id="cb38-1049"><a href="#cb38-1049"></a><span class="in">```{r}</span></span>
<span id="cb38-1050"><a href="#cb38-1050"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-1051"><a href="#cb38-1051"></a></span>
<span id="cb38-1052"><a href="#cb38-1052"></a>malaysia_murder_bar_chart</span>
<span id="cb38-1053"><a href="#cb38-1053"></a><span class="in">```</span></span>
<span id="cb38-1054"><a href="#cb38-1054"></a></span>
<span id="cb38-1055"><a href="#cb38-1055"></a></span>
<span id="cb38-1056"><a href="#cb38-1056"></a>To see if these colours are likely to work for different people, we can again check the colours with the colorblindr package:</span>
<span id="cb38-1057"><a href="#cb38-1057"></a></span>
<span id="cb38-1058"><a href="#cb38-1058"></a></span>
<span id="cb38-1061"><a href="#cb38-1061"></a><span class="in">```{r}</span></span>
<span id="cb38-1062"><a href="#cb38-1062"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-1063"><a href="#cb38-1063"></a><span class="co">#| fig-asp: 1</span></span>
<span id="cb38-1064"><a href="#cb38-1064"></a></span>
<span id="cb38-1065"><a href="#cb38-1065"></a><span class="co"># Check if chart colours are safe for different people</span></span>
<span id="cb38-1066"><a href="#cb38-1066"></a>colorblindr<span class="sc">::</span><span class="fu">cvd_grid</span>(malaysia_murder_bar_chart)</span>
<span id="cb38-1067"><a href="#cb38-1067"></a><span class="in">```</span></span>
<span id="cb38-1068"><a href="#cb38-1068"></a></span>
<span id="cb38-1069"><a href="#cb38-1069"></a>From this, we can see that this colour palette is going to be much more useful for people with different colour vision, as well as for everyone if the chart is printed in black and white or viewed on a screen in bad light.</span>
<span id="cb38-1070"><a href="#cb38-1070"></a></span>
<span id="cb38-1071"><a href="#cb38-1071"></a></span>
<span id="cb38-1072"><a href="#cb38-1072"></a>::: {.box .reading}</span>
<span id="cb38-1073"><a href="#cb38-1073"></a>There are lots of other ways to control colours on charts and maps in R. For more detail, read <span class="co">[</span><span class="ot">Working with colours in R</span><span class="co">](https://nrennie.rbind.io/blog/colours-in-r/)</span>.</span>
<span id="cb38-1074"><a href="#cb38-1074"></a>:::</span>
<span id="cb38-1075"><a href="#cb38-1075"></a></span>
<span id="cb38-1076"><a href="#cb38-1076"></a></span>
<span id="cb38-1077"><a href="#cb38-1077"></a>Bar charts are a very common way of presenting a numeric variable for each value of a categorical variable. Bar charts are easy to interpret, even for people who are not used to interpreting charts or who only have time to look at the chart for a few seconds.</span>
<span id="cb38-1078"><a href="#cb38-1078"></a></span>
<span id="cb38-1079"><a href="#cb38-1079"></a></span>
<span id="cb38-1080"><a href="#cb38-1080"></a>::: {.callout-quiz .callout}</span>
<span id="cb38-1081"><a href="#cb38-1081"></a></span>
<span id="cb38-1082"><a href="#cb38-1082"></a><span class="in">```{r bar-chart-quiz}</span></span>
<span id="cb38-1083"><a href="#cb38-1083"></a><span class="in">#| echo: false</span></span>
<span id="cb38-1084"><a href="#cb38-1084"></a></span>
<span id="cb38-1085"><a href="#cb38-1085"></a><span class="in">bar_chart_quiz1 &lt;- c(</span></span>
<span id="cb38-1086"><a href="#cb38-1086"></a><span class="in">  "To follow the alphabetical order of locations",</span></span>
<span id="cb38-1087"><a href="#cb38-1087"></a><span class="in">  "To avoid using colors in the chart",</span></span>
<span id="cb38-1088"><a href="#cb38-1088"></a><span class="in">  answer = "To make it easier to see which rows have the highest values",</span></span>
<span id="cb38-1089"><a href="#cb38-1089"></a><span class="in">  "To ensure a map is not needed"</span></span>
<span id="cb38-1090"><a href="#cb38-1090"></a><span class="in">)</span></span>
<span id="cb38-1091"><a href="#cb38-1091"></a></span>
<span id="cb38-1092"><a href="#cb38-1092"></a><span class="in">bar_chart_quiz2 &lt;- c(</span></span>
<span id="cb38-1093"><a href="#cb38-1093"></a><span class="in">  "To make the bar chart look more visually appealing",</span></span>
<span id="cb38-1094"><a href="#cb38-1094"></a><span class="in">  "To display non-spatial variables",</span></span>
<span id="cb38-1095"><a href="#cb38-1095"></a><span class="in">  "To replace the need for a table",</span></span>
<span id="cb38-1096"><a href="#cb38-1096"></a><span class="in">  answer = "To provide context for areas that the audience may not recognize"</span></span>
<span id="cb38-1097"><a href="#cb38-1097"></a><span class="in">)</span></span>
<span id="cb38-1098"><a href="#cb38-1098"></a></span>
<span id="cb38-1099"><a href="#cb38-1099"></a><span class="in">bar_chart_quiz3 &lt;- c(</span></span>
<span id="cb38-1100"><a href="#cb38-1100"></a><span class="in">  answer = "Bar charts allow for direct numeric comparisons between areas",</span></span>
<span id="cb38-1101"><a href="#cb38-1101"></a><span class="in">  "Bar charts can show detailed spatial relationships",</span></span>
<span id="cb38-1102"><a href="#cb38-1102"></a><span class="in">  "Bar charts are required for all crime analysis",</span></span>
<span id="cb38-1103"><a href="#cb38-1103"></a><span class="in">  "Bar charts are easier to make than maps"</span></span>
<span id="cb38-1104"><a href="#cb38-1104"></a><span class="in">)</span></span>
<span id="cb38-1105"><a href="#cb38-1105"></a><span class="in">```</span></span>
<span id="cb38-1106"><a href="#cb38-1106"></a></span>
<span id="cb38-1107"><a href="#cb38-1107"></a></span>
<span id="cb38-1108"><a href="#cb38-1108"></a>**When creating a bar chart, why might you want to sort the bars by value?**</span>
<span id="cb38-1109"><a href="#cb38-1109"></a></span>
<span id="cb38-1110"><a href="#cb38-1110"></a><span class="in">`r webexercises::longmcq(bar_chart_quiz1)`</span></span>
<span id="cb38-1111"><a href="#cb38-1111"></a></span>
<span id="cb38-1112"><a href="#cb38-1112"></a></span>
<span id="cb38-1113"><a href="#cb38-1113"></a>**What is one reason why a reference map might be included alongside a bar chart?**</span>
<span id="cb38-1114"><a href="#cb38-1114"></a></span>
<span id="cb38-1115"><a href="#cb38-1115"></a><span class="in">`r webexercises::longmcq(bar_chart_quiz2)`</span></span>
<span id="cb38-1116"><a href="#cb38-1116"></a></span>
<span id="cb38-1117"><a href="#cb38-1117"></a></span>
<span id="cb38-1118"><a href="#cb38-1118"></a>**Why might a bar chart be more effective than a choropleth map for presenting crime data?**</span>
<span id="cb38-1119"><a href="#cb38-1119"></a></span>
<span id="cb38-1120"><a href="#cb38-1120"></a><span class="in">`r webexercises::longmcq(bar_chart_quiz3)`</span></span>
<span id="cb38-1121"><a href="#cb38-1121"></a></span>
<span id="cb38-1122"><a href="#cb38-1122"></a></span>
<span id="cb38-1123"><a href="#cb38-1123"></a>:::</span>
<span id="cb38-1124"><a href="#cb38-1124"></a></span>
<span id="cb38-1125"><a href="#cb38-1125"></a></span>
<span id="cb38-1126"><a href="#cb38-1126"></a></span>
<span id="cb38-1127"><a href="#cb38-1127"></a><span class="fu">## Visualising distributions</span></span>
<span id="cb38-1128"><a href="#cb38-1128"></a></span>
<span id="cb38-1129"><a href="#cb38-1129"></a>Bar charts show a single piece of information about each category present in a dataset. So we might use a bar chart to show, for example, the average number of burglaries in neighbourhoods in different districts. But what if the average values masked substantial differences in the number of burglaries within each district? Averages often mask variation, and can sometimes be misleading as a result. In those circumstances it would be better to show more detail rather than a misleading average.</span>
<span id="cb38-1130"><a href="#cb38-1130"></a></span>
<span id="cb38-1131"><a href="#cb38-1131"></a>Let's start with the simple example of showing the distribution of burglary counts within a single district. Restart R (<span class="in">`Session &gt; Restart R`</span>), open a new R script file and save it as <span class="in">`chapter15b.R`</span>. Use this code to load a dataset of burglaries in each lower-layer super output area (LSOA) in Northamptonshire in England in 2020. </span>
<span id="cb38-1132"><a href="#cb38-1132"></a></span>
<span id="cb38-1133"><a href="#cb38-1133"></a></span>
<span id="cb38-1136"><a href="#cb38-1136"></a><span class="in">```{r}</span></span>
<span id="cb38-1137"><a href="#cb38-1137"></a><span class="co">#| filename: "chapter15b.R"</span></span>
<span id="cb38-1138"><a href="#cb38-1138"></a></span>
<span id="cb38-1139"><a href="#cb38-1139"></a><span class="co"># Load packages</span></span>
<span id="cb38-1140"><a href="#cb38-1140"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span>
<span id="cb38-1141"><a href="#cb38-1141"></a></span>
<span id="cb38-1142"><a href="#cb38-1142"></a><span class="co"># Load data</span></span>
<span id="cb38-1143"><a href="#cb38-1143"></a>burglary <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/northants_burglary_counts.rds"</span>)</span>
<span id="cb38-1144"><a href="#cb38-1144"></a><span class="in">```</span></span>
<span id="cb38-1145"><a href="#cb38-1145"></a></span>
<span id="cb38-1146"><a href="#cb38-1146"></a></span>
<span id="cb38-1147"><a href="#cb38-1147"></a>To show the distribution of burglary counts we can create a *histogram* using <span class="in">`geom_histogram()`</span>. A histogram divides the range of values present in the data into a number of equally sized _bins_, then shows bars representing the number of observations (rows) in the data that have values fitting into each bin. We can either allow <span class="in">`geom_histogram()`</span> to set the number of bins automatically, or set it ourself with the <span class="in">`binwidth`</span> argument.</span>
<span id="cb38-1148"><a href="#cb38-1148"></a></span>
<span id="cb38-1149"><a href="#cb38-1149"></a>We will set the <span class="in">`binwidth`</span> argument of the <span class="in">`geom_histogram()`</span> function to <span class="in">`binwidth = 1`</span> so that each bar on the chart will show now many LSOAs have each individual value. We will also add some labels to help readers interpret the chart.</span>
<span id="cb38-1150"><a href="#cb38-1150"></a></span>
<span id="cb38-1151"><a href="#cb38-1151"></a></span>
<span id="cb38-1154"><a href="#cb38-1154"></a><span class="in">```{r}</span></span>
<span id="cb38-1155"><a href="#cb38-1155"></a><span class="co">#| filename: "chapter15b.R"</span></span>
<span id="cb38-1156"><a href="#cb38-1156"></a></span>
<span id="cb38-1157"><a href="#cb38-1157"></a><span class="co"># Create histogram of burglary counts</span></span>
<span id="cb38-1158"><a href="#cb38-1158"></a>burglary <span class="sc">|&gt;</span> </span>
<span id="cb38-1159"><a href="#cb38-1159"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-1160"><a href="#cb38-1160"></a>  <span class="co"># Specify which column in the data contains the value we're interested in</span></span>
<span id="cb38-1161"><a href="#cb38-1161"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count) <span class="sc">+</span></span>
<span id="cb38-1162"><a href="#cb38-1162"></a>  <span class="co"># Add a histogram to the chart</span></span>
<span id="cb38-1163"><a href="#cb38-1163"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb38-1164"><a href="#cb38-1164"></a>  <span class="co"># Remove unnecessary space at either end of both axes</span></span>
<span id="cb38-1165"><a href="#cb38-1165"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb38-1166"><a href="#cb38-1166"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb38-1167"><a href="#cb38-1167"></a>  <span class="co"># Add labels</span></span>
<span id="cb38-1168"><a href="#cb38-1168"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-1169"><a href="#cb38-1169"></a>    <span class="at">title =</span> <span class="st">"Number of burglaries in Northamptonshire neighbourhoods"</span>,</span>
<span id="cb38-1170"><a href="#cb38-1170"></a>    <span class="at">x =</span> <span class="st">"count of burglaries, 2020"</span>,</span>
<span id="cb38-1171"><a href="#cb38-1171"></a>    <span class="at">y =</span> <span class="st">"number of LSOAs"</span></span>
<span id="cb38-1172"><a href="#cb38-1172"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1173"><a href="#cb38-1173"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb38-1174"><a href="#cb38-1174"></a>  <span class="fu">theme</span>(</span>
<span id="cb38-1175"><a href="#cb38-1175"></a>    <span class="co"># Remove unnecessary vertical grid lines</span></span>
<span id="cb38-1176"><a href="#cb38-1176"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-1177"><a href="#cb38-1177"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb38-1178"><a href="#cb38-1178"></a>  )</span>
<span id="cb38-1179"><a href="#cb38-1179"></a><span class="in">```</span></span>
<span id="cb38-1180"><a href="#cb38-1180"></a></span>
<span id="cb38-1181"><a href="#cb38-1181"></a></span>
<span id="cb38-1182"><a href="#cb38-1182"></a>Interpreting histograms can be slightly counter-intuitive. The important thing to remember is that the horizontal position of each bar represents a number of burglaries and the vertical height of the bar represents how many neighbourhoods had that number of burglaries. This is the opposite of a bar chart, where the length of the bar represents the number of burglaries.</span>
<span id="cb38-1183"><a href="#cb38-1183"></a></span>
<span id="cb38-1184"><a href="#cb38-1184"></a>In this chart, we can see on this chart that most LSOAs had only a few burglaries in 2020 (represented by the tallest bars are to the left of the chart), while a few LSOAs had a larger number (the bars to the right of the chart). This is what we would expect, since we know the crimes are generally concentrated in a few places.</span>
<span id="cb38-1185"><a href="#cb38-1185"></a></span>
<span id="cb38-1186"><a href="#cb38-1186"></a></span>
<span id="cb38-1187"><a href="#cb38-1187"></a><span class="fu">### Plotting density curves</span></span>
<span id="cb38-1188"><a href="#cb38-1188"></a></span>
<span id="cb38-1189"><a href="#cb38-1189"></a>Histograms are one way to show the distribution of a variable (in this case, the count of burglaries). Another way to show the distribution of a variable is to create a _density curve_ with `geom_density()`. A density curve is a _smoothed_ version of a histogram, which is useful to show the general distribution of a variable (in this case, the number of LSOAs with different numbers of burglaries) at the cost of not showing the exact data. The mathematical procedure used by <span class="in">`geom_density()`</span> to calculate a density curve is the same as the kernel-density estimation process we have already learned to use to show concentrations of crime on a map.</span>
<span id="cb38-1190"><a href="#cb38-1190"></a></span>
<span id="cb38-1191"><a href="#cb38-1191"></a></span>
<span id="cb38-1194"><a href="#cb38-1194"></a><span class="in">```{r}</span></span>
<span id="cb38-1195"><a href="#cb38-1195"></a><span class="co">#| filename: "chapter15b.R"</span></span>
<span id="cb38-1196"><a href="#cb38-1196"></a></span>
<span id="cb38-1197"><a href="#cb38-1197"></a><span class="co"># Create a density plot of burglaries</span></span>
<span id="cb38-1198"><a href="#cb38-1198"></a>burglary <span class="sc">|&gt;</span> </span>
<span id="cb38-1199"><a href="#cb38-1199"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-1200"><a href="#cb38-1200"></a>  <span class="co"># Specify which column in the data contains the value we're interested in</span></span>
<span id="cb38-1201"><a href="#cb38-1201"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count) <span class="sc">+</span></span>
<span id="cb38-1202"><a href="#cb38-1202"></a>  <span class="co"># Add a density curve to the chart</span></span>
<span id="cb38-1203"><a href="#cb38-1203"></a>  <span class="fu">geom_density</span>(<span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb38-1204"><a href="#cb38-1204"></a>  <span class="co"># Remove unnecessary space at either end of both axes</span></span>
<span id="cb38-1205"><a href="#cb38-1205"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb38-1206"><a href="#cb38-1206"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb38-1207"><a href="#cb38-1207"></a>  <span class="co"># Add labels</span></span>
<span id="cb38-1208"><a href="#cb38-1208"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-1209"><a href="#cb38-1209"></a>    <span class="at">title =</span> <span class="st">"Number of burglaries in Northamptonshire neighbourhoods"</span>,</span>
<span id="cb38-1210"><a href="#cb38-1210"></a>    <span class="at">x =</span> <span class="st">"count of burglaries, 2020"</span>,</span>
<span id="cb38-1211"><a href="#cb38-1211"></a>    <span class="at">y =</span> <span class="st">"percentage of LSOAs"</span></span>
<span id="cb38-1212"><a href="#cb38-1212"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1213"><a href="#cb38-1213"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb38-1214"><a href="#cb38-1214"></a>  <span class="fu">theme</span>(</span>
<span id="cb38-1215"><a href="#cb38-1215"></a>    <span class="co"># Remove unnecessary vertical grid lines</span></span>
<span id="cb38-1216"><a href="#cb38-1216"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-1217"><a href="#cb38-1217"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb38-1218"><a href="#cb38-1218"></a>  )</span>
<span id="cb38-1219"><a href="#cb38-1219"></a><span class="in">```</span></span>
<span id="cb38-1220"><a href="#cb38-1220"></a></span>
<span id="cb38-1221"><a href="#cb38-1221"></a></span>
<span id="cb38-1222"><a href="#cb38-1222"></a>We can use density curves to show the distribution of a variable across multiple categories at once. For example, we could show the distribution of burglary counts at the neighbourhood level for all the districts in Northamptonshire. To do this we use the <span class="in">`geom_density_ridges()`</span> function from the ggridges package to create a *ridge plot*. Although this function does not come from the ggplot2 package, it is designed to be used inside a <span class="in">`ggplot()`</span> stack.</span>
<span id="cb38-1223"><a href="#cb38-1223"></a></span>
<span id="cb38-1224"><a href="#cb38-1224"></a></span>
<span id="cb38-1227"><a href="#cb38-1227"></a><span class="in">```{r}</span></span>
<span id="cb38-1228"><a href="#cb38-1228"></a><span class="co">#| filename: "chapter15b.R"</span></span>
<span id="cb38-1229"><a href="#cb38-1229"></a></span>
<span id="cb38-1230"><a href="#cb38-1230"></a><span class="co"># Add ridge plot of Northamptonshire burglary</span></span>
<span id="cb38-1231"><a href="#cb38-1231"></a>burglary <span class="sc">|&gt;</span> </span>
<span id="cb38-1232"><a href="#cb38-1232"></a>  <span class="co"># Wrap the district names by replacing any space in a name with a new-line</span></span>
<span id="cb38-1233"><a href="#cb38-1233"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> <span class="fu">str_replace_all</span>(district, <span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb38-1234"><a href="#cb38-1234"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-1235"><a href="#cb38-1235"></a>  <span class="co"># Specify which columns in the data contain the values we're interested in</span></span>
<span id="cb38-1236"><a href="#cb38-1236"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> district) <span class="sc">+</span></span>
<span id="cb38-1237"><a href="#cb38-1237"></a>  <span class="co"># Add ridge plot</span></span>
<span id="cb38-1238"><a href="#cb38-1238"></a>  ggridges<span class="sc">::</span><span class="fu">geom_density_ridges</span>() <span class="sc">+</span></span>
<span id="cb38-1239"><a href="#cb38-1239"></a>  <span class="co"># Remove unnecessary space at either end of x axis</span></span>
<span id="cb38-1240"><a href="#cb38-1240"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb38-1241"><a href="#cb38-1241"></a>  <span class="co"># Add labels</span></span>
<span id="cb38-1242"><a href="#cb38-1242"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-1243"><a href="#cb38-1243"></a>    <span class="at">title =</span> <span class="st">"Number of burglaries in Kettering neighbourhoods"</span>,</span>
<span id="cb38-1244"><a href="#cb38-1244"></a>    <span class="at">x =</span> <span class="st">"count of burglaries, 2020"</span>,</span>
<span id="cb38-1245"><a href="#cb38-1245"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb38-1246"><a href="#cb38-1246"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1247"><a href="#cb38-1247"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb38-1248"><a href="#cb38-1248"></a><span class="in">```</span></span>
<span id="cb38-1249"><a href="#cb38-1249"></a></span>
<span id="cb38-1250"><a href="#cb38-1250"></a></span>
<span id="cb38-1251"><a href="#cb38-1251"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb38-1252"><a href="#cb38-1252"></a><span class="fu">#### What does the message `Picking joint bandwidth of 1.98` mean?</span></span>
<span id="cb38-1253"><a href="#cb38-1253"></a></span>
<span id="cb38-1254"><a href="#cb38-1254"></a>As you know from previous chapters, density estimation depends on us choosing a _bandwidth_ to control the degree of smoothing between data points. By default, <span class="in">`geom_density_ridges()`</span> chooses a suitable bandwidth automatically and reports this in a message. The bandwidth is referred to as 'joint' because the same bandwidth is used for all the density curves on a chart.</span>
<span id="cb38-1255"><a href="#cb38-1255"></a></span>
<span id="cb38-1256"><a href="#cb38-1256"></a>If you wanted to include a ridge plot in a Quarto document, you would probably not want this message to appear in your report. To suppress the message, you can use the Quarto chunk option <span class="in">`#| message: false`</span>.</span>
<span id="cb38-1257"><a href="#cb38-1257"></a>:::</span>
<span id="cb38-1258"><a href="#cb38-1258"></a></span>
<span id="cb38-1259"><a href="#cb38-1259"></a></span>
<span id="cb38-1260"><a href="#cb38-1260"></a>The ridge plot shows the distribution of burglary counts in LSOAs within each district, with the distributions overlapping slightly to save space. From this we can see that across all districts most LSOAs have few burglaries, with a small number of LSOAs having more. We can also see there are a small number of LSOAs (probably, in fact, just one LSOA) in Wellingborough district with a much higher number of burglaries than anywhere else in Northamptonshire.</span>
<span id="cb38-1261"><a href="#cb38-1261"></a></span>
<span id="cb38-1262"><a href="#cb38-1262"></a></span>
<span id="cb38-1265"><a href="#cb38-1265"></a><span class="in">```{r}</span></span>
<span id="cb38-1266"><a href="#cb38-1266"></a><span class="co">#| include: false</span></span>
<span id="cb38-1267"><a href="#cb38-1267"></a></span>
<span id="cb38-1268"><a href="#cb38-1268"></a>burglary_district_counts <span class="ot">&lt;-</span> <span class="fu">count</span>(burglary, district, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-1269"><a href="#cb38-1269"></a><span class="in">```</span></span>
<span id="cb38-1270"><a href="#cb38-1270"></a></span>
<span id="cb38-1271"><a href="#cb38-1271"></a></span>
<span id="cb38-1272"><a href="#cb38-1272"></a><span class="fu">### Small-multiple charts</span></span>
<span id="cb38-1273"><a href="#cb38-1273"></a></span>
<span id="cb38-1274"><a href="#cb38-1274"></a>Density plots can be helpful to summarise a lot of information, but they have some disadvantages. In particular, they don't show that the number of LSOAs in each district is quite different: there are <span class="in">`r pluck(burglary_district_counts, "n", 1)`</span> LSOAs in <span class="in">`r pluck(burglary_district_counts, "district", 1)`</span> but only <span class="in">`r pluck(burglary_district_counts, "n", nrow(burglary_district_counts))`</span> LSOAs in <span class="in">`r pluck(burglary_district_counts, "district", nrow(burglary_district_counts))`</span>. To make this clearer we can instead produce several dot plots, one for each district -- what are called *small-multiple* charts.</span>
<span id="cb38-1275"><a href="#cb38-1275"></a></span>
<span id="cb38-1276"><a href="#cb38-1276"></a>We could create small-multiple charts by producing a separate histogram for each district and then combine them with the patchwork package, but that would involve a lot of repeated code. Fortunately, we can use a feature of the ggplot2 package called *faceting* to split our single histogram into multiple plots based on a column in the data (in this case, the district name).</span>
<span id="cb38-1277"><a href="#cb38-1277"></a></span>
<span id="cb38-1278"><a href="#cb38-1278"></a>Adding <span class="in">`facet_wrap()`</span> to a <span class="in">`ggplot()`</span> stack will cause R to create multiple plots and wrap them across multiple rows and columns so that they approximately fit into the available space. If we only want the small multiples to appear on top of each other (i.e. in multiple rows) or next to each other (i.e. in multiple columns), we can use the <span class="in">`facet_grid()`</span> function. In this case we want the small multiples to appear on top of each other, so we will use <span class="in">`facet_grid()`</span> and say that the small multiples (which ggplot2 calls *facets*) should be based on the <span class="in">`district`</span> column in the data by specifying <span class="in">`rows = vars(district)`</span> (it is necessary to wrap the name of the column that you want to use as the basis of the small multiples in the <span class="in">`vars()`</span> helper function, but we do not need to go into why).</span>
<span id="cb38-1279"><a href="#cb38-1279"></a></span>
<span id="cb38-1280"><a href="#cb38-1280"></a></span>
<span id="cb38-1283"><a href="#cb38-1283"></a><span class="in">```{r}</span></span>
<span id="cb38-1284"><a href="#cb38-1284"></a><span class="co">#| filename: "chapter15b.R"</span></span>
<span id="cb38-1285"><a href="#cb38-1285"></a><span class="co">#| fig-asp: 1</span></span>
<span id="cb38-1286"><a href="#cb38-1286"></a></span>
<span id="cb38-1287"><a href="#cb38-1287"></a><span class="co"># Create histogram of burglary counts</span></span>
<span id="cb38-1288"><a href="#cb38-1288"></a>burglary <span class="sc">|&gt;</span> </span>
<span id="cb38-1289"><a href="#cb38-1289"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-1290"><a href="#cb38-1290"></a>  <span class="co"># Specify which column in the data contains the value we're interested in</span></span>
<span id="cb38-1291"><a href="#cb38-1291"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count) <span class="sc">+</span></span>
<span id="cb38-1292"><a href="#cb38-1292"></a>  <span class="co"># Add a histogram to the chart</span></span>
<span id="cb38-1293"><a href="#cb38-1293"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb38-1294"><a href="#cb38-1294"></a>  <span class="co"># Split chart into small multiples, one for each district</span></span>
<span id="cb38-1295"><a href="#cb38-1295"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(district), <span class="at">labeller =</span> <span class="fu">label_wrap_gen</span>(<span class="at">width =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb38-1296"><a href="#cb38-1296"></a>  <span class="co"># Remove unnecessary space at either end of both axes</span></span>
<span id="cb38-1297"><a href="#cb38-1297"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb38-1298"><a href="#cb38-1298"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb38-1299"><a href="#cb38-1299"></a>  <span class="co"># Add labels</span></span>
<span id="cb38-1300"><a href="#cb38-1300"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-1301"><a href="#cb38-1301"></a>    <span class="at">title =</span> <span class="st">"Number of burglaries in Northamptonshire neighbourhoods"</span>,</span>
<span id="cb38-1302"><a href="#cb38-1302"></a>    <span class="at">x =</span> <span class="st">"count of burglaries, 2020"</span>,</span>
<span id="cb38-1303"><a href="#cb38-1303"></a>    <span class="at">y =</span> <span class="st">"number of LSOAs"</span></span>
<span id="cb38-1304"><a href="#cb38-1304"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1305"><a href="#cb38-1305"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb38-1306"><a href="#cb38-1306"></a>  <span class="fu">theme</span>(</span>
<span id="cb38-1307"><a href="#cb38-1307"></a>    <span class="co"># Remove unnecessary vertical grid lines</span></span>
<span id="cb38-1308"><a href="#cb38-1308"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-1309"><a href="#cb38-1309"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-1310"><a href="#cb38-1310"></a>    <span class="co"># Control alignment of facet titles</span></span>
<span id="cb38-1311"><a href="#cb38-1311"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb38-1312"><a href="#cb38-1312"></a>  )</span>
<span id="cb38-1313"><a href="#cb38-1313"></a><span class="in">```</span></span>
<span id="cb38-1314"><a href="#cb38-1314"></a></span>
<span id="cb38-1315"><a href="#cb38-1315"></a></span>
<span id="cb38-1316"><a href="#cb38-1316"></a>You might have noticed we made some other changes to our code for this chart to </span>
<span id="cb38-1317"><a href="#cb38-1317"></a>make it clearer:</span>
<span id="cb38-1318"><a href="#cb38-1318"></a></span>
<span id="cb38-1319"><a href="#cb38-1319"></a><span class="ss">  * </span>Wrapped the facet labels using the <span class="in">`label_wrap_gen()`</span> helper function so that some of the longer district names don't take up too much space horizontally.</span>
<span id="cb38-1320"><a href="#cb38-1320"></a><span class="ss">  * </span>Made the facet labels easier to read by making the text horizontal (rather than the default vertical text) using the <span class="in">`strip.text.y`</span> attribute to <span class="in">`theme()`</span> and the <span class="in">`element_text()`</span> helper function. <span class="in">`angle`</span> sets the rotation of the text (or in this case, specifies that there should be no rotation) and <span class="in">`hjust = 0`</span> specifies that the text should be left aligned.</span>
<span id="cb38-1321"><a href="#cb38-1321"></a></span>
<span id="cb38-1322"><a href="#cb38-1322"></a>There are many more-technical ways to show distributions, such as box plots or violin plots. However, these can be difficult to interpret for people who are not used to looking at those particular types of chart, so they should probably be avoided for communicating with general audiences.</span>
<span id="cb38-1323"><a href="#cb38-1323"></a></span>
<span id="cb38-1324"><a href="#cb38-1324"></a></span>
<span id="cb38-1325"><a href="#cb38-1325"></a></span>
<span id="cb38-1326"><a href="#cb38-1326"></a><span class="fu">## Comparing continuous variables</span></span>
<span id="cb38-1327"><a href="#cb38-1327"></a></span>
<span id="cb38-1328"><a href="#cb38-1328"></a>So far we have used bar charts to communicate a single number (in our example, a number of murders) for each value of a categorical variable (the name of each Malaysian state or territory), and histograms to show multiple numbers (burglary counts for each neighbourhood) for each value of a categorical variable (districts in Northamptonshire). </span>
<span id="cb38-1329"><a href="#cb38-1329"></a></span>
<span id="cb38-1330"><a href="#cb38-1330"></a>Both these types of chart compare a numeric variable to a categorical one. But sometimes we may want to compare two categorical variables. We can do this with a *scatter plot*.</span>
<span id="cb38-1331"><a href="#cb38-1331"></a></span>
<span id="cb38-1332"><a href="#cb38-1332"></a>Restart R (<span class="in">`Session &gt; Restart R`</span>), open a new R script file and save it as <span class="in">`chapter15c.R`</span>. Use this code to load rates of thefts of and from motor vehicles per 1,000 households saying they own a vehicle for a selection of municipalities in South Africa.</span>
<span id="cb38-1333"><a href="#cb38-1333"></a></span>
<span id="cb38-1334"><a href="#cb38-1334"></a></span>
<span id="cb38-1337"><a href="#cb38-1337"></a><span class="in">```{r}</span></span>
<span id="cb38-1338"><a href="#cb38-1338"></a><span class="co">#| filename: "chapter15c.R"</span></span>
<span id="cb38-1339"><a href="#cb38-1339"></a></span>
<span id="cb38-1340"><a href="#cb38-1340"></a><span class="co"># Load packages</span></span>
<span id="cb38-1341"><a href="#cb38-1341"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggrepel, tidyverse)</span>
<span id="cb38-1342"><a href="#cb38-1342"></a></span>
<span id="cb38-1343"><a href="#cb38-1343"></a><span class="co"># Load South African vehicle theft rates</span></span>
<span id="cb38-1344"><a href="#cb38-1344"></a>vehicle_theft <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/south_africa_vehicle_theft.rds"</span>)</span>
<span id="cb38-1345"><a href="#cb38-1345"></a><span class="in">```</span></span>
<span id="cb38-1346"><a href="#cb38-1346"></a></span>
<span id="cb38-1347"><a href="#cb38-1347"></a></span>
<span id="cb38-1348"><a href="#cb38-1348"></a>Since thefts *of* vehicle and thefts *from* vehicles are different but related crimes, we might want to see if there is a relationship between counts of each type.</span>
<span id="cb38-1349"><a href="#cb38-1349"></a></span>
<span id="cb38-1350"><a href="#cb38-1350"></a>To create a <span class="in">`ggplot()`</span> scatter plot we use <span class="in">`geom_point()`</span>, the same function we previously used to create point maps. This makes sense, since point maps are a specialised type of scatter plot in which the *x* and *y* axes of the chart show the latitude and longitude or easting and northing of each crime location.</span>
<span id="cb38-1351"><a href="#cb38-1351"></a></span>
<span id="cb38-1352"><a href="#cb38-1352"></a>The data in the <span class="in">`vehicle_theft`</span> object are in long format, with each row representing a count of crime in a particular category for a particular municipality. To make a scatter plot where each point represents a municipality, we need to have all the data for a municipality in a single row of data, so we will need to transform the data with <span class="in">`pivot_wider()`</span> (as we did for some of the tables at the start of this chapter). Since this converts the values of the <span class="in">`crime_category`</span> column into column names. These names are quite long, so we first convert them to snake case using <span class="in">`janitor::clean_names()`</span> and then use <span class="in">`rename()`</span> to shorten the names so they are easier to work with.</span>
<span id="cb38-1353"><a href="#cb38-1353"></a></span>
<span id="cb38-1354"><a href="#cb38-1354"></a>Add this code to the R script file.</span>
<span id="cb38-1355"><a href="#cb38-1355"></a></span>
<span id="cb38-1356"><a href="#cb38-1356"></a></span>
<span id="cb38-1359"><a href="#cb38-1359"></a><span class="in">```{r}</span></span>
<span id="cb38-1360"><a href="#cb38-1360"></a><span class="co">#| filename: "chapter15c.R"</span></span>
<span id="cb38-1361"><a href="#cb38-1361"></a></span>
<span id="cb38-1362"><a href="#cb38-1362"></a><span class="co"># Convert vehicle theft data to wide format</span></span>
<span id="cb38-1363"><a href="#cb38-1363"></a>vehicle_theft_wider <span class="ot">&lt;-</span> vehicle_theft <span class="sc">|&gt;</span> </span>
<span id="cb38-1364"><a href="#cb38-1364"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_category, <span class="at">values_from =</span> theft_rate) <span class="sc">|&gt;</span> </span>
<span id="cb38-1365"><a href="#cb38-1365"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb38-1366"><a href="#cb38-1366"></a>  <span class="fu">rename</span>(</span>
<span id="cb38-1367"><a href="#cb38-1367"></a>    <span class="at">theft_of =</span> theft_of_motor_vehicle,</span>
<span id="cb38-1368"><a href="#cb38-1368"></a>    <span class="at">theft_from =</span> theft_out_of_or_from_motor_vehicle</span>
<span id="cb38-1369"><a href="#cb38-1369"></a>  )</span>
<span id="cb38-1370"><a href="#cb38-1370"></a><span class="in">```</span></span>
<span id="cb38-1371"><a href="#cb38-1371"></a></span>
<span id="cb38-1372"><a href="#cb38-1372"></a></span>
<span id="cb38-1373"><a href="#cb38-1373"></a>We can now make a basic scatter plot.</span>
<span id="cb38-1374"><a href="#cb38-1374"></a></span>
<span id="cb38-1375"><a href="#cb38-1375"></a></span>
<span id="cb38-1378"><a href="#cb38-1378"></a><span class="in">```{r}</span></span>
<span id="cb38-1379"><a href="#cb38-1379"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-1380"><a href="#cb38-1380"></a><span class="co">#| fig-asp: 1</span></span>
<span id="cb38-1381"><a href="#cb38-1381"></a></span>
<span id="cb38-1382"><a href="#cb38-1382"></a><span class="co"># Create scatter plot of vehicle theft</span></span>
<span id="cb38-1383"><a href="#cb38-1383"></a><span class="fu">ggplot</span>(vehicle_theft_wider) <span class="sc">+</span></span>
<span id="cb38-1384"><a href="#cb38-1384"></a>  <span class="co"># Specify which columns in the data should control the x and y positions of</span></span>
<span id="cb38-1385"><a href="#cb38-1385"></a>  <span class="co"># each point</span></span>
<span id="cb38-1386"><a href="#cb38-1386"></a>  <span class="fu">aes</span>(<span class="at">x =</span> theft_of, <span class="at">y =</span> theft_from) <span class="sc">+</span></span>
<span id="cb38-1387"><a href="#cb38-1387"></a>  <span class="co"># Add the points</span></span>
<span id="cb38-1388"><a href="#cb38-1388"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb38-1389"><a href="#cb38-1389"></a>  <span class="co"># Specify the format for the axis labels</span></span>
<span id="cb38-1390"><a href="#cb38-1390"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb38-1391"><a href="#cb38-1391"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb38-1392"><a href="#cb38-1392"></a>  <span class="co"># Add labels</span></span>
<span id="cb38-1393"><a href="#cb38-1393"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-1394"><a href="#cb38-1394"></a>    <span class="at">title =</span> <span class="st">"Vehicle thefts in South African municipalities"</span>,</span>
<span id="cb38-1395"><a href="#cb38-1395"></a>    <span class="at">subtitle =</span> <span class="st">"each dot represents one municipality, 2018-19"</span>,</span>
<span id="cb38-1396"><a href="#cb38-1396"></a>    <span class="at">x =</span> <span class="st">"rate of thefts of motor vehicles per 1,000 vehicle-owning households"</span>,</span>
<span id="cb38-1397"><a href="#cb38-1397"></a>    <span class="at">y =</span> <span class="st">"rate of thefts from motor vehicles per 1,000 vehicle-owning households"</span></span>
<span id="cb38-1398"><a href="#cb38-1398"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1399"><a href="#cb38-1399"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb38-1400"><a href="#cb38-1400"></a><span class="in">```</span></span>
<span id="cb38-1401"><a href="#cb38-1401"></a></span>
<span id="cb38-1402"><a href="#cb38-1402"></a></span>
<span id="cb38-1403"><a href="#cb38-1403"></a>From this plot we can see that most areas have low rates of both theft of and theft from motor vehicles, with a few areas having very-high rates of one type or the other (but none have high rates of both).</span>
<span id="cb38-1404"><a href="#cb38-1404"></a></span>
<span id="cb38-1405"><a href="#cb38-1405"></a>Looking at the bottom-left corner of the chart we can see that we have again encountered the problem of overlapping points making patterns less clear. We can try to deal with this by making the points semi-transparent using the <span class="in">`alpha`</span> argument to <span class="in">`geom_point()`</span>.</span>
<span id="cb38-1406"><a href="#cb38-1406"></a></span>
<span id="cb38-1407"><a href="#cb38-1407"></a>Scatter plots can be hard for people to interpret, especially if they are not used to interpreting charts. To help readers, we can annotate the plot to show how to interpret each region of the chart. We will add two types of annotation: lines to show the median value on each axis, and labels to help interpretation.</span>
<span id="cb38-1408"><a href="#cb38-1408"></a></span>
<span id="cb38-1409"><a href="#cb38-1409"></a>We can add median lines using the <span class="in">`geom_hline()`</span> and <span class="in">`geom_vline()`</span> functions, which add horizontal and vertical lines to plots. We will add these to the <span class="in">`ggplot()`</span> stack *before* `geom_point()` so that the lines appear *behind* the points.</span>
<span id="cb38-1410"><a href="#cb38-1410"></a></span>
<span id="cb38-1411"><a href="#cb38-1411"></a>To add text annotations we use the <span class="in">`annotate()`</span> function from ggplot2, which allows us to add data to a chart by specifying the aesthetics (*x* and *y* position, etc.) directly rather than by referencing columns in the data. To add a text annotation, we set the <span class="in">`geom`</span> argument of <span class="in">`annotate()`</span> to <span class="in">`"text"`</span>.</span>
<span id="cb38-1412"><a href="#cb38-1412"></a></span>
<span id="cb38-1413"><a href="#cb38-1413"></a></span>
<span id="cb38-1416"><a href="#cb38-1416"></a><span class="in">```{r}</span></span>
<span id="cb38-1417"><a href="#cb38-1417"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-1418"><a href="#cb38-1418"></a><span class="co">#| fig-asp: 1</span></span>
<span id="cb38-1419"><a href="#cb38-1419"></a></span>
<span id="cb38-1420"><a href="#cb38-1420"></a><span class="co"># Create scatter plot of vehicle theft</span></span>
<span id="cb38-1421"><a href="#cb38-1421"></a><span class="fu">ggplot</span>(vehicle_theft_wider) <span class="sc">+</span></span>
<span id="cb38-1422"><a href="#cb38-1422"></a>  <span class="co"># Specify which columns in the data should control the x and y positions of</span></span>
<span id="cb38-1423"><a href="#cb38-1423"></a>  <span class="co"># each point</span></span>
<span id="cb38-1424"><a href="#cb38-1424"></a>  <span class="fu">aes</span>(<span class="at">x =</span> theft_of, <span class="at">y =</span> theft_from) <span class="sc">+</span></span>
<span id="cb38-1425"><a href="#cb38-1425"></a>  <span class="co"># Add vertical line showing median rate of theft of a vehicle</span></span>
<span id="cb38-1426"><a href="#cb38-1426"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb38-1427"><a href="#cb38-1427"></a>    <span class="at">xintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_of"</span>)),</span>
<span id="cb38-1428"><a href="#cb38-1428"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb38-1429"><a href="#cb38-1429"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1430"><a href="#cb38-1430"></a>  <span class="co"># Add horizontal line showing median rate of theft from a vehicle</span></span>
<span id="cb38-1431"><a href="#cb38-1431"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb38-1432"><a href="#cb38-1432"></a>    <span class="at">yintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_from"</span>)),</span>
<span id="cb38-1433"><a href="#cb38-1433"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb38-1434"><a href="#cb38-1434"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1435"><a href="#cb38-1435"></a>  <span class="co"># Add points</span></span>
<span id="cb38-1436"><a href="#cb38-1436"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb38-1437"><a href="#cb38-1437"></a>  <span class="co"># Add annotations to aid interpretation</span></span>
<span id="cb38-1438"><a href="#cb38-1438"></a>  <span class="fu">annotate</span>(</span>
<span id="cb38-1439"><a href="#cb38-1439"></a>    <span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb38-1440"><a href="#cb38-1440"></a>    <span class="at">x =</span> <span class="dv">20</span>, </span>
<span id="cb38-1441"><a href="#cb38-1441"></a>    <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb38-1442"><a href="#cb38-1442"></a>    <span class="at">label =</span> <span class="st">"high rate of thefts of vehicles</span><span class="sc">\n</span><span class="st">low rate of thefts from vehicles"</span>, </span>
<span id="cb38-1443"><a href="#cb38-1443"></a>    <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb38-1444"><a href="#cb38-1444"></a>    <span class="at">lineheight =</span> <span class="dv">1</span></span>
<span id="cb38-1445"><a href="#cb38-1445"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1446"><a href="#cb38-1446"></a>  <span class="fu">annotate</span>(</span>
<span id="cb38-1447"><a href="#cb38-1447"></a>    <span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb38-1448"><a href="#cb38-1448"></a>    <span class="at">x =</span> <span class="dv">1</span>, </span>
<span id="cb38-1449"><a href="#cb38-1449"></a>    <span class="at">y =</span> <span class="dv">75</span>, </span>
<span id="cb38-1450"><a href="#cb38-1450"></a>    <span class="at">label =</span> <span class="st">"low rate of thefts of vehicles</span><span class="sc">\n</span><span class="st">high rate of thefts from vehicles"</span>, </span>
<span id="cb38-1451"><a href="#cb38-1451"></a>    <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb38-1452"><a href="#cb38-1452"></a>    <span class="at">lineheight =</span> <span class="dv">1</span></span>
<span id="cb38-1453"><a href="#cb38-1453"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1454"><a href="#cb38-1454"></a>  <span class="co"># Specify the format for the axis labels</span></span>
<span id="cb38-1455"><a href="#cb38-1455"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb38-1456"><a href="#cb38-1456"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb38-1457"><a href="#cb38-1457"></a>  <span class="co"># Add labels</span></span>
<span id="cb38-1458"><a href="#cb38-1458"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-1459"><a href="#cb38-1459"></a>    <span class="at">title =</span> <span class="st">"Vehicle thefts in South African municipalities"</span>,</span>
<span id="cb38-1460"><a href="#cb38-1460"></a>    <span class="at">subtitle =</span> <span class="fu">str_glue</span>(</span>
<span id="cb38-1461"><a href="#cb38-1461"></a>      <span class="st">"each dot represents one municipality, 2018-19, dashed lines show "</span>,</span>
<span id="cb38-1462"><a href="#cb38-1462"></a>      <span class="st">"median values"</span></span>
<span id="cb38-1463"><a href="#cb38-1463"></a>    ),</span>
<span id="cb38-1464"><a href="#cb38-1464"></a>    <span class="at">x =</span> <span class="st">"rate of thefts of motor vehicles per 1,000 vehicle-owning households"</span>,</span>
<span id="cb38-1465"><a href="#cb38-1465"></a>    <span class="at">y =</span> <span class="st">"rate of thefts from motor vehicles per 1,000 vehicle-owning households"</span></span>
<span id="cb38-1466"><a href="#cb38-1466"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1467"><a href="#cb38-1467"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb38-1468"><a href="#cb38-1468"></a><span class="in">```</span></span>
<span id="cb38-1469"><a href="#cb38-1469"></a></span>
<span id="cb38-1470"><a href="#cb38-1470"></a></span>
<span id="cb38-1471"><a href="#cb38-1471"></a>From this plot we can now see that half of municipalities have very low rates of both types of theft (shown by the dots below and to the left of the median lines).</span>
<span id="cb38-1472"><a href="#cb38-1472"></a></span>
<span id="cb38-1473"><a href="#cb38-1473"></a>We can make some further changes to this chart. For example, instead of labelling areas on the plot we could instead label the municipalities with high rates of vehicle theft (we cannot include both types of label because they would overlap). To do that, we will create a new column in the data containing either the municipality name (for high-rate municipalities) or <span class="in">`NA`</span> (meaning <span class="in">`ggplot()`</span> will not create a label for that row if we set <span class="in">`na.rm = TRUE`</span>). We can then use <span class="in">`geom_label_repel()`</span> to add the labels to the chart, remembering to add <span class="in">`label = label`</span> to the <span class="in">`aes()`</span> function so <span class="in">`ggplot()`</span> knows which column in the data to use for the labels.</span>
<span id="cb38-1474"><a href="#cb38-1474"></a></span>
<span id="cb38-1475"><a href="#cb38-1475"></a></span>
<span id="cb38-1478"><a href="#cb38-1478"></a><span class="in">```{r}</span></span>
<span id="cb38-1479"><a href="#cb38-1479"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb38-1480"><a href="#cb38-1480"></a><span class="co">#| fig-asp: 1</span></span>
<span id="cb38-1481"><a href="#cb38-1481"></a></span>
<span id="cb38-1482"><a href="#cb38-1482"></a><span class="co"># Create scatter plot of vehicle theft</span></span>
<span id="cb38-1483"><a href="#cb38-1483"></a>vehicle_theft_wider <span class="sc">|&gt;</span> </span>
<span id="cb38-1484"><a href="#cb38-1484"></a>  <span class="co"># Create a new column in the data, either containing the municipality name or</span></span>
<span id="cb38-1485"><a href="#cb38-1485"></a>  <span class="co"># `NA` depending on the values of `theft_of` and `theft_from`</span></span>
<span id="cb38-1486"><a href="#cb38-1486"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">if_else</span>(theft_of <span class="sc">&gt;</span> <span class="dv">17</span> <span class="sc">|</span> theft_from <span class="sc">&gt;</span> <span class="dv">65</span>, municipality, <span class="cn">NA</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb38-1487"><a href="#cb38-1487"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-1488"><a href="#cb38-1488"></a>  <span class="co"># Specify which columns in the data should control the x and y positions of</span></span>
<span id="cb38-1489"><a href="#cb38-1489"></a>  <span class="co"># each point and the labels (for those points that have labels)</span></span>
<span id="cb38-1490"><a href="#cb38-1490"></a>  <span class="fu">aes</span>(<span class="at">x =</span> theft_of, <span class="at">y =</span> theft_from, <span class="at">label =</span> label) <span class="sc">+</span></span>
<span id="cb38-1491"><a href="#cb38-1491"></a>  <span class="co"># Add vertical line showing median rate of theft of a vehicle</span></span>
<span id="cb38-1492"><a href="#cb38-1492"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb38-1493"><a href="#cb38-1493"></a>    <span class="at">xintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_of"</span>)),</span>
<span id="cb38-1494"><a href="#cb38-1494"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb38-1495"><a href="#cb38-1495"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1496"><a href="#cb38-1496"></a>  <span class="co"># Add horizontal line showing median rate of theft from a vehicle</span></span>
<span id="cb38-1497"><a href="#cb38-1497"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb38-1498"><a href="#cb38-1498"></a>    <span class="at">yintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_from"</span>)),</span>
<span id="cb38-1499"><a href="#cb38-1499"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb38-1500"><a href="#cb38-1500"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1501"><a href="#cb38-1501"></a>  <span class="co"># Add points</span></span>
<span id="cb38-1502"><a href="#cb38-1502"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb38-1503"><a href="#cb38-1503"></a>  <span class="co"># Add labels</span></span>
<span id="cb38-1504"><a href="#cb38-1504"></a>  <span class="fu">geom_label_repel</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">label.size =</span> <span class="dv">0</span>, <span class="at">lineheight =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb38-1505"><a href="#cb38-1505"></a>  <span class="co"># Specify the format for the axis labels</span></span>
<span id="cb38-1506"><a href="#cb38-1506"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb38-1507"><a href="#cb38-1507"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb38-1508"><a href="#cb38-1508"></a>  <span class="co"># Add labels</span></span>
<span id="cb38-1509"><a href="#cb38-1509"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-1510"><a href="#cb38-1510"></a>    <span class="at">title =</span> <span class="st">"Vehicle thefts in South African municipalities"</span>,</span>
<span id="cb38-1511"><a href="#cb38-1511"></a>    <span class="at">subtitle =</span> <span class="fu">str_glue</span>(</span>
<span id="cb38-1512"><a href="#cb38-1512"></a>      <span class="st">"each dot represents one municipality, 2018-19, dashed lines show "</span>,</span>
<span id="cb38-1513"><a href="#cb38-1513"></a>      <span class="st">"median values"</span></span>
<span id="cb38-1514"><a href="#cb38-1514"></a>    ),</span>
<span id="cb38-1515"><a href="#cb38-1515"></a>    <span class="at">x =</span> <span class="st">"rate of thefts of motor vehicles per 1,000 vehicle-owning households"</span>,</span>
<span id="cb38-1516"><a href="#cb38-1516"></a>    <span class="at">y =</span> <span class="st">"rate of thefts from motor vehicles per 1,000 vehicle-owning households"</span></span>
<span id="cb38-1517"><a href="#cb38-1517"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1518"><a href="#cb38-1518"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb38-1519"><a href="#cb38-1519"></a><span class="in">```</span></span>
<span id="cb38-1520"><a href="#cb38-1520"></a></span>
<span id="cb38-1521"><a href="#cb38-1521"></a></span>
<span id="cb38-1522"><a href="#cb38-1522"></a>Finally, we can add a trend line to the plot. We do this using the <span class="in">`geom_smooth()`</span> function from ggplot2. <span class="in">`geom_smooth()`</span> can add different types of trend line to a plot, but in this example we will specify a simple linear trend line by setting <span class="in">`method = "lm"`</span>. We will also specify <span class="in">`formula = y ~ x`</span> (the default) to avoid <span class="in">`geom_smooth()`</span> producing a message to tell us what formula it used to calculate the trend.</span>
<span id="cb38-1523"><a href="#cb38-1523"></a></span>
<span id="cb38-1524"><a href="#cb38-1524"></a>Add this code to the R script file and run it.</span>
<span id="cb38-1525"><a href="#cb38-1525"></a></span>
<span id="cb38-1526"><a href="#cb38-1526"></a></span>
<span id="cb38-1529"><a href="#cb38-1529"></a><span class="in">```{r}</span></span>
<span id="cb38-1530"><a href="#cb38-1530"></a><span class="co">#| filename: "chapter15c.R"</span></span>
<span id="cb38-1531"><a href="#cb38-1531"></a><span class="co">#| fig-asp: 1</span></span>
<span id="cb38-1532"><a href="#cb38-1532"></a></span>
<span id="cb38-1533"><a href="#cb38-1533"></a><span class="co"># Create scatter plot of vehicle theft</span></span>
<span id="cb38-1534"><a href="#cb38-1534"></a>vehicle_theft_wider <span class="sc">|&gt;</span> </span>
<span id="cb38-1535"><a href="#cb38-1535"></a>  <span class="co"># Create a new column in the data, either containing the municipality name or</span></span>
<span id="cb38-1536"><a href="#cb38-1536"></a>  <span class="co"># `NA` depending on the values of `theft_of` and `theft_from`</span></span>
<span id="cb38-1537"><a href="#cb38-1537"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">if_else</span>(theft_of <span class="sc">&gt;</span> <span class="dv">17</span> <span class="sc">|</span> theft_from <span class="sc">&gt;</span> <span class="dv">65</span>, municipality, <span class="cn">NA</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb38-1538"><a href="#cb38-1538"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-1539"><a href="#cb38-1539"></a>  <span class="co"># Specify which columns in the data should control the x and y positions of</span></span>
<span id="cb38-1540"><a href="#cb38-1540"></a>  <span class="co"># each point and the labels (for those points that have labels)</span></span>
<span id="cb38-1541"><a href="#cb38-1541"></a>  <span class="fu">aes</span>(<span class="at">x =</span> theft_of, <span class="at">y =</span> theft_from, <span class="at">label =</span> label) <span class="sc">+</span></span>
<span id="cb38-1542"><a href="#cb38-1542"></a>  <span class="co"># Add vertical line showing median rate of theft of a vehicle</span></span>
<span id="cb38-1543"><a href="#cb38-1543"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb38-1544"><a href="#cb38-1544"></a>    <span class="at">xintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_of"</span>)),</span>
<span id="cb38-1545"><a href="#cb38-1545"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb38-1546"><a href="#cb38-1546"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1547"><a href="#cb38-1547"></a>  <span class="co"># Add horizontal line showing median rate of theft from a vehicle</span></span>
<span id="cb38-1548"><a href="#cb38-1548"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb38-1549"><a href="#cb38-1549"></a>    <span class="at">yintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_from"</span>)),</span>
<span id="cb38-1550"><a href="#cb38-1550"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb38-1551"><a href="#cb38-1551"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1552"><a href="#cb38-1552"></a>  <span class="co"># Add trend line</span></span>
<span id="cb38-1553"><a href="#cb38-1553"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">colour =</span> <span class="st">"grey20"</span>) <span class="sc">+</span></span>
<span id="cb38-1554"><a href="#cb38-1554"></a>  <span class="co"># Add points</span></span>
<span id="cb38-1555"><a href="#cb38-1555"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb38-1556"><a href="#cb38-1556"></a>  <span class="co"># Add labels</span></span>
<span id="cb38-1557"><a href="#cb38-1557"></a>  <span class="fu">geom_label_repel</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">label.size =</span> <span class="dv">0</span>, <span class="at">lineheight =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb38-1558"><a href="#cb38-1558"></a>  <span class="co"># Specify the format for the axis labels</span></span>
<span id="cb38-1559"><a href="#cb38-1559"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb38-1560"><a href="#cb38-1560"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb38-1561"><a href="#cb38-1561"></a>  <span class="co"># Add labels</span></span>
<span id="cb38-1562"><a href="#cb38-1562"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-1563"><a href="#cb38-1563"></a>    <span class="at">title =</span> <span class="st">"Vehicle thefts in South African municipalities"</span>,</span>
<span id="cb38-1564"><a href="#cb38-1564"></a>    <span class="at">subtitle =</span> <span class="fu">str_glue</span>(</span>
<span id="cb38-1565"><a href="#cb38-1565"></a>      <span class="st">"each dot represents one municipality, 2018-19, dashed lines show "</span>,</span>
<span id="cb38-1566"><a href="#cb38-1566"></a>      <span class="st">"median values"</span></span>
<span id="cb38-1567"><a href="#cb38-1567"></a>    ),</span>
<span id="cb38-1568"><a href="#cb38-1568"></a>    <span class="at">x =</span> <span class="st">"rate of thefts of motor vehicles per 1,000 vehicle-owning households"</span>,</span>
<span id="cb38-1569"><a href="#cb38-1569"></a>    <span class="at">y =</span> <span class="st">"rate of thefts from motor vehicles per 1,000 vehicle-owning households"</span></span>
<span id="cb38-1570"><a href="#cb38-1570"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1571"><a href="#cb38-1571"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb38-1572"><a href="#cb38-1572"></a><span class="in">```</span></span>
<span id="cb38-1573"><a href="#cb38-1573"></a></span>
<span id="cb38-1574"><a href="#cb38-1574"></a></span>
<span id="cb38-1575"><a href="#cb38-1575"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb38-1576"><a href="#cb38-1576"></a><span class="fu">#### Why does this code produce a warning `The following aesthetics were dropped ...`?</span></span>
<span id="cb38-1577"><a href="#cb38-1577"></a></span>
<span id="cb38-1578"><a href="#cb38-1578"></a>The code that produces the chart above also produces a warning saying some aesthetics were dropped during a statistical transformation. This is because <span class="in">`geom_smooth()`</span> does not know how to use the <span class="in">`label`</span> aesthetic. There are two options to prevent this warning appearing in a Quarto document. First, you could set the <span class="in">`#| warning: false`</span> chunk option, although this will suppress any other warnings produced by this code chunk, so you should only add this chunk option once you are sure the code runs without any problems.</span>
<span id="cb38-1579"><a href="#cb38-1579"></a></span>
<span id="cb38-1580"><a href="#cb38-1580"></a>The second option is to remove <span class="in">`label = label`</span> from the call to <span class="in">`aes()`</span> on line 9 of the code and add <span class="in">`aes(label = label)`</span> separately on line 21.</span>
<span id="cb38-1581"><a href="#cb38-1581"></a>:::</span>
<span id="cb38-1582"><a href="#cb38-1582"></a></span>
<span id="cb38-1583"><a href="#cb38-1583"></a></span>
<span id="cb38-1584"><a href="#cb38-1584"></a>From this chart, we can see which municipalities have particularly unusual vehicle-theft rates. For example, we might well want to explore the rates of theft from vehicles in Beaufort West or Stellenbosch municipalities to see what makes them so different from the others, and similarly for the rate of theft of vehicles in Ethekwini.</span>
<span id="cb38-1585"><a href="#cb38-1585"></a></span>
<span id="cb38-1586"><a href="#cb38-1586"></a>One note of caution when using <span class="in">`geom_smooth()`</span>: this function will show the _direction_ of the relationship between two variables regardless of the _strength_ of that relationship. In extreme cases, that could mean that a chart would show a trend line between two variables even if the variables had almost no relationship to one another.</span>
<span id="cb38-1587"><a href="#cb38-1587"></a></span>
<span id="cb38-1588"><a href="#cb38-1588"></a>For example, <span class="in">`geom_smooth()`</span> produces a line showing the direction of the relationship between the two variables in each of these three charts, even though the relationship on the right is much stronger than the one on the left.</span>
<span id="cb38-1589"><a href="#cb38-1589"></a></span>
<span id="cb38-1590"><a href="#cb38-1590"></a></span>
<span id="cb38-1591"><a href="#cb38-1591"></a><span class="in">```{r geom-smooth-relationships}</span></span>
<span id="cb38-1592"><a href="#cb38-1592"></a><span class="in">#| echo: false</span></span>
<span id="cb38-1593"><a href="#cb38-1593"></a><span class="in">#| fig-asp: 0.33</span></span>
<span id="cb38-1594"><a href="#cb38-1594"></a><span class="in">#| out-width: "100%"</span></span>
<span id="cb38-1595"><a href="#cb38-1595"></a></span>
<span id="cb38-1596"><a href="#cb38-1596"></a><span class="in">tibble(</span></span>
<span id="cb38-1597"><a href="#cb38-1597"></a><span class="in">  group = factor(</span></span>
<span id="cb38-1598"><a href="#cb38-1598"></a><span class="in">    c("weak relationship", "moderate relationship", "strong relationship"), </span></span>
<span id="cb38-1599"><a href="#cb38-1599"></a><span class="in">    levels = c("weak relationship", "moderate relationship", "strong relationship")</span></span>
<span id="cb38-1600"><a href="#cb38-1600"></a><span class="in">  ),</span></span>
<span id="cb38-1601"><a href="#cb38-1601"></a><span class="in">  x = list(1:10, 1:10, 1:10)</span></span>
<span id="cb38-1602"><a href="#cb38-1602"></a><span class="in">) |&gt; </span></span>
<span id="cb38-1603"><a href="#cb38-1603"></a><span class="in">  mutate(</span></span>
<span id="cb38-1604"><a href="#cb38-1604"></a><span class="in">    sd = recode(</span></span>
<span id="cb38-1605"><a href="#cb38-1605"></a><span class="in">      group, </span></span>
<span id="cb38-1606"><a href="#cb38-1606"></a><span class="in">      "weak relationship" = 10, </span></span>
<span id="cb38-1607"><a href="#cb38-1607"></a><span class="in">      "moderate relationship" = 4, </span></span>
<span id="cb38-1608"><a href="#cb38-1608"></a><span class="in">      "strong relationship" = 0.5</span></span>
<span id="cb38-1609"><a href="#cb38-1609"></a><span class="in">    )</span></span>
<span id="cb38-1610"><a href="#cb38-1610"></a><span class="in">  ) |&gt; </span></span>
<span id="cb38-1611"><a href="#cb38-1611"></a><span class="in">  mutate(y = list(rnorm(10, sd = sd)), .by = sd) |&gt; </span></span>
<span id="cb38-1612"><a href="#cb38-1612"></a><span class="in">  unnest(c(x, y)) |&gt; </span></span>
<span id="cb38-1613"><a href="#cb38-1613"></a><span class="in">  mutate(y = scales::rescale(x + y, to = c(0, 10))) |&gt; </span></span>
<span id="cb38-1614"><a href="#cb38-1614"></a><span class="in">  ungroup() |&gt; </span></span>
<span id="cb38-1615"><a href="#cb38-1615"></a><span class="in">  ggplot() + </span></span>
<span id="cb38-1616"><a href="#cb38-1616"></a><span class="in">  aes(x = x, y = y, colour = group) +</span></span>
<span id="cb38-1617"><a href="#cb38-1617"></a><span class="in">  geom_smooth(method = "lm", formula = "y ~ x", se = FALSE, na.rm = TRUE) +</span></span>
<span id="cb38-1618"><a href="#cb38-1618"></a><span class="in">  geom_point() +</span></span>
<span id="cb38-1619"><a href="#cb38-1619"></a><span class="in">  scale_x_continuous(limits = c(0, 10)) +</span></span>
<span id="cb38-1620"><a href="#cb38-1620"></a><span class="in">  scale_y_continuous(limits = c(0, 10)) +</span></span>
<span id="cb38-1621"><a href="#cb38-1621"></a><span class="in">  labs(x = NULL, y = NULL) +</span></span>
<span id="cb38-1622"><a href="#cb38-1622"></a><span class="in">  coord_fixed() +</span></span>
<span id="cb38-1623"><a href="#cb38-1623"></a><span class="in">  facet_grid(cols = vars(group)) +</span></span>
<span id="cb38-1624"><a href="#cb38-1624"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb38-1625"><a href="#cb38-1625"></a><span class="in">  theme(</span></span>
<span id="cb38-1626"><a href="#cb38-1626"></a><span class="in">    axis.text = element_blank(),</span></span>
<span id="cb38-1627"><a href="#cb38-1627"></a><span class="in">    axis.ticks = element_blank(),</span></span>
<span id="cb38-1628"><a href="#cb38-1628"></a><span class="in">    legend.position = "none"</span></span>
<span id="cb38-1629"><a href="#cb38-1629"></a><span class="in">  )</span></span>
<span id="cb38-1630"><a href="#cb38-1630"></a><span class="in">```</span></span>
<span id="cb38-1631"><a href="#cb38-1631"></a></span>
<span id="cb38-1632"><a href="#cb38-1632"></a></span>
<span id="cb38-1633"><a href="#cb38-1633"></a>::: {.callout-important}</span>
<span id="cb38-1634"><a href="#cb38-1634"></a><span class="fu">#### Don't try to interpret the strength of a relationship from a trend line</span></span>
<span id="cb38-1635"><a href="#cb38-1635"></a></span>
<span id="cb38-1636"><a href="#cb38-1636"></a>Be very careful about trying to interpret the strength of relationships between two variables by plotting them on a chart. It is much better to measure the strength of the relationship using a statistical test such as a correlation test, but statistical tests are outside the scope of this course.</span>
<span id="cb38-1637"><a href="#cb38-1637"></a>:::</span>
<span id="cb38-1638"><a href="#cb38-1638"></a></span>
<span id="cb38-1639"><a href="#cb38-1639"></a></span>
<span id="cb38-1640"><a href="#cb38-1640"></a>::: {.callout-quiz .callout}</span>
<span id="cb38-1641"><a href="#cb38-1641"></a><span class="fu">#### Visualising distributions</span></span>
<span id="cb38-1642"><a href="#cb38-1642"></a></span>
<span id="cb38-1643"><a href="#cb38-1643"></a><span class="in">```{r distributions-quiz}</span></span>
<span id="cb38-1644"><a href="#cb38-1644"></a><span class="in">#| echo: false</span></span>
<span id="cb38-1645"><a href="#cb38-1645"></a></span>
<span id="cb38-1646"><a href="#cb38-1646"></a><span class="in">distributions_quiz1 &lt;- c(</span></span>
<span id="cb38-1647"><a href="#cb38-1647"></a><span class="in">  "Pie chart",</span></span>
<span id="cb38-1648"><a href="#cb38-1648"></a><span class="in">  answer = "Density plot",</span></span>
<span id="cb38-1649"><a href="#cb38-1649"></a><span class="in">  "Bar chart",</span></span>
<span id="cb38-1650"><a href="#cb38-1650"></a><span class="in">  "Scatter plot"</span></span>
<span id="cb38-1651"><a href="#cb38-1651"></a><span class="in">)</span></span>
<span id="cb38-1652"><a href="#cb38-1652"></a></span>
<span id="cb38-1653"><a href="#cb38-1653"></a><span class="in">distributions_quiz2 &lt;- c(</span></span>
<span id="cb38-1654"><a href="#cb38-1654"></a><span class="in">  answer = "Density plots do not require binning data into categories",</span></span>
<span id="cb38-1655"><a href="#cb38-1655"></a><span class="in">  "Density plots always provide exact numerical values",</span></span>
<span id="cb38-1656"><a href="#cb38-1656"></a><span class="in">  "Density plots are only used for categorical data",</span></span>
<span id="cb38-1657"><a href="#cb38-1657"></a><span class="in">  "Density plots cannot be used for crime analysis"</span></span>
<span id="cb38-1658"><a href="#cb38-1658"></a><span class="in">)</span></span>
<span id="cb38-1659"><a href="#cb38-1659"></a><span class="in">```</span></span>
<span id="cb38-1660"><a href="#cb38-1660"></a></span>
<span id="cb38-1661"><a href="#cb38-1661"></a></span>
<span id="cb38-1662"><a href="#cb38-1662"></a>**Which of these types of visualization is best used to show the distribution of a single continuous variable?**</span>
<span id="cb38-1663"><a href="#cb38-1663"></a></span>
<span id="cb38-1664"><a href="#cb38-1664"></a><span class="in">`r webexercises::longmcq(distributions_quiz1)`</span></span>
<span id="cb38-1665"><a href="#cb38-1665"></a></span>
<span id="cb38-1666"><a href="#cb38-1666"></a></span>
<span id="cb38-1667"><a href="#cb38-1667"></a>**What is an advantage of using a density plot over a histogram?**</span>
<span id="cb38-1668"><a href="#cb38-1668"></a></span>
<span id="cb38-1669"><a href="#cb38-1669"></a><span class="in">`r webexercises::longmcq(distributions_quiz2)`</span></span>
<span id="cb38-1670"><a href="#cb38-1670"></a></span>
<span id="cb38-1671"><a href="#cb38-1671"></a></span>
<span id="cb38-1672"><a href="#cb38-1672"></a>:::</span>
<span id="cb38-1673"><a href="#cb38-1673"></a></span>
<span id="cb38-1674"><a href="#cb38-1674"></a></span>
<span id="cb38-1675"><a href="#cb38-1675"></a></span>
<span id="cb38-1676"><a href="#cb38-1676"></a><span class="fu">## In summary</span></span>
<span id="cb38-1677"><a href="#cb38-1677"></a></span>
<span id="cb38-1678"><a href="#cb38-1678"></a>In this chapter we have learned how to present data about crime at places without using maps. These techniques give us more flexibility about how to best present data to communicate the main points that we want to get across.</span>
<span id="cb38-1679"><a href="#cb38-1679"></a></span>
<span id="cb38-1680"><a href="#cb38-1680"></a>Whether to use a map or a chart, and which type of map or chart to use, are design decisions for you to make. When you make these decisions, always remember that what is most important is that your audience understands your message. This makes it very important that you understand your audience.</span>
<span id="cb38-1681"><a href="#cb38-1681"></a></span>
<span id="cb38-1682"><a href="#cb38-1682"></a></span>
<span id="cb38-1683"><a href="#cb38-1683"></a>::: {.box .reading}</span>
<span id="cb38-1684"><a href="#cb38-1684"></a></span>
<span id="cb38-1685"><a href="#cb38-1685"></a>Visualising data with charts is a very large topic and there are lots of resources available to help you learn more. To get started, you might want to look at:</span>
<span id="cb38-1686"><a href="#cb38-1686"></a></span>
<span id="cb38-1687"><a href="#cb38-1687"></a><span class="ss">  * </span><span class="co">[</span><span class="ot">An Introduction to ggplot2</span><span class="co">](https://uc-r.github.io/ggplot_intro)</span> from the University of Cincinnati Business Analytics team.</span>
<span id="cb38-1688"><a href="#cb38-1688"></a><span class="ss">  * </span>The <span class="co">[</span><span class="ot">ggplot2 cheat sheet</span><span class="co">](https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf)</span> by the team that develops the ggplot2 package.</span>
<span id="cb38-1689"><a href="#cb38-1689"></a><span class="ss">  * </span>The <span class="co">[</span><span class="ot">R Graph Gallery</span><span class="co">](https://www.r-graph-gallery.com/)</span> for examples of many other types of chart that you can produce in R.</span>
<span id="cb38-1690"><a href="#cb38-1690"></a></span>
<span id="cb38-1691"><a href="#cb38-1691"></a>:::</span>
<span id="cb38-1692"><a href="#cb38-1692"></a></span>
<span id="cb38-1693"><a href="#cb38-1693"></a></span>
<span id="cb38-1694"><a href="#cb38-1694"></a>::: {.callout-quiz .callout}</span>
<span id="cb38-1695"><a href="#cb38-1695"></a><span class="fu">#### Check your knowledge: Revision questions</span></span>
<span id="cb38-1696"><a href="#cb38-1696"></a></span>
<span id="cb38-1697"><a href="#cb38-1697"></a>Answer these questions to check you have understood the main points covered in this chapter. Write between 50 and 100 words to answer each question.</span>
<span id="cb38-1698"><a href="#cb38-1698"></a></span>
<span id="cb38-1699"><a href="#cb38-1699"></a><span class="ss">1. </span>Explain at least two scenarios where using a table or a chart would be more effective than a map for presenting spatial data.</span>
<span id="cb38-1700"><a href="#cb38-1700"></a><span class="ss">2. </span>Why might you choose to use a bar chart rather than a choropleth map for displaying crime data in some circumstances?</span>
<span id="cb38-1701"><a href="#cb38-1701"></a><span class="ss">3. </span>When should you use a table instead of a bar chart to convey information about a continuous variable for each of several categories?</span>
<span id="cb38-1702"><a href="#cb38-1702"></a><span class="ss">4. </span>When is it useful to include a reference map alongside a chart, and when is it unnecessary?</span>
<span id="cb38-1703"><a href="#cb38-1703"></a><span class="ss">5. </span>What factors should you consider when choosing the best way to present spatial data?</span>
<span id="cb38-1704"><a href="#cb38-1704"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://creativecommons.org/licenses/by/4.0/">
<p>This book is available under a Creative Commons Attribution 4.0 International licence</p>
</a>
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mpjashby/crimemappingbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>