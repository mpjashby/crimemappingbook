<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>15&nbsp; Presenting spatial data without maps – Learn Crime Mapping with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../16_mapping_time/index.html" rel="next">
<link href="../14_writing_reports/index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- START OF INCLUDED HEADER -->

<!--
This file contains code that will be included in the header of each page of the
quarto book
-->

<script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>

<!-- END OF INCLUDED HEADER -->


<link rel="stylesheet" href="../css/styles.css">
<link rel="stylesheet" href="../include/webex.css">
<meta name="twitter:title" content="15&nbsp; Presenting spatial data without maps – Learn Crime Mapping with R">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="../images/cover_image.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../15_no_maps/index.html"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Presenting spatial data without maps</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/cover_image.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Learn Crime Mapping with R</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mpjashby/crimemappingbook/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../learn_crime_mapping_with_r.epub" title="Download ePub" class="quarto-navigation-tool px-1" aria-label="Download ePub"><i class="bi bi-journal"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contents</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Install the software needed for this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_getting_started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_your_first_crime_map/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Your first crime map</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_data_wrangling/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Wrangling data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_your_second_crime_map/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Your second crime map</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_code_with_style/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Code with style</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_mapping_crime_patterns/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Mapping crime patterns</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_map_context/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Giving a map context</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08_handling_bugs/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Handling bugs in your code</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../09_mapping_areas/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Mapping area data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../10_place_data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Using data about places</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../11_mapping_hotspots/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Mapping hotspots</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../12_messy_data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Handling messy data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../13_crime_series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Mapping crime series</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../14_writing_reports/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Writing reports in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../15_no_maps/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Presenting spatial data without maps</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../16_mapping_time/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Mapping crime over time</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/read_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Functions for reading data into R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/map_checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Checklist: Making a good crime map</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/common_errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Common R errors and how to fix them</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/functions_to_avoid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Some R functions you should avoid</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/handling_errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Checklist: handling code errors</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">In this chapter</h2>
   
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">15.1</span> Introduction</a></li>
  <li><a href="#tables" id="toc-tables" class="nav-link" data-scroll-target="#tables"><span class="header-section-number">15.2</span> Tables</a></li>
  <li><a href="#bar-charts" id="toc-bar-charts" class="nav-link" data-scroll-target="#bar-charts"><span class="header-section-number">15.3</span> Bar charts</a></li>
  <li><a href="#showing-a-distribution" id="toc-showing-a-distribution" class="nav-link" data-scroll-target="#showing-a-distribution"><span class="header-section-number">15.4</span> Showing a distribution</a></li>
  <li><a href="#comparing-continuous-variables" id="toc-comparing-continuous-variables" class="nav-link" data-scroll-target="#comparing-continuous-variables"><span class="header-section-number">15.5</span> Comparing continuous variables</a></li>
  <li><a href="#in-summary" id="toc-in-summary" class="nav-link" data-scroll-target="#in-summary"><span class="header-section-number">15.6</span> In summary</a></li>
  </ul>
<div class="toc-actions"><ul class="collapse"><li><a href="https://github.com/mpjashby/crimemappingbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Presenting spatial data without maps</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Learn how to use tables and charts to effectively communicate information about spatial data, and when these techniques might be more effective than using maps.</strong></p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>This chapter has not yet been updated for 2025, so some material is out of date. Check back for an update in mid-February 2025.</p>
</div>
</div>
<section id="introduction" class="level2" data-number="15.1">
<h2 data-number="15.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">15.1</span> Introduction</h2>
<p>Making maps is the core of analysing spatial data. But just because a particular dataset has a spatial element to it does not mean that a map is the best way to present that data. In this tutorial we will learn some other techniques for presenting data that can be more effective than maps for answering certain questions about spatial data.</p>
<p>As with so much in spatial analysis, whether it is best to make a map or use some other technique to convey information will depend on the circumstances. When you decide how to communicate information about the data you are analysing, you will need to consider the questions you are trying to answer, the audience that you are communicating to, what they will be using the information for and in what circumstances they will be using it.</p>
<p>While the best choice of how to communicate spatial information will depend on the circumstances, there are a few instances in which maps are typically <em>not</em> the best way to communicate your data. These are:</p>
<section id="when-you-only-need-to-convey-a-handful-of-pieces-of-information" class="level4" data-number="15.1.0.1">
<h4 data-number="15.1.0.1" class="anchored" data-anchor-id="when-you-only-need-to-convey-a-handful-of-pieces-of-information"><span class="header-section-number">15.1.0.1</span> When you only need to convey a handful of pieces of information</h4>
<p>Maps are very effective for communicating detailed information, such as the density of crime across thousands of cells in a KDE grid. But to do this, maps typically encode information into aesthetics such as colour, size and so on. This is necessary for communicating large amounts of information, but it makes the connection between the data and the visual representation of the data less direct. If you only need to communicate a small amount of information, there is less justification for forcing your audience to mentally translate the aesthetic into whatever it represents.</p>
<p>For example, if you wanted to show the number of violent and sexual offences in each of the seven districts in Northamptonshire in England, a choropleth map is less clear than a bar chart (for example, in being able to decipher if there were more offences in Kettering or in Wellingborough).</p>
<p class="full-width-image">
<img src="images/map_vs_bar_chart.png" alt="Choropleth map and bar chart both showing the frequency of violence in each district in Northamptonshire in 2020">
</p>
<p>A map might be a useful addition to the bar chart in this case <em>if</em> you are trying to communicate information to people who are not familiar with the locations of the districts. In that case, we might want to add a small reference map to help people understand which area is which:</p>
<p class="full-width-image">
<img src="images/bar_chart_ref_map.png" alt="Bar chart showing the frequency of violence in each district in Northamptonshire in 2020, with a reference map showing the area covered by each district">
</p>
<p>But in most circumstances in which you create crime maps, you will be creating them for an audience (such as local police officers) that already has sufficient knowledge of the area and so an inset map such as this would not be needed. In that case, a bar chart will probably be more effective at showing this information than a map would be.</p>
</section>
<section id="when-you-need-to-convey-several-different-things-about-one-place" class="level4" data-number="15.1.0.2">
<h4 data-number="15.1.0.2" class="anchored" data-anchor-id="when-you-need-to-convey-several-different-things-about-one-place"><span class="header-section-number">15.1.0.2</span> When you need to convey several different things about one place</h4>
<p>Maps are generally most effective when they show a single piece of data about each place. For example, a choropleth map shows a single shade of colour for each area on the map to represent a single value, such as the frequency of crime in that area. If you wanted to show the frequency of burglary <em>and</em> the frequency of robbery in the same area on a map, this would be quite hard. So if you need to convey multiple different things about each place, it is generally best to do this in a table or chart, rather than a map.</p>
<p>One exception to this is when you present multiple maps side by side, each showing a single thing about an area. These are called <em>small multiple</em> maps and we will learn about them in a future tutorial.</p>
</section>
<section id="when-the-geographic-relationship-between-places-on-the-map-is-not-the-most-important-thing-about-them" class="level4" data-number="15.1.0.3">
<h4 data-number="15.1.0.3" class="anchored" data-anchor-id="when-the-geographic-relationship-between-places-on-the-map-is-not-the-most-important-thing-about-them"><span class="header-section-number">15.1.0.3</span> When the geographic relationship between places on the map is not the most important thing about them</h4>
<p>Maps emphasise the spatial relationship between different places, but they do this at the expense of making non-spatial relationships between those places less obvious. If the spatial relationships are the most important thing that you want to convey, a map makes sense. For example, a hotspot map is often a very good way to communicate where crime is most concentrated. But in other cases the geographic relationships between variables will be much less important. For example, if you wanted to show the relationship between the amount of crime in an area and the level of poverty there, a scatter plot would probably be a more-effective way to do this than a map would be.</p>
</section>
</section>
<section id="tables" class="level2" data-number="15.2">
<h2 data-number="15.2" class="anchored" data-anchor-id="tables"><span class="header-section-number">15.2</span> Tables</h2>
<p>Well-designed tables can be a very effective way of communicating information, whereas badly-design tables can be confusing and even lead your audience to give up trying to engage with the information you’re trying to communicate.</p>
<p>Tables used to present information almost always show only a summary of the available data, so the first step in preparing a table is to wrangle the data into the right format. In a previous tutorial we learned about the <code>summarise()</code> function from the <code>dplyr</code> package that we can use to produce summaries of rows of data.</p>
<p>To learn about creating a good table for displaying summary data in a report, we will use the example of the frequency of different types of violence in the different states of Malaysia in 2017. This data is already loaded in an object called <code>violence</code>. We can get a feel for the data by looking at a random sample of rows using the <code>slice_sample()</code> function function from the <code>dplyr</code> package (remember <code>dplyr</code> is loaded automatically by <code>tidyverse</code>).</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">slice_sample</span>(violence, <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 10 × 5
   region        state            year crime_type         count
   &lt;chr&gt;         &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
 1 West Malaysia Johor            2017 murder                66
 2 West Malaysia Negeri Sembilan  2017 armed robbery          2
 3 West Malaysia Kuala Lumpur     2017 rape                 132
 4 West Malaysia Johor            2017 unarmed robbery     1701
 5 West Malaysia Kelantan         2017 rape                 114
 6 West Malaysia Perlis           2017 aggravated assault    47
 7 West Malaysia Terengganu       2017 rape                  64
 8 West Malaysia Perak            2017 unarmed robbery      626
 9 West Malaysia Kelantan         2017 armed robbery          2
10 West Malaysia Kuala Lumpur     2017 aggravated assault   651</code></pre>
</div>
</div>
<p>The output of <code>slice_sample()</code> looks acceptable as a table, especially if it is included in a Quarto document, but readers of our reports probably don’t want to know the type of each variable (underneath the variable names) and won’t want to page through the table if there are more rows or columns than can fit in the available space.</p>
<section id="making-data-wider-for-presentation" class="level3" data-number="15.2.1">
<h3 data-number="15.2.1" class="anchored" data-anchor-id="making-data-wider-for-presentation"><span class="header-section-number">15.2.1</span> Making data wider for presentation</h3>
<p>One issue with printing the <code>violence</code> object as a table is that it has 70 rows, so it will take up a lot of space on a page or screen. We can make the data more compact by converting it from long format to wide format. In the previous tutorial on tidying messy data we learned that data are often easier to analyse in long format. But it is often better to <em>present</em> data in a table in wide format.</p>
<p>To convert the table to a wider format we can use the <code>pivot_wider()</code> function from the <code>tidyr</code> package, just was we used the corresponding <code>pivot_longer()</code> function to tidy data in the messy-data tutorial. To make data wider, we specify a single column in the data to use as the names of multiple new columns using the <code>names_from</code> argument and a column to use as the values for the new columns using the <code>values_from</code> argument.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">pivot_wider</span>(violence, <span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 14 × 8
   region        state    year `aggravated assault` `armed robbery` murder  rape
   &lt;chr&gt;         &lt;chr&gt;   &lt;dbl&gt;                &lt;dbl&gt;           &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1 East Malaysia Sabah    2017                  230               0     36   211
 2 East Malaysia Sarawak  2017                  368               3     27   150
 3 West Malaysia Johor    2017                  614               1     66   196
 4 West Malaysia Kedah    2017                  364               2     21   119
 5 West Malaysia Kelant…  2017                  252               2     13   114
 6 West Malaysia Kuala …  2017                  651               4     37   132
 7 West Malaysia Melaka   2017                  176               1      7    69
 8 West Malaysia Negeri…  2017                  241               2     14    91
 9 West Malaysia Pahang   2017                  188               1     16   163
10 West Malaysia Perak    2017                  380               4     35    95
11 West Malaysia Perlis   2017                   47               0      2    30
12 West Malaysia Pulau …  2017                  275               0     17    80
13 West Malaysia Selang…  2017                 1108              14     83   321
14 West Malaysia Tereng…  2017                  130               0      5    64
# ℹ 1 more variable: `unarmed robbery` &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Now the table has only 14 rows, which makes it much easier to present both on screen and in print. We can also see that the <code>year</code> column is <em>constant</em> (all the values are the same), so we can remove this using the <code>select()</code> function from <code>dplyr</code>. We can also use <code>select()</code> to change the order of the columns from left to right so that the two types of robbery appear next to each other.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">select</span>(</span>
<span id="cb5-4"><a href="#cb5-4"></a>    region, state, murder, rape, <span class="st">`</span><span class="at">aggravated assault</span><span class="st">`</span>, <span class="st">`</span><span class="at">armed robbery</span><span class="st">`</span>, </span>
<span id="cb5-5"><a href="#cb5-5"></a>    <span class="st">`</span><span class="at">unarmed robbery</span><span class="st">`</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 14 × 7
   region        state         murder  rape `aggravated assault` `armed robbery`
   &lt;chr&gt;         &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;           &lt;dbl&gt;
 1 East Malaysia Sabah             36   211                  230               0
 2 East Malaysia Sarawak           27   150                  368               3
 3 West Malaysia Johor             66   196                  614               1
 4 West Malaysia Kedah             21   119                  364               2
 5 West Malaysia Kelantan          13   114                  252               2
 6 West Malaysia Kuala Lumpur      37   132                  651               4
 7 West Malaysia Melaka             7    69                  176               1
 8 West Malaysia Negeri Sembi…     14    91                  241               2
 9 West Malaysia Pahang            16   163                  188               1
10 West Malaysia Perak             35    95                  380               4
11 West Malaysia Perlis             2    30                   47               0
12 West Malaysia Pulau Pinang      17    80                  275               0
13 West Malaysia Selangor          83   321                 1108              14
14 West Malaysia Terengganu         5    64                  130               0
# ℹ 1 more variable: `unarmed robbery` &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="using-the-gt-package-to-make-better-tables" class="level3" data-number="15.2.2">
<h3 data-number="15.2.2" class="anchored" data-anchor-id="using-the-gt-package-to-make-better-tables"><span class="header-section-number">15.2.2</span> Using the <code>gt</code> package to make better tables</h3>
<p><a href="https://gt.rstudio.com/"><img src="images/gt.png" alt="gt package hex sticker" class="right-side-image"></a></p>
<p>We can create much better display tables with the <a href="https://gt.rstudio.com/"><code>gt</code> package</a>, which is designed to format data for display. The <code>gt</code> package works in a similar way to the <code>ggplot2</code> package, in that tables are made up of stacks of functions that contribute to the appearance of the final table. One difference is that the layers in a <code>gt</code> stack are joined using the pipe operator (<code>|&gt;</code>) rather than the plus operator (<code>+</code>).</p>
<p>We can create a very basic <code>gt</code> table by just passing a data frame or tibble to the <code>gt()</code> function. So we can add <code>gt()</code> to the end of the pipeline of functions we have already started to build to create a good display table.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="fu">select</span>(</span>
<span id="cb7-4"><a href="#cb7-4"></a>    region, state, murder, rape, <span class="st">`</span><span class="at">aggravated assault</span><span class="st">`</span>, <span class="st">`</span><span class="at">armed robbery</span><span class="st">`</span>, </span>
<span id="cb7-5"><a href="#cb7-5"></a>    <span class="st">`</span><span class="at">unarmed robbery</span><span class="st">`</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="fu">gt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="xgptsqbcxa" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#xgptsqbcxa table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#xgptsqbcxa thead, #xgptsqbcxa tbody, #xgptsqbcxa tfoot, #xgptsqbcxa tr, #xgptsqbcxa td, #xgptsqbcxa th {
  border-style: none;
}

#xgptsqbcxa p {
  margin: 0;
  padding: 0;
}

#xgptsqbcxa .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xgptsqbcxa .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#xgptsqbcxa .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xgptsqbcxa .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xgptsqbcxa .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xgptsqbcxa .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xgptsqbcxa .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xgptsqbcxa .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xgptsqbcxa .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xgptsqbcxa .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xgptsqbcxa .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xgptsqbcxa .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xgptsqbcxa .gt_spanner_row {
  border-bottom-style: hidden;
}

#xgptsqbcxa .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#xgptsqbcxa .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xgptsqbcxa .gt_from_md > :first-child {
  margin-top: 0;
}

#xgptsqbcxa .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xgptsqbcxa .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xgptsqbcxa .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#xgptsqbcxa .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#xgptsqbcxa .gt_row_group_first td {
  border-top-width: 2px;
}

#xgptsqbcxa .gt_row_group_first th {
  border-top-width: 2px;
}

#xgptsqbcxa .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xgptsqbcxa .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#xgptsqbcxa .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#xgptsqbcxa .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xgptsqbcxa .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xgptsqbcxa .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xgptsqbcxa .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#xgptsqbcxa .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xgptsqbcxa .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xgptsqbcxa .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xgptsqbcxa .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xgptsqbcxa .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xgptsqbcxa .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xgptsqbcxa .gt_left {
  text-align: left;
}

#xgptsqbcxa .gt_center {
  text-align: center;
}

#xgptsqbcxa .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xgptsqbcxa .gt_font_normal {
  font-weight: normal;
}

#xgptsqbcxa .gt_font_bold {
  font-weight: bold;
}

#xgptsqbcxa .gt_font_italic {
  font-style: italic;
}

#xgptsqbcxa .gt_super {
  font-size: 65%;
}

#xgptsqbcxa .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#xgptsqbcxa .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#xgptsqbcxa .gt_indent_1 {
  text-indent: 5px;
}

#xgptsqbcxa .gt_indent_2 {
  text-indent: 10px;
}

#xgptsqbcxa .gt_indent_3 {
  text-indent: 15px;
}

#xgptsqbcxa .gt_indent_4 {
  text-indent: 20px;
}

#xgptsqbcxa .gt_indent_5 {
  text-indent: 25px;
}

#xgptsqbcxa .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#xgptsqbcxa div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="region" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">region</th>
<th id="state" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">state</th>
<th id="murder" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">murder</th>
<th id="rape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rape</th>
<th id="aggravated-assault" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">aggravated assault</th>
<th id="armed-robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">armed robbery</th>
<th id="unarmed-robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">unarmed robbery</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="region">East Malaysia</td>
<td class="gt_row gt_left" headers="state">Sabah</td>
<td class="gt_row gt_right" headers="murder">36</td>
<td class="gt_row gt_right" headers="rape">211</td>
<td class="gt_row gt_right" headers="aggravated assault">230</td>
<td class="gt_row gt_right" headers="armed robbery">0</td>
<td class="gt_row gt_right" headers="unarmed robbery">284</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="region">East Malaysia</td>
<td class="gt_row gt_left" headers="state">Sarawak</td>
<td class="gt_row gt_right" headers="murder">27</td>
<td class="gt_row gt_right" headers="rape">150</td>
<td class="gt_row gt_right" headers="aggravated assault">368</td>
<td class="gt_row gt_right" headers="armed robbery">3</td>
<td class="gt_row gt_right" headers="unarmed robbery">328</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Johor</td>
<td class="gt_row gt_right" headers="murder">66</td>
<td class="gt_row gt_right" headers="rape">196</td>
<td class="gt_row gt_right" headers="aggravated assault">614</td>
<td class="gt_row gt_right" headers="armed robbery">1</td>
<td class="gt_row gt_right" headers="unarmed robbery">1701</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Kedah</td>
<td class="gt_row gt_right" headers="murder">21</td>
<td class="gt_row gt_right" headers="rape">119</td>
<td class="gt_row gt_right" headers="aggravated assault">364</td>
<td class="gt_row gt_right" headers="armed robbery">2</td>
<td class="gt_row gt_right" headers="unarmed robbery">490</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Kelantan</td>
<td class="gt_row gt_right" headers="murder">13</td>
<td class="gt_row gt_right" headers="rape">114</td>
<td class="gt_row gt_right" headers="aggravated assault">252</td>
<td class="gt_row gt_right" headers="armed robbery">2</td>
<td class="gt_row gt_right" headers="unarmed robbery">219</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Kuala Lumpur</td>
<td class="gt_row gt_right" headers="murder">37</td>
<td class="gt_row gt_right" headers="rape">132</td>
<td class="gt_row gt_right" headers="aggravated assault">651</td>
<td class="gt_row gt_right" headers="armed robbery">4</td>
<td class="gt_row gt_right" headers="unarmed robbery">3175</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Melaka</td>
<td class="gt_row gt_right" headers="murder">7</td>
<td class="gt_row gt_right" headers="rape">69</td>
<td class="gt_row gt_right" headers="aggravated assault">176</td>
<td class="gt_row gt_right" headers="armed robbery">1</td>
<td class="gt_row gt_right" headers="unarmed robbery">589</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Negeri Sembilan</td>
<td class="gt_row gt_right" headers="murder">14</td>
<td class="gt_row gt_right" headers="rape">91</td>
<td class="gt_row gt_right" headers="aggravated assault">241</td>
<td class="gt_row gt_right" headers="armed robbery">2</td>
<td class="gt_row gt_right" headers="unarmed robbery">536</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Pahang</td>
<td class="gt_row gt_right" headers="murder">16</td>
<td class="gt_row gt_right" headers="rape">163</td>
<td class="gt_row gt_right" headers="aggravated assault">188</td>
<td class="gt_row gt_right" headers="armed robbery">1</td>
<td class="gt_row gt_right" headers="unarmed robbery">288</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Perak</td>
<td class="gt_row gt_right" headers="murder">35</td>
<td class="gt_row gt_right" headers="rape">95</td>
<td class="gt_row gt_right" headers="aggravated assault">380</td>
<td class="gt_row gt_right" headers="armed robbery">4</td>
<td class="gt_row gt_right" headers="unarmed robbery">626</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Perlis</td>
<td class="gt_row gt_right" headers="murder">2</td>
<td class="gt_row gt_right" headers="rape">30</td>
<td class="gt_row gt_right" headers="aggravated assault">47</td>
<td class="gt_row gt_right" headers="armed robbery">0</td>
<td class="gt_row gt_right" headers="unarmed robbery">53</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Pulau Pinang</td>
<td class="gt_row gt_right" headers="murder">17</td>
<td class="gt_row gt_right" headers="rape">80</td>
<td class="gt_row gt_right" headers="aggravated assault">275</td>
<td class="gt_row gt_right" headers="armed robbery">0</td>
<td class="gt_row gt_right" headers="unarmed robbery">706</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Selangor</td>
<td class="gt_row gt_right" headers="murder">83</td>
<td class="gt_row gt_right" headers="rape">321</td>
<td class="gt_row gt_right" headers="aggravated assault">1108</td>
<td class="gt_row gt_right" headers="armed robbery">14</td>
<td class="gt_row gt_right" headers="unarmed robbery">4944</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Terengganu</td>
<td class="gt_row gt_right" headers="murder">5</td>
<td class="gt_row gt_right" headers="rape">64</td>
<td class="gt_row gt_right" headers="aggravated assault">130</td>
<td class="gt_row gt_right" headers="armed robbery">0</td>
<td class="gt_row gt_right" headers="unarmed robbery">155</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This table is already better than the default table produced by Quarto if we just print a data frame or tibble. The <code>gt</code> table does not take up the whole width of the page unnecessarily (which can make it harder to read across rows) and has hidden the type of each column.</p>
<p>Note that in the code above, some of the variable names are surrounded by back ticks (<code>`</code>). There are spaces in these variable names, so we use back ticks to stop R from interpreting the first space as the end of the variable name.</p>
<p>We can add more functions to the <code>gt()</code> stack to adjust the appearance of the table. For example, we can format the numeric columns as numbers using the <code>fmt_number()</code> function. This adds thousand separators (in British English, commas) to make it easier to read the large numeric values and can make various other changes such as adding a prefix or suffix to numbers (useful for showing units), scaling numbers (useful for very large numbers) or automatically formatting numbers according to the conventions of the language your computer is set to use (referred to in R help pages as the <em>locale</em> of your computer).</p>
<p>We choose which columns <code>fmt_number()</code> should format using the <code>columns</code> argument. In this case, we want to format all the numeric columns in the data, so we will set <code>columns = where(is.numeric)</code>.</p>
<p>We don’t want the numbers in the table to have any decimal places (since the crime counts are all whole numbers), so we also set <code>decimals = 0</code>. We can use the default values of all the other arguments to <code>fmt_number()</code> – type <code>?gt::fmt_number</code> in the R console to find out more about the different options available on the help page for the <code>fmt_number()</code> function.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">select</span>(</span>
<span id="cb8-4"><a href="#cb8-4"></a>    region, state, murder, rape, <span class="st">`</span><span class="at">aggravated assault</span><span class="st">`</span>, <span class="st">`</span><span class="at">armed robbery</span><span class="st">`</span>, </span>
<span id="cb8-5"><a href="#cb8-5"></a>    <span class="st">`</span><span class="at">unarmed robbery</span><span class="st">`</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb8-7"><a href="#cb8-7"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb8-8"><a href="#cb8-8"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">where</span>(is.numeric), <span class="at">decimals =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="bgwznprfou" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#bgwznprfou table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#bgwznprfou thead, #bgwznprfou tbody, #bgwznprfou tfoot, #bgwznprfou tr, #bgwznprfou td, #bgwznprfou th {
  border-style: none;
}

#bgwznprfou p {
  margin: 0;
  padding: 0;
}

#bgwznprfou .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#bgwznprfou .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#bgwznprfou .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#bgwznprfou .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#bgwznprfou .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bgwznprfou .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bgwznprfou .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bgwznprfou .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#bgwznprfou .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#bgwznprfou .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#bgwznprfou .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#bgwznprfou .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#bgwznprfou .gt_spanner_row {
  border-bottom-style: hidden;
}

#bgwznprfou .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#bgwznprfou .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#bgwznprfou .gt_from_md > :first-child {
  margin-top: 0;
}

#bgwznprfou .gt_from_md > :last-child {
  margin-bottom: 0;
}

#bgwznprfou .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#bgwznprfou .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#bgwznprfou .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#bgwznprfou .gt_row_group_first td {
  border-top-width: 2px;
}

#bgwznprfou .gt_row_group_first th {
  border-top-width: 2px;
}

#bgwznprfou .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bgwznprfou .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#bgwznprfou .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#bgwznprfou .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bgwznprfou .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bgwznprfou .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#bgwznprfou .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#bgwznprfou .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#bgwznprfou .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bgwznprfou .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bgwznprfou .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bgwznprfou .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bgwznprfou .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bgwznprfou .gt_left {
  text-align: left;
}

#bgwznprfou .gt_center {
  text-align: center;
}

#bgwznprfou .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#bgwznprfou .gt_font_normal {
  font-weight: normal;
}

#bgwznprfou .gt_font_bold {
  font-weight: bold;
}

#bgwznprfou .gt_font_italic {
  font-style: italic;
}

#bgwznprfou .gt_super {
  font-size: 65%;
}

#bgwznprfou .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#bgwznprfou .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#bgwznprfou .gt_indent_1 {
  text-indent: 5px;
}

#bgwznprfou .gt_indent_2 {
  text-indent: 10px;
}

#bgwznprfou .gt_indent_3 {
  text-indent: 15px;
}

#bgwznprfou .gt_indent_4 {
  text-indent: 20px;
}

#bgwznprfou .gt_indent_5 {
  text-indent: 25px;
}

#bgwznprfou .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#bgwznprfou div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="region" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">region</th>
<th id="state" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">state</th>
<th id="murder" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">murder</th>
<th id="rape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rape</th>
<th id="aggravated-assault" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">aggravated assault</th>
<th id="armed-robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">armed robbery</th>
<th id="unarmed-robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">unarmed robbery</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="region">East Malaysia</td>
<td class="gt_row gt_left" headers="state">Sabah</td>
<td class="gt_row gt_right" headers="murder">36</td>
<td class="gt_row gt_right" headers="rape">211</td>
<td class="gt_row gt_right" headers="aggravated assault">230</td>
<td class="gt_row gt_right" headers="armed robbery">0</td>
<td class="gt_row gt_right" headers="unarmed robbery">284</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="region">East Malaysia</td>
<td class="gt_row gt_left" headers="state">Sarawak</td>
<td class="gt_row gt_right" headers="murder">27</td>
<td class="gt_row gt_right" headers="rape">150</td>
<td class="gt_row gt_right" headers="aggravated assault">368</td>
<td class="gt_row gt_right" headers="armed robbery">3</td>
<td class="gt_row gt_right" headers="unarmed robbery">328</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Johor</td>
<td class="gt_row gt_right" headers="murder">66</td>
<td class="gt_row gt_right" headers="rape">196</td>
<td class="gt_row gt_right" headers="aggravated assault">614</td>
<td class="gt_row gt_right" headers="armed robbery">1</td>
<td class="gt_row gt_right" headers="unarmed robbery">1,701</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Kedah</td>
<td class="gt_row gt_right" headers="murder">21</td>
<td class="gt_row gt_right" headers="rape">119</td>
<td class="gt_row gt_right" headers="aggravated assault">364</td>
<td class="gt_row gt_right" headers="armed robbery">2</td>
<td class="gt_row gt_right" headers="unarmed robbery">490</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Kelantan</td>
<td class="gt_row gt_right" headers="murder">13</td>
<td class="gt_row gt_right" headers="rape">114</td>
<td class="gt_row gt_right" headers="aggravated assault">252</td>
<td class="gt_row gt_right" headers="armed robbery">2</td>
<td class="gt_row gt_right" headers="unarmed robbery">219</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Kuala Lumpur</td>
<td class="gt_row gt_right" headers="murder">37</td>
<td class="gt_row gt_right" headers="rape">132</td>
<td class="gt_row gt_right" headers="aggravated assault">651</td>
<td class="gt_row gt_right" headers="armed robbery">4</td>
<td class="gt_row gt_right" headers="unarmed robbery">3,175</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Melaka</td>
<td class="gt_row gt_right" headers="murder">7</td>
<td class="gt_row gt_right" headers="rape">69</td>
<td class="gt_row gt_right" headers="aggravated assault">176</td>
<td class="gt_row gt_right" headers="armed robbery">1</td>
<td class="gt_row gt_right" headers="unarmed robbery">589</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Negeri Sembilan</td>
<td class="gt_row gt_right" headers="murder">14</td>
<td class="gt_row gt_right" headers="rape">91</td>
<td class="gt_row gt_right" headers="aggravated assault">241</td>
<td class="gt_row gt_right" headers="armed robbery">2</td>
<td class="gt_row gt_right" headers="unarmed robbery">536</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Pahang</td>
<td class="gt_row gt_right" headers="murder">16</td>
<td class="gt_row gt_right" headers="rape">163</td>
<td class="gt_row gt_right" headers="aggravated assault">188</td>
<td class="gt_row gt_right" headers="armed robbery">1</td>
<td class="gt_row gt_right" headers="unarmed robbery">288</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Perak</td>
<td class="gt_row gt_right" headers="murder">35</td>
<td class="gt_row gt_right" headers="rape">95</td>
<td class="gt_row gt_right" headers="aggravated assault">380</td>
<td class="gt_row gt_right" headers="armed robbery">4</td>
<td class="gt_row gt_right" headers="unarmed robbery">626</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Perlis</td>
<td class="gt_row gt_right" headers="murder">2</td>
<td class="gt_row gt_right" headers="rape">30</td>
<td class="gt_row gt_right" headers="aggravated assault">47</td>
<td class="gt_row gt_right" headers="armed robbery">0</td>
<td class="gt_row gt_right" headers="unarmed robbery">53</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Pulau Pinang</td>
<td class="gt_row gt_right" headers="murder">17</td>
<td class="gt_row gt_right" headers="rape">80</td>
<td class="gt_row gt_right" headers="aggravated assault">275</td>
<td class="gt_row gt_right" headers="armed robbery">0</td>
<td class="gt_row gt_right" headers="unarmed robbery">706</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Selangor</td>
<td class="gt_row gt_right" headers="murder">83</td>
<td class="gt_row gt_right" headers="rape">321</td>
<td class="gt_row gt_right" headers="aggravated assault">1,108</td>
<td class="gt_row gt_right" headers="armed robbery">14</td>
<td class="gt_row gt_right" headers="unarmed robbery">4,944</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="region">West Malaysia</td>
<td class="gt_row gt_left" headers="state">Terengganu</td>
<td class="gt_row gt_right" headers="murder">5</td>
<td class="gt_row gt_right" headers="rape">64</td>
<td class="gt_row gt_right" headers="aggravated assault">130</td>
<td class="gt_row gt_right" headers="armed robbery">0</td>
<td class="gt_row gt_right" headers="unarmed robbery">155</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><code>fmt_number()</code> is one of several formatting functions available in <code>gt</code>. For example, we could use <code>fmt_currency()</code> to format columns according to the conventions for currency values, <code>fmt_date()</code> for dates or <code>fmt_percent()</code> for percentages.</p>
<p>The <code>region</code> column only has two values: <code>West Malaysia</code> for states and territories in Peninsular Malaysia and <code>East Malaysia</code> for states on the island of Borneo. Rather than repeat these two values on every row of the table – which is a waste of space and makes the table more cluttered than necessary – we can instead group the rows according to these two regions and then only show the region names once at the top of each group.</p>
<p><code>gt()</code> will automatically create group headings in a table if the data frame or tibble passed to <code>gt()</code> contains groups created by the <code>group_by()</code> function from the <code>dplyr</code> package. All we have to do is use <code>group_by()</code> to specify which column (in this case, <code>region</code>) contains the values that we should use to determine which group each row is in.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="fu">select</span>(</span>
<span id="cb9-4"><a href="#cb9-4"></a>    region, state, murder, rape, <span class="st">`</span><span class="at">aggravated assault</span><span class="st">`</span>, <span class="st">`</span><span class="at">armed robbery</span><span class="st">`</span>, </span>
<span id="cb9-5"><a href="#cb9-5"></a>    <span class="st">`</span><span class="at">unarmed robbery</span><span class="st">`</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb9-7"><a href="#cb9-7"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span> </span>
<span id="cb9-8"><a href="#cb9-8"></a>  <span class="co"># Functions from `dplyr`, `tidyr` etc above and functions from `gt` below</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb9-10"><a href="#cb9-10"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">where</span>(is.numeric), <span class="at">decimals =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="btpbaayjrt" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#btpbaayjrt table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#btpbaayjrt thead, #btpbaayjrt tbody, #btpbaayjrt tfoot, #btpbaayjrt tr, #btpbaayjrt td, #btpbaayjrt th {
  border-style: none;
}

#btpbaayjrt p {
  margin: 0;
  padding: 0;
}

#btpbaayjrt .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#btpbaayjrt .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#btpbaayjrt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#btpbaayjrt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#btpbaayjrt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#btpbaayjrt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#btpbaayjrt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#btpbaayjrt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#btpbaayjrt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#btpbaayjrt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#btpbaayjrt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#btpbaayjrt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#btpbaayjrt .gt_spanner_row {
  border-bottom-style: hidden;
}

#btpbaayjrt .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#btpbaayjrt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#btpbaayjrt .gt_from_md > :first-child {
  margin-top: 0;
}

#btpbaayjrt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#btpbaayjrt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#btpbaayjrt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#btpbaayjrt .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#btpbaayjrt .gt_row_group_first td {
  border-top-width: 2px;
}

#btpbaayjrt .gt_row_group_first th {
  border-top-width: 2px;
}

#btpbaayjrt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#btpbaayjrt .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#btpbaayjrt .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#btpbaayjrt .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#btpbaayjrt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#btpbaayjrt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#btpbaayjrt .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#btpbaayjrt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#btpbaayjrt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#btpbaayjrt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#btpbaayjrt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#btpbaayjrt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#btpbaayjrt .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#btpbaayjrt .gt_left {
  text-align: left;
}

#btpbaayjrt .gt_center {
  text-align: center;
}

#btpbaayjrt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#btpbaayjrt .gt_font_normal {
  font-weight: normal;
}

#btpbaayjrt .gt_font_bold {
  font-weight: bold;
}

#btpbaayjrt .gt_font_italic {
  font-style: italic;
}

#btpbaayjrt .gt_super {
  font-size: 65%;
}

#btpbaayjrt .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#btpbaayjrt .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#btpbaayjrt .gt_indent_1 {
  text-indent: 5px;
}

#btpbaayjrt .gt_indent_2 {
  text-indent: 10px;
}

#btpbaayjrt .gt_indent_3 {
  text-indent: 15px;
}

#btpbaayjrt .gt_indent_4 {
  text-indent: 20px;
}

#btpbaayjrt .gt_indent_5 {
  text-indent: 25px;
}

#btpbaayjrt .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#btpbaayjrt div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="state" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">state</th>
<th id="murder" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">murder</th>
<th id="rape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rape</th>
<th id="aggravated-assault" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">aggravated assault</th>
<th id="armed-robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">armed robbery</th>
<th id="unarmed-robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">unarmed robbery</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd gt_group_heading_row">
<td colspan="6" id="East Malaysia" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">East Malaysia</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_left" headers="East Malaysia  state">Sabah</td>
<td class="gt_row gt_right" headers="East Malaysia  murder">36</td>
<td class="gt_row gt_right" headers="East Malaysia  rape">211</td>
<td class="gt_row gt_right" headers="East Malaysia  aggravated assault">230</td>
<td class="gt_row gt_right" headers="East Malaysia  armed robbery">0</td>
<td class="gt_row gt_right" headers="East Malaysia  unarmed robbery">284</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="East Malaysia  state">Sarawak</td>
<td class="gt_row gt_right" headers="East Malaysia  murder">27</td>
<td class="gt_row gt_right" headers="East Malaysia  rape">150</td>
<td class="gt_row gt_right" headers="East Malaysia  aggravated assault">368</td>
<td class="gt_row gt_right" headers="East Malaysia  armed robbery">3</td>
<td class="gt_row gt_right" headers="East Malaysia  unarmed robbery">328</td>
</tr>
<tr class="even gt_group_heading_row">
<td colspan="6" id="West Malaysia" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">West Malaysia</td>
</tr>
<tr class="odd gt_row_group_first">
<td class="gt_row gt_left" headers="West Malaysia  state">Johor</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">66</td>
<td class="gt_row gt_right" headers="West Malaysia  rape">196</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">614</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery">1,701</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="West Malaysia  state">Kedah</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">21</td>
<td class="gt_row gt_right" headers="West Malaysia  rape">119</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">364</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery">490</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="West Malaysia  state">Kelantan</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">13</td>
<td class="gt_row gt_right" headers="West Malaysia  rape">114</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">252</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery">219</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="West Malaysia  state">Kuala Lumpur</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">37</td>
<td class="gt_row gt_right" headers="West Malaysia  rape">132</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">651</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">4</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery">3,175</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="West Malaysia  state">Melaka</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">7</td>
<td class="gt_row gt_right" headers="West Malaysia  rape">69</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">176</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery">589</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="West Malaysia  state">Negeri Sembilan</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">14</td>
<td class="gt_row gt_right" headers="West Malaysia  rape">91</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">241</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery">536</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="West Malaysia  state">Pahang</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">16</td>
<td class="gt_row gt_right" headers="West Malaysia  rape">163</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">188</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery">288</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="West Malaysia  state">Perak</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">35</td>
<td class="gt_row gt_right" headers="West Malaysia  rape">95</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">380</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">4</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery">626</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="West Malaysia  state">Perlis</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">2</td>
<td class="gt_row gt_right" headers="West Malaysia  rape">30</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">47</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery">53</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="West Malaysia  state">Pulau Pinang</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">17</td>
<td class="gt_row gt_right" headers="West Malaysia  rape">80</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">275</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery">706</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="West Malaysia  state">Selangor</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">83</td>
<td class="gt_row gt_right" headers="West Malaysia  rape">321</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">1,108</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">14</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery">4,944</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="West Malaysia  state">Terengganu</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">5</td>
<td class="gt_row gt_right" headers="West Malaysia  rape">64</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">130</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery">155</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In tables containing lots of numbers it can be difficult to see patterns. One way to help readers to understand patterns is to map the numbers to an aesthetic property such as colour that people can easily see patterns in. To do this, we can colour the cells in a column according to the value of each cell using the <code>data_color()</code> function (note the spelling of ‘color’ in this function). To use <code>data_color()</code>, we specify the columns we want to shade using the <code>columns</code> argument and the colour palette we want to use using the <code>palette</code> argument.</p>
<p>In this example, we will only colour the values in two columns, so we will pass the column names (enclosed in <code>`</code>back ticks<code>`</code> if they contain a space) to the <code>columns</code> argument.</p>
<p>The easiest way to specify a colour palette is to use one of the built-in colour palettes that the <code>gt</code> package understands automatically. These use the same colour palette names we have used in previous tutorials when making use of functions such as <code>scale_fill_distiller()</code>.</p>
<div class="cell" data-exercise="true" data-exercise.lines="17">
<div class="sourceCode cell-code" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="fu">select</span>(</span>
<span id="cb10-6"><a href="#cb10-6"></a>    region, state, murder, rape, <span class="st">`</span><span class="at">aggravated assault</span><span class="st">`</span>, <span class="st">`</span><span class="at">armed robbery</span><span class="st">`</span>, </span>
<span id="cb10-7"><a href="#cb10-7"></a>    <span class="st">`</span><span class="at">unarmed robbery</span><span class="st">`</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb10-9"><a href="#cb10-9"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span> </span>
<span id="cb10-10"><a href="#cb10-10"></a>  <span class="co"># Functions from `dplyr`, `tidyr` etc above and functions from `gt` below</span></span>
<span id="cb10-11"><a href="#cb10-11"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb10-12"><a href="#cb10-12"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">where</span>(is.numeric), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-13"><a href="#cb10-13"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> <span class="st">`</span><span class="at">unarmed robbery</span><span class="st">`</span>, <span class="at">palette =</span> <span class="st">"Oranges"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-14"><a href="#cb10-14"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> rape, <span class="at">palette =</span> <span class="st">"Blues"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ybcwebslxc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ybcwebslxc table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ybcwebslxc thead, #ybcwebslxc tbody, #ybcwebslxc tfoot, #ybcwebslxc tr, #ybcwebslxc td, #ybcwebslxc th {
  border-style: none;
}

#ybcwebslxc p {
  margin: 0;
  padding: 0;
}

#ybcwebslxc .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ybcwebslxc .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ybcwebslxc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ybcwebslxc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ybcwebslxc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ybcwebslxc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ybcwebslxc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ybcwebslxc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ybcwebslxc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ybcwebslxc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ybcwebslxc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ybcwebslxc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ybcwebslxc .gt_spanner_row {
  border-bottom-style: hidden;
}

#ybcwebslxc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ybcwebslxc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ybcwebslxc .gt_from_md > :first-child {
  margin-top: 0;
}

#ybcwebslxc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ybcwebslxc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ybcwebslxc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ybcwebslxc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ybcwebslxc .gt_row_group_first td {
  border-top-width: 2px;
}

#ybcwebslxc .gt_row_group_first th {
  border-top-width: 2px;
}

#ybcwebslxc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ybcwebslxc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ybcwebslxc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ybcwebslxc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ybcwebslxc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ybcwebslxc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ybcwebslxc .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ybcwebslxc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ybcwebslxc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ybcwebslxc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ybcwebslxc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ybcwebslxc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ybcwebslxc .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ybcwebslxc .gt_left {
  text-align: left;
}

#ybcwebslxc .gt_center {
  text-align: center;
}

#ybcwebslxc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ybcwebslxc .gt_font_normal {
  font-weight: normal;
}

#ybcwebslxc .gt_font_bold {
  font-weight: bold;
}

#ybcwebslxc .gt_font_italic {
  font-style: italic;
}

#ybcwebslxc .gt_super {
  font-size: 65%;
}

#ybcwebslxc .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ybcwebslxc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ybcwebslxc .gt_indent_1 {
  text-indent: 5px;
}

#ybcwebslxc .gt_indent_2 {
  text-indent: 10px;
}

#ybcwebslxc .gt_indent_3 {
  text-indent: 15px;
}

#ybcwebslxc .gt_indent_4 {
  text-indent: 20px;
}

#ybcwebslxc .gt_indent_5 {
  text-indent: 25px;
}

#ybcwebslxc .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ybcwebslxc div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="state" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">state</th>
<th id="murder" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">murder</th>
<th id="rape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rape</th>
<th id="aggravated-assault" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">aggravated assault</th>
<th id="armed-robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">armed robbery</th>
<th id="unarmed-robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">unarmed robbery</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd gt_group_heading_row">
<td colspan="6" id="East Malaysia" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">East Malaysia</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_left" headers="East Malaysia  state">Sabah</td>
<td class="gt_row gt_right" headers="East Malaysia  murder">36</td>
<td class="gt_row gt_right" headers="East Malaysia  rape" style="background-color: #4393C6; color: #FFFFFF">211</td>
<td class="gt_row gt_right" headers="East Malaysia  aggravated assault">230</td>
<td class="gt_row gt_right" headers="East Malaysia  armed robbery">0</td>
<td class="gt_row gt_right" headers="East Malaysia  unarmed robbery" style="background-color: #FFEFE0; color: #000000">284</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="East Malaysia  state">Sarawak</td>
<td class="gt_row gt_right" headers="East Malaysia  murder">27</td>
<td class="gt_row gt_right" headers="East Malaysia  rape" style="background-color: #90C2DE; color: #000000">150</td>
<td class="gt_row gt_right" headers="East Malaysia  aggravated assault">368</td>
<td class="gt_row gt_right" headers="East Malaysia  armed robbery">3</td>
<td class="gt_row gt_right" headers="East Malaysia  unarmed robbery" style="background-color: #FFEEDE; color: #000000">328</td>
</tr>
<tr class="even gt_group_heading_row">
<td colspan="6" id="West Malaysia" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">West Malaysia</td>
</tr>
<tr class="odd gt_row_group_first">
<td class="gt_row gt_left" headers="West Malaysia  state">Johor</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">66</td>
<td class="gt_row gt_right" headers="West Malaysia  rape" style="background-color: #559ECD; color: #FFFFFF">196</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">614</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery" style="background-color: #FEB87C; color: #000000">1,701</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="West Malaysia  state">Kedah</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">21</td>
<td class="gt_row gt_right" headers="West Malaysia  rape" style="background-color: #B4D3E9; color: #000000">119</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">364</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery" style="background-color: #FEEAD6; color: #000000">490</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="West Malaysia  state">Kelantan</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">13</td>
<td class="gt_row gt_right" headers="West Malaysia  rape" style="background-color: #BAD6EB; color: #000000">114</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">252</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery" style="background-color: #FFF1E3; color: #000000">219</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="West Malaysia  state">Kuala Lumpur</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">37</td>
<td class="gt_row gt_right" headers="West Malaysia  rape" style="background-color: #A6CDE4; color: #000000">132</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">651</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">4</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery" style="background-color: #EE6611; color: #FFFFFF">3,175</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="West Malaysia  state">Melaka</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">7</td>
<td class="gt_row gt_right" headers="West Malaysia  rape" style="background-color: #DCEAF6; color: #000000">69</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">176</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery" style="background-color: #FEE8D2; color: #000000">589</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="West Malaysia  state">Negeri Sembilan</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">14</td>
<td class="gt_row gt_right" headers="West Malaysia  rape" style="background-color: #CEE0F2; color: #000000">91</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">241</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery" style="background-color: #FEE9D4; color: #000000">536</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="West Malaysia  state">Pahang</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">16</td>
<td class="gt_row gt_right" headers="West Malaysia  rape" style="background-color: #7EB8DA; color: #000000">163</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">188</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery" style="background-color: #FFEFE0; color: #000000">288</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="West Malaysia  state">Perak</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">35</td>
<td class="gt_row gt_right" headers="West Malaysia  rape" style="background-color: #CBDEF1; color: #000000">95</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">380</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">4</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery" style="background-color: #FEE7D0; color: #000000">626</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="West Malaysia  state">Perlis</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">2</td>
<td class="gt_row gt_right" headers="West Malaysia  rape" style="background-color: #F7FBFF; color: #000000">30</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">47</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery" style="background-color: #FFF5EB; color: #000000">53</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="West Malaysia  state">Pulau Pinang</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">17</td>
<td class="gt_row gt_right" headers="West Malaysia  rape" style="background-color: #D5E5F4; color: #000000">80</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">275</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery" style="background-color: #FEE4CB; color: #000000">706</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="West Malaysia  state">Selangor</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">83</td>
<td class="gt_row gt_right" headers="West Malaysia  rape" style="background-color: #08306B; color: #FFFFFF">321</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">1,108</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">14</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery" style="background-color: #7F2704; color: #FFFFFF">4,944</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="West Malaysia  state">Terengganu</td>
<td class="gt_row gt_right" headers="West Malaysia  murder">5</td>
<td class="gt_row gt_right" headers="West Malaysia  rape" style="background-color: #E0ECF8; color: #000000">64</td>
<td class="gt_row gt_right" headers="West Malaysia  aggravated assault">130</td>
<td class="gt_row gt_right" headers="West Malaysia  armed robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia  unarmed robbery" style="background-color: #FFF2E6; color: #000000">155</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="box notewell">
<p>In this table we use two different colours to show the patterns in the frequency of murder and unarmed robbery. This is because we want readers to remember that different types of crime are <em>different</em> and so comparisons that treat crimes as being equivalent to one another are likely to be flawed. If we used the same colour across columns, readers might end up seeing that the shade used for unarmed robberies in Kuala Lumpur was darker than the shade showing the number of murders and conclude that unarmed robberies were a bigger problem than murders. This would be a potentially false conclusion because a single murder and a single unarmed robbery are not the same in terms of their seriousness.</p>
<p>For the same reason the table does not include a column showing the total number of crimes in each state – when we total all types of crime together, we are implicitly assuming that all types of crime are the same when that is obviously untrue.</p>
</div>
</section>
<section id="adding-summary-rows" class="level3" data-number="15.2.3">
<h3 data-number="15.2.3" class="anchored" data-anchor-id="adding-summary-rows"><span class="header-section-number">15.2.3</span> Adding summary rows</h3>
<p>The final thing we will add to this table is a summary row containing the total number of each type of crime across all the states and territories. We do this using the <code>summary_rows()</code> function from <code>gt</code>. We specify the columns we want to summarise using the <code>columns</code> argument as we did for <code>fmt_number()</code>.</p>
<p>Summary rows can be produced using lots of different R functions. For example, we could use the <code>mean()</code> function to produce a summary row showing the mean (average) number of crimes of each time across the states. In this case, we want to know the total number of each type of crime across all states, so we will use the <code>sum()</code> function. To specify this, we pass the <code>fns</code> argument to <code>summary_rows()</code>. For reasons we don’t need to go into, the <code>funs</code> argument must be a <em>list</em> of function names, even if only one function name is needed. So to tell <code>summary_rows()</code> to produce summaries based on totals, we need to specify <code>fns = list("sum")</code>.</p>
<p>By default, this will produce a row at the bottom of the table containing the totals, but that row will have a label on the left that is based on the name of the function – <code>sum()</code> used to produce the summary values. Since more people will know the word ‘total’ than the word ‘sum’, we will instead specify that this summary row should be labelled as ‘total’. To do this, we have to <em>name</em> the entry in the list passed to <code>fns</code> that specifies the function to use, i.e. we need to specify <code>fns = list("total = "sum")</code> rather than just <code>fns = list("sum")</code>.</p>
<p>By default, <code>summary_rows()</code> formats the calculated summary values as numbers using <code>fmt_numeric()</code>, we also need to specify <code>decimals = 0</code> as before.</p>
<div class="cell" data-exercise="true" data-exercise.lines="20">
<div class="sourceCode cell-code" id="cb11" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_type, <span class="at">values_from =</span> count) <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">select</span>(</span>
<span id="cb11-4"><a href="#cb11-4"></a>    region, state, murder, rape, <span class="st">`</span><span class="at">aggravated assault</span><span class="st">`</span>, <span class="st">`</span><span class="at">armed robbery</span><span class="st">`</span>, </span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="st">`</span><span class="at">unarmed robbery</span><span class="st">`</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb11-7"><a href="#cb11-7"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span> </span>
<span id="cb11-8"><a href="#cb11-8"></a>  <span class="co"># Functions from `dplyr`, `tidyr` etc above and functions from `gt` below</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb11-10"><a href="#cb11-10"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">where</span>(is.numeric), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-11"><a href="#cb11-11"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> <span class="st">`</span><span class="at">unarmed robbery</span><span class="st">`</span>, <span class="at">palette =</span> <span class="st">"Oranges"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-12"><a href="#cb11-12"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> rape, <span class="at">palette =</span> <span class="st">"Blues"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-13"><a href="#cb11-13"></a>  <span class="fu">summary_rows</span>(</span>
<span id="cb11-14"><a href="#cb11-14"></a>    <span class="at">columns =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb11-15"><a href="#cb11-15"></a>    <span class="at">fns =</span> <span class="fu">list</span>(<span class="st">"total"</span> <span class="ot">=</span> <span class="st">"sum"</span>),</span>
<span id="cb11-16"><a href="#cb11-16"></a>    <span class="at">decimals =</span> <span class="dv">0</span></span>
<span id="cb11-17"><a href="#cb11-17"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fotxamdvdp" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#fotxamdvdp table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#fotxamdvdp thead, #fotxamdvdp tbody, #fotxamdvdp tfoot, #fotxamdvdp tr, #fotxamdvdp td, #fotxamdvdp th {
  border-style: none;
}

#fotxamdvdp p {
  margin: 0;
  padding: 0;
}

#fotxamdvdp .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fotxamdvdp .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#fotxamdvdp .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fotxamdvdp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fotxamdvdp .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fotxamdvdp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fotxamdvdp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fotxamdvdp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fotxamdvdp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fotxamdvdp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fotxamdvdp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fotxamdvdp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fotxamdvdp .gt_spanner_row {
  border-bottom-style: hidden;
}

#fotxamdvdp .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#fotxamdvdp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fotxamdvdp .gt_from_md > :first-child {
  margin-top: 0;
}

#fotxamdvdp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fotxamdvdp .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fotxamdvdp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#fotxamdvdp .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#fotxamdvdp .gt_row_group_first td {
  border-top-width: 2px;
}

#fotxamdvdp .gt_row_group_first th {
  border-top-width: 2px;
}

#fotxamdvdp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fotxamdvdp .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#fotxamdvdp .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#fotxamdvdp .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fotxamdvdp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fotxamdvdp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fotxamdvdp .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#fotxamdvdp .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fotxamdvdp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fotxamdvdp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fotxamdvdp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fotxamdvdp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fotxamdvdp .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fotxamdvdp .gt_left {
  text-align: left;
}

#fotxamdvdp .gt_center {
  text-align: center;
}

#fotxamdvdp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fotxamdvdp .gt_font_normal {
  font-weight: normal;
}

#fotxamdvdp .gt_font_bold {
  font-weight: bold;
}

#fotxamdvdp .gt_font_italic {
  font-style: italic;
}

#fotxamdvdp .gt_super {
  font-size: 65%;
}

#fotxamdvdp .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#fotxamdvdp .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#fotxamdvdp .gt_indent_1 {
  text-indent: 5px;
}

#fotxamdvdp .gt_indent_2 {
  text-indent: 10px;
}

#fotxamdvdp .gt_indent_3 {
  text-indent: 15px;
}

#fotxamdvdp .gt_indent_4 {
  text-indent: 20px;
}

#fotxamdvdp .gt_indent_5 {
  text-indent: 25px;
}

#fotxamdvdp .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#fotxamdvdp div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="state" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">state</th>
<th id="murder" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">murder</th>
<th id="rape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rape</th>
<th id="aggravated-assault" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">aggravated assault</th>
<th id="armed-robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">armed robbery</th>
<th id="unarmed-robbery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">unarmed robbery</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd gt_group_heading_row">
<td colspan="7" id="East Malaysia" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">East Malaysia</td>
</tr>
<tr class="even gt_row_group_first">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left" headers="East Malaysia stub_1_1 state">Sabah</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 murder">36</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 rape" style="background-color: #4393C6; color: #FFFFFF">211</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 aggravated assault">230</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 armed robbery">0</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_1 unarmed robbery" style="background-color: #FFEFE0; color: #000000">284</td>
</tr>
<tr class="odd">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left" headers="East Malaysia stub_1_2 state">Sarawak</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 murder">27</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 rape" style="background-color: #90C2DE; color: #000000">150</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 aggravated assault">368</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 armed robbery">3</td>
<td class="gt_row gt_right" headers="East Malaysia stub_1_2 unarmed robbery" style="background-color: #FFEEDE; color: #000000">328</td>
</tr>
<tr class="even">
<td id="summary_stub_East Malaysia_1" class="gt_row gt_left gt_stub gt_summary_row gt_first_summary_row thick gt_last_summary_row" data-quarto-table-cell-role="th" scope="row">sum</td>
<td class="gt_row gt_left gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="East Malaysia summary_stub_East Malaysia_1 state">—</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="East Malaysia summary_stub_East Malaysia_1 murder">63</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="East Malaysia summary_stub_East Malaysia_1 rape">361</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="East Malaysia summary_stub_East Malaysia_1 aggravated assault">598</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="East Malaysia summary_stub_East Malaysia_1 armed robbery">3</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="East Malaysia summary_stub_East Malaysia_1 unarmed robbery">612</td>
</tr>
<tr class="odd gt_group_heading_row">
<td colspan="7" id="West Malaysia" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">West Malaysia</td>
</tr>
<tr class="even gt_row_group_first">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left" headers="West Malaysia stub_1_3 state">Johor</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 murder">66</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 rape" style="background-color: #559ECD; color: #FFFFFF">196</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 aggravated assault">614</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 armed robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_3 unarmed robbery" style="background-color: #FEB87C; color: #000000">1,701</td>
</tr>
<tr class="odd">
<td id="stub_1_4" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left" headers="West Malaysia stub_1_4 state">Kedah</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 murder">21</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 rape" style="background-color: #B4D3E9; color: #000000">119</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 aggravated assault">364</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 armed robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_4 unarmed robbery" style="background-color: #FEEAD6; color: #000000">490</td>
</tr>
<tr class="even">
<td id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left" headers="West Malaysia stub_1_5 state">Kelantan</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 murder">13</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 rape" style="background-color: #BAD6EB; color: #000000">114</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 aggravated assault">252</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 armed robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_5 unarmed robbery" style="background-color: #FFF1E3; color: #000000">219</td>
</tr>
<tr class="odd">
<td id="stub_1_6" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left" headers="West Malaysia stub_1_6 state">Kuala Lumpur</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 murder">37</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 rape" style="background-color: #A6CDE4; color: #000000">132</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 aggravated assault">651</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 armed robbery">4</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_6 unarmed robbery" style="background-color: #EE6611; color: #FFFFFF">3,175</td>
</tr>
<tr class="even">
<td id="stub_1_7" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left" headers="West Malaysia stub_1_7 state">Melaka</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 murder">7</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 rape" style="background-color: #DCEAF6; color: #000000">69</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 aggravated assault">176</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 armed robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_7 unarmed robbery" style="background-color: #FEE8D2; color: #000000">589</td>
</tr>
<tr class="odd">
<td id="stub_1_8" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left" headers="West Malaysia stub_1_8 state">Negeri Sembilan</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 murder">14</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 rape" style="background-color: #CEE0F2; color: #000000">91</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 aggravated assault">241</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 armed robbery">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_8 unarmed robbery" style="background-color: #FEE9D4; color: #000000">536</td>
</tr>
<tr class="even">
<td id="stub_1_9" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left" headers="West Malaysia stub_1_9 state">Pahang</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 murder">16</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 rape" style="background-color: #7EB8DA; color: #000000">163</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 aggravated assault">188</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 armed robbery">1</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_9 unarmed robbery" style="background-color: #FFEFE0; color: #000000">288</td>
</tr>
<tr class="odd">
<td id="stub_1_10" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left" headers="West Malaysia stub_1_10 state">Perak</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 murder">35</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 rape" style="background-color: #CBDEF1; color: #000000">95</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 aggravated assault">380</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 armed robbery">4</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_10 unarmed robbery" style="background-color: #FEE7D0; color: #000000">626</td>
</tr>
<tr class="even">
<td id="stub_1_11" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left" headers="West Malaysia stub_1_11 state">Perlis</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 murder">2</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 rape" style="background-color: #F7FBFF; color: #000000">30</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 aggravated assault">47</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 armed robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_11 unarmed robbery" style="background-color: #FFF5EB; color: #000000">53</td>
</tr>
<tr class="odd">
<td id="stub_1_12" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left" headers="West Malaysia stub_1_12 state">Pulau Pinang</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 murder">17</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 rape" style="background-color: #D5E5F4; color: #000000">80</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 aggravated assault">275</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 armed robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_12 unarmed robbery" style="background-color: #FEE4CB; color: #000000">706</td>
</tr>
<tr class="even">
<td id="stub_1_13" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left" headers="West Malaysia stub_1_13 state">Selangor</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 murder">83</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 rape" style="background-color: #08306B; color: #FFFFFF">321</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 aggravated assault">1,108</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 armed robbery">14</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_13 unarmed robbery" style="background-color: #7F2704; color: #FFFFFF">4,944</td>
</tr>
<tr class="odd">
<td id="stub_1_14" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left" headers="West Malaysia stub_1_14 state">Terengganu</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 murder">5</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 rape" style="background-color: #E0ECF8; color: #000000">64</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 aggravated assault">130</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 armed robbery">0</td>
<td class="gt_row gt_right" headers="West Malaysia stub_1_14 unarmed robbery" style="background-color: #FFF2E6; color: #000000">155</td>
</tr>
<tr class="even">
<td id="summary_stub_West Malaysia_1" class="gt_row gt_left gt_stub gt_summary_row gt_first_summary_row thick gt_last_summary_row" data-quarto-table-cell-role="th" scope="row">sum</td>
<td class="gt_row gt_left gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="West Malaysia summary_stub_West Malaysia_1 state">—</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="West Malaysia summary_stub_West Malaysia_1 murder">316</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="West Malaysia summary_stub_West Malaysia_1 rape">1474</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="West Malaysia summary_stub_West Malaysia_1 aggravated assault">4426</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="West Malaysia summary_stub_West Malaysia_1 armed robbery">31</td>
<td class="gt_row gt_right gt_summary_row gt_first_summary_row thick gt_last_summary_row" headers="West Malaysia summary_stub_West Malaysia_1 unarmed robbery">13482</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="box notewell">
<p>Tables are good for showing detailed information, particularly when we want to present multiple pieces of information about a single place. But it can be hard to spot patterns in tables even with coloured cells. For this reason, <strong>do not use tables when you are primarily trying to show the relationship between two or more variables</strong>. In the next section, we will learn to create bar chart in R to show patterns more effectively.</p>
</div>
<!--
<div class="box extra-detail">

<h5 id="gtword-box1-title" class="box-title">Using the `gt` package with Word documents</h5>

<div id="gtword-box1" class="box-content">

The `gt` package is primarily designed to produce tables in HTML or PDF 
documents. If you want to use `gt` to create tables in Word documents, you will
need to adjust the YAML header section of your Rmarkdown document. Specifically,
you must add a line to your YAML header specifying:

```
output: rtf_document
```

`rtf` here means rich-text format, which is a file format created by Microsoft
for documents that can be shared between Word and other word-processing 
software.

If there is already a line in the YAML header that starts `output: `, you should
replace this with `output: rtf_document`. Note that `gt` will _not_ work if you
use `output: word_document`, which is the usual output format for producing Word
documents.

A few features of the `gt` package – including colouring table cells based on
their value – are not available for RTF documents. This is one reason why you
may want to prefer producing output as HTML where possible.

</div>

</div>

<script>
$("#gtword-box1-title").click(function () { $("#section-gtword-box1").toggle("slow") })
</script>
-->
</section>
</section>
<section id="bar-charts" class="level2" data-number="15.3">
<h2 data-number="15.3" class="anchored" data-anchor-id="bar-charts"><span class="header-section-number">15.3</span> Bar charts</h2>
<p>Bar charts are useful for showing values of one <em>continuous</em> variable (e.g.&nbsp;a count of crimes) for each value of one <em>categorical</em> variable (e.g.&nbsp;states of a country). Bar charts are very common, but there are several things we can do to make them more useful. In this section we will learn how to construct a good bar chart.</p>
<p>You’re already an expert at making maps using functions from the <code>ggplot2</code> package. We can use these same functions to create many other types of graphics. For example, we can use <code>geom_bar()</code> to create bar charts just as we use <code>geom_sf()</code> to create a map using data stored in an SF object.</p>
<p><code>geom_bar()</code> calculates the length of each bar on a chart by counting the number of rows of data in each category. This isn’t what we want to do to visualise the <code>violence</code> object, since the data provided by the Royal Malaysian Police are already in the form of counts of crimes. Instead, we will use the <code>geom_col()</code> function, which creates bar charts from this type of summary data.</p>
<p>To create a simple bar chart, we will work with the original (long-format) data and filter it to show only the number of murders in each state.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">filter</span>(crime_type <span class="sc">==</span> <span class="st">"murder"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> state, <span class="at">y =</span> count))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/bars-exercise1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can improve this chart in several ways:</p>
<ul>
<li>We can switch the order of the variables used for the <code>x</code> and <code>y</code> aesthetics so that the bars are horizontal rather than vertical, which will stop the state names from overlapping.</li>
<li>We can change the axis labels, add a title and so on using <code>labs()</code>.</li>
<li>We can reduce the visual clutter in the chart using <code>theme_minimal()</code>.</li>
</ul>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb13" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="fu">filter</span>(crime_type <span class="sc">==</span> <span class="st">"murder"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> state)) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-6"><a href="#cb13-6"></a>    <span class="at">title =</span> <span class="st">"Murders in Malaysian states, 2017"</span>,</span>
<span id="cb13-7"><a href="#cb13-7"></a>    <span class="at">caption =</span> <span class="st">"Data from the Royal Malaysian Police"</span>,</span>
<span id="cb13-8"><a href="#cb13-8"></a>    <span class="at">x =</span> <span class="st">"number of murders"</span>,</span>
<span id="cb13-9"><a href="#cb13-9"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>  ) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/bars-exercise2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This chart is better, but we can improve it further. For example, we can reduce the space between the state names and the bars by setting the <code>expand</code> argument to the <code>scale_x_continuous()</code> function. <code>scale_x_continuous()</code> works in a similar way to the other scale functions we have used already, such as <code>scale_fill_brewer()</code> to control the colour of areas in a choropleth map.</p>
<p>Although we are trying to reduce the gap between the bars and labels on the <em>y</em> axis, we use a function that change the <em>x</em> axis. This is because the space we are reducing is created by R by-default adding some space to each end of any continuous axis, such as the count of murders.</p>
<p>We can specify the space at the end of each axis using the helper function <code>expansion()</code>, but in this case we just want to remove the space completely so we can just set <code>expand = c(0, 0)</code>.</p>
<p>At the same time, we can also remove the grid lines on the <em>y</em> axis (i.e.&nbsp;those running along the length of the bars) since they don’t really make it any easier to understand the chart. As a general principle, we want to remove anything on a chart that does not contribute to communicating information, since unnecessary chart elements can distract readers from understanding the data.</p>
<p>We can remove the grid lines by setting the <code>panel.grid.major.y</code> and <code>panel.grid.minor.y</code> arguments to the <code>theme()</code> function. The value we want to use is the helper function <code>element_blank()</code>, which sets the grid lines to be blank.</p>
<div class="cell" data-exercise="true" data-exercise.lines="17">
<div class="sourceCode cell-code" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">filter</span>(crime_type <span class="sc">==</span> <span class="st">"murder"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> state)) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-7"><a href="#cb14-7"></a>    <span class="at">title =</span> <span class="st">"Murders in Malaysian states, 2017"</span>,</span>
<span id="cb14-8"><a href="#cb14-8"></a>    <span class="at">caption =</span> <span class="st">"Data from the Royal Malaysian Police"</span>,</span>
<span id="cb14-9"><a href="#cb14-9"></a>    <span class="at">x =</span> <span class="st">"number of murders"</span>,</span>
<span id="cb14-10"><a href="#cb14-10"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>  ) <span class="sc">+</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-13"><a href="#cb14-13"></a>  <span class="fu">theme</span>(</span>
<span id="cb14-14"><a href="#cb14-14"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-15"><a href="#cb14-15"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb14-16"><a href="#cb14-16"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/bars-exercise3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="ordering-bar-charts-by-value" class="level3" data-number="15.3.1">
<h3 data-number="15.3.1" class="anchored" data-anchor-id="ordering-bar-charts-by-value"><span class="header-section-number">15.3.1</span> Ordering bar charts by value</h3>
<p>If you were trying to find the three Malaysian states or territories with the most murders from this chart, it would be pretty easy to see that Selangor had the most murders, followed by Johor. But at a glance, it’s not so easy to see which state or territory comes third. We can make this easier to see by changing the order of the bars from the default alphabetical order to an order based on how many murders there were.</p>
<p>To do this, we need to convert the <code>state</code> column in the data to a new type of variable: a <em>factor</em>. Factors are what R calls categorical variables that have a defined set of possible values. For example, a factor recording if a person was under or over 18 might have two possible values: <code>adult</code> and <code>child</code>.</p>
<p>One of the benefits of storing a variable as a factor is that we can specify an order for the categories. This is useful for categories that have a meaningful order, such as <code>bad</code>, <code>acceptable</code>, <code>good</code>, <code>excellent</code>. But we can also use this feature of factors to specify that values should appear in a particular order in any charts produced from the data, whatever the order of the values in the data itself.</p>
<p><a href="https://forcats.tidyverse.org/"><img src="images/forcats.png" alt="forcats package hex sticker" class="right-side-image"></a></p>
<p>To work with factors in R we can use the <a href="https://forcats.tidyverse.org/"><code>forcats</code> package</a>, so-called because it’s <em>for</em> working with <em>categories</em>. <code>forcats</code> is loaded as part of <code>tidyverse</code>, so we don’t need to load it separately.</p>
<p>All the functions in the <code>forcats</code> package start with the letters <code>fct_</code>, just as all the functions in the SF package start <code>st_</code>. For our bar chart, we will use the <code>fct_reorder()</code> function. This takes a factor or character variable (such as the names of the Malaysian states and territories) and sets the order of the categories according to the values of a numeric variable (such as the number of murders in a state). So to re-order the <code>state</code> variable according to the count of murders, we can use <code>fct_reorder(state, count)</code>. Since we’re changing an existing variable, we will do this inside a call to the <code>mutate()</code> function.</p>
<div class="cell" data-exercise="true" data-exercise.lines="18">
<div class="sourceCode cell-code" id="cb15" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="fu">filter</span>(crime_type <span class="sc">==</span> <span class="st">"murder"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">fct_reorder</span>(state, count)) <span class="sc">|&gt;</span> </span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> state)) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-8"><a href="#cb15-8"></a>    <span class="at">title =</span> <span class="st">"Murders in Malaysian states, 2017"</span>,</span>
<span id="cb15-9"><a href="#cb15-9"></a>    <span class="at">caption =</span> <span class="st">"Data from the Royal Malaysian Police"</span>,</span>
<span id="cb15-10"><a href="#cb15-10"></a>    <span class="at">x =</span> <span class="st">"number of murders"</span>,</span>
<span id="cb15-11"><a href="#cb15-11"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb15-12"><a href="#cb15-12"></a>  ) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb15-14"><a href="#cb15-14"></a>  <span class="fu">theme</span>(</span>
<span id="cb15-15"><a href="#cb15-15"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-16"><a href="#cb15-16"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb15-17"><a href="#cb15-17"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/bars-exercise4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Finally, we can use colour to indicate which states are in which of the two regions of Malaysia. To do this, we will:</p>
<ul>
<li>specify in the call to <code>aes()</code> that the fill colour of the bars should be controlled by the <code>region</code> column in the data,</li>
<li>specify in the call to <code>labs()</code> that we don’t want the legend to have a title, since the meaning is obvious from the values ‘East Malaysia’ and ‘West Malaysia’, and</li>
<li>specify in the call to <code>theme()</code> that we would like the legend use up some of the empty space in the bottom-right corner of the chart, rather than making the chart smaller to give space for the legend on the right-hand side.</li>
</ul>
<p>To move the legend, we need to specify three different arguments in the <code>theme()</code> function. <code>legend.position</code> determines where in the plot the legend should be placed, based on how far along each axis (as a proportion of the axis length, on a scale from zero to one) the legend should be placed.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">tibble</span>(</span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), </span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>)</span>
<span id="cb16-4"><a href="#cb16-4"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-6"><a href="#cb16-6"></a>    <span class="at">label =</span> <span class="fu">str_glue</span>(<span class="st">"{number(x, accuracy = 0.1)}, {number(y, accuracy = 0.1)}"</span>)</span>
<span id="cb16-7"><a href="#cb16-7"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb16-8"><a href="#cb16-8"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10"></a>  <span class="fu">geom_label</span>() <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb16-12"><a href="#cb16-12"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="fl">0.1</span>), </span>
<span id="cb16-13"><a href="#cb16-13"></a>    <span class="at">position =</span> <span class="st">"top"</span>, </span>
<span id="cb16-14"><a href="#cb16-14"></a>    <span class="at">sec.axis =</span> <span class="fu">dup_axis</span>(<span class="at">name =</span> <span class="cn">NULL</span>)</span>
<span id="cb16-15"><a href="#cb16-15"></a>  ) <span class="sc">+</span></span>
<span id="cb16-16"><a href="#cb16-16"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb16-17"><a href="#cb16-17"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="fl">0.1</span>), </span>
<span id="cb16-18"><a href="#cb16-18"></a>    <span class="at">sec.axis =</span> <span class="fu">dup_axis</span>(<span class="at">name =</span> <span class="cn">NULL</span>)</span>
<span id="cb16-19"><a href="#cb16-19"></a>  ) <span class="sc">+</span></span>
<span id="cb16-20"><a href="#cb16-20"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb16-21"><a href="#cb16-21"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-22"><a href="#cb16-22"></a>    <span class="at">x =</span> <span class="st">"the first number gives the value on horizontal (x) axis"</span>,</span>
<span id="cb16-23"><a href="#cb16-23"></a>    <span class="at">y =</span> <span class="st">"the second number gives the value on vertical (y) axis"</span></span>
<span id="cb16-24"><a href="#cb16-24"></a>  ) <span class="sc">+</span></span>
<span id="cb16-25"><a href="#cb16-25"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/legend-position-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Using this specification, we can place the legend in the right-most point on the horizontal axis and the bottom-most point on the vertical axis by specifying <code>legend.position = c(1, 0)</code>.</p>
<p><code>legend.position</code> sets the <em>anchor</em> point from which the legend is created, with the actual size of the legend depending on how much space is required by its contents. By default, a legend will spread out in all directions from the anchor point, i.e.&nbsp;the legend will be horizontally and vertically centred on the anchor point. As we have positioned the legend in a corner of the plot, this is probably not what we want since some of the legend will be hidden outside the plot area. Instead, we can set the <code>legend.justifcation</code> argument of <code>theme()</code> using a similar specification to that for <code>legend.position</code> based on which way we want the legend to grow.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">tibble</span>(</span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="fl">1.1</span>, <span class="fl">1.1</span>, <span class="fl">0.9</span>, <span class="fl">0.9</span>, <span class="fl">1.1</span>, <span class="fl">0.9</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="at">xend =</span> <span class="fu">c</span>(<span class="fl">1.25</span>, <span class="fl">1.25</span>, <span class="fl">0.75</span>, <span class="fl">0.75</span>, <span class="fl">1.25</span>, <span class="fl">0.75</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="fl">1.1</span>, <span class="fl">0.9</span>, <span class="fl">1.1</span>, <span class="fl">0.9</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.9</span>, <span class="fl">1.1</span>),</span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="at">yend =</span> <span class="fu">c</span>(<span class="fl">1.25</span>, <span class="fl">0.75</span>, <span class="fl">1.25</span>, <span class="fl">0.75</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.75</span>, <span class="fl">1.25</span>),</span>
<span id="cb17-6"><a href="#cb17-6"></a>  <span class="at">h =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>),</span>
<span id="cb17-7"><a href="#cb17-7"></a>  <span class="at">v =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb17-8"><a href="#cb17-8"></a>)  <span class="sc">|&gt;</span>  </span>
<span id="cb17-9"><a href="#cb17-9"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-10"><a href="#cb17-10"></a>    <span class="at">label =</span> <span class="fu">str_glue</span>(<span class="st">"{number(h, accuracy = 0.1)}, {number(v, accuracy = 0.1)}"</span>)</span>
<span id="cb17-11"><a href="#cb17-11"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb17-12"><a href="#cb17-12"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-13"><a href="#cb17-13"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb17-14"><a href="#cb17-14"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend), </span>
<span id="cb17-15"><a href="#cb17-15"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>, </span>
<span id="cb17-16"><a href="#cb17-16"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">3</span>, <span class="st">"mm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>)</span>
<span id="cb17-17"><a href="#cb17-17"></a>  ) <span class="sc">+</span></span>
<span id="cb17-18"><a href="#cb17-18"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> xend, <span class="at">y =</span> yend, <span class="at">hjust =</span> h, <span class="at">vjust =</span> v, <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb17-19"><a href="#cb17-19"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb17-20"><a href="#cb17-20"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb17-21"><a href="#cb17-21"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb17-22"><a href="#cb17-22"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb17-23"><a href="#cb17-23"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/legend-justification-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If you want the legend to grow ‘inwards’ from a corner, just set <code>legend.justification</code> to the same value as you used for <code>legend.position</code>. In this case, we want the legend to be anchored in the bottom-right corner and to grow inwards from it, so we will set both arguments to <code>c(1, 0)</code>.</p>
<div class="cell" data-exercise="true" data-exercise.lines="21">
<div class="sourceCode cell-code" id="cb18" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>violence <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="fu">filter</span>(crime_type <span class="sc">==</span> <span class="st">"murder"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">fct_reorder</span>(state, count)) <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> state, <span class="at">fill =</span> region)) <span class="sc">+</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-8"><a href="#cb18-8"></a>    <span class="at">title =</span> <span class="st">"Murders in Malaysian states, 2017"</span>,</span>
<span id="cb18-9"><a href="#cb18-9"></a>    <span class="at">caption =</span> <span class="st">"Data from the Royal Malaysian Police"</span>,</span>
<span id="cb18-10"><a href="#cb18-10"></a>    <span class="at">x =</span> <span class="st">"number of murders"</span>,</span>
<span id="cb18-11"><a href="#cb18-11"></a>    <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb18-12"><a href="#cb18-12"></a>    <span class="at">fill =</span> <span class="cn">NULL</span></span>
<span id="cb18-13"><a href="#cb18-13"></a>  ) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15"></a>  <span class="fu">theme</span>(</span>
<span id="cb18-16"><a href="#cb18-16"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="st">"white"</span>),</span>
<span id="cb18-17"><a href="#cb18-17"></a>    <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb18-18"><a href="#cb18-18"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb18-19"><a href="#cb18-19"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb18-20"><a href="#cb18-20"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb18-21"><a href="#cb18-21"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>Warning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2
3.5.0.
ℹ Please use the `legend.position.inside` argument of `theme()` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/bars-exercise5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Bar charts are a very common way of presenting a numeric variable for each value of a categorical variable. Bar charts are easy to interpret, even for people who are not used to interpreting charts or who only have time to look at the chart for a few seconds.</p>
<div class="box notewell">
<p>One of the reasons why bar charts are easy to interpret is that the <em>length</em> of each bar directly corresponds to the relative size of that particular value. But this direct relationship between bar length and value only applies if the bars start at zero. If you create a bar chart in which the bars don’t start at zero, readers are likely to be mislead, so remember <em>bar charts should always start at zero</em>. But don’t worry – <code>ggplot()</code> will handle this for you automatically.</p>
</div>
</section>
</section>
<section id="showing-a-distribution" class="level2" data-number="15.4">
<h2 data-number="15.4" class="anchored" data-anchor-id="showing-a-distribution"><span class="header-section-number">15.4</span> Showing a distribution</h2>
<p>Bar charts show a single piece of information about each category present in a dataset. So we might use a bar chart to show, for example, the average number of burglaries in neighbourhoods in different districts. But what if the average values masked substantial differences in the number of burglaries within each district? Averages often mask variation, and can sometimes be misleading as a result. In those circumstances it would be better to show more detail rather than a misleading average.</p>
<p>Let’s start with the simple example of showing the distribution of burglary counts within a single district. The <code>burglary</code> object contains counts of burglaries in each lower-layer super output area (LSOA) in Northamptonshire in England in 2020. To show the distribution of burglary counts within one district (Kettering), we can create a <em>histogram</em> using <code>geom_histogram()</code>.</p>
<p>A histogram divides the range of values present in the data into a number of equally sized <em>bins</em>, then shows bars representing the number of observations (rows) in the data that have values fitting into each bin. We can either allow <code>geom_histogram()</code> to set the number of bins automatically, or set it ourself with the <code>binwidth</code> argument.</p>
<p>We will set the <code>binwidth</code> argument of the <code>geom_histogram()</code> function to <code>binwidth = 1</code> so that each bar on the chart will show now many LSOAs have each individual value. We will also add some labels to help readers interpret the chart.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb20" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>burglary <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">filter</span>(district <span class="sc">==</span> <span class="st">"Kettering"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> count), <span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>  <span class="fu">labs</span>(</span>
<span id="cb20-8"><a href="#cb20-8"></a>    <span class="at">title =</span> <span class="st">"Number of burglaries in Kettering neighbourhoods"</span>,</span>
<span id="cb20-9"><a href="#cb20-9"></a>    <span class="at">x =</span> <span class="st">"count of burglaries, 2020"</span>,</span>
<span id="cb20-10"><a href="#cb20-10"></a>    <span class="at">y =</span> <span class="st">"number of LSOAs"</span></span>
<span id="cb20-11"><a href="#cb20-11"></a>  ) <span class="sc">+</span></span>
<span id="cb20-12"><a href="#cb20-12"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb20-13"><a href="#cb20-13"></a>  <span class="fu">theme</span>(</span>
<span id="cb20-14"><a href="#cb20-14"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-15"><a href="#cb20-15"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb20-16"><a href="#cb20-16"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/dist-exercise1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see on this chart that most LSOAs had only a few burglaries in 2020 (i.e. the largest bars are to the left of the chart), while a few LSOAs had a larger number (the bars to the right of the chart). This is what we would expect, since we know the crimes are generally concentrated in a few places.</p>
<section id="plotting-density-curves" class="level3" data-number="15.4.1">
<h3 data-number="15.4.1" class="anchored" data-anchor-id="plotting-density-curves"><span class="header-section-number">15.4.1</span> Plotting density curves</h3>
<p>Dot plots can be effective at showing the distribution of a variable, but are only really useful for a <em>single</em> group since they become cluttered if you try to show several types of dot (e.g.&nbsp;of different colours). One way to show the general distribution of a variable is to summarise the locations of the points on the horizontal axis by adding a <em>density curve</em> with <code>geom_density()</code>. A density curve is a <em>smoothed</em> version of a histogram, which is useful to show the general distribution of a variable (in this case, the number of LSOAs with different numbers of burglaries) at the cost of not showing the exact data. The mathematical procedure used by <code>geom_density()</code> to calculate a density curve is the same as the kernel-density estimation process we have already learned to use to show concentrations of crime on a map.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb21" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>burglary <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="fu">filter</span>(district <span class="sc">==</span> <span class="st">"Kettering"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> count), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7"></a>  <span class="fu">labs</span>(</span>
<span id="cb21-8"><a href="#cb21-8"></a>    <span class="at">title =</span> <span class="st">"Number of burglaries in Kettering neighbourhoods"</span>,</span>
<span id="cb21-9"><a href="#cb21-9"></a>    <span class="at">x =</span> <span class="st">"count of burglaries, 2020"</span>,</span>
<span id="cb21-10"><a href="#cb21-10"></a>    <span class="at">y =</span> <span class="st">"percentage of LSOAs"</span></span>
<span id="cb21-11"><a href="#cb21-11"></a>  ) <span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb21-13"><a href="#cb21-13"></a>  <span class="fu">theme</span>(</span>
<span id="cb21-14"><a href="#cb21-14"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-15"><a href="#cb21-15"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb21-16"><a href="#cb21-16"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/dist-exercise2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can use density curves to show the distribution of a variable across multiple categories at once. For example, we could show the distribution of burglary counts at the neighbourhood level for all the districts in Northamptonshire. To do this we use the <code>geom_density_ridges()</code> function from the <code>ggridges</code> package to create a <em>ridge plot</em>. Although this function does not come from the <code>ggplot2</code> package, it is designed to be used inside a <code>ggplot()</code> stack.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb22" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb22-2"><a href="#cb22-2"></a></span>
<span id="cb22-3"><a href="#cb22-3"></a>burglary <span class="sc">|&gt;</span> </span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="co"># Wrap the district names by replacing any space in a name with a new-line</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> <span class="fu">str_replace_all</span>(district, <span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb22-6"><a href="#cb22-6"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> district)) <span class="sc">+</span></span>
<span id="cb22-7"><a href="#cb22-7"></a>  <span class="fu">geom_density_ridges</span>() <span class="sc">+</span></span>
<span id="cb22-8"><a href="#cb22-8"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-10"><a href="#cb22-10"></a>    <span class="at">title =</span> <span class="st">"Number of burglaries in Kettering neighbourhoods"</span>,</span>
<span id="cb22-11"><a href="#cb22-11"></a>    <span class="at">x =</span> <span class="st">"count of burglaries, 2020"</span>,</span>
<span id="cb22-12"><a href="#cb22-12"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb22-13"><a href="#cb22-13"></a>  ) <span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>Picking joint bandwidth of 1.98</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/dist-exercise3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The ridge plot shows the distribution of burglary counts in LSOAs within each district, with the distributions overlapping slightly to save space. From this we can see that across all districts most LSOAs have few burglaries, with a small number of LSOAs having more. We can also see there are a small number of LSOAs (probably, in fact, just one LSOA) in Wellingborough district with a much higher number of burglaries than anywhere else in Northamptonshire.</p>
</section>
<section id="small-multiple-charts" class="level3" data-number="15.4.2">
<h3 data-number="15.4.2" class="anchored" data-anchor-id="small-multiple-charts"><span class="header-section-number">15.4.2</span> Small-multiple charts</h3>
<p>Density plots can be helpful to summarise a lot of information, but they have some disadvantages. In particular, they don’t show that the number of LSOAs in each district is quite different: there are 131 LSOAs in Northampton but only 41 LSOAs in Corby. To make this clearer we can instead produce several dot plots, one for each district – what are called <em>small-multiple</em> charts.</p>
<p>We could create small-multiple charts by producing a separate histogram for each district and then combine them with the <code>patchwork</code> package, but that would involve a lot of repeated code. Fortunately, we can use a feature of the <code>ggplot2</code> package called <em>faceting</em> to split our single dot plot into multiple plots based on a column in the data (in this case, the district name).</p>
<p>Adding <code>facet_wrap()</code> to our <code>ggplot()</code> stack will cause R to create multiple plots and wrap them across multiple rows and columns so that they approximately fit into the available space. If we only want the small multiples to appear on top of each other (i.e.&nbsp;in multiple rows) or next to each other (i.e.&nbsp;in multiple columns), we can use the <code>facet_grid()</code> function. In this case we want the small multiples to appear on top of each other, so we will use <code>facet_grid()</code> and say that the small multiples (which <code>ggplot2</code> calls <em>facets</em>) should be based on the <code>district</code> column in the data by specifying <code>rows = vars(district)</code> (it is necessary to wrap the name of the column that you want to use as the basis of the small multiples in the <code>vars()</code> function, but we do not need to go into why).</p>
<div class="cell" data-exercise="true" data-exercise.lines="18">
<div class="sourceCode cell-code" id="cb24" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>burglary <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">fill =</span> district)) <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"grey80"</span>) <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(district), <span class="at">labeller =</span> <span class="fu">label_wrap_gen</span>(<span class="at">width =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-7"><a href="#cb24-7"></a>    <span class="at">title =</span> <span class="st">"Number of burglaries in Northamptonshire neighbourhoods"</span>,</span>
<span id="cb24-8"><a href="#cb24-8"></a>    <span class="at">x =</span> <span class="st">"count of burglaries, 2020"</span>,</span>
<span id="cb24-9"><a href="#cb24-9"></a>    <span class="at">y =</span> <span class="st">"number of LSOAs"</span></span>
<span id="cb24-10"><a href="#cb24-10"></a>  ) <span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb24-12"><a href="#cb24-12"></a>  <span class="fu">theme</span>(</span>
<span id="cb24-13"><a href="#cb24-13"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb24-14"><a href="#cb24-14"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-15"><a href="#cb24-15"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-16"><a href="#cb24-16"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb24-17"><a href="#cb24-17"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/dist-exercise5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>You might have noticed we made some other changes to our code for this chart to make it clearer:</p>
<ul>
<li>Set the dot <code>fill</code> to be based on the <code>district</code> column in the data, so the bars in each small multiple will be a different colour. We then remove the legend that is automatically generated by adding the <code>fill</code> aesthetic using the <code>legend.position = "none"</code> attribute to <code>theme()</code>, since the legend is redundant (the same information is shown in the facet labels).</li>
<li>Removed the values and the title on the <em>y</em> axis, since it is clear from the rest of the chart that the vertical axis shows the count of dots in each stack.</li>
<li>Added a horizontal line at zero on the <em>y</em> axis using <code>geom_hline()</code> to make it easier to compare the height of each stack of dots to zero.</li>
<li>Wrapped the facet labels using the <code>label_wrap_gen()</code> helper function so that some of the longer district names don’t take up too much space horizontally.</li>
<li>Made the facet labels easier to read by making the text horizontal (rather than the default vertical text) using the <code>strip.text.y</code> attribute to <code>theme()</code> and the <code>element_text()</code> helper function. <code>angle</code> sets the rotation of the text (or in this case, specifies that there should be no rotation) and <code>hjust = 0</code> specifies that the text should be left aligned.</li>
</ul>
<div class="tutorial">
<p>If you want to play around with each of these parts of the code to understand what they do in more detail, remove one part at a time and re-run the code to see how the appearance of the plot changes.</p>
</div>
<p>There are many more-technical ways to show distributions, such as box plots or violin plots. However, these can be difficult to interpret for people who are not used to looking at those particular types of chart, so they should probably be avoided for communicating with general audiences.</p>
</section>
</section>
<section id="comparing-continuous-variables" class="level2" data-number="15.5">
<h2 data-number="15.5" class="anchored" data-anchor-id="comparing-continuous-variables"><span class="header-section-number">15.5</span> Comparing continuous variables</h2>
<p>So far we have used bar charts to communicate a single number (in our example, a number of murders) for each value of a categorical variable (the name of each Malaysian state or territory), and histograms to show multiple numbers (burglary counts for each neighbourhood) for each value of a categorical variable (districts in Northamptonshire).</p>
<p>Both these types of chart compare a numeric variable to a categorical one. But sometimes we may want to compare two categorical variables. We can do this with a <em>scatter plot</em>. For example, the object <code>vehicle_theft</code> contains rates of thefts of and from motor vehicles per 1,000 households saying they own a vehicle for a selection of 189 municipalities in South Africa. Since thefts <em>of</em> vehicle and thefts <em>from</em> vehicles are different but related crimes, we might want to see if there is a relationship between counts of each type.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>vehicle_theft <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="fu">head</span>() <span class="sc">|&gt;</span> </span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb25-5"><a href="#cb25-5"></a>    <span class="at">title =</span> <span class="st">"Vehicle thefts in South African municipalities"</span>,</span>
<span id="cb25-6"><a href="#cb25-6"></a>    <span class="at">subtitle =</span> <span class="st">"a sample of the data"</span></span>
<span id="cb25-7"><a href="#cb25-7"></a>  )  <span class="sc">|&gt;</span>  </span>
<span id="cb25-8"><a href="#cb25-8"></a>  <span class="fu">tab_options</span>(</span>
<span id="cb25-9"><a href="#cb25-9"></a>    <span class="at">heading.align =</span> <span class="st">"left"</span></span>
<span id="cb25-10"><a href="#cb25-10"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="mcucfbmywl" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#mcucfbmywl table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mcucfbmywl thead, #mcucfbmywl tbody, #mcucfbmywl tfoot, #mcucfbmywl tr, #mcucfbmywl td, #mcucfbmywl th {
  border-style: none;
}

#mcucfbmywl p {
  margin: 0;
  padding: 0;
}

#mcucfbmywl .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mcucfbmywl .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mcucfbmywl .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mcucfbmywl .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mcucfbmywl .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mcucfbmywl .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mcucfbmywl .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mcucfbmywl .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mcucfbmywl .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mcucfbmywl .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mcucfbmywl .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mcucfbmywl .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mcucfbmywl .gt_spanner_row {
  border-bottom-style: hidden;
}

#mcucfbmywl .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mcucfbmywl .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mcucfbmywl .gt_from_md > :first-child {
  margin-top: 0;
}

#mcucfbmywl .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mcucfbmywl .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mcucfbmywl .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mcucfbmywl .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mcucfbmywl .gt_row_group_first td {
  border-top-width: 2px;
}

#mcucfbmywl .gt_row_group_first th {
  border-top-width: 2px;
}

#mcucfbmywl .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mcucfbmywl .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mcucfbmywl .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mcucfbmywl .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mcucfbmywl .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mcucfbmywl .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mcucfbmywl .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mcucfbmywl .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mcucfbmywl .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mcucfbmywl .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mcucfbmywl .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mcucfbmywl .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mcucfbmywl .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mcucfbmywl .gt_left {
  text-align: left;
}

#mcucfbmywl .gt_center {
  text-align: center;
}

#mcucfbmywl .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mcucfbmywl .gt_font_normal {
  font-weight: normal;
}

#mcucfbmywl .gt_font_bold {
  font-weight: bold;
}

#mcucfbmywl .gt_font_italic {
  font-style: italic;
}

#mcucfbmywl .gt_super {
  font-size: 65%;
}

#mcucfbmywl .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mcucfbmywl .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mcucfbmywl .gt_indent_1 {
  text-indent: 5px;
}

#mcucfbmywl .gt_indent_2 {
  text-indent: 10px;
}

#mcucfbmywl .gt_indent_3 {
  text-indent: 15px;
}

#mcucfbmywl .gt_indent_4 {
  text-indent: 20px;
}

#mcucfbmywl .gt_indent_5 {
  text-indent: 25px;
}

#mcucfbmywl .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#mcucfbmywl div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="4" class="gt_heading gt_title gt_font_normal">Vehicle thefts in South African municipalities</th>
</tr>
<tr class="odd gt_heading">
<th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">a sample of the data</th>
</tr>
<tr class="header gt_col_headings">
<th id="province" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">province</th>
<th id="municipality" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">municipality</th>
<th id="crime_category" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">crime_category</th>
<th id="theft_rate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">theft_rate</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="province">Eastern Cape</td>
<td class="gt_row gt_left" headers="municipality">Amahlathi</td>
<td class="gt_row gt_left" headers="crime_category">Theft of motor vehicle</td>
<td class="gt_row gt_right" headers="theft_rate">2.492026</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="province">Eastern Cape</td>
<td class="gt_row gt_left" headers="municipality">Amahlathi</td>
<td class="gt_row gt_left" headers="crime_category">Theft out of or from motor vehicle</td>
<td class="gt_row gt_right" headers="theft_rate">26.415470</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="province">Eastern Cape</td>
<td class="gt_row gt_left" headers="municipality">Blue Crane Route</td>
<td class="gt_row gt_left" headers="crime_category">Theft of motor vehicle</td>
<td class="gt_row gt_right" headers="theft_rate">6.054396</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="province">Eastern Cape</td>
<td class="gt_row gt_left" headers="municipality">Blue Crane Route</td>
<td class="gt_row gt_left" headers="crime_category">Theft out of or from motor vehicle</td>
<td class="gt_row gt_right" headers="theft_rate">19.094635</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="province">Eastern Cape</td>
<td class="gt_row gt_left" headers="municipality">Buffalo City</td>
<td class="gt_row gt_left" headers="crime_category">Theft of motor vehicle</td>
<td class="gt_row gt_right" headers="theft_rate">7.584509</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="province">Eastern Cape</td>
<td class="gt_row gt_left" headers="municipality">Buffalo City</td>
<td class="gt_row gt_left" headers="crime_category">Theft out of or from motor vehicle</td>
<td class="gt_row gt_right" headers="theft_rate">49.028434</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>To create a <code>ggplot()</code> scatter plot we use <code>geom_point()</code>, the same function we previously used to create point maps. This makes sense, since point maps are a specialised type of scatter plot in which the <em>x</em> and <em>y</em> axes of the chart show the latitude and longitude or easting and northing of each crime location.</p>
<p>The data in the <code>vehicle_theft</code> object are in long format, with each row representing a count of crime in a particular category for a particular municipality. To make a scatter plot where each point represents a municipality, we need to have all the data for a municipality in a single row of data, so we will need to transform the data with <code>pivot_wider()</code> (as we did for some of the tables at the start of this tutorial). Since this will turn the crime categories into column names, we will first change the column names to clean names (i.e.&nbsp; containing only lower-case letters, numbers and underscores) using <code>recode()</code> to make the column names easier to work with.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb26" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>vehicle_theft_wider <span class="ot">&lt;-</span> vehicle_theft <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-3"><a href="#cb26-3"></a>    <span class="at">crime_category =</span> <span class="fu">recode</span>(</span>
<span id="cb26-4"><a href="#cb26-4"></a>      crime_category,</span>
<span id="cb26-5"><a href="#cb26-5"></a>      <span class="st">"Theft of motor vehicle"</span> <span class="ot">=</span> <span class="st">"theft_of"</span>,</span>
<span id="cb26-6"><a href="#cb26-6"></a>      <span class="st">"Theft out of or from motor vehicle"</span> <span class="ot">=</span> <span class="st">"theft_from"</span></span>
<span id="cb26-7"><a href="#cb26-7"></a>    )</span>
<span id="cb26-8"><a href="#cb26-8"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb26-9"><a href="#cb26-9"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> crime_category, <span class="at">values_from =</span> theft_rate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now make a basic scatter plot.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb27" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">ggplot</span>(vehicle_theft_wider, <span class="fu">aes</span>(<span class="at">x =</span> theft_of, <span class="at">y =</span> theft_from)) <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-6"><a href="#cb27-6"></a>    <span class="at">title =</span> <span class="st">"Vehicle thefts in South African municipalities"</span>,</span>
<span id="cb27-7"><a href="#cb27-7"></a>    <span class="at">subtitle =</span> <span class="st">"each dot represents one municipality, 2018-19"</span>,</span>
<span id="cb27-8"><a href="#cb27-8"></a>    <span class="at">x =</span> <span class="st">"rate of thefts of motor vehicles per 1,000 vehicle-owning households"</span>,</span>
<span id="cb27-9"><a href="#cb27-9"></a>    <span class="at">y =</span> <span class="st">"rate of thefts from motor vehicles per 1,000 vehicle-owning households"</span></span>
<span id="cb27-10"><a href="#cb27-10"></a>  ) <span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/scatter-exercise2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From this plot we can see that most areas have low rates of both theft of and theft from motor vehicles, with a few areas having very-high rates of one type or the other (but none have high rates of both).</p>
<p>Looking at the bottom-left corner of the chart we can see that we have again encountered the problem of overlapping points making patterns less clear. We can try to deal with this by making the points semi-transparent using the <code>alpha</code> argument to <code>geom_point()</code>.</p>
<p>Scatter plots can be hard for people to interpret, especially if they are not used to interpreting charts. To help readers, we can annotate the plot to show how to interpret each region of the chart. We will add two types of annotation: lines to show the median value on each axis, and labels to help interpretation.</p>
<p>We can add median lines using the <code>geom_hline()</code> and <code>geom_vline()</code> functions, which add horizontal and vertical lines to plots. We will add these to the <code>ggplot()</code> stack <em>before</em> <code>geom_point()</code> so that the lines appear <em>behind</em> the points.</p>
<p>To add text annotations we use the <code>annotate()</code> function from <code>ggplot2</code>, which allows us to add data to a chart by specifying the aesthetics (<em>x</em> and <em>y</em> position, etc.) directly rather than by referencing columns in the data. To add a text annotation, we set the <code>geom</code> argument of <code>annotate()</code> to <code>"text"</code>.</p>
<div class="cell" data-exercise="true" data-exercise.lines="40">
<div class="sourceCode cell-code" id="cb28" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="fu">ggplot</span>(vehicle_theft_wider, <span class="fu">aes</span>(<span class="at">x =</span> theft_of, <span class="at">y =</span> theft_from)) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb28-3"><a href="#cb28-3"></a>    <span class="at">xintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_of"</span>)),</span>
<span id="cb28-4"><a href="#cb28-4"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>  ) <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb28-7"><a href="#cb28-7"></a>    <span class="at">yintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_from"</span>)),</span>
<span id="cb28-8"><a href="#cb28-8"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb28-9"><a href="#cb28-9"></a>  ) <span class="sc">+</span></span>
<span id="cb28-10"><a href="#cb28-10"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb28-11"><a href="#cb28-11"></a>  <span class="fu">annotate</span>(</span>
<span id="cb28-12"><a href="#cb28-12"></a>    <span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb28-13"><a href="#cb28-13"></a>    <span class="at">x =</span> <span class="dv">20</span>, </span>
<span id="cb28-14"><a href="#cb28-14"></a>    <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb28-15"><a href="#cb28-15"></a>    <span class="at">label =</span> <span class="st">"high rate of thefts of vehicles</span><span class="sc">\n</span><span class="st">low rate of thefts from vehicles"</span>, </span>
<span id="cb28-16"><a href="#cb28-16"></a>    <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb28-17"><a href="#cb28-17"></a>    <span class="at">lineheight =</span> <span class="dv">1</span></span>
<span id="cb28-18"><a href="#cb28-18"></a>  ) <span class="sc">+</span></span>
<span id="cb28-19"><a href="#cb28-19"></a>  <span class="fu">annotate</span>(</span>
<span id="cb28-20"><a href="#cb28-20"></a>    <span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb28-21"><a href="#cb28-21"></a>    <span class="at">x =</span> <span class="dv">1</span>, </span>
<span id="cb28-22"><a href="#cb28-22"></a>    <span class="at">y =</span> <span class="dv">75</span>, </span>
<span id="cb28-23"><a href="#cb28-23"></a>    <span class="at">label =</span> <span class="st">"low rate of thefts of vehicles</span><span class="sc">\n</span><span class="st">high rate of thefts from vehicles"</span>, </span>
<span id="cb28-24"><a href="#cb28-24"></a>    <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb28-25"><a href="#cb28-25"></a>    <span class="at">lineheight =</span> <span class="dv">1</span></span>
<span id="cb28-26"><a href="#cb28-26"></a>  ) <span class="sc">+</span></span>
<span id="cb28-27"><a href="#cb28-27"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb28-28"><a href="#cb28-28"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb28-29"><a href="#cb28-29"></a>  <span class="fu">labs</span>(</span>
<span id="cb28-30"><a href="#cb28-30"></a>    <span class="at">title =</span> <span class="st">"Vehicle thefts in South African municipalities"</span>,</span>
<span id="cb28-31"><a href="#cb28-31"></a>    <span class="at">subtitle =</span> <span class="fu">str_glue</span>(</span>
<span id="cb28-32"><a href="#cb28-32"></a>      <span class="st">"each dot represents one municipality, 2018-19, dashed lines show "</span>,</span>
<span id="cb28-33"><a href="#cb28-33"></a>      <span class="st">"median values"</span></span>
<span id="cb28-34"><a href="#cb28-34"></a>    ),</span>
<span id="cb28-35"><a href="#cb28-35"></a>    <span class="at">x =</span> <span class="st">"rate of thefts of motor vehicles per 1,000 vehicle-owning households"</span>,</span>
<span id="cb28-36"><a href="#cb28-36"></a>    <span class="at">y =</span> <span class="st">"rate of thefts from motor vehicles per 1,000 vehicle-owning households"</span></span>
<span id="cb28-37"><a href="#cb28-37"></a>  ) <span class="sc">+</span></span>
<span id="cb28-38"><a href="#cb28-38"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/scatter-exercise3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From this plot we can now see that half of municipalities have very low rates of both types of theft (shown by the dots below and to the left of the median lines).</p>
<p>We can make some further changes to this chart. For example, instead of labelling areas on the plot we could instead label the municipalities with high rates of vehicle theft (we cannot include both types of label because they would overlap). To do that, we will create a new column in the data containing either the municipality name (for high-rate municipalities) or <code>NA</code> (meaning <code>ggplot()</code> will not create a label for that row if we set <code>na.rm = TRUE</code>). We can then use <code>geom_label_repel()</code> to add the labels to the chart, remembering to add <code>label = label</code> to the <code>aes()</code> function so <code>ggplot()</code> knows which column in the data to use for the labels.</p>
<div class="cell" data-exercise="true" data-exercise.lines="28">
<div class="sourceCode cell-code" id="cb29" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb29-2"><a href="#cb29-2"></a></span>
<span id="cb29-3"><a href="#cb29-3"></a>vehicle_theft_wider <span class="sc">|&gt;</span> </span>
<span id="cb29-4"><a href="#cb29-4"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-5"><a href="#cb29-5"></a>    <span class="at">label =</span> <span class="fu">if_else</span>(theft_of <span class="sc">&gt;</span> <span class="dv">17</span> <span class="sc">|</span> theft_from <span class="sc">&gt;</span> <span class="dv">65</span>, municipality, <span class="cn">NA_character_</span>)</span>
<span id="cb29-6"><a href="#cb29-6"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb29-7"><a href="#cb29-7"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theft_of, <span class="at">y =</span> theft_from, <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb29-9"><a href="#cb29-9"></a>    <span class="at">xintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_of"</span>)),</span>
<span id="cb29-10"><a href="#cb29-10"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb29-11"><a href="#cb29-11"></a>  ) <span class="sc">+</span></span>
<span id="cb29-12"><a href="#cb29-12"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb29-13"><a href="#cb29-13"></a>    <span class="at">yintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_from"</span>)),</span>
<span id="cb29-14"><a href="#cb29-14"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb29-15"><a href="#cb29-15"></a>  ) <span class="sc">+</span></span>
<span id="cb29-16"><a href="#cb29-16"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb29-17"><a href="#cb29-17"></a>  <span class="fu">geom_label_repel</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">label.size =</span> <span class="dv">0</span>, <span class="at">lineheight =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb29-18"><a href="#cb29-18"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb29-19"><a href="#cb29-19"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb29-20"><a href="#cb29-20"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-21"><a href="#cb29-21"></a>    <span class="at">title =</span> <span class="st">"Vehicle thefts in South African municipalities"</span>,</span>
<span id="cb29-22"><a href="#cb29-22"></a>    <span class="at">subtitle =</span> <span class="fu">str_glue</span>(</span>
<span id="cb29-23"><a href="#cb29-23"></a>      <span class="st">"each dot represents one municipality, 2018-19, dashed lines show "</span>,</span>
<span id="cb29-24"><a href="#cb29-24"></a>      <span class="st">"median values"</span></span>
<span id="cb29-25"><a href="#cb29-25"></a>    ),</span>
<span id="cb29-26"><a href="#cb29-26"></a>    <span class="at">x =</span> <span class="st">"rate of thefts of motor vehicles per 1,000 vehicle-owning households"</span>,</span>
<span id="cb29-27"><a href="#cb29-27"></a>    <span class="at">y =</span> <span class="st">"rate of thefts from motor vehicles per 1,000 vehicle-owning households"</span></span>
<span id="cb29-28"><a href="#cb29-28"></a>  ) <span class="sc">+</span></span>
<span id="cb29-29"><a href="#cb29-29"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/scatter-exercise4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Finally, we can add a trend line to the plot. We do this using the <code>geom_smooth()</code> function from <code>ggplot2</code>. <code>geom_smooth()</code> can add different types of trend line to a plot, but in this example we will specify a simple linear trend line by setting <code>method = "lm"</code>. We will also specify <code>formula = y ~ x</code> (the default) to avoid <code>geom_smooth()</code> producing a message to tell us what formula it used to calculate the trend.</p>
<div class="cell" data-exercise="true" data-exercise.lines="27">
<div class="sourceCode cell-code" id="cb30" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>vehicle_theft_wider <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-3"><a href="#cb30-3"></a>    <span class="at">label =</span> <span class="fu">if_else</span>(theft_of <span class="sc">&gt;</span> <span class="dv">17</span> <span class="sc">|</span> theft_from <span class="sc">&gt;</span> <span class="dv">65</span>, municipality, <span class="cn">NA_character_</span>)</span>
<span id="cb30-4"><a href="#cb30-4"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theft_of, <span class="at">y =</span> theft_from)) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb30-7"><a href="#cb30-7"></a>    <span class="at">xintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_of"</span>)),</span>
<span id="cb30-8"><a href="#cb30-8"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb30-9"><a href="#cb30-9"></a>  ) <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb30-11"><a href="#cb30-11"></a>    <span class="at">yintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(vehicle_theft_wider, <span class="st">"theft_from"</span>)),</span>
<span id="cb30-12"><a href="#cb30-12"></a>    <span class="at">linetype =</span> <span class="st">"22"</span></span>
<span id="cb30-13"><a href="#cb30-13"></a>  ) <span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">colour =</span> <span class="st">"grey20"</span>) <span class="sc">+</span></span>
<span id="cb30-15"><a href="#cb30-15"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb30-16"><a href="#cb30-16"></a>  <span class="fu">geom_label_repel</span>(</span>
<span id="cb30-17"><a href="#cb30-17"></a>    <span class="fu">aes</span>(<span class="at">label =</span> label), </span>
<span id="cb30-18"><a href="#cb30-18"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span>, </span>
<span id="cb30-19"><a href="#cb30-19"></a>    <span class="at">label.size =</span> <span class="dv">0</span>, </span>
<span id="cb30-20"><a href="#cb30-20"></a>    <span class="at">lineheight =</span> <span class="dv">1</span></span>
<span id="cb30-21"><a href="#cb30-21"></a>  ) <span class="sc">+</span></span>
<span id="cb30-22"><a href="#cb30-22"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb30-23"><a href="#cb30-23"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb30-24"><a href="#cb30-24"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-25"><a href="#cb30-25"></a>    <span class="at">title =</span> <span class="st">"Vehicle thefts in South African municipalities"</span>,</span>
<span id="cb30-26"><a href="#cb30-26"></a>    <span class="at">subtitle =</span> <span class="fu">str_glue</span>(</span>
<span id="cb30-27"><a href="#cb30-27"></a>      <span class="st">"each dot represents one municipality, 2018-19, dashed lines show "</span>,</span>
<span id="cb30-28"><a href="#cb30-28"></a>      <span class="st">"median values"</span></span>
<span id="cb30-29"><a href="#cb30-29"></a>    ),</span>
<span id="cb30-30"><a href="#cb30-30"></a>    <span class="at">x =</span> <span class="st">"rate of thefts of motor vehicles per 1,000 vehicle-owning households"</span>,</span>
<span id="cb30-31"><a href="#cb30-31"></a>    <span class="at">y =</span> <span class="st">"rate of thefts from motor vehicles per 1,000 vehicle-owning households"</span></span>
<span id="cb30-32"><a href="#cb30-32"></a>  ) <span class="sc">+</span></span>
<span id="cb30-33"><a href="#cb30-33"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/scatter-exercise5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From this chart, we can see which municipalities have particularly unusual vehicle theft rates. For example, we might well want to explore the rates of theft from vehicles in Beaufort West or Stellenbosch municipalities to see what makes them so different from the others, and similarly for the rate of theft of vehicles in Ethekwini.</p>
<p>One note of caution when using <code>geom_smooth()</code>: this function will show the <em>direction</em> of the relationship between two variables regardless of the <em>strength</em> of that relationship. In extreme cases, that could mean that a chart would show a trend line between two variables even if the variables had almost no relationship to one another.</p>
<p>For example, <code>geom_smooth()</code> produces a line showing the direction of the relationship between the two variables in each of these three charts, even though the relationship on the right is much stronger than the one on the left.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="fu">tibble</span>(</span>
<span id="cb31-2"><a href="#cb31-2"></a>  <span class="at">group =</span> <span class="fu">factor</span>(</span>
<span id="cb31-3"><a href="#cb31-3"></a>    <span class="fu">c</span>(<span class="st">"weak relationship"</span>, <span class="st">"moderate relationship"</span>, <span class="st">"strong relationship"</span>), </span>
<span id="cb31-4"><a href="#cb31-4"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"weak relationship"</span>, <span class="st">"moderate relationship"</span>, <span class="st">"strong relationship"</span>)</span>
<span id="cb31-5"><a href="#cb31-5"></a>  ),</span>
<span id="cb31-6"><a href="#cb31-6"></a>  <span class="at">x =</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb31-7"><a href="#cb31-7"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb31-8"><a href="#cb31-8"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-9"><a href="#cb31-9"></a>    <span class="at">sd =</span> <span class="fu">recode</span>(</span>
<span id="cb31-10"><a href="#cb31-10"></a>      group, </span>
<span id="cb31-11"><a href="#cb31-11"></a>      <span class="st">"weak relationship"</span> <span class="ot">=</span> <span class="dv">10</span>, </span>
<span id="cb31-12"><a href="#cb31-12"></a>      <span class="st">"moderate relationship"</span> <span class="ot">=</span> <span class="dv">4</span>, </span>
<span id="cb31-13"><a href="#cb31-13"></a>      <span class="st">"strong relationship"</span> <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb31-14"><a href="#cb31-14"></a>    )</span>
<span id="cb31-15"><a href="#cb31-15"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb31-16"><a href="#cb31-16"></a>  <span class="fu">group_by</span>(sd) <span class="sc">|&gt;</span> </span>
<span id="cb31-17"><a href="#cb31-17"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">list</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">sd =</span> sd))) <span class="sc">|&gt;</span> </span>
<span id="cb31-18"><a href="#cb31-18"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(x, y)) <span class="sc">|&gt;</span> </span>
<span id="cb31-19"><a href="#cb31-19"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(x <span class="sc">+</span> y, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb31-20"><a href="#cb31-20"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb31-21"><a href="#cb31-21"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">colour =</span> group)) <span class="sc">+</span> </span>
<span id="cb31-22"><a href="#cb31-22"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb31-23"><a href="#cb31-23"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb31-24"><a href="#cb31-24"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb31-25"><a href="#cb31-25"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb31-26"><a href="#cb31-26"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb31-27"><a href="#cb31-27"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb31-28"><a href="#cb31-28"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(group)) <span class="sc">+</span></span>
<span id="cb31-29"><a href="#cb31-29"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb31-30"><a href="#cb31-30"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-31"><a href="#cb31-31"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-32"><a href="#cb31-32"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-33"><a href="#cb31-33"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb31-34"><a href="#cb31-34"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/geom-smooth-relationships-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="box notewell">
<p>Be very careful about trying to interpret the strength of relationships between two variables by plotting them on a chart. It is much better to measure the strength of the relationship using a statistical test such as a correlation test, but statistical tests are outside the scope of this course.</p>
</div>
</section>
<section id="in-summary" class="level2" data-number="15.6">
<h2 data-number="15.6" class="anchored" data-anchor-id="in-summary"><span class="header-section-number">15.6</span> In summary</h2>
<div class="box welldone">
<p>In this tutorial we have learned how to present data about crime at places without using maps. These techniques give us more flexibility about how to best present data to communicate the main points that we want to get across.</p>
<p>Whether to use a map or a chart, and which type of map or chart to use, are design decisions for you to make. When you make these decisions, always remember that what is most important is that your audience understands your message. This makes it very important that you understand your audience.</p>
</div>
<p>Visualising data with charts is a very large topic and there are lots of resources available to help you learn more. To get started, you might want to look at:</p>
<ul>
<li><a href="https://uc-r.github.io/ggplot_intro">An Introduction to ggplot2</a> from the University of Cincinnati Business Analytics team.</li>
<li>The <a href="https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf">ggplot2 cheat sheet</a> by the team that develops the `ggplot2 package.</li>
<li>The <a href="https://www.r-graph-gallery.com/">R Graph Gallery</a> for examples of many other types of chart that you can produce in R.</li>
</ul>


<!-- -->

</section>

</main> <!-- /main -->
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../14_writing_reports/index.html" class="pagination-link" aria-label="Writing reports in R">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Writing reports in R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../16_mapping_time/index.html" class="pagination-link" aria-label="Mapping crime over time">
        <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Mapping crime over time</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb32" data-shortcodes="false" data-code-line-numbers=""><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu"># Presenting spatial data without maps</span></span>
<span id="cb32-2"><a href="#cb32-2"></a></span>
<span id="cb32-3"><a href="#cb32-3"></a></span>
<span id="cb32-4"><a href="#cb32-4"></a>**Learn how to use tables and charts to effectively communicate information about spatial data, and when these techniques might be more effective than using maps.**</span>
<span id="cb32-5"><a href="#cb32-5"></a></span>
<span id="cb32-6"><a href="#cb32-6"></a></span>
<span id="cb32-7"><a href="#cb32-7"></a>::: {.callout-important}</span>
<span id="cb32-8"><a href="#cb32-8"></a>This chapter has not yet been updated for 2025, so some material is out of date. Check back for an update in mid-February 2025.</span>
<span id="cb32-9"><a href="#cb32-9"></a>:::</span>
<span id="cb32-10"><a href="#cb32-10"></a></span>
<span id="cb32-11"><a href="#cb32-11"></a></span>
<span id="cb32-12"><a href="#cb32-12"></a><span class="in">```{r setup}</span></span>
<span id="cb32-13"><a href="#cb32-13"></a><span class="in">#| echo: false</span></span>
<span id="cb32-14"><a href="#cb32-14"></a><span class="in">#| include: false</span></span>
<span id="cb32-15"><a href="#cb32-15"></a></span>
<span id="cb32-16"><a href="#cb32-16"></a><span class="in">source(here::here("mask_learnr_functions.R"))</span></span>
<span id="cb32-17"><a href="#cb32-17"></a></span>
<span id="cb32-18"><a href="#cb32-18"></a><span class="in"># Load packages</span></span>
<span id="cb32-19"><a href="#cb32-19"></a><span class="in">library(ggrepel)</span></span>
<span id="cb32-20"><a href="#cb32-20"></a><span class="in">library(ggridges)</span></span>
<span id="cb32-21"><a href="#cb32-21"></a><span class="in">library(gt)</span></span>
<span id="cb32-22"><a href="#cb32-22"></a><span class="in">library(scales)</span></span>
<span id="cb32-23"><a href="#cb32-23"></a><span class="in">library(sf)</span></span>
<span id="cb32-24"><a href="#cb32-24"></a><span class="in">library(tidyverse)</span></span>
<span id="cb32-25"><a href="#cb32-25"></a></span>
<span id="cb32-26"><a href="#cb32-26"></a><span class="in"># Load data</span></span>
<span id="cb32-27"><a href="#cb32-27"></a><span class="in">burglary &lt;- read_rds("https://mpjashby.github.io/crimemappingdata/northants_burglary_counts.rds")</span></span>
<span id="cb32-28"><a href="#cb32-28"></a><span class="in">vehicle_theft &lt;- read_rds("https://mpjashby.github.io/crimemappingdata/south_africa_vehicle_theft.rds")</span></span>
<span id="cb32-29"><a href="#cb32-29"></a><span class="in">violence &lt;- read_rds("https://mpjashby.github.io/crimemappingdata/malaysia_violence_counts.rds") |&gt; </span></span>
<span id="cb32-30"><a href="#cb32-30"></a><span class="in">  filter(year == 2017)</span></span>
<span id="cb32-31"><a href="#cb32-31"></a></span>
<span id="cb32-32"><a href="#cb32-32"></a><span class="in">vehicle_theft_wider &lt;- vehicle_theft |&gt; </span></span>
<span id="cb32-33"><a href="#cb32-33"></a><span class="in">  mutate(</span></span>
<span id="cb32-34"><a href="#cb32-34"></a><span class="in">    crime_category = recode(</span></span>
<span id="cb32-35"><a href="#cb32-35"></a><span class="in">      crime_category,</span></span>
<span id="cb32-36"><a href="#cb32-36"></a><span class="in">      "Theft of motor vehicle" = "theft_of",</span></span>
<span id="cb32-37"><a href="#cb32-37"></a><span class="in">      "Theft out of or from motor vehicle" = "theft_from"</span></span>
<span id="cb32-38"><a href="#cb32-38"></a><span class="in">    )</span></span>
<span id="cb32-39"><a href="#cb32-39"></a><span class="in">  ) |&gt; </span></span>
<span id="cb32-40"><a href="#cb32-40"></a><span class="in">  pivot_wider(names_from = crime_category, values_from = theft_rate)</span></span>
<span id="cb32-41"><a href="#cb32-41"></a><span class="in">```</span></span>
<span id="cb32-42"><a href="#cb32-42"></a></span>
<span id="cb32-43"><a href="#cb32-43"></a></span>
<span id="cb32-44"><a href="#cb32-44"></a><span class="fu">## Introduction</span></span>
<span id="cb32-45"><a href="#cb32-45"></a></span>
<span id="cb32-46"><a href="#cb32-46"></a>Making maps is the core of analysing spatial data. But just because a particular</span>
<span id="cb32-47"><a href="#cb32-47"></a>dataset has a spatial element to it does not mean that a map is the best way to</span>
<span id="cb32-48"><a href="#cb32-48"></a>present that data. In this tutorial we will learn some other techniques for </span>
<span id="cb32-49"><a href="#cb32-49"></a>presenting data that can be more effective than maps for answering certain </span>
<span id="cb32-50"><a href="#cb32-50"></a>questions about spatial data. </span>
<span id="cb32-51"><a href="#cb32-51"></a></span>
<span id="cb32-52"><a href="#cb32-52"></a>As with so much in spatial analysis, whether it is best to make a map or use</span>
<span id="cb32-53"><a href="#cb32-53"></a>some other technique to convey information will depend on the circumstances. </span>
<span id="cb32-54"><a href="#cb32-54"></a>When you decide how to communicate information about the data you are analysing,</span>
<span id="cb32-55"><a href="#cb32-55"></a>you will need to consider the questions you are trying to answer, the audience</span>
<span id="cb32-56"><a href="#cb32-56"></a>that you are communicating to, what they will be using the information for and</span>
<span id="cb32-57"><a href="#cb32-57"></a>in what circumstances they will be using it.</span>
<span id="cb32-58"><a href="#cb32-58"></a></span>
<span id="cb32-59"><a href="#cb32-59"></a>While the best choice of how to communicate spatial information will depend on</span>
<span id="cb32-60"><a href="#cb32-60"></a>the circumstances, there are a few instances in which maps are typically *not*</span>
<span id="cb32-61"><a href="#cb32-61"></a>the best way to communicate your data. These are:</span>
<span id="cb32-62"><a href="#cb32-62"></a></span>
<span id="cb32-63"><a href="#cb32-63"></a></span>
<span id="cb32-64"><a href="#cb32-64"></a><span class="fu">#### When you only need to convey a handful of pieces of information</span></span>
<span id="cb32-65"><a href="#cb32-65"></a>  </span>
<span id="cb32-66"><a href="#cb32-66"></a>Maps are very effective for communicating detailed information, such as the</span>
<span id="cb32-67"><a href="#cb32-67"></a>density of crime across thousands of cells in a KDE grid. But to do this, maps</span>
<span id="cb32-68"><a href="#cb32-68"></a>typically encode information into aesthetics such as colour, size and so on.</span>
<span id="cb32-69"><a href="#cb32-69"></a>This is necessary for communicating large amounts of information, but it makes</span>
<span id="cb32-70"><a href="#cb32-70"></a>the connection between the data and the visual representation of the data less</span>
<span id="cb32-71"><a href="#cb32-71"></a>direct. If you only need to communicate a small amount of information, there is</span>
<span id="cb32-72"><a href="#cb32-72"></a>less justification for forcing your audience to mentally translate the aesthetic</span>
<span id="cb32-73"><a href="#cb32-73"></a>into whatever it represents. </span>
<span id="cb32-74"><a href="#cb32-74"></a></span>
<span id="cb32-75"><a href="#cb32-75"></a>For example, if you wanted to show the number of violent and sexual offences in</span>
<span id="cb32-76"><a href="#cb32-76"></a>each of the seven districts in Northamptonshire in England, a choropleth map is</span>
<span id="cb32-77"><a href="#cb32-77"></a>less clear than a bar chart (for example, in being able to decipher if there </span>
<span id="cb32-78"><a href="#cb32-78"></a>were more offences in Kettering or in Wellingborough). </span>
<span id="cb32-79"><a href="#cb32-79"></a></span>
<span id="cb32-80"><a href="#cb32-80"></a></span>
<span id="cb32-81"><a href="#cb32-81"></a><span class="in">```{r northants-district-maps, echo=FALSE, eval=FALSE}</span></span>
<span id="cb32-82"><a href="#cb32-82"></a><span class="in">library(patchwork)</span></span>
<span id="cb32-83"><a href="#cb32-83"></a></span>
<span id="cb32-84"><a href="#cb32-84"></a><span class="in"># Load crime data</span></span>
<span id="cb32-85"><a href="#cb32-85"></a><span class="in">data_dir &lt;- str_glue("{tempdir()}/crime_data")</span></span>
<span id="cb32-86"><a href="#cb32-86"></a><span class="in">unzip(</span></span>
<span id="cb32-87"><a href="#cb32-87"></a><span class="in">  zipfile = here::here("inst/tutorials/prep/code/northamptonshire_crimes_2020.zip"),</span></span>
<span id="cb32-88"><a href="#cb32-88"></a><span class="in">  exdir = data_dir</span></span>
<span id="cb32-89"><a href="#cb32-89"></a><span class="in">)</span></span>
<span id="cb32-90"><a href="#cb32-90"></a><span class="in">violence &lt;- data_dir %&gt;%</span></span>
<span id="cb32-91"><a href="#cb32-91"></a><span class="in">  dir(pattern = ".csv", full.names = TRUE, recursive = TRUE) %&gt;%</span></span>
<span id="cb32-92"><a href="#cb32-92"></a><span class="in">  map_dfr(read_csv) %&gt;%</span></span>
<span id="cb32-93"><a href="#cb32-93"></a><span class="in">  janitor::clean_names() %&gt;%</span></span>
<span id="cb32-94"><a href="#cb32-94"></a><span class="in">  filter(crime_type == "Violence and sexual offences") %&gt;%</span></span>
<span id="cb32-95"><a href="#cb32-95"></a><span class="in">  st_as_sf(coords = c("longitude", "latitude"), crs = 4326)</span></span>
<span id="cb32-96"><a href="#cb32-96"></a></span>
<span id="cb32-97"><a href="#cb32-97"></a><span class="in"># Load boundary data</span></span>
<span id="cb32-98"><a href="#cb32-98"></a><span class="in">districts &lt;- read_sf("https://opendata.arcgis.com/datasets/0e07a8196454415eab18c40a54dfbbef_0.geojson") %&gt;%</span></span>
<span id="cb32-99"><a href="#cb32-99"></a><span class="in">  janitor::clean_names() %&gt;%</span></span>
<span id="cb32-100"><a href="#cb32-100"></a><span class="in">  filter(lad19nm %in% c(</span></span>
<span id="cb32-101"><a href="#cb32-101"></a><span class="in">    "South Northamptonshire", "Northampton", "Daventry", "Wellingborough",</span></span>
<span id="cb32-102"><a href="#cb32-102"></a><span class="in">    "Kettering", "Corby", "East Northamptonshire"</span></span>
<span id="cb32-103"><a href="#cb32-103"></a><span class="in">  )) %&gt;%</span></span>
<span id="cb32-104"><a href="#cb32-104"></a><span class="in">  select(lad19nm, geometry)</span></span>
<span id="cb32-105"><a href="#cb32-105"></a></span>
<span id="cb32-106"><a href="#cb32-106"></a><span class="in"># Calculate violence counts at district level</span></span>
<span id="cb32-107"><a href="#cb32-107"></a><span class="in">violence_counts &lt;- violence %&gt;%</span></span>
<span id="cb32-108"><a href="#cb32-108"></a><span class="in">  st_join(districts) %&gt;%</span></span>
<span id="cb32-109"><a href="#cb32-109"></a><span class="in">  st_drop_geometry() %&gt;%</span></span>
<span id="cb32-110"><a href="#cb32-110"></a><span class="in">  count(lad19nm) %&gt;%</span></span>
<span id="cb32-111"><a href="#cb32-111"></a><span class="in">  drop_na() %&gt;%</span></span>
<span id="cb32-112"><a href="#cb32-112"></a><span class="in">  right_join(districts, by = "lad19nm") %&gt;%</span></span>
<span id="cb32-113"><a href="#cb32-113"></a><span class="in">  st_as_sf() %&gt;%</span></span>
<span id="cb32-114"><a href="#cb32-114"></a><span class="in">  mutate(hjust = if_else(n == max(n), 1, 0))</span></span>
<span id="cb32-115"><a href="#cb32-115"></a></span>
<span id="cb32-116"><a href="#cb32-116"></a><span class="in"># Download base map</span></span>
<span id="cb32-117"><a href="#cb32-117"></a><span class="in">base_map &lt;- violence_counts %&gt;%</span></span>
<span id="cb32-118"><a href="#cb32-118"></a><span class="in">  st_bbox() %&gt;%</span></span>
<span id="cb32-119"><a href="#cb32-119"></a><span class="in">  set_names(c("left", "bottom", "right", "top")) %&gt;%</span></span>
<span id="cb32-120"><a href="#cb32-120"></a><span class="in">  get_stamenmap(maptype = "toner-lines")</span></span>
<span id="cb32-121"><a href="#cb32-121"></a></span>
<span id="cb32-122"><a href="#cb32-122"></a><span class="in"># Create map</span></span>
<span id="cb32-123"><a href="#cb32-123"></a><span class="in">violence_map &lt;- ggmap(base_map) +</span></span>
<span id="cb32-124"><a href="#cb32-124"></a><span class="in">  geom_sf(aes(fill = n), data = violence_counts, inherit.aes = FALSE, alpha = 0.8) +</span></span>
<span id="cb32-125"><a href="#cb32-125"></a><span class="in">  geom_sf_label(</span></span>
<span id="cb32-126"><a href="#cb32-126"></a><span class="in">    aes(label = str_replace_all(lad19nm, "\\s", "\n")),</span></span>
<span id="cb32-127"><a href="#cb32-127"></a><span class="in">    data = violence_counts,</span></span>
<span id="cb32-128"><a href="#cb32-128"></a><span class="in">    inherit.aes = FALSE,</span></span>
<span id="cb32-129"><a href="#cb32-129"></a><span class="in">    alpha = 0.7,</span></span>
<span id="cb32-130"><a href="#cb32-130"></a><span class="in">    colour = "grey20",</span></span>
<span id="cb32-131"><a href="#cb32-131"></a><span class="in">    label.size = NA,</span></span>
<span id="cb32-132"><a href="#cb32-132"></a><span class="in">    lineheight = 0.9,</span></span>
<span id="cb32-133"><a href="#cb32-133"></a><span class="in">    size = 2.5</span></span>
<span id="cb32-134"><a href="#cb32-134"></a><span class="in">  ) +</span></span>
<span id="cb32-135"><a href="#cb32-135"></a><span class="in">  scale_fill_distiller(</span></span>
<span id="cb32-136"><a href="#cb32-136"></a><span class="in">    palette = "Oranges",</span></span>
<span id="cb32-137"><a href="#cb32-137"></a><span class="in">    labels = scales::comma_format(),</span></span>
<span id="cb32-138"><a href="#cb32-138"></a><span class="in">    limits = c(0, NA),</span></span>
<span id="cb32-139"><a href="#cb32-139"></a><span class="in">    direction = 1,</span></span>
<span id="cb32-140"><a href="#cb32-140"></a><span class="in">    guide = guide_colorbar(title.position = "top", barwidth = unit(0.25, "npc"))</span></span>
<span id="cb32-141"><a href="#cb32-141"></a><span class="in">  ) +</span></span>
<span id="cb32-142"><a href="#cb32-142"></a><span class="in">  labs(</span></span>
<span id="cb32-143"><a href="#cb32-143"></a><span class="in">    fill = "number of violent and sexual offences"</span></span>
<span id="cb32-144"><a href="#cb32-144"></a><span class="in">  ) +</span></span>
<span id="cb32-145"><a href="#cb32-145"></a><span class="in">  theme_void() +</span></span>
<span id="cb32-146"><a href="#cb32-146"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb32-147"><a href="#cb32-147"></a></span>
<span id="cb32-148"><a href="#cb32-148"></a><span class="in"># Create small reference map</span></span>
<span id="cb32-149"><a href="#cb32-149"></a><span class="in">reference_map &lt;- ggmap(base_map) +</span></span>
<span id="cb32-150"><a href="#cb32-150"></a><span class="in">  # Add a 50% white mask to reduce the visibility of the base map</span></span>
<span id="cb32-151"><a href="#cb32-151"></a><span class="in">  annotate(</span></span>
<span id="cb32-152"><a href="#cb32-152"></a><span class="in">    "rect",</span></span>
<span id="cb32-153"><a href="#cb32-153"></a><span class="in">    xmin = -Inf,</span></span>
<span id="cb32-154"><a href="#cb32-154"></a><span class="in">    xmax = Inf,</span></span>
<span id="cb32-155"><a href="#cb32-155"></a><span class="in">    ymin = -Inf,</span></span>
<span id="cb32-156"><a href="#cb32-156"></a><span class="in">    ymax = Inf,</span></span>
<span id="cb32-157"><a href="#cb32-157"></a><span class="in">    alpha = 0.5,</span></span>
<span id="cb32-158"><a href="#cb32-158"></a><span class="in">    fill = "white"</span></span>
<span id="cb32-159"><a href="#cb32-159"></a><span class="in">  ) +</span></span>
<span id="cb32-160"><a href="#cb32-160"></a><span class="in">  geom_sf(</span></span>
<span id="cb32-161"><a href="#cb32-161"></a><span class="in">    data = districts,</span></span>
<span id="cb32-162"><a href="#cb32-162"></a><span class="in">    inherit.aes = FALSE,</span></span>
<span id="cb32-163"><a href="#cb32-163"></a><span class="in">    alpha = 0.8,</span></span>
<span id="cb32-164"><a href="#cb32-164"></a><span class="in">    colour = "grey50",</span></span>
<span id="cb32-165"><a href="#cb32-165"></a><span class="in">    fill = NA</span></span>
<span id="cb32-166"><a href="#cb32-166"></a><span class="in">  ) +</span></span>
<span id="cb32-167"><a href="#cb32-167"></a><span class="in">  geom_sf_label(</span></span>
<span id="cb32-168"><a href="#cb32-168"></a><span class="in">    aes(label = str_replace_all(str_to_upper(lad19nm), "\\s", "\n")),</span></span>
<span id="cb32-169"><a href="#cb32-169"></a><span class="in">    data = violence_counts,</span></span>
<span id="cb32-170"><a href="#cb32-170"></a><span class="in">    inherit.aes = FALSE,</span></span>
<span id="cb32-171"><a href="#cb32-171"></a><span class="in">    alpha = 0.7,</span></span>
<span id="cb32-172"><a href="#cb32-172"></a><span class="in">    fontface = "bold",</span></span>
<span id="cb32-173"><a href="#cb32-173"></a><span class="in">    label.size = NA,</span></span>
<span id="cb32-174"><a href="#cb32-174"></a><span class="in">    lineheight = 0.9,</span></span>
<span id="cb32-175"><a href="#cb32-175"></a><span class="in">    size = 2</span></span>
<span id="cb32-176"><a href="#cb32-176"></a><span class="in">  ) +</span></span>
<span id="cb32-177"><a href="#cb32-177"></a><span class="in">  theme_void() +</span></span>
<span id="cb32-178"><a href="#cb32-178"></a><span class="in">  theme(</span></span>
<span id="cb32-179"><a href="#cb32-179"></a><span class="in">    legend.position = "none",</span></span>
<span id="cb32-180"><a href="#cb32-180"></a><span class="in">    panel.border = element_rect(colour = "grey50", fill = NA)</span></span>
<span id="cb32-181"><a href="#cb32-181"></a><span class="in">  )</span></span>
<span id="cb32-182"><a href="#cb32-182"></a></span>
<span id="cb32-183"><a href="#cb32-183"></a><span class="in"># Create bar chart</span></span>
<span id="cb32-184"><a href="#cb32-184"></a><span class="in">violence_chart &lt;- violence_counts %&gt;%</span></span>
<span id="cb32-185"><a href="#cb32-185"></a><span class="in">  mutate(lad19nm = fct_reorder(str_replace_all(lad19nm, "\\s", "\n"), n)) %&gt;%</span></span>
<span id="cb32-186"><a href="#cb32-186"></a><span class="in">  ggplot(aes(n, lad19nm)) +</span></span>
<span id="cb32-187"><a href="#cb32-187"></a><span class="in">  geom_col(fill = "orange3") +</span></span>
<span id="cb32-188"><a href="#cb32-188"></a><span class="in">  geom_label(</span></span>
<span id="cb32-189"><a href="#cb32-189"></a><span class="in">    aes(label = scales::comma(n), fill = as_factor(hjust), hjust = hjust),</span></span>
<span id="cb32-190"><a href="#cb32-190"></a><span class="in">    label.size = NA,</span></span>
<span id="cb32-191"><a href="#cb32-191"></a><span class="in">    size = 2.5</span></span>
<span id="cb32-192"><a href="#cb32-192"></a><span class="in">  ) +</span></span>
<span id="cb32-193"><a href="#cb32-193"></a><span class="in">  scale_x_continuous(labels = scales::comma_format(), expand = c(0, 0)) +</span></span>
<span id="cb32-194"><a href="#cb32-194"></a><span class="in">  scale_fill_manual(values = c(`1` = "orange3", `0` = "white")) +</span></span>
<span id="cb32-195"><a href="#cb32-195"></a><span class="in">  labs(</span></span>
<span id="cb32-196"><a href="#cb32-196"></a><span class="in">    x = "number of violent and sexual offences",</span></span>
<span id="cb32-197"><a href="#cb32-197"></a><span class="in">    y = NULL</span></span>
<span id="cb32-198"><a href="#cb32-198"></a><span class="in">  ) +</span></span>
<span id="cb32-199"><a href="#cb32-199"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb32-200"><a href="#cb32-200"></a><span class="in">  theme(</span></span>
<span id="cb32-201"><a href="#cb32-201"></a><span class="in">    legend.position = "none",</span></span>
<span id="cb32-202"><a href="#cb32-202"></a><span class="in">    panel.grid.major.y = element_blank(),</span></span>
<span id="cb32-203"><a href="#cb32-203"></a><span class="in">    panel.grid.minor.y = element_blank()</span></span>
<span id="cb32-204"><a href="#cb32-204"></a><span class="in">  )</span></span>
<span id="cb32-205"><a href="#cb32-205"></a></span>
<span id="cb32-206"><a href="#cb32-206"></a><span class="in"># Create violence map and chart combo</span></span>
<span id="cb32-207"><a href="#cb32-207"></a><span class="in">violence_combined &lt;- violence_map + violence_chart + plot_annotation(</span></span>
<span id="cb32-208"><a href="#cb32-208"></a><span class="in">  title = "Violent and sexual offences in Northamptonshire, 2020",</span></span>
<span id="cb32-209"><a href="#cb32-209"></a><span class="in">  caption = "Contains public sector information licensed under the Open Government Licence v3.0."</span></span>
<span id="cb32-210"><a href="#cb32-210"></a><span class="in">)</span></span>
<span id="cb32-211"><a href="#cb32-211"></a></span>
<span id="cb32-212"><a href="#cb32-212"></a><span class="in"># Save violence map and chart combo</span></span>
<span id="cb32-213"><a href="#cb32-213"></a><span class="in">ggsave(</span></span>
<span id="cb32-214"><a href="#cb32-214"></a><span class="in">  filename = here::here("inst/tutorials/15_no_maps/images/map_vs_bar_chart.png"),</span></span>
<span id="cb32-215"><a href="#cb32-215"></a><span class="in">  plot = violence_combined,</span></span>
<span id="cb32-216"><a href="#cb32-216"></a><span class="in">  width = 1200 / 150,</span></span>
<span id="cb32-217"><a href="#cb32-217"></a><span class="in">  height = 800 / 150,</span></span>
<span id="cb32-218"><a href="#cb32-218"></a><span class="in">  dpi = 300</span></span>
<span id="cb32-219"><a href="#cb32-219"></a><span class="in">)</span></span>
<span id="cb32-220"><a href="#cb32-220"></a></span>
<span id="cb32-221"><a href="#cb32-221"></a><span class="in"># Create chart with reference map</span></span>
<span id="cb32-222"><a href="#cb32-222"></a><span class="in">chart_reference &lt;-</span></span>
<span id="cb32-223"><a href="#cb32-223"></a><span class="in">  # reference_map +</span></span>
<span id="cb32-224"><a href="#cb32-224"></a><span class="in">  violence_chart +</span></span>
<span id="cb32-225"><a href="#cb32-225"></a><span class="in">  inset_element(</span></span>
<span id="cb32-226"><a href="#cb32-226"></a><span class="in">    reference_map,</span></span>
<span id="cb32-227"><a href="#cb32-227"></a><span class="in">    top = 0.7,</span></span>
<span id="cb32-228"><a href="#cb32-228"></a><span class="in">    right = unit(1, "npc"),</span></span>
<span id="cb32-229"><a href="#cb32-229"></a><span class="in">    bottom = 0,</span></span>
<span id="cb32-230"><a href="#cb32-230"></a><span class="in">    left = 0.5</span></span>
<span id="cb32-231"><a href="#cb32-231"></a><span class="in">  ) +</span></span>
<span id="cb32-232"><a href="#cb32-232"></a><span class="in">  # plot_layout(widths = c(1, 2)) +</span></span>
<span id="cb32-233"><a href="#cb32-233"></a><span class="in">  plot_annotation(</span></span>
<span id="cb32-234"><a href="#cb32-234"></a><span class="in">    title = "Violent and sexual offences in Northamptonshire, 2020",</span></span>
<span id="cb32-235"><a href="#cb32-235"></a><span class="in">    caption = "Contains public sector information licensed under the Open Government Licence v3.0."</span></span>
<span id="cb32-236"><a href="#cb32-236"></a><span class="in">  )</span></span>
<span id="cb32-237"><a href="#cb32-237"></a></span>
<span id="cb32-238"><a href="#cb32-238"></a><span class="in"># Save chart with reference map</span></span>
<span id="cb32-239"><a href="#cb32-239"></a><span class="in">ggsave(</span></span>
<span id="cb32-240"><a href="#cb32-240"></a><span class="in">  filename = here::here("inst/tutorials/15_no_maps/images/bar_chart_ref_map.png"),</span></span>
<span id="cb32-241"><a href="#cb32-241"></a><span class="in">  plot = chart_reference,</span></span>
<span id="cb32-242"><a href="#cb32-242"></a><span class="in">  width = 1200 / 150,</span></span>
<span id="cb32-243"><a href="#cb32-243"></a><span class="in">  height = 800 / 150,</span></span>
<span id="cb32-244"><a href="#cb32-244"></a><span class="in">  dpi = 300</span></span>
<span id="cb32-245"><a href="#cb32-245"></a><span class="in">)</span></span>
<span id="cb32-246"><a href="#cb32-246"></a><span class="in">```</span></span>
<span id="cb32-247"><a href="#cb32-247"></a></span>
<span id="cb32-248"><a href="#cb32-248"></a></span>
<span id="cb32-249"><a href="#cb32-249"></a>&lt;p class="full-width-image"&gt;&lt;img src="images/map_vs_bar_chart.png" alt="Choropleth map and bar chart both showing the frequency of violence in each district in Northamptonshire in 2020"&gt;&lt;/p&gt;</span>
<span id="cb32-250"><a href="#cb32-250"></a></span>
<span id="cb32-251"><a href="#cb32-251"></a>A map might be a useful addition to the bar chart in this case *if* you are</span>
<span id="cb32-252"><a href="#cb32-252"></a>trying to communicate information to people who are not familiar with the</span>
<span id="cb32-253"><a href="#cb32-253"></a>locations of the districts. In that case, we might want to add a small reference</span>
<span id="cb32-254"><a href="#cb32-254"></a>map to help people understand which area is which:</span>
<span id="cb32-255"><a href="#cb32-255"></a></span>
<span id="cb32-256"><a href="#cb32-256"></a>&lt;p class="full-width-image"&gt;&lt;img src="images/bar_chart_ref_map.png" alt="Bar chart showing the frequency of violence in each district in Northamptonshire in 2020, with a reference map showing the area covered by each district"&gt;&lt;/p&gt;</span>
<span id="cb32-257"><a href="#cb32-257"></a></span>
<span id="cb32-258"><a href="#cb32-258"></a>But in most circumstances in which you create crime maps, you will be creating</span>
<span id="cb32-259"><a href="#cb32-259"></a>them for an audience (such as local police officers) that already has sufficient </span>
<span id="cb32-260"><a href="#cb32-260"></a>knowledge of the area and so an inset map such as this would not be needed. In</span>
<span id="cb32-261"><a href="#cb32-261"></a>that case, a bar chart will probably be more effective at showing this </span>
<span id="cb32-262"><a href="#cb32-262"></a>information than a map would be.</span>
<span id="cb32-263"><a href="#cb32-263"></a></span>
<span id="cb32-264"><a href="#cb32-264"></a></span>
<span id="cb32-265"><a href="#cb32-265"></a><span class="fu">#### When you need to convey several different things about one place</span></span>
<span id="cb32-266"><a href="#cb32-266"></a>  </span>
<span id="cb32-267"><a href="#cb32-267"></a>Maps are generally most effective when they show a single piece of data about</span>
<span id="cb32-268"><a href="#cb32-268"></a>each place. For example, a choropleth map shows a single shade of colour for</span>
<span id="cb32-269"><a href="#cb32-269"></a>each area on the map to represent a single value, such as the frequency of crime</span>
<span id="cb32-270"><a href="#cb32-270"></a>in that area. If you wanted to show the frequency of burglary *and* the</span>
<span id="cb32-271"><a href="#cb32-271"></a>frequency of robbery in the same area on a map, this would be quite hard. So if</span>
<span id="cb32-272"><a href="#cb32-272"></a>you need to convey multiple different things about each place, it is generally</span>
<span id="cb32-273"><a href="#cb32-273"></a>best to do this in a table or chart, rather than a map. </span>
<span id="cb32-274"><a href="#cb32-274"></a></span>
<span id="cb32-275"><a href="#cb32-275"></a>One exception to this is when you present multiple maps side by side, each </span>
<span id="cb32-276"><a href="#cb32-276"></a>showing a single thing about an area. These are called *small multiple* maps and</span>
<span id="cb32-277"><a href="#cb32-277"></a>we will learn about them in a future tutorial.</span>
<span id="cb32-278"><a href="#cb32-278"></a></span>
<span id="cb32-279"><a href="#cb32-279"></a></span>
<span id="cb32-280"><a href="#cb32-280"></a><span class="fu">#### When the geographic relationship between places on the map is not the most important thing about them</span></span>
<span id="cb32-281"><a href="#cb32-281"></a></span>
<span id="cb32-282"><a href="#cb32-282"></a>Maps emphasise the spatial relationship between different places, but they do</span>
<span id="cb32-283"><a href="#cb32-283"></a>this at the expense of making non-spatial relationships between those places</span>
<span id="cb32-284"><a href="#cb32-284"></a>less obvious. If the spatial relationships are the most important thing that you</span>
<span id="cb32-285"><a href="#cb32-285"></a>want to convey, a map makes sense. For example, a hotspot map is often a very </span>
<span id="cb32-286"><a href="#cb32-286"></a>good way to communicate where crime is most concentrated. But in other cases the</span>
<span id="cb32-287"><a href="#cb32-287"></a>geographic relationships between variables will be much less important. For </span>
<span id="cb32-288"><a href="#cb32-288"></a>example, if you wanted to show the relationship between the amount of crime in</span>
<span id="cb32-289"><a href="#cb32-289"></a>an area and the level of poverty there, a scatter plot would probably be a </span>
<span id="cb32-290"><a href="#cb32-290"></a>more-effective way to do this than a map would be.</span>
<span id="cb32-291"><a href="#cb32-291"></a></span>
<span id="cb32-292"><a href="#cb32-292"></a></span>
<span id="cb32-293"><a href="#cb32-293"></a></span>
<span id="cb32-294"><a href="#cb32-294"></a><span class="fu">## Tables</span></span>
<span id="cb32-295"><a href="#cb32-295"></a></span>
<span id="cb32-296"><a href="#cb32-296"></a>Well-designed tables can be a very effective way of communicating information,</span>
<span id="cb32-297"><a href="#cb32-297"></a>whereas badly-design tables can be confusing and even lead your audience to</span>
<span id="cb32-298"><a href="#cb32-298"></a>give up trying to engage with the information you're trying to communicate. </span>
<span id="cb32-299"><a href="#cb32-299"></a></span>
<span id="cb32-300"><a href="#cb32-300"></a>Tables used to present information almost always show only a summary of the </span>
<span id="cb32-301"><a href="#cb32-301"></a>available data, so the first step in preparing a table is to wrangle the data</span>
<span id="cb32-302"><a href="#cb32-302"></a>into the right format. In a previous tutorial we learned about the <span class="in">`summarise()`</span></span>
<span id="cb32-303"><a href="#cb32-303"></a>function from the <span class="in">`dplyr`</span> package that we can use to produce summaries of rows</span>
<span id="cb32-304"><a href="#cb32-304"></a>of data.</span>
<span id="cb32-305"><a href="#cb32-305"></a></span>
<span id="cb32-306"><a href="#cb32-306"></a>To learn about creating a good table for displaying summary data in a report, we</span>
<span id="cb32-307"><a href="#cb32-307"></a>will use the example of the frequency of different types of violence in the </span>
<span id="cb32-308"><a href="#cb32-308"></a>different states of Malaysia in 2017. This data is already loaded in an object</span>
<span id="cb32-309"><a href="#cb32-309"></a>called <span class="in">`violence`</span>. We can get a feel for the data by looking at a random sample </span>
<span id="cb32-310"><a href="#cb32-310"></a>of rows using the <span class="in">`slice_sample()`</span> function function from the <span class="in">`dplyr`</span> package</span>
<span id="cb32-311"><a href="#cb32-311"></a>(remember <span class="in">`dplyr`</span> is loaded automatically by <span class="in">`tidyverse`</span>).</span>
<span id="cb32-312"><a href="#cb32-312"></a></span>
<span id="cb32-313"><a href="#cb32-313"></a><span class="in">```{r tables-exercise1, exercise=TRUE}</span></span>
<span id="cb32-314"><a href="#cb32-314"></a><span class="in">library(tidyverse)</span></span>
<span id="cb32-315"><a href="#cb32-315"></a></span>
<span id="cb32-316"><a href="#cb32-316"></a><span class="in">slice_sample(violence, n = 10)</span></span>
<span id="cb32-317"><a href="#cb32-317"></a><span class="in">```</span></span>
<span id="cb32-318"><a href="#cb32-318"></a></span>
<span id="cb32-319"><a href="#cb32-319"></a>The output of <span class="in">`slice_sample()`</span> looks acceptable as a table, especially if it is </span>
<span id="cb32-320"><a href="#cb32-320"></a>included in a Quarto document, but readers of our reports probably don't want </span>
<span id="cb32-321"><a href="#cb32-321"></a>to know the type of each variable (underneath the variable names) and won't</span>
<span id="cb32-322"><a href="#cb32-322"></a>want to page through the table if there are more rows or columns than can fit in</span>
<span id="cb32-323"><a href="#cb32-323"></a>the available space.</span>
<span id="cb32-324"><a href="#cb32-324"></a></span>
<span id="cb32-325"><a href="#cb32-325"></a></span>
<span id="cb32-326"><a href="#cb32-326"></a><span class="fu">### Making data wider for presentation</span></span>
<span id="cb32-327"><a href="#cb32-327"></a></span>
<span id="cb32-328"><a href="#cb32-328"></a>One issue with printing the <span class="in">`violence`</span> object as a table is that it has </span>
<span id="cb32-329"><a href="#cb32-329"></a><span class="in">`r scales::comma(nrow(violence))`</span> rows, so it will take up a lot of space on a</span>
<span id="cb32-330"><a href="#cb32-330"></a>page or screen. We can make the data more compact by converting it from long</span>
<span id="cb32-331"><a href="#cb32-331"></a>format to wide format. In the previous tutorial on tidying messy data we learned</span>
<span id="cb32-332"><a href="#cb32-332"></a>that data are often easier to analyse in long format. But it is often better to</span>
<span id="cb32-333"><a href="#cb32-333"></a>_present_ data in a table in wide format.</span>
<span id="cb32-334"><a href="#cb32-334"></a></span>
<span id="cb32-335"><a href="#cb32-335"></a>To convert the table to a wider format we can use the <span class="in">`pivot_wider()`</span> function</span>
<span id="cb32-336"><a href="#cb32-336"></a>from the <span class="in">`tidyr`</span> package, just was we used the corresponding <span class="in">`pivot_longer()`</span> </span>
<span id="cb32-337"><a href="#cb32-337"></a>function to tidy data in the messy-data tutorial. To make data wider, we specify</span>
<span id="cb32-338"><a href="#cb32-338"></a>a single column in the data to use as the names of multiple new columns using </span>
<span id="cb32-339"><a href="#cb32-339"></a>the <span class="in">`names_from`</span> argument and a column to use as the values for the new columns</span>
<span id="cb32-340"><a href="#cb32-340"></a>using the <span class="in">`values_from`</span> argument.</span>
<span id="cb32-341"><a href="#cb32-341"></a></span>
<span id="cb32-342"><a href="#cb32-342"></a><span class="in">```{r tables-exercise2, exercise=TRUE}</span></span>
<span id="cb32-343"><a href="#cb32-343"></a><span class="in">pivot_wider(violence, names_from = crime_type, values_from = count)</span></span>
<span id="cb32-344"><a href="#cb32-344"></a><span class="in">```</span></span>
<span id="cb32-345"><a href="#cb32-345"></a></span>
<span id="cb32-346"><a href="#cb32-346"></a>Now the table has only </span>
<span id="cb32-347"><a href="#cb32-347"></a><span class="in">`r nrow(pivot_wider(violence, names_from = crime_type, values_from = count))`</span></span>
<span id="cb32-348"><a href="#cb32-348"></a>rows, which makes it much easier to present both on screen and in print. We can</span>
<span id="cb32-349"><a href="#cb32-349"></a>also see that the <span class="in">`year`</span> column is *constant* (all the values are the same), so</span>
<span id="cb32-350"><a href="#cb32-350"></a>we can remove this using the <span class="in">`select()`</span> function from <span class="in">`dplyr`</span>. We can also </span>
<span id="cb32-351"><a href="#cb32-351"></a>use <span class="in">`select()`</span> to change the order of the columns from left to right so that the</span>
<span id="cb32-352"><a href="#cb32-352"></a>two types of robbery appear next to each other.</span>
<span id="cb32-353"><a href="#cb32-353"></a></span>
<span id="cb32-354"><a href="#cb32-354"></a></span>
<span id="cb32-355"><a href="#cb32-355"></a><span class="in">```{r tables-exercise2a, exercise=TRUE}</span></span>
<span id="cb32-356"><a href="#cb32-356"></a><span class="in">violence |&gt; </span></span>
<span id="cb32-357"><a href="#cb32-357"></a><span class="in">  pivot_wider(names_from = crime_type, values_from = count) |&gt; </span></span>
<span id="cb32-358"><a href="#cb32-358"></a><span class="in">  select(</span></span>
<span id="cb32-359"><a href="#cb32-359"></a><span class="in">    region, state, murder, rape, `aggravated assault`, `armed robbery`, </span></span>
<span id="cb32-360"><a href="#cb32-360"></a><span class="in">    `unarmed robbery`</span></span>
<span id="cb32-361"><a href="#cb32-361"></a><span class="in">  )</span></span>
<span id="cb32-362"><a href="#cb32-362"></a><span class="in">```</span></span>
<span id="cb32-363"><a href="#cb32-363"></a></span>
<span id="cb32-364"><a href="#cb32-364"></a></span>
<span id="cb32-365"><a href="#cb32-365"></a><span class="fu">### Using the `gt` package to make better tables</span></span>
<span id="cb32-366"><a href="#cb32-366"></a></span>
<span id="cb32-367"><a href="#cb32-367"></a>&lt;a href="https://gt.rstudio.com/"&gt;&lt;img src="images/gt.png" alt="gt package hex sticker" class="right-side-image"&gt;&lt;/a&gt;</span>
<span id="cb32-368"><a href="#cb32-368"></a></span>
<span id="cb32-369"><a href="#cb32-369"></a>We can create much better display tables with the <span class="co">[</span><span class="ot">`gt` package</span><span class="co">](https://gt.rstudio.com/)</span>,</span>
<span id="cb32-370"><a href="#cb32-370"></a>which is designed to format data for display. The <span class="in">`gt`</span> package works in a </span>
<span id="cb32-371"><a href="#cb32-371"></a>similar way to the <span class="in">`ggplot2`</span> package, in that tables are made up of stacks of</span>
<span id="cb32-372"><a href="#cb32-372"></a>functions that contribute to the appearance of the final table. One difference</span>
<span id="cb32-373"><a href="#cb32-373"></a>is that the layers in a <span class="in">`gt`</span> stack are joined using the pipe operator (<span class="in">`|&gt;`</span>)</span>
<span id="cb32-374"><a href="#cb32-374"></a>rather than the plus operator (<span class="in">`+`</span>).</span>
<span id="cb32-375"><a href="#cb32-375"></a></span>
<span id="cb32-376"><a href="#cb32-376"></a>We can create a very basic <span class="in">`gt`</span> table by just passing a data frame or tibble to</span>
<span id="cb32-377"><a href="#cb32-377"></a>the <span class="in">`gt()`</span> function. So we can add <span class="in">`gt()`</span> to the end of the pipeline of </span>
<span id="cb32-378"><a href="#cb32-378"></a>functions we have already started to build to create a good display table.</span>
<span id="cb32-379"><a href="#cb32-379"></a></span>
<span id="cb32-380"><a href="#cb32-380"></a><span class="in">```{r tables-exercise3, exercise=TRUE}</span></span>
<span id="cb32-381"><a href="#cb32-381"></a><span class="in">violence |&gt; </span></span>
<span id="cb32-382"><a href="#cb32-382"></a><span class="in">  pivot_wider(names_from = crime_type, values_from = count) |&gt; </span></span>
<span id="cb32-383"><a href="#cb32-383"></a><span class="in">  select(</span></span>
<span id="cb32-384"><a href="#cb32-384"></a><span class="in">    region, state, murder, rape, `aggravated assault`, `armed robbery`, </span></span>
<span id="cb32-385"><a href="#cb32-385"></a><span class="in">    `unarmed robbery`</span></span>
<span id="cb32-386"><a href="#cb32-386"></a><span class="in">  ) |&gt; </span></span>
<span id="cb32-387"><a href="#cb32-387"></a><span class="in">  gt()</span></span>
<span id="cb32-388"><a href="#cb32-388"></a><span class="in">```</span></span>
<span id="cb32-389"><a href="#cb32-389"></a></span>
<span id="cb32-390"><a href="#cb32-390"></a>This table is already better than the default table produced by Quarto if we</span>
<span id="cb32-391"><a href="#cb32-391"></a>just print a data frame or tibble. The <span class="in">`gt`</span> table does not take up the whole</span>
<span id="cb32-392"><a href="#cb32-392"></a>width of the page unnecessarily (which can make it harder to read across rows)</span>
<span id="cb32-393"><a href="#cb32-393"></a>and has hidden the type of each column.</span>
<span id="cb32-394"><a href="#cb32-394"></a></span>
<span id="cb32-395"><a href="#cb32-395"></a>Note that in the code above, some of the variable names are surrounded by </span>
<span id="cb32-396"><a href="#cb32-396"></a>back ticks (<span class="in">`` ` ``</span>). There are spaces in these variable names, so we use back</span>
<span id="cb32-397"><a href="#cb32-397"></a>ticks to stop R from interpreting the first space as the end of the variable</span>
<span id="cb32-398"><a href="#cb32-398"></a>name.</span>
<span id="cb32-399"><a href="#cb32-399"></a></span>
<span id="cb32-400"><a href="#cb32-400"></a>We can add more functions to the <span class="in">`gt()`</span> stack to adjust the appearance of the</span>
<span id="cb32-401"><a href="#cb32-401"></a>table. For example, we can format the numeric columns as numbers using the </span>
<span id="cb32-402"><a href="#cb32-402"></a><span class="in">`fmt_number()`</span> function. This adds thousand separators (in British English, </span>
<span id="cb32-403"><a href="#cb32-403"></a>commas) to make it easier to read the large numeric values and can make various</span>
<span id="cb32-404"><a href="#cb32-404"></a>other changes such as adding a prefix or suffix to numbers (useful for showing</span>
<span id="cb32-405"><a href="#cb32-405"></a>units), scaling numbers (useful for very large numbers) or automatically </span>
<span id="cb32-406"><a href="#cb32-406"></a>formatting numbers according to the conventions of the language your computer is</span>
<span id="cb32-407"><a href="#cb32-407"></a>set to use (referred to in R help pages as the *locale* of your computer).</span>
<span id="cb32-408"><a href="#cb32-408"></a></span>
<span id="cb32-409"><a href="#cb32-409"></a>We choose which columns <span class="in">`fmt_number()`</span> should format using the <span class="in">`columns`</span></span>
<span id="cb32-410"><a href="#cb32-410"></a>argument. In this case, we want to format all the numeric columns in the data,</span>
<span id="cb32-411"><a href="#cb32-411"></a>so we will set <span class="in">`columns = where(is.numeric)`</span>.</span>
<span id="cb32-412"><a href="#cb32-412"></a></span>
<span id="cb32-413"><a href="#cb32-413"></a>We don't want the numbers in the table to have any decimal places (since the</span>
<span id="cb32-414"><a href="#cb32-414"></a>crime counts are all whole numbers), so we also set <span class="in">`decimals = 0`</span>. We can use</span>
<span id="cb32-415"><a href="#cb32-415"></a>the default values of all the other arguments to <span class="in">`fmt_number()`</span> -- type</span>
<span id="cb32-416"><a href="#cb32-416"></a><span class="in">`?gt::fmt_number`</span> in the R console to find out more about the different options</span>
<span id="cb32-417"><a href="#cb32-417"></a>available on the help page for the <span class="in">`fmt_number()`</span> function.</span>
<span id="cb32-418"><a href="#cb32-418"></a></span>
<span id="cb32-419"><a href="#cb32-419"></a><span class="in">```{r tables-exercise4, exercise=TRUE}</span></span>
<span id="cb32-420"><a href="#cb32-420"></a><span class="in">violence |&gt; </span></span>
<span id="cb32-421"><a href="#cb32-421"></a><span class="in">  pivot_wider(names_from = crime_type, values_from = count) |&gt; </span></span>
<span id="cb32-422"><a href="#cb32-422"></a><span class="in">  select(</span></span>
<span id="cb32-423"><a href="#cb32-423"></a><span class="in">    region, state, murder, rape, `aggravated assault`, `armed robbery`, </span></span>
<span id="cb32-424"><a href="#cb32-424"></a><span class="in">    `unarmed robbery`</span></span>
<span id="cb32-425"><a href="#cb32-425"></a><span class="in">  ) |&gt; </span></span>
<span id="cb32-426"><a href="#cb32-426"></a><span class="in">  gt() |&gt; </span></span>
<span id="cb32-427"><a href="#cb32-427"></a><span class="in">  fmt_number(columns = where(is.numeric), decimals = 0)</span></span>
<span id="cb32-428"><a href="#cb32-428"></a><span class="in">```</span></span>
<span id="cb32-429"><a href="#cb32-429"></a></span>
<span id="cb32-430"><a href="#cb32-430"></a><span class="in">`fmt_number()`</span> is one of several formatting functions available in <span class="in">`gt`</span>. For</span>
<span id="cb32-431"><a href="#cb32-431"></a>example, we could use <span class="in">`fmt_currency()`</span> to format columns according to the </span>
<span id="cb32-432"><a href="#cb32-432"></a>conventions for currency values, <span class="in">`fmt_date()`</span> for dates or <span class="in">`fmt_percent()`</span> for</span>
<span id="cb32-433"><a href="#cb32-433"></a>percentages.</span>
<span id="cb32-434"><a href="#cb32-434"></a></span>
<span id="cb32-435"><a href="#cb32-435"></a>The <span class="in">`region`</span> column only has two values: <span class="in">`West Malaysia`</span> for states and </span>
<span id="cb32-436"><a href="#cb32-436"></a>territories in Peninsular Malaysia and <span class="in">`East Malaysia`</span> for states on the island</span>
<span id="cb32-437"><a href="#cb32-437"></a>of Borneo. Rather than repeat these two values on every row of the table -- </span>
<span id="cb32-438"><a href="#cb32-438"></a>which is a waste of space and makes the table more cluttered than necessary -- </span>
<span id="cb32-439"><a href="#cb32-439"></a>we can instead group the rows according to these two regions and then only show</span>
<span id="cb32-440"><a href="#cb32-440"></a>the region names once at the top of each group.</span>
<span id="cb32-441"><a href="#cb32-441"></a></span>
<span id="cb32-442"><a href="#cb32-442"></a><span class="in">`gt()`</span> will automatically create group headings in a table if the data frame or</span>
<span id="cb32-443"><a href="#cb32-443"></a>tibble passed to <span class="in">`gt()`</span> contains groups created by the <span class="in">`group_by()`</span> function </span>
<span id="cb32-444"><a href="#cb32-444"></a>from the <span class="in">`dplyr`</span> package. All we have to do is use <span class="in">`group_by()`</span> to specify </span>
<span id="cb32-445"><a href="#cb32-445"></a>which column (in this case, <span class="in">`region`</span>) contains the values that we should use to</span>
<span id="cb32-446"><a href="#cb32-446"></a>determine which group each row is in.</span>
<span id="cb32-447"><a href="#cb32-447"></a></span>
<span id="cb32-448"><a href="#cb32-448"></a><span class="in">```{r tables-exercise5, exercise=TRUE}</span></span>
<span id="cb32-449"><a href="#cb32-449"></a><span class="in">violence |&gt; </span></span>
<span id="cb32-450"><a href="#cb32-450"></a><span class="in">  pivot_wider(names_from = crime_type, values_from = count) |&gt; </span></span>
<span id="cb32-451"><a href="#cb32-451"></a><span class="in">  select(</span></span>
<span id="cb32-452"><a href="#cb32-452"></a><span class="in">    region, state, murder, rape, `aggravated assault`, `armed robbery`, </span></span>
<span id="cb32-453"><a href="#cb32-453"></a><span class="in">    `unarmed robbery`</span></span>
<span id="cb32-454"><a href="#cb32-454"></a><span class="in">  ) |&gt; </span></span>
<span id="cb32-455"><a href="#cb32-455"></a><span class="in">  group_by(region) |&gt; </span></span>
<span id="cb32-456"><a href="#cb32-456"></a><span class="in">  # Functions from `dplyr`, `tidyr` etc above and functions from `gt` below</span></span>
<span id="cb32-457"><a href="#cb32-457"></a><span class="in">  gt() |&gt; </span></span>
<span id="cb32-458"><a href="#cb32-458"></a><span class="in">  fmt_number(columns = where(is.numeric), decimals = 0)</span></span>
<span id="cb32-459"><a href="#cb32-459"></a><span class="in">```</span></span>
<span id="cb32-460"><a href="#cb32-460"></a></span>
<span id="cb32-461"><a href="#cb32-461"></a>In tables containing lots of numbers it can be difficult to see patterns. One </span>
<span id="cb32-462"><a href="#cb32-462"></a>way to help readers to understand patterns is to map the numbers to an aesthetic</span>
<span id="cb32-463"><a href="#cb32-463"></a>property such as colour that people can easily see patterns in. To do this, we</span>
<span id="cb32-464"><a href="#cb32-464"></a>can colour the cells in a column according to the value of each cell using the </span>
<span id="cb32-465"><a href="#cb32-465"></a><span class="in">`data_color()`</span> function (note the spelling of 'color' in this function). To use </span>
<span id="cb32-466"><a href="#cb32-466"></a><span class="in">`data_color()`</span>, we specify the columns we want to shade using the <span class="in">`columns`</span> </span>
<span id="cb32-467"><a href="#cb32-467"></a>argument and the colour palette we want to use using the <span class="in">`palette`</span> argument. </span>
<span id="cb32-468"><a href="#cb32-468"></a></span>
<span id="cb32-469"><a href="#cb32-469"></a>In this example, we will only colour the values in two columns, so we will pass</span>
<span id="cb32-470"><a href="#cb32-470"></a>the column names (enclosed in <span class="in">`` ` ``</span>back ticks<span class="in">`` ` ``</span> if they contain a space) </span>
<span id="cb32-471"><a href="#cb32-471"></a>to the <span class="in">`columns`</span> argument.</span>
<span id="cb32-472"><a href="#cb32-472"></a></span>
<span id="cb32-473"><a href="#cb32-473"></a>The easiest way to specify a colour palette is to use one of the built-in colour</span>
<span id="cb32-474"><a href="#cb32-474"></a>palettes that the <span class="in">`gt`</span> package understands automatically. These use the same</span>
<span id="cb32-475"><a href="#cb32-475"></a>colour palette names we have used in previous tutorials when making use of </span>
<span id="cb32-476"><a href="#cb32-476"></a>functions such as <span class="in">`scale_fill_distiller()`</span>.</span>
<span id="cb32-477"><a href="#cb32-477"></a></span>
<span id="cb32-478"><a href="#cb32-478"></a><span class="in">```{r tables-exercise7, exercise=TRUE, exercise.lines=17}</span></span>
<span id="cb32-479"><a href="#cb32-479"></a><span class="in">library(scales)</span></span>
<span id="cb32-480"><a href="#cb32-480"></a></span>
<span id="cb32-481"><a href="#cb32-481"></a><span class="in">violence |&gt; </span></span>
<span id="cb32-482"><a href="#cb32-482"></a><span class="in">  pivot_wider(names_from = crime_type, values_from = count) |&gt; </span></span>
<span id="cb32-483"><a href="#cb32-483"></a><span class="in">  select(</span></span>
<span id="cb32-484"><a href="#cb32-484"></a><span class="in">    region, state, murder, rape, `aggravated assault`, `armed robbery`, </span></span>
<span id="cb32-485"><a href="#cb32-485"></a><span class="in">    `unarmed robbery`</span></span>
<span id="cb32-486"><a href="#cb32-486"></a><span class="in">  ) |&gt; </span></span>
<span id="cb32-487"><a href="#cb32-487"></a><span class="in">  group_by(region) |&gt; </span></span>
<span id="cb32-488"><a href="#cb32-488"></a><span class="in">  # Functions from `dplyr`, `tidyr` etc above and functions from `gt` below</span></span>
<span id="cb32-489"><a href="#cb32-489"></a><span class="in">  gt() |&gt; </span></span>
<span id="cb32-490"><a href="#cb32-490"></a><span class="in">  fmt_number(columns = where(is.numeric), decimals = 0) |&gt; </span></span>
<span id="cb32-491"><a href="#cb32-491"></a><span class="in">  data_color(columns = `unarmed robbery`, palette = "Oranges") |&gt; </span></span>
<span id="cb32-492"><a href="#cb32-492"></a><span class="in">  data_color(columns = rape, palette = "Blues")</span></span>
<span id="cb32-493"><a href="#cb32-493"></a><span class="in">```</span></span>
<span id="cb32-494"><a href="#cb32-494"></a></span>
<span id="cb32-495"><a href="#cb32-495"></a></span>
<span id="cb32-496"><a href="#cb32-496"></a>::: {.box .notewell}</span>
<span id="cb32-497"><a href="#cb32-497"></a></span>
<span id="cb32-498"><a href="#cb32-498"></a>In this table we use two different colours to show the patterns in the frequency</span>
<span id="cb32-499"><a href="#cb32-499"></a>of murder and unarmed robbery. This is because we want readers to remember that</span>
<span id="cb32-500"><a href="#cb32-500"></a>different types of crime are *different* and so comparisons that treat crimes as</span>
<span id="cb32-501"><a href="#cb32-501"></a>being equivalent to one another are likely to be flawed. If we used the same</span>
<span id="cb32-502"><a href="#cb32-502"></a>colour across columns, readers might end up seeing that the shade used for</span>
<span id="cb32-503"><a href="#cb32-503"></a>unarmed robberies in Kuala Lumpur was darker than the shade showing the number</span>
<span id="cb32-504"><a href="#cb32-504"></a>of murders and conclude that unarmed robberies were a bigger problem than</span>
<span id="cb32-505"><a href="#cb32-505"></a>murders. This would be a potentially false conclusion because a single murder</span>
<span id="cb32-506"><a href="#cb32-506"></a>and a single unarmed robbery are not the same in terms of their seriousness.</span>
<span id="cb32-507"><a href="#cb32-507"></a></span>
<span id="cb32-508"><a href="#cb32-508"></a>For the same reason the table does not include a column showing the total number</span>
<span id="cb32-509"><a href="#cb32-509"></a>of crimes in each state -- when we total all types of crime together, we are</span>
<span id="cb32-510"><a href="#cb32-510"></a>implicitly assuming that all types of crime are the same when that is obviously</span>
<span id="cb32-511"><a href="#cb32-511"></a>untrue.</span>
<span id="cb32-512"><a href="#cb32-512"></a></span>
<span id="cb32-513"><a href="#cb32-513"></a>:::</span>
<span id="cb32-514"><a href="#cb32-514"></a></span>
<span id="cb32-515"><a href="#cb32-515"></a></span>
<span id="cb32-516"><a href="#cb32-516"></a><span class="fu">### Adding summary rows</span></span>
<span id="cb32-517"><a href="#cb32-517"></a></span>
<span id="cb32-518"><a href="#cb32-518"></a>The final thing we will add to this table is a summary row containing the total </span>
<span id="cb32-519"><a href="#cb32-519"></a>number of each type of crime across all the states and territories. We do this</span>
<span id="cb32-520"><a href="#cb32-520"></a>using the <span class="in">`summary_rows()`</span> function from <span class="in">`gt`</span>. We specify the columns we want to</span>
<span id="cb32-521"><a href="#cb32-521"></a>summarise using the <span class="in">`columns`</span> argument as we did for <span class="in">`fmt_number()`</span>. </span>
<span id="cb32-522"><a href="#cb32-522"></a></span>
<span id="cb32-523"><a href="#cb32-523"></a>Summary rows can be produced using lots of different R functions. For example,</span>
<span id="cb32-524"><a href="#cb32-524"></a>we could use the <span class="in">`mean()`</span> function to produce a summary row showing the mean</span>
<span id="cb32-525"><a href="#cb32-525"></a>(average) number of crimes of each time across the states. In this case, we want</span>
<span id="cb32-526"><a href="#cb32-526"></a>to know the total number of each type of crime across all states, so we will use</span>
<span id="cb32-527"><a href="#cb32-527"></a>the <span class="in">`sum()`</span> function. To specify this, we pass the <span class="in">`fns`</span> argument to </span>
<span id="cb32-528"><a href="#cb32-528"></a><span class="in">`summary_rows()`</span>. For reasons we don't need to go into, the <span class="in">`funs`</span> argument must</span>
<span id="cb32-529"><a href="#cb32-529"></a>be a _list_ of function names, even if only one function name is needed. So to</span>
<span id="cb32-530"><a href="#cb32-530"></a>tell <span class="in">`summary_rows()`</span> to produce summaries based on totals, we need to specify</span>
<span id="cb32-531"><a href="#cb32-531"></a><span class="in">`fns = list("sum")`</span>. </span>
<span id="cb32-532"><a href="#cb32-532"></a></span>
<span id="cb32-533"><a href="#cb32-533"></a>By default, this will produce a row at the bottom of the table containing the </span>
<span id="cb32-534"><a href="#cb32-534"></a>totals, but that row will have a label on the left that is based on the name of </span>
<span id="cb32-535"><a href="#cb32-535"></a>the function -- <span class="in">`sum()`</span> used to produce the summary values. Since more people </span>
<span id="cb32-536"><a href="#cb32-536"></a>will know the word 'total' than the word 'sum', we will instead specify that</span>
<span id="cb32-537"><a href="#cb32-537"></a>this summary row should be labelled as 'total'. To do this, we have to _name_</span>
<span id="cb32-538"><a href="#cb32-538"></a>the entry in the list passed to <span class="in">`fns`</span> that specifies the function to use, i.e.</span>
<span id="cb32-539"><a href="#cb32-539"></a>we need to specify <span class="in">`fns = list("total = "sum")`</span> rather than just </span>
<span id="cb32-540"><a href="#cb32-540"></a><span class="in">`fns = list("sum")`</span>.</span>
<span id="cb32-541"><a href="#cb32-541"></a></span>
<span id="cb32-542"><a href="#cb32-542"></a>By default, <span class="in">`summary_rows()`</span> formats the calculated summary values as numbers </span>
<span id="cb32-543"><a href="#cb32-543"></a>using <span class="in">`fmt_numeric()`</span>, we also need to specify <span class="in">`decimals = 0`</span> as before.</span>
<span id="cb32-544"><a href="#cb32-544"></a></span>
<span id="cb32-545"><a href="#cb32-545"></a><span class="in">```{r tables-exercise8, exercise=TRUE, exercise.lines=20}</span></span>
<span id="cb32-546"><a href="#cb32-546"></a><span class="in">violence |&gt; </span></span>
<span id="cb32-547"><a href="#cb32-547"></a><span class="in">  pivot_wider(names_from = crime_type, values_from = count) |&gt; </span></span>
<span id="cb32-548"><a href="#cb32-548"></a><span class="in">  select(</span></span>
<span id="cb32-549"><a href="#cb32-549"></a><span class="in">    region, state, murder, rape, `aggravated assault`, `armed robbery`, </span></span>
<span id="cb32-550"><a href="#cb32-550"></a><span class="in">    `unarmed robbery`</span></span>
<span id="cb32-551"><a href="#cb32-551"></a><span class="in">  ) |&gt; </span></span>
<span id="cb32-552"><a href="#cb32-552"></a><span class="in">  group_by(region) |&gt; </span></span>
<span id="cb32-553"><a href="#cb32-553"></a><span class="in">  # Functions from `dplyr`, `tidyr` etc above and functions from `gt` below</span></span>
<span id="cb32-554"><a href="#cb32-554"></a><span class="in">  gt() |&gt; </span></span>
<span id="cb32-555"><a href="#cb32-555"></a><span class="in">  fmt_number(columns = where(is.numeric), decimals = 0) |&gt; </span></span>
<span id="cb32-556"><a href="#cb32-556"></a><span class="in">  data_color(columns = `unarmed robbery`, palette = "Oranges") |&gt; </span></span>
<span id="cb32-557"><a href="#cb32-557"></a><span class="in">  data_color(columns = rape, palette = "Blues") |&gt; </span></span>
<span id="cb32-558"><a href="#cb32-558"></a><span class="in">  summary_rows(</span></span>
<span id="cb32-559"><a href="#cb32-559"></a><span class="in">    columns = where(is.numeric),</span></span>
<span id="cb32-560"><a href="#cb32-560"></a><span class="in">    fns = list("total" = "sum"),</span></span>
<span id="cb32-561"><a href="#cb32-561"></a><span class="in">    decimals = 0</span></span>
<span id="cb32-562"><a href="#cb32-562"></a><span class="in">  )</span></span>
<span id="cb32-563"><a href="#cb32-563"></a><span class="in">```</span></span>
<span id="cb32-564"><a href="#cb32-564"></a></span>
<span id="cb32-565"><a href="#cb32-565"></a></span>
<span id="cb32-566"><a href="#cb32-566"></a>::: {.box .notewell}</span>
<span id="cb32-567"><a href="#cb32-567"></a></span>
<span id="cb32-568"><a href="#cb32-568"></a>Tables are good for showing detailed information, particularly when we want to</span>
<span id="cb32-569"><a href="#cb32-569"></a>present multiple pieces of information about a single place. But it can be hard</span>
<span id="cb32-570"><a href="#cb32-570"></a>to spot patterns in tables even with coloured cells. For this reason, **do not</span>
<span id="cb32-571"><a href="#cb32-571"></a>use tables when you are primarily trying to show the relationship between two or</span>
<span id="cb32-572"><a href="#cb32-572"></a>more variables**. In the next section, we will learn to create bar chart in R to </span>
<span id="cb32-573"><a href="#cb32-573"></a>show patterns more effectively.</span>
<span id="cb32-574"><a href="#cb32-574"></a></span>
<span id="cb32-575"><a href="#cb32-575"></a>:::</span>
<span id="cb32-576"><a href="#cb32-576"></a></span>
<span id="cb32-577"><a href="#cb32-577"></a></span>
<span id="cb32-578"><a href="#cb32-578"></a><span class="co">&lt;!--</span></span>
<span id="cb32-579"><a href="#cb32-579"></a><span class="co">&lt;div class="box extra-detail"&gt;</span></span>
<span id="cb32-580"><a href="#cb32-580"></a></span>
<span id="cb32-581"><a href="#cb32-581"></a><span class="co">&lt;h5 id="gtword-box1-title" class="box-title"&gt;Using the `gt` package with Word documents&lt;/h5&gt;</span></span>
<span id="cb32-582"><a href="#cb32-582"></a></span>
<span id="cb32-583"><a href="#cb32-583"></a><span class="co">&lt;div id="gtword-box1" class="box-content"&gt;</span></span>
<span id="cb32-584"><a href="#cb32-584"></a></span>
<span id="cb32-585"><a href="#cb32-585"></a><span class="co">The `gt` package is primarily designed to produce tables in HTML or PDF </span></span>
<span id="cb32-586"><a href="#cb32-586"></a><span class="co">documents. If you want to use `gt` to create tables in Word documents, you will</span></span>
<span id="cb32-587"><a href="#cb32-587"></a><span class="co">need to adjust the YAML header section of your Rmarkdown document. Specifically,</span></span>
<span id="cb32-588"><a href="#cb32-588"></a><span class="co">you must add a line to your YAML header specifying:</span></span>
<span id="cb32-589"><a href="#cb32-589"></a></span>
<span id="cb32-590"><a href="#cb32-590"></a><span class="co">```</span></span>
<span id="cb32-591"><a href="#cb32-591"></a><span class="co">output: rtf_document</span></span>
<span id="cb32-592"><a href="#cb32-592"></a><span class="co">```</span></span>
<span id="cb32-593"><a href="#cb32-593"></a></span>
<span id="cb32-594"><a href="#cb32-594"></a><span class="co">`rtf` here means rich-text format, which is a file format created by Microsoft</span></span>
<span id="cb32-595"><a href="#cb32-595"></a><span class="co">for documents that can be shared between Word and other word-processing </span></span>
<span id="cb32-596"><a href="#cb32-596"></a><span class="co">software.</span></span>
<span id="cb32-597"><a href="#cb32-597"></a></span>
<span id="cb32-598"><a href="#cb32-598"></a><span class="co">If there is already a line in the YAML header that starts `output: `, you should</span></span>
<span id="cb32-599"><a href="#cb32-599"></a><span class="co">replace this with `output: rtf_document`. Note that `gt` will _not_ work if you</span></span>
<span id="cb32-600"><a href="#cb32-600"></a><span class="co">use `output: word_document`, which is the usual output format for producing Word</span></span>
<span id="cb32-601"><a href="#cb32-601"></a><span class="co">documents.</span></span>
<span id="cb32-602"><a href="#cb32-602"></a></span>
<span id="cb32-603"><a href="#cb32-603"></a><span class="co">A few features of the `gt` package – including colouring table cells based on</span></span>
<span id="cb32-604"><a href="#cb32-604"></a><span class="co">their value – are not available for RTF documents. This is one reason why you</span></span>
<span id="cb32-605"><a href="#cb32-605"></a><span class="co">may want to prefer producing output as HTML where possible.</span></span>
<span id="cb32-606"><a href="#cb32-606"></a></span>
<span id="cb32-607"><a href="#cb32-607"></a><span class="co">&lt;/div&gt;</span></span>
<span id="cb32-608"><a href="#cb32-608"></a></span>
<span id="cb32-609"><a href="#cb32-609"></a><span class="co">&lt;/div&gt;</span></span>
<span id="cb32-610"><a href="#cb32-610"></a></span>
<span id="cb32-611"><a href="#cb32-611"></a><span class="co">&lt;script&gt;</span></span>
<span id="cb32-612"><a href="#cb32-612"></a><span class="co">$("#gtword-box1-title").click(function () { $("#section-gtword-box1").toggle("slow") })</span></span>
<span id="cb32-613"><a href="#cb32-613"></a><span class="co">&lt;/script&gt;</span></span>
<span id="cb32-614"><a href="#cb32-614"></a><span class="co">--&gt;</span></span>
<span id="cb32-615"><a href="#cb32-615"></a></span>
<span id="cb32-616"><a href="#cb32-616"></a></span>
<span id="cb32-617"><a href="#cb32-617"></a><span class="fu">## Bar charts</span></span>
<span id="cb32-618"><a href="#cb32-618"></a></span>
<span id="cb32-619"><a href="#cb32-619"></a>Bar charts are useful for showing values of one _continuous_ variable (e.g. a</span>
<span id="cb32-620"><a href="#cb32-620"></a>count of crimes) for each value of one _categorical_ variable (e.g. states of a</span>
<span id="cb32-621"><a href="#cb32-621"></a>country). Bar charts are very common, but there are several things we can do to</span>
<span id="cb32-622"><a href="#cb32-622"></a>make them more useful. In this section we will learn how to construct a good bar</span>
<span id="cb32-623"><a href="#cb32-623"></a>chart.</span>
<span id="cb32-624"><a href="#cb32-624"></a></span>
<span id="cb32-625"><a href="#cb32-625"></a>You're already an expert at making maps using functions from the <span class="in">`ggplot2`</span></span>
<span id="cb32-626"><a href="#cb32-626"></a>package. We can use these same functions to create many other types of graphics.</span>
<span id="cb32-627"><a href="#cb32-627"></a>For example, we can use <span class="in">`geom_bar()`</span> to create bar charts just as we use </span>
<span id="cb32-628"><a href="#cb32-628"></a><span class="in">`geom_sf()`</span> to create a map using data stored in an SF object. </span>
<span id="cb32-629"><a href="#cb32-629"></a></span>
<span id="cb32-630"><a href="#cb32-630"></a><span class="in">`geom_bar()`</span> calculates the length of each bar on a chart by counting the number</span>
<span id="cb32-631"><a href="#cb32-631"></a>of rows of data in each category. This isn't what we want to do to visualise the</span>
<span id="cb32-632"><a href="#cb32-632"></a><span class="in">`violence`</span> object, since the data provided by the Royal Malaysian Police are </span>
<span id="cb32-633"><a href="#cb32-633"></a>already in the form of counts of crimes. Instead, we will use the <span class="in">`geom_col()`</span> </span>
<span id="cb32-634"><a href="#cb32-634"></a>function, which creates bar charts from this type of summary data.</span>
<span id="cb32-635"><a href="#cb32-635"></a></span>
<span id="cb32-636"><a href="#cb32-636"></a>To create a simple bar chart, we will work with the original (long-format) data</span>
<span id="cb32-637"><a href="#cb32-637"></a>and filter it to show only the number of murders in each state.</span>
<span id="cb32-638"><a href="#cb32-638"></a></span>
<span id="cb32-639"><a href="#cb32-639"></a><span class="in">```{r bars-exercise1, exercise=TRUE}</span></span>
<span id="cb32-640"><a href="#cb32-640"></a><span class="in">violence |&gt; </span></span>
<span id="cb32-641"><a href="#cb32-641"></a><span class="in">  filter(crime_type == "murder") |&gt; </span></span>
<span id="cb32-642"><a href="#cb32-642"></a><span class="in">  ggplot() +</span></span>
<span id="cb32-643"><a href="#cb32-643"></a><span class="in">  geom_col(aes(x = state, y = count))</span></span>
<span id="cb32-644"><a href="#cb32-644"></a><span class="in">```</span></span>
<span id="cb32-645"><a href="#cb32-645"></a></span>
<span id="cb32-646"><a href="#cb32-646"></a>We can improve this chart in several ways:</span>
<span id="cb32-647"><a href="#cb32-647"></a></span>
<span id="cb32-648"><a href="#cb32-648"></a><span class="ss">  * </span>We can switch the order of the variables used for the <span class="in">`x`</span> and <span class="in">`y`</span> aesthetics </span>
<span id="cb32-649"><a href="#cb32-649"></a>    so that the bars are horizontal rather than vertical, which will stop the </span>
<span id="cb32-650"><a href="#cb32-650"></a>    state names from overlapping.</span>
<span id="cb32-651"><a href="#cb32-651"></a><span class="ss">  * </span>We can change the axis labels, add a title and so on using <span class="in">`labs()`</span>.</span>
<span id="cb32-652"><a href="#cb32-652"></a><span class="ss">  * </span>We can reduce the visual clutter in the chart using <span class="in">`theme_minimal()`</span>.</span>
<span id="cb32-653"><a href="#cb32-653"></a></span>
<span id="cb32-654"><a href="#cb32-654"></a><span class="in">```{r bars-exercise2, exercise=TRUE}</span></span>
<span id="cb32-655"><a href="#cb32-655"></a><span class="in">violence |&gt; </span></span>
<span id="cb32-656"><a href="#cb32-656"></a><span class="in">  filter(crime_type == "murder") |&gt; </span></span>
<span id="cb32-657"><a href="#cb32-657"></a><span class="in">  ggplot() +</span></span>
<span id="cb32-658"><a href="#cb32-658"></a><span class="in">  geom_col(aes(x = count, y = state)) +</span></span>
<span id="cb32-659"><a href="#cb32-659"></a><span class="in">  labs(</span></span>
<span id="cb32-660"><a href="#cb32-660"></a><span class="in">    title = "Murders in Malaysian states, 2017",</span></span>
<span id="cb32-661"><a href="#cb32-661"></a><span class="in">    caption = "Data from the Royal Malaysian Police",</span></span>
<span id="cb32-662"><a href="#cb32-662"></a><span class="in">    x = "number of murders",</span></span>
<span id="cb32-663"><a href="#cb32-663"></a><span class="in">    y = NULL</span></span>
<span id="cb32-664"><a href="#cb32-664"></a><span class="in">  ) +</span></span>
<span id="cb32-665"><a href="#cb32-665"></a><span class="in">  theme_minimal()</span></span>
<span id="cb32-666"><a href="#cb32-666"></a><span class="in">```</span></span>
<span id="cb32-667"><a href="#cb32-667"></a></span>
<span id="cb32-668"><a href="#cb32-668"></a>This chart is better, but we can improve it further. For example, we can reduce </span>
<span id="cb32-669"><a href="#cb32-669"></a>the space between the state names and the bars by setting the <span class="in">`expand`</span> argument </span>
<span id="cb32-670"><a href="#cb32-670"></a>to the <span class="in">`scale_x_continuous()`</span> function. <span class="in">`scale_x_continuous()`</span> works in a </span>
<span id="cb32-671"><a href="#cb32-671"></a>similar way to the other scale functions we have used already, such as </span>
<span id="cb32-672"><a href="#cb32-672"></a><span class="in">`scale_fill_brewer()`</span> to control the colour of areas in a choropleth map.</span>
<span id="cb32-673"><a href="#cb32-673"></a></span>
<span id="cb32-674"><a href="#cb32-674"></a>Although we are trying to reduce the gap between the bars and labels on the *y* </span>
<span id="cb32-675"><a href="#cb32-675"></a>axis, we use a function that change the *x* axis. This is because the space we </span>
<span id="cb32-676"><a href="#cb32-676"></a>are reducing is created by R by-default adding some space to each end of any </span>
<span id="cb32-677"><a href="#cb32-677"></a>continuous axis, such as the count of murders. </span>
<span id="cb32-678"><a href="#cb32-678"></a></span>
<span id="cb32-679"><a href="#cb32-679"></a>We can specify the space at the end of each axis using the helper function </span>
<span id="cb32-680"><a href="#cb32-680"></a><span class="in">`expansion()`</span>, but in this case we just want to remove the space completely so</span>
<span id="cb32-681"><a href="#cb32-681"></a>we can just set <span class="in">`expand = c(0, 0)`</span>.</span>
<span id="cb32-682"><a href="#cb32-682"></a></span>
<span id="cb32-683"><a href="#cb32-683"></a>At the same time, we can also remove the grid lines on the *y* axis (i.e. those</span>
<span id="cb32-684"><a href="#cb32-684"></a>running along the length of the bars) since they don't really make it any easier</span>
<span id="cb32-685"><a href="#cb32-685"></a>to understand the chart. As a general principle, we want to remove anything on</span>
<span id="cb32-686"><a href="#cb32-686"></a>a chart that does not contribute to communicating information, since unnecessary</span>
<span id="cb32-687"><a href="#cb32-687"></a>chart elements can distract readers from understanding the data.</span>
<span id="cb32-688"><a href="#cb32-688"></a></span>
<span id="cb32-689"><a href="#cb32-689"></a>We can remove the grid lines by setting the <span class="in">`panel.grid.major.y`</span> and </span>
<span id="cb32-690"><a href="#cb32-690"></a><span class="in">`panel.grid.minor.y`</span> arguments to the <span class="in">`theme()`</span> function. The value we want to</span>
<span id="cb32-691"><a href="#cb32-691"></a>use is the helper function <span class="in">`element_blank()`</span>, which sets the grid lines to be</span>
<span id="cb32-692"><a href="#cb32-692"></a>blank.</span>
<span id="cb32-693"><a href="#cb32-693"></a></span>
<span id="cb32-694"><a href="#cb32-694"></a><span class="in">```{r bars-exercise3, exercise=TRUE, exercise.lines=17}</span></span>
<span id="cb32-695"><a href="#cb32-695"></a><span class="in">violence |&gt; </span></span>
<span id="cb32-696"><a href="#cb32-696"></a><span class="in">  filter(crime_type == "murder") |&gt; </span></span>
<span id="cb32-697"><a href="#cb32-697"></a><span class="in">  ggplot() +</span></span>
<span id="cb32-698"><a href="#cb32-698"></a><span class="in">  geom_col(aes(x = count, y = state)) +</span></span>
<span id="cb32-699"><a href="#cb32-699"></a><span class="in">  scale_x_continuous(expand = c(0, 0)) +</span></span>
<span id="cb32-700"><a href="#cb32-700"></a><span class="in">  labs(</span></span>
<span id="cb32-701"><a href="#cb32-701"></a><span class="in">    title = "Murders in Malaysian states, 2017",</span></span>
<span id="cb32-702"><a href="#cb32-702"></a><span class="in">    caption = "Data from the Royal Malaysian Police",</span></span>
<span id="cb32-703"><a href="#cb32-703"></a><span class="in">    x = "number of murders",</span></span>
<span id="cb32-704"><a href="#cb32-704"></a><span class="in">    y = NULL</span></span>
<span id="cb32-705"><a href="#cb32-705"></a><span class="in">  ) +</span></span>
<span id="cb32-706"><a href="#cb32-706"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb32-707"><a href="#cb32-707"></a><span class="in">  theme(</span></span>
<span id="cb32-708"><a href="#cb32-708"></a><span class="in">    panel.grid.major.y = element_blank(),</span></span>
<span id="cb32-709"><a href="#cb32-709"></a><span class="in">    panel.grid.minor.y = element_blank()</span></span>
<span id="cb32-710"><a href="#cb32-710"></a><span class="in">  )</span></span>
<span id="cb32-711"><a href="#cb32-711"></a><span class="in">```</span></span>
<span id="cb32-712"><a href="#cb32-712"></a></span>
<span id="cb32-713"><a href="#cb32-713"></a></span>
<span id="cb32-714"><a href="#cb32-714"></a></span>
<span id="cb32-715"><a href="#cb32-715"></a><span class="fu">### Ordering bar charts by value</span></span>
<span id="cb32-716"><a href="#cb32-716"></a></span>
<span id="cb32-717"><a href="#cb32-717"></a>If you were trying to find the three Malaysian states or territories with the</span>
<span id="cb32-718"><a href="#cb32-718"></a>most murders from this chart, it would be pretty easy to see that Selangor had</span>
<span id="cb32-719"><a href="#cb32-719"></a>the most murders, followed by Johor. But at a glance, it's not so easy to see</span>
<span id="cb32-720"><a href="#cb32-720"></a>which state or territory comes third. We can make this easier to see by changing</span>
<span id="cb32-721"><a href="#cb32-721"></a>the order of the bars from the default alphabetical order to an order based on</span>
<span id="cb32-722"><a href="#cb32-722"></a>how many murders there were.</span>
<span id="cb32-723"><a href="#cb32-723"></a></span>
<span id="cb32-724"><a href="#cb32-724"></a>To do this, we need to convert the <span class="in">`state`</span> column in the data to a new type of</span>
<span id="cb32-725"><a href="#cb32-725"></a>variable: a *factor*. Factors are what R calls categorical variables that have a</span>
<span id="cb32-726"><a href="#cb32-726"></a>defined set of possible values. For example, a factor recording if a person was</span>
<span id="cb32-727"><a href="#cb32-727"></a>under or over 18 might have two possible values: <span class="in">`adult`</span> and <span class="in">`child`</span>.</span>
<span id="cb32-728"><a href="#cb32-728"></a></span>
<span id="cb32-729"><a href="#cb32-729"></a>One of the benefits of storing a variable as a factor is that we can specify an</span>
<span id="cb32-730"><a href="#cb32-730"></a>order for the categories. This is useful for categories that have a meaningful</span>
<span id="cb32-731"><a href="#cb32-731"></a>order, such as <span class="in">`bad`</span>, <span class="in">`acceptable`</span>, <span class="in">`good`</span>, <span class="in">`excellent`</span>. But we can also use</span>
<span id="cb32-732"><a href="#cb32-732"></a>this feature of factors to specify that values should appear in a particular</span>
<span id="cb32-733"><a href="#cb32-733"></a>order in any charts produced from the data, whatever the order of the values in</span>
<span id="cb32-734"><a href="#cb32-734"></a>the data itself.</span>
<span id="cb32-735"><a href="#cb32-735"></a></span>
<span id="cb32-736"><a href="#cb32-736"></a>&lt;a href="https://forcats.tidyverse.org/"&gt;&lt;img src="images/forcats.png" alt="forcats package hex sticker" class="right-side-image"&gt;&lt;/a&gt;</span>
<span id="cb32-737"><a href="#cb32-737"></a></span>
<span id="cb32-738"><a href="#cb32-738"></a>To work with factors in R we can use the </span>
<span id="cb32-739"><a href="#cb32-739"></a><span class="co">[</span><span class="ot">`forcats` package</span><span class="co">](https://forcats.tidyverse.org/)</span>, so-called because it's </span>
<span id="cb32-740"><a href="#cb32-740"></a>*for* working with *categories*. <span class="in">`forcats`</span> is loaded as part of <span class="in">`tidyverse`</span>, so </span>
<span id="cb32-741"><a href="#cb32-741"></a>we don't need to load it separately. </span>
<span id="cb32-742"><a href="#cb32-742"></a></span>
<span id="cb32-743"><a href="#cb32-743"></a>All the functions in the <span class="in">`forcats`</span> package start with the letters <span class="in">`fct_`</span>, just </span>
<span id="cb32-744"><a href="#cb32-744"></a>as all the functions in the SF package start <span class="in">`st_`</span>. For our bar chart, we will </span>
<span id="cb32-745"><a href="#cb32-745"></a>use the <span class="in">`fct_reorder()`</span> function. This takes a factor or character variable </span>
<span id="cb32-746"><a href="#cb32-746"></a>(such as the names of the Malaysian states and territories) and sets the order </span>
<span id="cb32-747"><a href="#cb32-747"></a>of the categories according to the values of a numeric variable (such as the </span>
<span id="cb32-748"><a href="#cb32-748"></a>number of murders in a state). So to re-order the <span class="in">`state`</span> variable according to </span>
<span id="cb32-749"><a href="#cb32-749"></a>the count of murders, we can use <span class="in">`fct_reorder(state, count)`</span>. Since we're </span>
<span id="cb32-750"><a href="#cb32-750"></a>changing an existing variable, we will do this inside a call to the <span class="in">`mutate()`</span> </span>
<span id="cb32-751"><a href="#cb32-751"></a>function.</span>
<span id="cb32-752"><a href="#cb32-752"></a></span>
<span id="cb32-753"><a href="#cb32-753"></a><span class="in">```{r bars-exercise4, exercise=TRUE, exercise.lines=18}</span></span>
<span id="cb32-754"><a href="#cb32-754"></a><span class="in">violence |&gt; </span></span>
<span id="cb32-755"><a href="#cb32-755"></a><span class="in">  filter(crime_type == "murder") |&gt; </span></span>
<span id="cb32-756"><a href="#cb32-756"></a><span class="in">  mutate(state = fct_reorder(state, count)) |&gt; </span></span>
<span id="cb32-757"><a href="#cb32-757"></a><span class="in">  ggplot() +</span></span>
<span id="cb32-758"><a href="#cb32-758"></a><span class="in">  geom_col(aes(x = count, y = state)) +</span></span>
<span id="cb32-759"><a href="#cb32-759"></a><span class="in">  scale_x_continuous(expand = c(0, 0)) +</span></span>
<span id="cb32-760"><a href="#cb32-760"></a><span class="in">  labs(</span></span>
<span id="cb32-761"><a href="#cb32-761"></a><span class="in">    title = "Murders in Malaysian states, 2017",</span></span>
<span id="cb32-762"><a href="#cb32-762"></a><span class="in">    caption = "Data from the Royal Malaysian Police",</span></span>
<span id="cb32-763"><a href="#cb32-763"></a><span class="in">    x = "number of murders",</span></span>
<span id="cb32-764"><a href="#cb32-764"></a><span class="in">    y = NULL</span></span>
<span id="cb32-765"><a href="#cb32-765"></a><span class="in">  ) +</span></span>
<span id="cb32-766"><a href="#cb32-766"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb32-767"><a href="#cb32-767"></a><span class="in">  theme(</span></span>
<span id="cb32-768"><a href="#cb32-768"></a><span class="in">    panel.grid.major.y = element_blank(),</span></span>
<span id="cb32-769"><a href="#cb32-769"></a><span class="in">    panel.grid.minor.y = element_blank()</span></span>
<span id="cb32-770"><a href="#cb32-770"></a><span class="in">  )</span></span>
<span id="cb32-771"><a href="#cb32-771"></a><span class="in">```</span></span>
<span id="cb32-772"><a href="#cb32-772"></a></span>
<span id="cb32-773"><a href="#cb32-773"></a>Finally, we can use colour to indicate which states are in which of the two</span>
<span id="cb32-774"><a href="#cb32-774"></a>regions of Malaysia. To do this, we will:</span>
<span id="cb32-775"><a href="#cb32-775"></a></span>
<span id="cb32-776"><a href="#cb32-776"></a><span class="ss">  * </span>specify in the call to <span class="in">`aes()`</span> that the fill colour of the bars should be</span>
<span id="cb32-777"><a href="#cb32-777"></a>    controlled by the <span class="in">`region`</span> column in the data,</span>
<span id="cb32-778"><a href="#cb32-778"></a><span class="ss">  * </span>specify in the call to <span class="in">`labs()`</span> that we don't want the legend to have a </span>
<span id="cb32-779"><a href="#cb32-779"></a>    title, since the meaning is obvious from the values 'East Malaysia' and</span>
<span id="cb32-780"><a href="#cb32-780"></a>    'West Malaysia', and</span>
<span id="cb32-781"><a href="#cb32-781"></a><span class="ss">  * </span>specify in the call to <span class="in">`theme()`</span> that we would like the legend use up some </span>
<span id="cb32-782"><a href="#cb32-782"></a>    of the empty space in the bottom-right corner of the chart, rather than </span>
<span id="cb32-783"><a href="#cb32-783"></a>    making the chart smaller to give space for the legend on the right-hand </span>
<span id="cb32-784"><a href="#cb32-784"></a>    side.</span>
<span id="cb32-785"><a href="#cb32-785"></a>    </span>
<span id="cb32-786"><a href="#cb32-786"></a>To move the legend, we need to specify three different arguments in the </span>
<span id="cb32-787"><a href="#cb32-787"></a><span class="in">`theme()`</span> function. <span class="in">`legend.position`</span> determines where in the plot the legend</span>
<span id="cb32-788"><a href="#cb32-788"></a>should be placed, based on how far along each axis (as a proportion of the axis</span>
<span id="cb32-789"><a href="#cb32-789"></a>length, on a scale from zero to one) the legend should be placed. </span>
<span id="cb32-790"><a href="#cb32-790"></a></span>
<span id="cb32-791"><a href="#cb32-791"></a><span class="in">```{r legend-position, fig.align='center', fig.asp=1}</span></span>
<span id="cb32-792"><a href="#cb32-792"></a><span class="in">tibble(</span></span>
<span id="cb32-793"><a href="#cb32-793"></a><span class="in">  x = c(0, 0, 0, 0.5, 0.5, 0.5, 1, 1, 1), </span></span>
<span id="cb32-794"><a href="#cb32-794"></a><span class="in">  y = c(0, 0.5, 1, 0, 0.5, 1, 0, 0.5, 1)</span></span>
<span id="cb32-795"><a href="#cb32-795"></a><span class="in">) |&gt; </span></span>
<span id="cb32-796"><a href="#cb32-796"></a><span class="in">  mutate(</span></span>
<span id="cb32-797"><a href="#cb32-797"></a><span class="in">    label = str_glue("{number(x, accuracy = 0.1)}, {number(y, accuracy = 0.1)}")</span></span>
<span id="cb32-798"><a href="#cb32-798"></a><span class="in">  ) |&gt; </span></span>
<span id="cb32-799"><a href="#cb32-799"></a><span class="in">  ggplot(aes(x = x, y = y, label = label)) +</span></span>
<span id="cb32-800"><a href="#cb32-800"></a><span class="in">  geom_point() +</span></span>
<span id="cb32-801"><a href="#cb32-801"></a><span class="in">  geom_label() +</span></span>
<span id="cb32-802"><a href="#cb32-802"></a><span class="in">  scale_x_continuous(</span></span>
<span id="cb32-803"><a href="#cb32-803"></a><span class="in">    expand = expansion(0.1), </span></span>
<span id="cb32-804"><a href="#cb32-804"></a><span class="in">    position = "top", </span></span>
<span id="cb32-805"><a href="#cb32-805"></a><span class="in">    sec.axis = dup_axis(name = NULL)</span></span>
<span id="cb32-806"><a href="#cb32-806"></a><span class="in">  ) +</span></span>
<span id="cb32-807"><a href="#cb32-807"></a><span class="in">  scale_y_continuous(</span></span>
<span id="cb32-808"><a href="#cb32-808"></a><span class="in">    expand = expansion(0.1), </span></span>
<span id="cb32-809"><a href="#cb32-809"></a><span class="in">    sec.axis = dup_axis(name = NULL)</span></span>
<span id="cb32-810"><a href="#cb32-810"></a><span class="in">  ) +</span></span>
<span id="cb32-811"><a href="#cb32-811"></a><span class="in">  coord_fixed() +</span></span>
<span id="cb32-812"><a href="#cb32-812"></a><span class="in">  labs(</span></span>
<span id="cb32-813"><a href="#cb32-813"></a><span class="in">    x = "the first number gives the value on horizontal (x) axis",</span></span>
<span id="cb32-814"><a href="#cb32-814"></a><span class="in">    y = "the second number gives the value on vertical (y) axis"</span></span>
<span id="cb32-815"><a href="#cb32-815"></a><span class="in">  ) +</span></span>
<span id="cb32-816"><a href="#cb32-816"></a><span class="in">  theme_minimal()</span></span>
<span id="cb32-817"><a href="#cb32-817"></a><span class="in">```</span></span>
<span id="cb32-818"><a href="#cb32-818"></a></span>
<span id="cb32-819"><a href="#cb32-819"></a>Using this specification, we can place the legend in the right-most point on the </span>
<span id="cb32-820"><a href="#cb32-820"></a>horizontal axis and the bottom-most point on the vertical axis by specifying</span>
<span id="cb32-821"><a href="#cb32-821"></a><span class="in">`legend.position = c(1, 0)`</span>.</span>
<span id="cb32-822"><a href="#cb32-822"></a></span>
<span id="cb32-823"><a href="#cb32-823"></a><span class="in">`legend.position`</span> sets the _anchor_ point from which the legend is created, with</span>
<span id="cb32-824"><a href="#cb32-824"></a>the actual size of the legend depending on how much space is required by its</span>
<span id="cb32-825"><a href="#cb32-825"></a>contents. By default, a legend will spread out in all directions from the anchor</span>
<span id="cb32-826"><a href="#cb32-826"></a>point, i.e. the legend will be horizontally and vertically centred on the</span>
<span id="cb32-827"><a href="#cb32-827"></a>anchor point. As we have positioned the legend in a corner of the plot, this is</span>
<span id="cb32-828"><a href="#cb32-828"></a>probably not what we want since some of the legend will be hidden outside the</span>
<span id="cb32-829"><a href="#cb32-829"></a>plot area. Instead, we can set the <span class="in">`legend.justifcation`</span> argument of <span class="in">`theme()`</span></span>
<span id="cb32-830"><a href="#cb32-830"></a>using a similar specification to that for <span class="in">`legend.position`</span> based on which way</span>
<span id="cb32-831"><a href="#cb32-831"></a>we want the legend to grow.</span>
<span id="cb32-832"><a href="#cb32-832"></a></span>
<span id="cb32-833"><a href="#cb32-833"></a><span class="in">```{r legend-justification, fig.align='center', fig.asp=0.5}</span></span>
<span id="cb32-834"><a href="#cb32-834"></a><span class="in">tibble(</span></span>
<span id="cb32-835"><a href="#cb32-835"></a><span class="in">  x = c(1.1, 1.1, 0.9, 0.9, 1.1, 0.9, 1, 1),</span></span>
<span id="cb32-836"><a href="#cb32-836"></a><span class="in">  xend = c(1.25, 1.25, 0.75, 0.75, 1.25, 0.75, 1, 1),</span></span>
<span id="cb32-837"><a href="#cb32-837"></a><span class="in">  y = c(1.1, 0.9, 1.1, 0.9, 1, 1, 0.9, 1.1),</span></span>
<span id="cb32-838"><a href="#cb32-838"></a><span class="in">  yend = c(1.25, 0.75, 1.25, 0.75, 1, 1, 0.75, 1.25),</span></span>
<span id="cb32-839"><a href="#cb32-839"></a><span class="in">  h = c(0, 0, 1, 1, 0, 1, 0.5, 0.5),</span></span>
<span id="cb32-840"><a href="#cb32-840"></a><span class="in">  v = c(0, 1, 0, 1, 0.5, 0.5, 1, 0)</span></span>
<span id="cb32-841"><a href="#cb32-841"></a><span class="in">)  |&gt;  </span></span>
<span id="cb32-842"><a href="#cb32-842"></a><span class="in">  mutate(</span></span>
<span id="cb32-843"><a href="#cb32-843"></a><span class="in">    label = str_glue("{number(h, accuracy = 0.1)}, {number(v, accuracy = 0.1)}")</span></span>
<span id="cb32-844"><a href="#cb32-844"></a><span class="in">  ) |&gt; </span></span>
<span id="cb32-845"><a href="#cb32-845"></a><span class="in">  ggplot() +</span></span>
<span id="cb32-846"><a href="#cb32-846"></a><span class="in">  geom_segment(</span></span>
<span id="cb32-847"><a href="#cb32-847"></a><span class="in">    aes(x = x, y = y, xend = xend, yend = yend), </span></span>
<span id="cb32-848"><a href="#cb32-848"></a><span class="in">    linewidth = 1, </span></span>
<span id="cb32-849"><a href="#cb32-849"></a><span class="in">    arrow = arrow(length = unit(3, "mm"), type = "closed")</span></span>
<span id="cb32-850"><a href="#cb32-850"></a><span class="in">  ) +</span></span>
<span id="cb32-851"><a href="#cb32-851"></a><span class="in">  geom_label(aes(x = xend, y = yend, hjust = h, vjust = v, label = label)) +</span></span>
<span id="cb32-852"><a href="#cb32-852"></a><span class="in">  geom_point(aes(x = x, y = y), size = 4) +</span></span>
<span id="cb32-853"><a href="#cb32-853"></a><span class="in">  scale_x_continuous(expand = expansion(3)) +</span></span>
<span id="cb32-854"><a href="#cb32-854"></a><span class="in">  scale_y_continuous(expand = expansion(0.5)) +</span></span>
<span id="cb32-855"><a href="#cb32-855"></a><span class="in">  coord_fixed() +</span></span>
<span id="cb32-856"><a href="#cb32-856"></a><span class="in">  theme_void()</span></span>
<span id="cb32-857"><a href="#cb32-857"></a><span class="in">```</span></span>
<span id="cb32-858"><a href="#cb32-858"></a></span>
<span id="cb32-859"><a href="#cb32-859"></a>If you want the legend to grow 'inwards' from a corner, just set </span>
<span id="cb32-860"><a href="#cb32-860"></a><span class="in">`legend.justification`</span> to the same value as you used for <span class="in">`legend.position`</span>. In </span>
<span id="cb32-861"><a href="#cb32-861"></a>this case, we want the legend to be anchored in the bottom-right corner and to </span>
<span id="cb32-862"><a href="#cb32-862"></a>grow inwards from it, so we will set both arguments to <span class="in">`c(1, 0)`</span>.</span>
<span id="cb32-863"><a href="#cb32-863"></a></span>
<span id="cb32-864"><a href="#cb32-864"></a></span>
<span id="cb32-865"><a href="#cb32-865"></a><span class="in">```{r bars-exercise5, exercise=TRUE, exercise.lines=21}</span></span>
<span id="cb32-866"><a href="#cb32-866"></a><span class="in">violence |&gt; </span></span>
<span id="cb32-867"><a href="#cb32-867"></a><span class="in">  filter(crime_type == "murder") |&gt; </span></span>
<span id="cb32-868"><a href="#cb32-868"></a><span class="in">  mutate(state = fct_reorder(state, count)) |&gt; </span></span>
<span id="cb32-869"><a href="#cb32-869"></a><span class="in">  ggplot() +</span></span>
<span id="cb32-870"><a href="#cb32-870"></a><span class="in">  geom_col(aes(x = count, y = state, fill = region)) +</span></span>
<span id="cb32-871"><a href="#cb32-871"></a><span class="in">  scale_x_continuous(expand = c(0, 0)) +</span></span>
<span id="cb32-872"><a href="#cb32-872"></a><span class="in">  labs(</span></span>
<span id="cb32-873"><a href="#cb32-873"></a><span class="in">    title = "Murders in Malaysian states, 2017",</span></span>
<span id="cb32-874"><a href="#cb32-874"></a><span class="in">    caption = "Data from the Royal Malaysian Police",</span></span>
<span id="cb32-875"><a href="#cb32-875"></a><span class="in">    x = "number of murders",</span></span>
<span id="cb32-876"><a href="#cb32-876"></a><span class="in">    y = NULL,</span></span>
<span id="cb32-877"><a href="#cb32-877"></a><span class="in">    fill = NULL</span></span>
<span id="cb32-878"><a href="#cb32-878"></a><span class="in">  ) +</span></span>
<span id="cb32-879"><a href="#cb32-879"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb32-880"><a href="#cb32-880"></a><span class="in">  theme(</span></span>
<span id="cb32-881"><a href="#cb32-881"></a><span class="in">    legend.background = element_rect(colour = NA, fill = "white"),</span></span>
<span id="cb32-882"><a href="#cb32-882"></a><span class="in">    legend.justification = c(1, 0),</span></span>
<span id="cb32-883"><a href="#cb32-883"></a><span class="in">    legend.position = c(1, 0),</span></span>
<span id="cb32-884"><a href="#cb32-884"></a><span class="in">    panel.grid.major.y = element_blank(),</span></span>
<span id="cb32-885"><a href="#cb32-885"></a><span class="in">    panel.grid.minor.y = element_blank()</span></span>
<span id="cb32-886"><a href="#cb32-886"></a><span class="in">  )</span></span>
<span id="cb32-887"><a href="#cb32-887"></a><span class="in">```</span></span>
<span id="cb32-888"><a href="#cb32-888"></a></span>
<span id="cb32-889"><a href="#cb32-889"></a>Bar charts are a very common way of presenting a numeric variable for each value</span>
<span id="cb32-890"><a href="#cb32-890"></a>of a categorical variable. Bar charts are easy to interpret, even for people who</span>
<span id="cb32-891"><a href="#cb32-891"></a>are not used to interpreting charts or who only have time to look at the chart</span>
<span id="cb32-892"><a href="#cb32-892"></a>for a few seconds. </span>
<span id="cb32-893"><a href="#cb32-893"></a></span>
<span id="cb32-894"><a href="#cb32-894"></a></span>
<span id="cb32-895"><a href="#cb32-895"></a>::: {.box .notewell}</span>
<span id="cb32-896"><a href="#cb32-896"></a></span>
<span id="cb32-897"><a href="#cb32-897"></a>One of the reasons why bar charts are easy to interpret is</span>
<span id="cb32-898"><a href="#cb32-898"></a>that the *length* of each bar directly corresponds to the relative size of that</span>
<span id="cb32-899"><a href="#cb32-899"></a>particular value. But this direct relationship between bar length and value only</span>
<span id="cb32-900"><a href="#cb32-900"></a>applies if the bars start at zero. If you create a bar chart in which the bars </span>
<span id="cb32-901"><a href="#cb32-901"></a>don't start at zero, readers are likely to be mislead, so remember *bar charts </span>
<span id="cb32-902"><a href="#cb32-902"></a>should always start at zero*. But don't worry -- <span class="in">`ggplot()`</span> will handle this for </span>
<span id="cb32-903"><a href="#cb32-903"></a>you automatically.</span>
<span id="cb32-904"><a href="#cb32-904"></a></span>
<span id="cb32-905"><a href="#cb32-905"></a>:::</span>
<span id="cb32-906"><a href="#cb32-906"></a></span>
<span id="cb32-907"><a href="#cb32-907"></a></span>
<span id="cb32-908"><a href="#cb32-908"></a></span>
<span id="cb32-909"><a href="#cb32-909"></a><span class="fu">## Showing a distribution</span></span>
<span id="cb32-910"><a href="#cb32-910"></a></span>
<span id="cb32-911"><a href="#cb32-911"></a>Bar charts show a single piece of information about each category present in a</span>
<span id="cb32-912"><a href="#cb32-912"></a>dataset. So we might use a bar chart to show, for example, the average number of</span>
<span id="cb32-913"><a href="#cb32-913"></a>burglaries in neighbourhoods in different districts. But what if the average</span>
<span id="cb32-914"><a href="#cb32-914"></a>values masked substantial differences in the number of burglaries within each</span>
<span id="cb32-915"><a href="#cb32-915"></a>district? Averages often mask variation, and can sometimes be misleading as a</span>
<span id="cb32-916"><a href="#cb32-916"></a>result. In those circumstances it would be better to show more detail rather</span>
<span id="cb32-917"><a href="#cb32-917"></a>than a misleading average.</span>
<span id="cb32-918"><a href="#cb32-918"></a></span>
<span id="cb32-919"><a href="#cb32-919"></a>Let's start with the simple example of showing the distribution of burglary</span>
<span id="cb32-920"><a href="#cb32-920"></a>counts within a single district. The <span class="in">`burglary`</span> object contains counts of</span>
<span id="cb32-921"><a href="#cb32-921"></a>burglaries in each lower-layer super output area (LSOA) in Northamptonshire in </span>
<span id="cb32-922"><a href="#cb32-922"></a>England in 2020. To show the distribution of burglary counts within one district</span>
<span id="cb32-923"><a href="#cb32-923"></a>(Kettering), we can create a *histogram* using <span class="in">`geom_histogram()`</span>.</span>
<span id="cb32-924"><a href="#cb32-924"></a></span>
<span id="cb32-925"><a href="#cb32-925"></a>A histogram divides the range of values present in the data into a number of</span>
<span id="cb32-926"><a href="#cb32-926"></a>equally sized _bins_, then shows bars representing the number of observations </span>
<span id="cb32-927"><a href="#cb32-927"></a>(rows) in the data that have values fitting into each bin. We can either allow</span>
<span id="cb32-928"><a href="#cb32-928"></a><span class="in">`geom_histogram()`</span> to set the number of bins automatically, or set it ourself</span>
<span id="cb32-929"><a href="#cb32-929"></a>with the <span class="in">`binwidth`</span> argument.</span>
<span id="cb32-930"><a href="#cb32-930"></a></span>
<span id="cb32-931"><a href="#cb32-931"></a>We will set the <span class="in">`binwidth`</span> argument of the <span class="in">`geom_histogram()`</span> function to</span>
<span id="cb32-932"><a href="#cb32-932"></a><span class="in">`binwidth = 1`</span> so that each bar on the chart will show now many LSOAs have each</span>
<span id="cb32-933"><a href="#cb32-933"></a>individual value. We will also add some labels to help readers interpret the </span>
<span id="cb32-934"><a href="#cb32-934"></a>chart.</span>
<span id="cb32-935"><a href="#cb32-935"></a></span>
<span id="cb32-936"><a href="#cb32-936"></a><span class="in">```{r dist-exercise1, exercise=TRUE}</span></span>
<span id="cb32-937"><a href="#cb32-937"></a><span class="in">burglary |&gt; </span></span>
<span id="cb32-938"><a href="#cb32-938"></a><span class="in">  filter(district == "Kettering") |&gt; </span></span>
<span id="cb32-939"><a href="#cb32-939"></a><span class="in">  ggplot() +</span></span>
<span id="cb32-940"><a href="#cb32-940"></a><span class="in">  geom_histogram(aes(x = count), binwidth = 1) +</span></span>
<span id="cb32-941"><a href="#cb32-941"></a><span class="in">  scale_x_continuous(expand = c(0, 0)) +</span></span>
<span id="cb32-942"><a href="#cb32-942"></a><span class="in">  scale_y_continuous(expand = c(0, 0)) +</span></span>
<span id="cb32-943"><a href="#cb32-943"></a><span class="in">  labs(</span></span>
<span id="cb32-944"><a href="#cb32-944"></a><span class="in">    title = "Number of burglaries in Kettering neighbourhoods",</span></span>
<span id="cb32-945"><a href="#cb32-945"></a><span class="in">    x = "count of burglaries, 2020",</span></span>
<span id="cb32-946"><a href="#cb32-946"></a><span class="in">    y = "number of LSOAs"</span></span>
<span id="cb32-947"><a href="#cb32-947"></a><span class="in">  ) +</span></span>
<span id="cb32-948"><a href="#cb32-948"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb32-949"><a href="#cb32-949"></a><span class="in">  theme(</span></span>
<span id="cb32-950"><a href="#cb32-950"></a><span class="in">    panel.grid.major.x = element_blank(),</span></span>
<span id="cb32-951"><a href="#cb32-951"></a><span class="in">    panel.grid.minor.x = element_blank()</span></span>
<span id="cb32-952"><a href="#cb32-952"></a><span class="in">  )</span></span>
<span id="cb32-953"><a href="#cb32-953"></a><span class="in">```</span></span>
<span id="cb32-954"><a href="#cb32-954"></a></span>
<span id="cb32-955"><a href="#cb32-955"></a></span>
<span id="cb32-956"><a href="#cb32-956"></a>We can see on this chart that most LSOAs had only a few burglaries in 2020 (i.e.</span>
<span id="cb32-957"><a href="#cb32-957"></a>the largest bars are to the left of the chart), while a few LSOAs had a larger </span>
<span id="cb32-958"><a href="#cb32-958"></a>number (the bars to the right of the chart). This is what we would expect, since </span>
<span id="cb32-959"><a href="#cb32-959"></a>we know the crimes are generally concentrated in a few places.</span>
<span id="cb32-960"><a href="#cb32-960"></a></span>
<span id="cb32-961"><a href="#cb32-961"></a></span>
<span id="cb32-962"><a href="#cb32-962"></a><span class="fu">### Plotting density curves</span></span>
<span id="cb32-963"><a href="#cb32-963"></a></span>
<span id="cb32-964"><a href="#cb32-964"></a>Dot plots can be effective at showing the distribution of a variable, but are</span>
<span id="cb32-965"><a href="#cb32-965"></a>only really useful for a _single_ group since they become cluttered if you try </span>
<span id="cb32-966"><a href="#cb32-966"></a>to show several types of dot (e.g. of different colours). One way to show the</span>
<span id="cb32-967"><a href="#cb32-967"></a>general distribution of a variable is to summarise the locations of the points</span>
<span id="cb32-968"><a href="#cb32-968"></a>on the horizontal axis by adding a *density curve* with <span class="in">`geom_density()`</span>. A</span>
<span id="cb32-969"><a href="#cb32-969"></a>density curve is a _smoothed_ version of a histogram, which is useful to show</span>
<span id="cb32-970"><a href="#cb32-970"></a>the general distribution of a variable (in this case, the number of LSOAs with</span>
<span id="cb32-971"><a href="#cb32-971"></a>different numbers of burglaries) at the cost of not showing the exact data. The</span>
<span id="cb32-972"><a href="#cb32-972"></a>mathematical procedure used by <span class="in">`geom_density()`</span> to calculate a density curve is</span>
<span id="cb32-973"><a href="#cb32-973"></a>the same as the kernel-density estimation process we have already learned to use</span>
<span id="cb32-974"><a href="#cb32-974"></a>to show concentrations of crime on a map.</span>
<span id="cb32-975"><a href="#cb32-975"></a></span>
<span id="cb32-976"><a href="#cb32-976"></a><span class="in">```{r dist-exercise2, exercise=TRUE}</span></span>
<span id="cb32-977"><a href="#cb32-977"></a><span class="in">burglary |&gt; </span></span>
<span id="cb32-978"><a href="#cb32-978"></a><span class="in">  filter(district == "Kettering") |&gt; </span></span>
<span id="cb32-979"><a href="#cb32-979"></a><span class="in">  ggplot() +</span></span>
<span id="cb32-980"><a href="#cb32-980"></a><span class="in">  geom_density(aes(x = count), colour = "red", linewidth = 1) +</span></span>
<span id="cb32-981"><a href="#cb32-981"></a><span class="in">  scale_x_continuous(expand = c(0, 0)) +</span></span>
<span id="cb32-982"><a href="#cb32-982"></a><span class="in">  scale_y_continuous(labels = scales::label_percent()) +</span></span>
<span id="cb32-983"><a href="#cb32-983"></a><span class="in">  labs(</span></span>
<span id="cb32-984"><a href="#cb32-984"></a><span class="in">    title = "Number of burglaries in Kettering neighbourhoods",</span></span>
<span id="cb32-985"><a href="#cb32-985"></a><span class="in">    x = "count of burglaries, 2020",</span></span>
<span id="cb32-986"><a href="#cb32-986"></a><span class="in">    y = "percentage of LSOAs"</span></span>
<span id="cb32-987"><a href="#cb32-987"></a><span class="in">  ) +</span></span>
<span id="cb32-988"><a href="#cb32-988"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb32-989"><a href="#cb32-989"></a><span class="in">  theme(</span></span>
<span id="cb32-990"><a href="#cb32-990"></a><span class="in">    panel.grid.major.x = element_blank(),</span></span>
<span id="cb32-991"><a href="#cb32-991"></a><span class="in">    panel.grid.minor.x = element_blank()</span></span>
<span id="cb32-992"><a href="#cb32-992"></a><span class="in">  )</span></span>
<span id="cb32-993"><a href="#cb32-993"></a><span class="in">```</span></span>
<span id="cb32-994"><a href="#cb32-994"></a></span>
<span id="cb32-995"><a href="#cb32-995"></a>We can use density curves to show the distribution of a variable across multiple</span>
<span id="cb32-996"><a href="#cb32-996"></a>categories at once. For example, we could show the distribution of burglary </span>
<span id="cb32-997"><a href="#cb32-997"></a>counts at the neighbourhood level for all the districts in Northamptonshire. To</span>
<span id="cb32-998"><a href="#cb32-998"></a>do this we use the <span class="in">`geom_density_ridges()`</span> function from the <span class="in">`ggridges`</span> package</span>
<span id="cb32-999"><a href="#cb32-999"></a>to create a *ridge plot*. Although this function does not come from the </span>
<span id="cb32-1000"><a href="#cb32-1000"></a><span class="in">`ggplot2`</span> package, it is designed to be used inside a <span class="in">`ggplot()`</span> stack.</span>
<span id="cb32-1001"><a href="#cb32-1001"></a></span>
<span id="cb32-1002"><a href="#cb32-1002"></a><span class="in">```{r dist-exercise3, exercise=TRUE}</span></span>
<span id="cb32-1003"><a href="#cb32-1003"></a><span class="in">library(ggridges)</span></span>
<span id="cb32-1004"><a href="#cb32-1004"></a></span>
<span id="cb32-1005"><a href="#cb32-1005"></a><span class="in">burglary |&gt; </span></span>
<span id="cb32-1006"><a href="#cb32-1006"></a><span class="in">  # Wrap the district names by replacing any space in a name with a new-line</span></span>
<span id="cb32-1007"><a href="#cb32-1007"></a><span class="in">  mutate(district = str_replace_all(district, "\\s", "\n")) |&gt; </span></span>
<span id="cb32-1008"><a href="#cb32-1008"></a><span class="in">  ggplot(aes(x = count, y = district)) +</span></span>
<span id="cb32-1009"><a href="#cb32-1009"></a><span class="in">  geom_density_ridges() +</span></span>
<span id="cb32-1010"><a href="#cb32-1010"></a><span class="in">  scale_x_continuous(expand = c(0, 0)) +</span></span>
<span id="cb32-1011"><a href="#cb32-1011"></a><span class="in">  labs(</span></span>
<span id="cb32-1012"><a href="#cb32-1012"></a><span class="in">    title = "Number of burglaries in Kettering neighbourhoods",</span></span>
<span id="cb32-1013"><a href="#cb32-1013"></a><span class="in">    x = "count of burglaries, 2020",</span></span>
<span id="cb32-1014"><a href="#cb32-1014"></a><span class="in">    y = NULL</span></span>
<span id="cb32-1015"><a href="#cb32-1015"></a><span class="in">  ) +</span></span>
<span id="cb32-1016"><a href="#cb32-1016"></a><span class="in">  theme_minimal()</span></span>
<span id="cb32-1017"><a href="#cb32-1017"></a><span class="in">```</span></span>
<span id="cb32-1018"><a href="#cb32-1018"></a></span>
<span id="cb32-1019"><a href="#cb32-1019"></a>The ridge plot shows the distribution of burglary counts in LSOAs within each</span>
<span id="cb32-1020"><a href="#cb32-1020"></a>district, with the distributions overlapping slightly to save space. From this</span>
<span id="cb32-1021"><a href="#cb32-1021"></a>we can see that across all districts most LSOAs have few burglaries, with a </span>
<span id="cb32-1022"><a href="#cb32-1022"></a>small number of LSOAs having more. We can also see there are a small number of </span>
<span id="cb32-1023"><a href="#cb32-1023"></a>LSOAs (probably, in fact, just one LSOA) in Wellingborough district with a much</span>
<span id="cb32-1024"><a href="#cb32-1024"></a>higher number of burglaries than anywhere else in Northamptonshire.</span>
<span id="cb32-1025"><a href="#cb32-1025"></a></span>
<span id="cb32-1026"><a href="#cb32-1026"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb32-1027"><a href="#cb32-1027"></a><span class="in">burglary_district_counts &lt;- count(burglary, district, sort = TRUE)</span></span>
<span id="cb32-1028"><a href="#cb32-1028"></a><span class="in">```</span></span>
<span id="cb32-1029"><a href="#cb32-1029"></a></span>
<span id="cb32-1030"><a href="#cb32-1030"></a></span>
<span id="cb32-1031"><a href="#cb32-1031"></a><span class="fu">### Small-multiple charts</span></span>
<span id="cb32-1032"><a href="#cb32-1032"></a></span>
<span id="cb32-1033"><a href="#cb32-1033"></a>Density plots can be helpful to summarise a lot of information, but they have </span>
<span id="cb32-1034"><a href="#cb32-1034"></a>some disadvantages. In particular, they don't show that the number of LSOAs in</span>
<span id="cb32-1035"><a href="#cb32-1035"></a>each district is quite different: there are </span>
<span id="cb32-1036"><a href="#cb32-1036"></a><span class="in">`r pluck(burglary_district_counts, "n", 1)`</span> LSOAs in </span>
<span id="cb32-1037"><a href="#cb32-1037"></a><span class="in">`r pluck(burglary_district_counts, "district", 1)`</span> but only </span>
<span id="cb32-1038"><a href="#cb32-1038"></a><span class="in">`r pluck(burglary_district_counts, "n", nrow(burglary_district_counts))`</span> LSOAs in</span>
<span id="cb32-1039"><a href="#cb32-1039"></a><span class="in">`r pluck(burglary_district_counts, "district", nrow(burglary_district_counts))`</span>.</span>
<span id="cb32-1040"><a href="#cb32-1040"></a>To make this clearer we can instead produce several dot plots, one for each</span>
<span id="cb32-1041"><a href="#cb32-1041"></a>district -- what are called *small-multiple* charts.</span>
<span id="cb32-1042"><a href="#cb32-1042"></a></span>
<span id="cb32-1043"><a href="#cb32-1043"></a>We could create small-multiple charts by producing a separate histogram for each</span>
<span id="cb32-1044"><a href="#cb32-1044"></a>district and then combine them with the <span class="in">`patchwork`</span> package, but that would</span>
<span id="cb32-1045"><a href="#cb32-1045"></a>involve a lot of repeated code. Fortunately, we can use a feature of the </span>
<span id="cb32-1046"><a href="#cb32-1046"></a><span class="in">`ggplot2`</span> package called *faceting* to split our single dot plot into multiple</span>
<span id="cb32-1047"><a href="#cb32-1047"></a>plots based on a column in the data (in this case, the district name).</span>
<span id="cb32-1048"><a href="#cb32-1048"></a></span>
<span id="cb32-1049"><a href="#cb32-1049"></a>Adding <span class="in">`facet_wrap()`</span> to our <span class="in">`ggplot()`</span> stack will cause R to create multiple</span>
<span id="cb32-1050"><a href="#cb32-1050"></a>plots and wrap them across multiple rows and columns so that they approximately</span>
<span id="cb32-1051"><a href="#cb32-1051"></a>fit into the available space. If we only want the small multiples to appear on</span>
<span id="cb32-1052"><a href="#cb32-1052"></a>top of each other (i.e. in multiple rows) or next to each other (i.e. in </span>
<span id="cb32-1053"><a href="#cb32-1053"></a>multiple columns), we can use the <span class="in">`facet_grid()`</span> function. In this case we want</span>
<span id="cb32-1054"><a href="#cb32-1054"></a>the small multiples to appear on top of each other, so we will use </span>
<span id="cb32-1055"><a href="#cb32-1055"></a><span class="in">`facet_grid()`</span> and say that the small multiples (which <span class="in">`ggplot2`</span> calls *facets*)</span>
<span id="cb32-1056"><a href="#cb32-1056"></a>should be based on the <span class="in">`district`</span> column in the data by specifying </span>
<span id="cb32-1057"><a href="#cb32-1057"></a><span class="in">`rows = vars(district)`</span> (it is necessary to wrap the name of the column that you</span>
<span id="cb32-1058"><a href="#cb32-1058"></a>want to use as the basis of the small multiples in the <span class="in">`vars()`</span> function, but we</span>
<span id="cb32-1059"><a href="#cb32-1059"></a>do not need to go into why).</span>
<span id="cb32-1060"><a href="#cb32-1060"></a></span>
<span id="cb32-1061"><a href="#cb32-1061"></a><span class="in">```{r dist-exercise5, exercise=TRUE, exercise.lines=18, fig.asp=1}</span></span>
<span id="cb32-1062"><a href="#cb32-1062"></a><span class="in">burglary |&gt; </span></span>
<span id="cb32-1063"><a href="#cb32-1063"></a><span class="in">  ggplot(aes(x = count, fill = district)) +</span></span>
<span id="cb32-1064"><a href="#cb32-1064"></a><span class="in">  geom_hline(yintercept = 0, colour = "grey80") +</span></span>
<span id="cb32-1065"><a href="#cb32-1065"></a><span class="in">  geom_histogram(binwidth = 1) +</span></span>
<span id="cb32-1066"><a href="#cb32-1066"></a><span class="in">  facet_grid(rows = vars(district), labeller = label_wrap_gen(width = 10)) +</span></span>
<span id="cb32-1067"><a href="#cb32-1067"></a><span class="in">  labs(</span></span>
<span id="cb32-1068"><a href="#cb32-1068"></a><span class="in">    title = "Number of burglaries in Northamptonshire neighbourhoods",</span></span>
<span id="cb32-1069"><a href="#cb32-1069"></a><span class="in">    x = "count of burglaries, 2020",</span></span>
<span id="cb32-1070"><a href="#cb32-1070"></a><span class="in">    y = "number of LSOAs"</span></span>
<span id="cb32-1071"><a href="#cb32-1071"></a><span class="in">  ) +</span></span>
<span id="cb32-1072"><a href="#cb32-1072"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb32-1073"><a href="#cb32-1073"></a><span class="in">  theme(</span></span>
<span id="cb32-1074"><a href="#cb32-1074"></a><span class="in">    legend.position = "none",</span></span>
<span id="cb32-1075"><a href="#cb32-1075"></a><span class="in">    panel.grid.major.x = element_blank(),</span></span>
<span id="cb32-1076"><a href="#cb32-1076"></a><span class="in">    panel.grid.minor.x = element_blank(),</span></span>
<span id="cb32-1077"><a href="#cb32-1077"></a><span class="in">    strip.text.y = element_text(angle = 0, hjust = 0)</span></span>
<span id="cb32-1078"><a href="#cb32-1078"></a><span class="in">  )</span></span>
<span id="cb32-1079"><a href="#cb32-1079"></a><span class="in">```</span></span>
<span id="cb32-1080"><a href="#cb32-1080"></a></span>
<span id="cb32-1081"><a href="#cb32-1081"></a>You might have noticed we made some other changes to our code for this chart to </span>
<span id="cb32-1082"><a href="#cb32-1082"></a>make it clearer:</span>
<span id="cb32-1083"><a href="#cb32-1083"></a></span>
<span id="cb32-1084"><a href="#cb32-1084"></a><span class="ss">  * </span>Set the dot <span class="in">`fill`</span> to be based on the <span class="in">`district`</span> column in the data, so the </span>
<span id="cb32-1085"><a href="#cb32-1085"></a>    bars in each small multiple will be a different colour. We then remove the </span>
<span id="cb32-1086"><a href="#cb32-1086"></a>    legend that is automatically generated by adding the <span class="in">`fill`</span> aesthetic using </span>
<span id="cb32-1087"><a href="#cb32-1087"></a>    the <span class="in">`legend.position = "none"`</span> attribute to <span class="in">`theme()`</span>, since the legend is </span>
<span id="cb32-1088"><a href="#cb32-1088"></a>    redundant (the same information is shown in the facet labels).</span>
<span id="cb32-1089"><a href="#cb32-1089"></a><span class="ss">  * </span>Removed the values and the title on the *y* axis, since it is clear from the</span>
<span id="cb32-1090"><a href="#cb32-1090"></a>    rest of the chart that the vertical axis shows the count of dots in each</span>
<span id="cb32-1091"><a href="#cb32-1091"></a>    stack.</span>
<span id="cb32-1092"><a href="#cb32-1092"></a><span class="ss">  * </span>Added a horizontal line at zero on the *y* axis using <span class="in">`geom_hline()`</span> to make </span>
<span id="cb32-1093"><a href="#cb32-1093"></a>    it easier to compare the height of each stack of dots to zero.</span>
<span id="cb32-1094"><a href="#cb32-1094"></a><span class="ss">  * </span>Wrapped the facet labels using the <span class="in">`label_wrap_gen()`</span> helper function so </span>
<span id="cb32-1095"><a href="#cb32-1095"></a>    that some of the longer district names don't take up too much space </span>
<span id="cb32-1096"><a href="#cb32-1096"></a>    horizontally.</span>
<span id="cb32-1097"><a href="#cb32-1097"></a><span class="ss">  * </span>Made the facet labels easier to read by making the text horizontal (rather</span>
<span id="cb32-1098"><a href="#cb32-1098"></a>    than the default vertical text) using the <span class="in">`strip.text.y`</span> attribute to </span>
<span id="cb32-1099"><a href="#cb32-1099"></a>    <span class="in">`theme()`</span> and the <span class="in">`element_text()`</span> helper function. <span class="in">`angle`</span> sets the </span>
<span id="cb32-1100"><a href="#cb32-1100"></a>    rotation of the text (or in this case, specifies that there should be no</span>
<span id="cb32-1101"><a href="#cb32-1101"></a>    rotation) and <span class="in">`hjust = 0`</span> specifies that the text should be left aligned.</span>
<span id="cb32-1102"><a href="#cb32-1102"></a></span>
<span id="cb32-1103"><a href="#cb32-1103"></a></span>
<span id="cb32-1104"><a href="#cb32-1104"></a>::: {.tutorial}</span>
<span id="cb32-1105"><a href="#cb32-1105"></a></span>
<span id="cb32-1106"><a href="#cb32-1106"></a>If you want to play around with each of these parts of the code to understand</span>
<span id="cb32-1107"><a href="#cb32-1107"></a>what they do in more detail, remove one part at a time and re-run the code to</span>
<span id="cb32-1108"><a href="#cb32-1108"></a>see how the appearance of the plot changes.</span>
<span id="cb32-1109"><a href="#cb32-1109"></a></span>
<span id="cb32-1110"><a href="#cb32-1110"></a>:::</span>
<span id="cb32-1111"><a href="#cb32-1111"></a></span>
<span id="cb32-1112"><a href="#cb32-1112"></a></span>
<span id="cb32-1113"><a href="#cb32-1113"></a>There are many more-technical ways to show distributions, such as box plots or</span>
<span id="cb32-1114"><a href="#cb32-1114"></a>violin plots. However, these can be difficult to interpret for people who are</span>
<span id="cb32-1115"><a href="#cb32-1115"></a>not used to looking at those particular types of chart, so they should probably</span>
<span id="cb32-1116"><a href="#cb32-1116"></a>be avoided for communicating with general audiences.</span>
<span id="cb32-1117"><a href="#cb32-1117"></a></span>
<span id="cb32-1118"><a href="#cb32-1118"></a></span>
<span id="cb32-1119"><a href="#cb32-1119"></a></span>
<span id="cb32-1120"><a href="#cb32-1120"></a><span class="fu">## Comparing continuous variables</span></span>
<span id="cb32-1121"><a href="#cb32-1121"></a></span>
<span id="cb32-1122"><a href="#cb32-1122"></a>So far we have used bar charts to communicate a single number (in our example,</span>
<span id="cb32-1123"><a href="#cb32-1123"></a>a number of murders) for each value of a categorical variable (the name of each </span>
<span id="cb32-1124"><a href="#cb32-1124"></a>Malaysian state or territory), and histograms to show multiple numbers (burglary</span>
<span id="cb32-1125"><a href="#cb32-1125"></a>counts for each neighbourhood) for each value of a categorical variable </span>
<span id="cb32-1126"><a href="#cb32-1126"></a>(districts in Northamptonshire). </span>
<span id="cb32-1127"><a href="#cb32-1127"></a></span>
<span id="cb32-1128"><a href="#cb32-1128"></a>Both these types of chart compare a numeric variable to a categorical one. But</span>
<span id="cb32-1129"><a href="#cb32-1129"></a>sometimes we may want to compare two categorical variables. We can do this with</span>
<span id="cb32-1130"><a href="#cb32-1130"></a>a *scatter plot*. For example, the object <span class="in">`vehicle_theft`</span> contains rates of </span>
<span id="cb32-1131"><a href="#cb32-1131"></a>thefts of and from motor vehicles per 1,000 households saying they own a vehicle </span>
<span id="cb32-1132"><a href="#cb32-1132"></a>for a selection of <span class="in">`r nrow(vehicle_theft_wider)`</span> municipalities in South </span>
<span id="cb32-1133"><a href="#cb32-1133"></a>Africa. Since thefts *of* vehicle and thefts *from* vehicles are different but </span>
<span id="cb32-1134"><a href="#cb32-1134"></a>related crimes, we might want to see if there is a relationship between counts </span>
<span id="cb32-1135"><a href="#cb32-1135"></a>of each type.</span>
<span id="cb32-1136"><a href="#cb32-1136"></a></span>
<span id="cb32-1139"><a href="#cb32-1139"></a><span class="in">```{r}</span></span>
<span id="cb32-1140"><a href="#cb32-1140"></a>vehicle_theft <span class="sc">|&gt;</span> </span>
<span id="cb32-1141"><a href="#cb32-1141"></a>  <span class="fu">head</span>() <span class="sc">|&gt;</span> </span>
<span id="cb32-1142"><a href="#cb32-1142"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb32-1143"><a href="#cb32-1143"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb32-1144"><a href="#cb32-1144"></a>    <span class="at">title =</span> <span class="st">"Vehicle thefts in South African municipalities"</span>,</span>
<span id="cb32-1145"><a href="#cb32-1145"></a>    <span class="at">subtitle =</span> <span class="st">"a sample of the data"</span></span>
<span id="cb32-1146"><a href="#cb32-1146"></a>  )  <span class="sc">|&gt;</span>  </span>
<span id="cb32-1147"><a href="#cb32-1147"></a>  <span class="fu">tab_options</span>(</span>
<span id="cb32-1148"><a href="#cb32-1148"></a>    <span class="at">heading.align =</span> <span class="st">"left"</span></span>
<span id="cb32-1149"><a href="#cb32-1149"></a>  )</span>
<span id="cb32-1150"><a href="#cb32-1150"></a><span class="in">```</span></span>
<span id="cb32-1151"><a href="#cb32-1151"></a></span>
<span id="cb32-1152"><a href="#cb32-1152"></a>To create a <span class="in">`ggplot()`</span> scatter plot we use <span class="in">`geom_point()`</span>, the same function we</span>
<span id="cb32-1153"><a href="#cb32-1153"></a>previously used to create point maps. This makes sense, since point maps are a</span>
<span id="cb32-1154"><a href="#cb32-1154"></a>specialised type of scatter plot in which the *x* and *y* axes of the chart show</span>
<span id="cb32-1155"><a href="#cb32-1155"></a>the latitude and longitude or easting and northing of each crime location.</span>
<span id="cb32-1156"><a href="#cb32-1156"></a></span>
<span id="cb32-1157"><a href="#cb32-1157"></a>The data in the <span class="in">`vehicle_theft`</span> object are in long format, with each row</span>
<span id="cb32-1158"><a href="#cb32-1158"></a>representing a count of crime in a particular category for a particular </span>
<span id="cb32-1159"><a href="#cb32-1159"></a>municipality. To make a scatter plot where each point represents a municipality, </span>
<span id="cb32-1160"><a href="#cb32-1160"></a>we need to have all the data for a municipality in a single row of data, so we </span>
<span id="cb32-1161"><a href="#cb32-1161"></a>will need to transform the data with <span class="in">`pivot_wider()`</span> (as we did for some of the </span>
<span id="cb32-1162"><a href="#cb32-1162"></a>tables at the start of this tutorial). Since this will turn the crime categories </span>
<span id="cb32-1163"><a href="#cb32-1163"></a>into column names, we will first change the column names to clean names (i.e. </span>
<span id="cb32-1164"><a href="#cb32-1164"></a>containing only lower-case letters, numbers and underscores) using <span class="in">`recode()`</span> to </span>
<span id="cb32-1165"><a href="#cb32-1165"></a>make the column names easier to work with. </span>
<span id="cb32-1166"><a href="#cb32-1166"></a></span>
<span id="cb32-1167"><a href="#cb32-1167"></a><span class="in">```{r scatter-exercise1, exercise=TRUE}</span></span>
<span id="cb32-1168"><a href="#cb32-1168"></a><span class="in">vehicle_theft_wider &lt;- vehicle_theft |&gt; </span></span>
<span id="cb32-1169"><a href="#cb32-1169"></a><span class="in">  mutate(</span></span>
<span id="cb32-1170"><a href="#cb32-1170"></a><span class="in">    crime_category = recode(</span></span>
<span id="cb32-1171"><a href="#cb32-1171"></a><span class="in">      crime_category,</span></span>
<span id="cb32-1172"><a href="#cb32-1172"></a><span class="in">      "Theft of motor vehicle" = "theft_of",</span></span>
<span id="cb32-1173"><a href="#cb32-1173"></a><span class="in">      "Theft out of or from motor vehicle" = "theft_from"</span></span>
<span id="cb32-1174"><a href="#cb32-1174"></a><span class="in">    )</span></span>
<span id="cb32-1175"><a href="#cb32-1175"></a><span class="in">  ) |&gt; </span></span>
<span id="cb32-1176"><a href="#cb32-1176"></a><span class="in">  pivot_wider(names_from = crime_category, values_from = theft_rate)</span></span>
<span id="cb32-1177"><a href="#cb32-1177"></a><span class="in">```</span></span>
<span id="cb32-1178"><a href="#cb32-1178"></a></span>
<span id="cb32-1179"><a href="#cb32-1179"></a>We can now make a basic scatter plot.</span>
<span id="cb32-1180"><a href="#cb32-1180"></a></span>
<span id="cb32-1181"><a href="#cb32-1181"></a><span class="in">```{r scatter-exercise2, exercise=TRUE, fig.asp=1}</span></span>
<span id="cb32-1182"><a href="#cb32-1182"></a><span class="in">ggplot(vehicle_theft_wider, aes(x = theft_of, y = theft_from)) +</span></span>
<span id="cb32-1183"><a href="#cb32-1183"></a><span class="in">  geom_point() +</span></span>
<span id="cb32-1184"><a href="#cb32-1184"></a><span class="in">  scale_x_continuous(labels = scales::comma_format()) +</span></span>
<span id="cb32-1185"><a href="#cb32-1185"></a><span class="in">  scale_y_continuous(labels = scales::comma_format()) +</span></span>
<span id="cb32-1186"><a href="#cb32-1186"></a><span class="in">  labs(</span></span>
<span id="cb32-1187"><a href="#cb32-1187"></a><span class="in">    title = "Vehicle thefts in South African municipalities",</span></span>
<span id="cb32-1188"><a href="#cb32-1188"></a><span class="in">    subtitle = "each dot represents one municipality, 2018-19",</span></span>
<span id="cb32-1189"><a href="#cb32-1189"></a><span class="in">    x = "rate of thefts of motor vehicles per 1,000 vehicle-owning households",</span></span>
<span id="cb32-1190"><a href="#cb32-1190"></a><span class="in">    y = "rate of thefts from motor vehicles per 1,000 vehicle-owning households"</span></span>
<span id="cb32-1191"><a href="#cb32-1191"></a><span class="in">  ) +</span></span>
<span id="cb32-1192"><a href="#cb32-1192"></a><span class="in">  theme_minimal()</span></span>
<span id="cb32-1193"><a href="#cb32-1193"></a><span class="in">```</span></span>
<span id="cb32-1194"><a href="#cb32-1194"></a></span>
<span id="cb32-1195"><a href="#cb32-1195"></a>From this plot we can see that most areas have low rates of both theft of and</span>
<span id="cb32-1196"><a href="#cb32-1196"></a>theft from motor vehicles, with a few areas having very-high rates of one type</span>
<span id="cb32-1197"><a href="#cb32-1197"></a>or the other (but none have high rates of both).</span>
<span id="cb32-1198"><a href="#cb32-1198"></a></span>
<span id="cb32-1199"><a href="#cb32-1199"></a>Looking at the bottom-left corner of the chart we can see that we have again</span>
<span id="cb32-1200"><a href="#cb32-1200"></a>encountered the problem of overlapping points making patterns less clear. We can</span>
<span id="cb32-1201"><a href="#cb32-1201"></a>try to deal with this by making the points semi-transparent using the <span class="in">`alpha`</span></span>
<span id="cb32-1202"><a href="#cb32-1202"></a>argument to <span class="in">`geom_point()`</span>.</span>
<span id="cb32-1203"><a href="#cb32-1203"></a></span>
<span id="cb32-1204"><a href="#cb32-1204"></a>Scatter plots can be hard for people to interpret, especially if they are not </span>
<span id="cb32-1205"><a href="#cb32-1205"></a>used to interpreting charts. To help readers, we can annotate the plot to show</span>
<span id="cb32-1206"><a href="#cb32-1206"></a>how to interpret each region of the chart. We will add two types of annotation:</span>
<span id="cb32-1207"><a href="#cb32-1207"></a>lines to show the median value on each axis, and labels to help interpretation.</span>
<span id="cb32-1208"><a href="#cb32-1208"></a></span>
<span id="cb32-1209"><a href="#cb32-1209"></a>We can add median lines using the <span class="in">`geom_hline()`</span> and <span class="in">`geom_vline()`</span> functions,</span>
<span id="cb32-1210"><a href="#cb32-1210"></a>which add horizontal and vertical lines to plots. We will add these to the</span>
<span id="cb32-1211"><a href="#cb32-1211"></a><span class="in">`ggplot()`</span> stack *before* `geom_point()` so that the lines appear *behind* the</span>
<span id="cb32-1212"><a href="#cb32-1212"></a>points.</span>
<span id="cb32-1213"><a href="#cb32-1213"></a></span>
<span id="cb32-1214"><a href="#cb32-1214"></a>To add text annotations we use the <span class="in">`annotate()`</span> function from <span class="in">`ggplot2`</span>, which</span>
<span id="cb32-1215"><a href="#cb32-1215"></a>allows us to add data to a chart by specifying the aesthetics (*x* and *y*</span>
<span id="cb32-1216"><a href="#cb32-1216"></a>position, etc.) directly rather than by referencing columns in the data. To add</span>
<span id="cb32-1217"><a href="#cb32-1217"></a>a text annotation, we set the <span class="in">`geom`</span> argument of <span class="in">`annotate()`</span> to <span class="in">`"text"`</span>.</span>
<span id="cb32-1218"><a href="#cb32-1218"></a></span>
<span id="cb32-1219"><a href="#cb32-1219"></a><span class="in">```{r scatter-exercise3, exercise=TRUE, exercise.lines=40, fig.asp=1}</span></span>
<span id="cb32-1220"><a href="#cb32-1220"></a><span class="in">ggplot(vehicle_theft_wider, aes(x = theft_of, y = theft_from)) +</span></span>
<span id="cb32-1221"><a href="#cb32-1221"></a><span class="in">  geom_vline(</span></span>
<span id="cb32-1222"><a href="#cb32-1222"></a><span class="in">    xintercept = median(pull(vehicle_theft_wider, "theft_of")),</span></span>
<span id="cb32-1223"><a href="#cb32-1223"></a><span class="in">    linetype = "22"</span></span>
<span id="cb32-1224"><a href="#cb32-1224"></a><span class="in">  ) +</span></span>
<span id="cb32-1225"><a href="#cb32-1225"></a><span class="in">  geom_hline(</span></span>
<span id="cb32-1226"><a href="#cb32-1226"></a><span class="in">    yintercept = median(pull(vehicle_theft_wider, "theft_from")),</span></span>
<span id="cb32-1227"><a href="#cb32-1227"></a><span class="in">    linetype = "22"</span></span>
<span id="cb32-1228"><a href="#cb32-1228"></a><span class="in">  ) +</span></span>
<span id="cb32-1229"><a href="#cb32-1229"></a><span class="in">  geom_point(alpha = 0.5) +</span></span>
<span id="cb32-1230"><a href="#cb32-1230"></a><span class="in">  annotate(</span></span>
<span id="cb32-1231"><a href="#cb32-1231"></a><span class="in">    geom = "text", </span></span>
<span id="cb32-1232"><a href="#cb32-1232"></a><span class="in">    x = 20, </span></span>
<span id="cb32-1233"><a href="#cb32-1233"></a><span class="in">    y = 0, </span></span>
<span id="cb32-1234"><a href="#cb32-1234"></a><span class="in">    label = "high rate of thefts of vehicles\nlow rate of thefts from vehicles", </span></span>
<span id="cb32-1235"><a href="#cb32-1235"></a><span class="in">    hjust = 1,</span></span>
<span id="cb32-1236"><a href="#cb32-1236"></a><span class="in">    lineheight = 1</span></span>
<span id="cb32-1237"><a href="#cb32-1237"></a><span class="in">  ) +</span></span>
<span id="cb32-1238"><a href="#cb32-1238"></a><span class="in">  annotate(</span></span>
<span id="cb32-1239"><a href="#cb32-1239"></a><span class="in">    geom = "text", </span></span>
<span id="cb32-1240"><a href="#cb32-1240"></a><span class="in">    x = 1, </span></span>
<span id="cb32-1241"><a href="#cb32-1241"></a><span class="in">    y = 75, </span></span>
<span id="cb32-1242"><a href="#cb32-1242"></a><span class="in">    label = "low rate of thefts of vehicles\nhigh rate of thefts from vehicles", </span></span>
<span id="cb32-1243"><a href="#cb32-1243"></a><span class="in">    hjust = 0,</span></span>
<span id="cb32-1244"><a href="#cb32-1244"></a><span class="in">    lineheight = 1</span></span>
<span id="cb32-1245"><a href="#cb32-1245"></a><span class="in">  ) +</span></span>
<span id="cb32-1246"><a href="#cb32-1246"></a><span class="in">  scale_x_continuous(labels = scales::comma_format()) +</span></span>
<span id="cb32-1247"><a href="#cb32-1247"></a><span class="in">  scale_y_continuous(labels = scales::comma_format()) +</span></span>
<span id="cb32-1248"><a href="#cb32-1248"></a><span class="in">  labs(</span></span>
<span id="cb32-1249"><a href="#cb32-1249"></a><span class="in">    title = "Vehicle thefts in South African municipalities",</span></span>
<span id="cb32-1250"><a href="#cb32-1250"></a><span class="in">    subtitle = str_glue(</span></span>
<span id="cb32-1251"><a href="#cb32-1251"></a><span class="in">      "each dot represents one municipality, 2018-19, dashed lines show ",</span></span>
<span id="cb32-1252"><a href="#cb32-1252"></a><span class="in">      "median values"</span></span>
<span id="cb32-1253"><a href="#cb32-1253"></a><span class="in">    ),</span></span>
<span id="cb32-1254"><a href="#cb32-1254"></a><span class="in">    x = "rate of thefts of motor vehicles per 1,000 vehicle-owning households",</span></span>
<span id="cb32-1255"><a href="#cb32-1255"></a><span class="in">    y = "rate of thefts from motor vehicles per 1,000 vehicle-owning households"</span></span>
<span id="cb32-1256"><a href="#cb32-1256"></a><span class="in">  ) +</span></span>
<span id="cb32-1257"><a href="#cb32-1257"></a><span class="in">  theme_minimal()</span></span>
<span id="cb32-1258"><a href="#cb32-1258"></a><span class="in">```</span></span>
<span id="cb32-1259"><a href="#cb32-1259"></a></span>
<span id="cb32-1260"><a href="#cb32-1260"></a>From this plot we can now see that half of municipalities have very low rates of </span>
<span id="cb32-1261"><a href="#cb32-1261"></a>both types of theft (shown by the dots below and to the left of the median </span>
<span id="cb32-1262"><a href="#cb32-1262"></a>lines).</span>
<span id="cb32-1263"><a href="#cb32-1263"></a></span>
<span id="cb32-1264"><a href="#cb32-1264"></a>We can make some further changes to this chart. For example, instead of </span>
<span id="cb32-1265"><a href="#cb32-1265"></a>labelling areas on the plot we could instead label the municipalities with high</span>
<span id="cb32-1266"><a href="#cb32-1266"></a>rates of vehicle theft (we cannot include both types of label because they would</span>
<span id="cb32-1267"><a href="#cb32-1267"></a>overlap). To do that, we will create a new column in the data containing either</span>
<span id="cb32-1268"><a href="#cb32-1268"></a>the municipality name (for high-rate municipalities) or <span class="in">`NA`</span> (meaning <span class="in">`ggplot()`</span></span>
<span id="cb32-1269"><a href="#cb32-1269"></a>will not create a label for that row if we set <span class="in">`na.rm = TRUE`</span>). We can then use </span>
<span id="cb32-1270"><a href="#cb32-1270"></a><span class="in">`geom_label_repel()`</span> to add the labels to the chart, remembering to add </span>
<span id="cb32-1271"><a href="#cb32-1271"></a><span class="in">`label = label`</span> to the <span class="in">`aes()`</span> function so <span class="in">`ggplot()`</span> knows which column in the </span>
<span id="cb32-1272"><a href="#cb32-1272"></a>data to use for the labels.</span>
<span id="cb32-1273"><a href="#cb32-1273"></a></span>
<span id="cb32-1274"><a href="#cb32-1274"></a><span class="in">```{r scatter-exercise4, exercise=TRUE, exercise.lines=28, fig.asp=1}</span></span>
<span id="cb32-1275"><a href="#cb32-1275"></a><span class="in">library(ggrepel)</span></span>
<span id="cb32-1276"><a href="#cb32-1276"></a></span>
<span id="cb32-1277"><a href="#cb32-1277"></a><span class="in">vehicle_theft_wider |&gt; </span></span>
<span id="cb32-1278"><a href="#cb32-1278"></a><span class="in">  mutate(</span></span>
<span id="cb32-1279"><a href="#cb32-1279"></a><span class="in">    label = if_else(theft_of &gt; 17 | theft_from &gt; 65, municipality, NA_character_)</span></span>
<span id="cb32-1280"><a href="#cb32-1280"></a><span class="in">  ) |&gt; </span></span>
<span id="cb32-1281"><a href="#cb32-1281"></a><span class="in">  ggplot(aes(x = theft_of, y = theft_from, label = label)) +</span></span>
<span id="cb32-1282"><a href="#cb32-1282"></a><span class="in">  geom_vline(</span></span>
<span id="cb32-1283"><a href="#cb32-1283"></a><span class="in">    xintercept = median(pull(vehicle_theft_wider, "theft_of")),</span></span>
<span id="cb32-1284"><a href="#cb32-1284"></a><span class="in">    linetype = "22"</span></span>
<span id="cb32-1285"><a href="#cb32-1285"></a><span class="in">  ) +</span></span>
<span id="cb32-1286"><a href="#cb32-1286"></a><span class="in">  geom_hline(</span></span>
<span id="cb32-1287"><a href="#cb32-1287"></a><span class="in">    yintercept = median(pull(vehicle_theft_wider, "theft_from")),</span></span>
<span id="cb32-1288"><a href="#cb32-1288"></a><span class="in">    linetype = "22"</span></span>
<span id="cb32-1289"><a href="#cb32-1289"></a><span class="in">  ) +</span></span>
<span id="cb32-1290"><a href="#cb32-1290"></a><span class="in">  geom_point(alpha = 0.2) +</span></span>
<span id="cb32-1291"><a href="#cb32-1291"></a><span class="in">  geom_label_repel(na.rm = TRUE, label.size = 0, lineheight = 1) +</span></span>
<span id="cb32-1292"><a href="#cb32-1292"></a><span class="in">  scale_x_continuous(labels = scales::comma_format()) +</span></span>
<span id="cb32-1293"><a href="#cb32-1293"></a><span class="in">  scale_y_continuous(labels = scales::comma_format()) +</span></span>
<span id="cb32-1294"><a href="#cb32-1294"></a><span class="in">  labs(</span></span>
<span id="cb32-1295"><a href="#cb32-1295"></a><span class="in">    title = "Vehicle thefts in South African municipalities",</span></span>
<span id="cb32-1296"><a href="#cb32-1296"></a><span class="in">    subtitle = str_glue(</span></span>
<span id="cb32-1297"><a href="#cb32-1297"></a><span class="in">      "each dot represents one municipality, 2018-19, dashed lines show ",</span></span>
<span id="cb32-1298"><a href="#cb32-1298"></a><span class="in">      "median values"</span></span>
<span id="cb32-1299"><a href="#cb32-1299"></a><span class="in">    ),</span></span>
<span id="cb32-1300"><a href="#cb32-1300"></a><span class="in">    x = "rate of thefts of motor vehicles per 1,000 vehicle-owning households",</span></span>
<span id="cb32-1301"><a href="#cb32-1301"></a><span class="in">    y = "rate of thefts from motor vehicles per 1,000 vehicle-owning households"</span></span>
<span id="cb32-1302"><a href="#cb32-1302"></a><span class="in">  ) +</span></span>
<span id="cb32-1303"><a href="#cb32-1303"></a><span class="in">  theme_minimal()</span></span>
<span id="cb32-1304"><a href="#cb32-1304"></a><span class="in">```</span></span>
<span id="cb32-1305"><a href="#cb32-1305"></a></span>
<span id="cb32-1306"><a href="#cb32-1306"></a>Finally, we can add a trend line to the plot. We do this using the </span>
<span id="cb32-1307"><a href="#cb32-1307"></a><span class="in">`geom_smooth()`</span> function from <span class="in">`ggplot2`</span>. <span class="in">`geom_smooth()`</span> can add different types</span>
<span id="cb32-1308"><a href="#cb32-1308"></a>of trend line to a plot, but in this example we will specify a simple linear</span>
<span id="cb32-1309"><a href="#cb32-1309"></a>trend line by setting <span class="in">`method = "lm"`</span>. We will also specify <span class="in">`formula = y ~ x`</span></span>
<span id="cb32-1310"><a href="#cb32-1310"></a>(the default) to avoid <span class="in">`geom_smooth()`</span> producing a message to tell us what</span>
<span id="cb32-1311"><a href="#cb32-1311"></a>formula it used to calculate the trend.</span>
<span id="cb32-1312"><a href="#cb32-1312"></a></span>
<span id="cb32-1313"><a href="#cb32-1313"></a><span class="in">```{r scatter-exercise5, exercise=TRUE, exercise.lines=27, fig.asp=1}</span></span>
<span id="cb32-1314"><a href="#cb32-1314"></a><span class="in">vehicle_theft_wider |&gt; </span></span>
<span id="cb32-1315"><a href="#cb32-1315"></a><span class="in">  mutate(</span></span>
<span id="cb32-1316"><a href="#cb32-1316"></a><span class="in">    label = if_else(theft_of &gt; 17 | theft_from &gt; 65, municipality, NA_character_)</span></span>
<span id="cb32-1317"><a href="#cb32-1317"></a><span class="in">  ) |&gt; </span></span>
<span id="cb32-1318"><a href="#cb32-1318"></a><span class="in">  ggplot(aes(x = theft_of, y = theft_from)) +</span></span>
<span id="cb32-1319"><a href="#cb32-1319"></a><span class="in">  geom_vline(</span></span>
<span id="cb32-1320"><a href="#cb32-1320"></a><span class="in">    xintercept = median(pull(vehicle_theft_wider, "theft_of")),</span></span>
<span id="cb32-1321"><a href="#cb32-1321"></a><span class="in">    linetype = "22"</span></span>
<span id="cb32-1322"><a href="#cb32-1322"></a><span class="in">  ) +</span></span>
<span id="cb32-1323"><a href="#cb32-1323"></a><span class="in">  geom_hline(</span></span>
<span id="cb32-1324"><a href="#cb32-1324"></a><span class="in">    yintercept = median(pull(vehicle_theft_wider, "theft_from")),</span></span>
<span id="cb32-1325"><a href="#cb32-1325"></a><span class="in">    linetype = "22"</span></span>
<span id="cb32-1326"><a href="#cb32-1326"></a><span class="in">  ) +</span></span>
<span id="cb32-1327"><a href="#cb32-1327"></a><span class="in">  geom_smooth(method = "lm", formula = y ~ x, colour = "grey20") +</span></span>
<span id="cb32-1328"><a href="#cb32-1328"></a><span class="in">  geom_point(alpha = 0.2) +</span></span>
<span id="cb32-1329"><a href="#cb32-1329"></a><span class="in">  geom_label_repel(</span></span>
<span id="cb32-1330"><a href="#cb32-1330"></a><span class="in">    aes(label = label), </span></span>
<span id="cb32-1331"><a href="#cb32-1331"></a><span class="in">    na.rm = TRUE, </span></span>
<span id="cb32-1332"><a href="#cb32-1332"></a><span class="in">    label.size = 0, </span></span>
<span id="cb32-1333"><a href="#cb32-1333"></a><span class="in">    lineheight = 1</span></span>
<span id="cb32-1334"><a href="#cb32-1334"></a><span class="in">  ) +</span></span>
<span id="cb32-1335"><a href="#cb32-1335"></a><span class="in">  scale_x_continuous(labels = scales::comma_format()) +</span></span>
<span id="cb32-1336"><a href="#cb32-1336"></a><span class="in">  scale_y_continuous(labels = scales::comma_format()) +</span></span>
<span id="cb32-1337"><a href="#cb32-1337"></a><span class="in">  labs(</span></span>
<span id="cb32-1338"><a href="#cb32-1338"></a><span class="in">    title = "Vehicle thefts in South African municipalities",</span></span>
<span id="cb32-1339"><a href="#cb32-1339"></a><span class="in">    subtitle = str_glue(</span></span>
<span id="cb32-1340"><a href="#cb32-1340"></a><span class="in">      "each dot represents one municipality, 2018-19, dashed lines show ",</span></span>
<span id="cb32-1341"><a href="#cb32-1341"></a><span class="in">      "median values"</span></span>
<span id="cb32-1342"><a href="#cb32-1342"></a><span class="in">    ),</span></span>
<span id="cb32-1343"><a href="#cb32-1343"></a><span class="in">    x = "rate of thefts of motor vehicles per 1,000 vehicle-owning households",</span></span>
<span id="cb32-1344"><a href="#cb32-1344"></a><span class="in">    y = "rate of thefts from motor vehicles per 1,000 vehicle-owning households"</span></span>
<span id="cb32-1345"><a href="#cb32-1345"></a><span class="in">  ) +</span></span>
<span id="cb32-1346"><a href="#cb32-1346"></a><span class="in">  theme_minimal()</span></span>
<span id="cb32-1347"><a href="#cb32-1347"></a><span class="in">```</span></span>
<span id="cb32-1348"><a href="#cb32-1348"></a></span>
<span id="cb32-1349"><a href="#cb32-1349"></a>From this chart, we can see which municipalities have particularly unusual </span>
<span id="cb32-1350"><a href="#cb32-1350"></a>vehicle theft rates. For example, we might well want to explore the rates of</span>
<span id="cb32-1351"><a href="#cb32-1351"></a>theft from vehicles in Beaufort West or Stellenbosch municipalities to see what </span>
<span id="cb32-1352"><a href="#cb32-1352"></a>makes them so different from the others, and similarly for the rate of theft of </span>
<span id="cb32-1353"><a href="#cb32-1353"></a>vehicles in Ethekwini.</span>
<span id="cb32-1354"><a href="#cb32-1354"></a></span>
<span id="cb32-1355"><a href="#cb32-1355"></a>One note of caution when using <span class="in">`geom_smooth()`</span>: this function will show the</span>
<span id="cb32-1356"><a href="#cb32-1356"></a>_direction_ of the relationship between two variables regardless of the </span>
<span id="cb32-1357"><a href="#cb32-1357"></a>_strength_ of that relationship. In extreme cases, that could mean that a chart</span>
<span id="cb32-1358"><a href="#cb32-1358"></a>would show a trend line between two variables even if the variables had almost</span>
<span id="cb32-1359"><a href="#cb32-1359"></a>no relationship to one another.</span>
<span id="cb32-1360"><a href="#cb32-1360"></a></span>
<span id="cb32-1361"><a href="#cb32-1361"></a>For example, <span class="in">`geom_smooth()`</span> produces a line showing the direction of the </span>
<span id="cb32-1362"><a href="#cb32-1362"></a>relationship between the two variables in each of these three charts, even </span>
<span id="cb32-1363"><a href="#cb32-1363"></a>though the relationship on the right is much stronger than the one on the left.</span>
<span id="cb32-1364"><a href="#cb32-1364"></a></span>
<span id="cb32-1365"><a href="#cb32-1365"></a><span class="in">```{r geom-smooth-relationships, out.width="100%"}</span></span>
<span id="cb32-1366"><a href="#cb32-1366"></a><span class="in">tibble(</span></span>
<span id="cb32-1367"><a href="#cb32-1367"></a><span class="in">  group = factor(</span></span>
<span id="cb32-1368"><a href="#cb32-1368"></a><span class="in">    c("weak relationship", "moderate relationship", "strong relationship"), </span></span>
<span id="cb32-1369"><a href="#cb32-1369"></a><span class="in">    levels = c("weak relationship", "moderate relationship", "strong relationship")</span></span>
<span id="cb32-1370"><a href="#cb32-1370"></a><span class="in">  ),</span></span>
<span id="cb32-1371"><a href="#cb32-1371"></a><span class="in">  x = list(1:10, 1:10, 1:10)</span></span>
<span id="cb32-1372"><a href="#cb32-1372"></a><span class="in">) |&gt; </span></span>
<span id="cb32-1373"><a href="#cb32-1373"></a><span class="in">  mutate(</span></span>
<span id="cb32-1374"><a href="#cb32-1374"></a><span class="in">    sd = recode(</span></span>
<span id="cb32-1375"><a href="#cb32-1375"></a><span class="in">      group, </span></span>
<span id="cb32-1376"><a href="#cb32-1376"></a><span class="in">      "weak relationship" = 10, </span></span>
<span id="cb32-1377"><a href="#cb32-1377"></a><span class="in">      "moderate relationship" = 4, </span></span>
<span id="cb32-1378"><a href="#cb32-1378"></a><span class="in">      "strong relationship" = 0.5</span></span>
<span id="cb32-1379"><a href="#cb32-1379"></a><span class="in">    )</span></span>
<span id="cb32-1380"><a href="#cb32-1380"></a><span class="in">  ) |&gt; </span></span>
<span id="cb32-1381"><a href="#cb32-1381"></a><span class="in">  group_by(sd) |&gt; </span></span>
<span id="cb32-1382"><a href="#cb32-1382"></a><span class="in">  mutate(y = list(rnorm(10, sd = sd))) |&gt; </span></span>
<span id="cb32-1383"><a href="#cb32-1383"></a><span class="in">  unnest(c(x, y)) |&gt; </span></span>
<span id="cb32-1384"><a href="#cb32-1384"></a><span class="in">  mutate(y = scales::rescale(x + y, to = c(0, 10))) |&gt; </span></span>
<span id="cb32-1385"><a href="#cb32-1385"></a><span class="in">  ungroup() |&gt; </span></span>
<span id="cb32-1386"><a href="#cb32-1386"></a><span class="in">  ggplot(aes(x = x, y = y, colour = group)) + </span></span>
<span id="cb32-1387"><a href="#cb32-1387"></a><span class="in">  geom_smooth(method = "lm", formula = "y ~ x", se = FALSE, na.rm = TRUE) +</span></span>
<span id="cb32-1388"><a href="#cb32-1388"></a><span class="in">  geom_point() +</span></span>
<span id="cb32-1389"><a href="#cb32-1389"></a><span class="in">  scale_x_continuous(limits = c(0, 10)) +</span></span>
<span id="cb32-1390"><a href="#cb32-1390"></a><span class="in">  scale_y_continuous(limits = c(0, 10)) +</span></span>
<span id="cb32-1391"><a href="#cb32-1391"></a><span class="in">  labs(x = NULL, y = NULL) +</span></span>
<span id="cb32-1392"><a href="#cb32-1392"></a><span class="in">  coord_fixed() +</span></span>
<span id="cb32-1393"><a href="#cb32-1393"></a><span class="in">  facet_grid(cols = vars(group)) +</span></span>
<span id="cb32-1394"><a href="#cb32-1394"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb32-1395"><a href="#cb32-1395"></a><span class="in">  theme(</span></span>
<span id="cb32-1396"><a href="#cb32-1396"></a><span class="in">    axis.text = element_blank(),</span></span>
<span id="cb32-1397"><a href="#cb32-1397"></a><span class="in">    axis.ticks = element_blank(),</span></span>
<span id="cb32-1398"><a href="#cb32-1398"></a><span class="in">    legend.position = "none"</span></span>
<span id="cb32-1399"><a href="#cb32-1399"></a><span class="in">  )</span></span>
<span id="cb32-1400"><a href="#cb32-1400"></a><span class="in">```</span></span>
<span id="cb32-1401"><a href="#cb32-1401"></a></span>
<span id="cb32-1402"><a href="#cb32-1402"></a></span>
<span id="cb32-1403"><a href="#cb32-1403"></a>::: {.box .notewell}</span>
<span id="cb32-1404"><a href="#cb32-1404"></a></span>
<span id="cb32-1405"><a href="#cb32-1405"></a>Be very careful about trying to interpret the strength of relationships between</span>
<span id="cb32-1406"><a href="#cb32-1406"></a>two variables by plotting them on a chart. It is much better to measure the</span>
<span id="cb32-1407"><a href="#cb32-1407"></a>strength of the relationship using a statistical test such as a correlation </span>
<span id="cb32-1408"><a href="#cb32-1408"></a>test, but statistical tests are outside the scope of this course.</span>
<span id="cb32-1409"><a href="#cb32-1409"></a></span>
<span id="cb32-1410"><a href="#cb32-1410"></a>:::</span>
<span id="cb32-1411"><a href="#cb32-1411"></a></span>
<span id="cb32-1412"><a href="#cb32-1412"></a></span>
<span id="cb32-1413"><a href="#cb32-1413"></a><span class="fu">## In summary</span></span>
<span id="cb32-1414"><a href="#cb32-1414"></a></span>
<span id="cb32-1415"><a href="#cb32-1415"></a></span>
<span id="cb32-1416"><a href="#cb32-1416"></a>::: {.box .welldone}</span>
<span id="cb32-1417"><a href="#cb32-1417"></a></span>
<span id="cb32-1418"><a href="#cb32-1418"></a>In this tutorial we have learned how to present data about crime at places </span>
<span id="cb32-1419"><a href="#cb32-1419"></a>without using maps. These techniques give us more flexibility about how to best </span>
<span id="cb32-1420"><a href="#cb32-1420"></a>present data to communicate the main points that we want to get across.</span>
<span id="cb32-1421"><a href="#cb32-1421"></a></span>
<span id="cb32-1422"><a href="#cb32-1422"></a>Whether to use a map or a chart, and which type of map or chart to use, are</span>
<span id="cb32-1423"><a href="#cb32-1423"></a>design decisions for you to make. When you make these decisions, always remember</span>
<span id="cb32-1424"><a href="#cb32-1424"></a>that what is most important is that your audience understands your message. This</span>
<span id="cb32-1425"><a href="#cb32-1425"></a>makes it very important that you understand your audience.</span>
<span id="cb32-1426"><a href="#cb32-1426"></a></span>
<span id="cb32-1427"><a href="#cb32-1427"></a>:::</span>
<span id="cb32-1428"><a href="#cb32-1428"></a></span>
<span id="cb32-1429"><a href="#cb32-1429"></a></span>
<span id="cb32-1430"><a href="#cb32-1430"></a>Visualising data with charts is a very large topic and there are lots of </span>
<span id="cb32-1431"><a href="#cb32-1431"></a>resources available to help you learn more. To get started, you might want to</span>
<span id="cb32-1432"><a href="#cb32-1432"></a>look at:</span>
<span id="cb32-1433"><a href="#cb32-1433"></a></span>
<span id="cb32-1434"><a href="#cb32-1434"></a><span class="ss">  * </span><span class="co">[</span><span class="ot">An Introduction to ggplot2</span><span class="co">](https://uc-r.github.io/ggplot_intro)</span> from the</span>
<span id="cb32-1435"><a href="#cb32-1435"></a>    University of Cincinnati Business Analytics team.</span>
<span id="cb32-1436"><a href="#cb32-1436"></a><span class="ss">  * </span>The <span class="co">[</span><span class="ot">ggplot2 cheat sheet</span><span class="co">](https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf)</span></span>
<span id="cb32-1437"><a href="#cb32-1437"></a>    by the team that develops the `ggplot2 package.</span>
<span id="cb32-1438"><a href="#cb32-1438"></a><span class="ss">  * </span>The <span class="co">[</span><span class="ot">R Graph Gallery</span><span class="co">](https://www.r-graph-gallery.com/)</span> for examples of many</span>
<span id="cb32-1439"><a href="#cb32-1439"></a>    other types of chart that you can produce in R.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://creativecommons.org/licenses/by/4.0/">
<p>This book is available under a Creative Commons Attribution 4.0 International licence</p>
</a>
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mpjashby/crimemappingbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>