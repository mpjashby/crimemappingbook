<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>13&nbsp; Mapping crime series – Learn Crime Mapping with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../14_writing_reports/index.html" rel="next">
<link href="../12_messy_data/index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- START OF INCLUDED HEADER -->

<!--
This file contains code that will be included in the header of each page of the
quarto book
-->

<script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>

<!-- END OF INCLUDED HEADER -->


<link rel="stylesheet" href="../css/styles.css">
<link rel="stylesheet" href="../include/webex.css">
<meta name="twitter:title" content="13&nbsp; Mapping crime series – Learn Crime Mapping with R">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="../images/cover_image.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../13_crime_series/index.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Mapping crime series</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/cover_image.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Learn Crime Mapping with R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/mpjashby/crimemappingbook/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contents</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Install the software needed for this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_getting_started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_your_first_crime_map/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Your first crime map</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_data_wrangling/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Wrangling data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_your_second_crime_map/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Your second crime map</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_code_with_style/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Code with style</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_mapping_crime_patterns/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Mapping crime patterns</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_map_context/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Giving a map context</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08_handling_bugs/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Handling bugs in your code</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../09_mapping_areas/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Mapping area data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../10_place_data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Using data about places</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../11_mapping_hotspots/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Mapping hotspots</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../12_messy_data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Handling messy data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../13_crime_series/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Mapping crime series</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../14_writing_reports/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Writing reports in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../15_no_maps/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Presenting spatial data without maps</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../16_mapping_time/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Mapping crime over time</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/read_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Functions for reading data into R #sec-load-functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/map_checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Checklist: Making a good crime map</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/common_errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Common R errors and how to fix them</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/functions_to_avoid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Some R functions you should avoid</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/handling_errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Checklist: handling code errors</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">In this chapter</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">13.1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#case-linkage" id="toc-case-linkage" class="nav-link" data-scroll-target="#case-linkage"><span class="header-section-number">13.1.1</span> Case linkage</a></li>
  <li><a href="#the-case-used-in-this-tutorial" id="toc-the-case-used-in-this-tutorial" class="nav-link" data-scroll-target="#the-case-used-in-this-tutorial"><span class="header-section-number">13.1.2</span> The case used in this tutorial</a></li>
  </ul></li>
  <li><a href="#mapping-linked-cases" id="toc-mapping-linked-cases" class="nav-link" data-scroll-target="#mapping-linked-cases"><span class="header-section-number">13.2</span> Mapping linked cases</a>
  <ul class="collapse">
  <li><a href="#extending-the-map-area" id="toc-extending-the-map-area" class="nav-link" data-scroll-target="#extending-the-map-area"><span class="header-section-number">13.2.1</span> Extending the map area</a></li>
  <li><a href="#adding-arrows-and-curves" id="toc-adding-arrows-and-curves" class="nav-link" data-scroll-target="#adding-arrows-and-curves"><span class="header-section-number">13.2.2</span> Adding arrows and curves</a></li>
  </ul></li>
  <li><a href="#multiple-maps" id="toc-multiple-maps" class="nav-link" data-scroll-target="#multiple-maps"><span class="header-section-number">13.3</span> Multiple maps</a></li>
  <li><a href="#putting-it-all-together" id="toc-putting-it-all-together" class="nav-link" data-scroll-target="#putting-it-all-together"><span class="header-section-number">13.4</span> Putting it all together</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/mpjashby/crimemappingbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-crime-series" class="quarto-section-identifier"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Mapping crime series</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Learn how to map crime series, including mapping movement over time and the journey to crime.</strong></p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>This chapter has not yet been updated for 2025, so some material is out of date. Check back for an update in mid-February 2025.</p>
</div>
</div>
<!-- Case linkage: http://eknygos.lsmuni.lt/springer/605/117-133.pdf -->
<section id="introduction" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">13.1</span> Introduction</h2>
<p>It’s common in crime mapping to treat each crime as a separate event. But a large proportion of crimes are committed by a relatively small proportion of all the people who commit crime. These persistent or repeat offenders commit crimes frequently, maybe several times a day in the case of some people. One type of repeat offending is the <em>crime series</em>, in which an offender or group of offenders commits the same or related crimes in different places over time.</p>
<section id="case-linkage" class="level3" data-number="13.1.1">
<h3 data-number="13.1.1" class="anchored" data-anchor-id="case-linkage"><span class="header-section-number">13.1.1</span> Case linkage</h3>
<p>One of the difficulties in studying serial offending is in identifying which offences are committed by the same offender. <em>Case linkage</em> is the process of identifying crime series by looking for similarities in the method used by an offender (e.g.&nbsp;entering a house by breaking a lock on a side door out of sight from the street) or by evidence left at the scene (such as fingerprints or DNA). Case linkage is typically an imperfect process – investigators might believe that two offences were committed by the same person, but in most cases they are unlikely to know for sure unless the offender has been caught (and sometimes not even then).</p>
<p>Watch this video to learn a bit more about crime linkage.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/XPOtaFRYrQs?t=13" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>Once crimes have been linked together as being part of the same series, it can be useful to map them to better understand how the series has progressed. In this tutorial we will learn how to map linked cases.</p>
</section>
<section id="the-case-used-in-this-tutorial" class="level3" data-number="13.1.2">
<h3 data-number="13.1.2" class="anchored" data-anchor-id="the-case-used-in-this-tutorial"><span class="header-section-number">13.1.2</span> The case used in this tutorial</h3>
<p>Due to the uncertainty of case linkage, there is little publicly available data on the locations of serial crimes. The available data tends to focus on serial murders. To minimise the likelihood of anyone taking this course having been directly affected by – or know anyone affected by – the cases we use in this tutorial, we will use a historical example.</p>
<p>The <a href="https://en.wikipedia.org/wiki/Hungerford_massacre">Hungerford massacre</a> occurred in southern England in August 1987, when a marauding attacker (also known as a spree offender) killed 16 people and shot many others in the space of about 90 minutes. We will use a dataset called <code>hungerford_shootings</code> that contains the names of each victim and the approximate location at which they were shot (recorded as eastings and northings in the British National Grid). This data is taken from the <a href="https://www.jesip.org.uk/uploads/media/incident_reports_and_inquiries/Hungerford%20Shootings.pdf">official report into the massacre</a>. The <code>order</code> column shows the order in which the victims were shot. These are the first few rows of the dataset (the dagger symbol † shows that the victim was killed):</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 73%">
<col style="width: 6%">
<col style="width: 9%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">victims</th>
<th style="text-align: right;">order</th>
<th style="text-align: right;">easting</th>
<th style="text-align: right;">northing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Susan GODFREY†</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">423168</td>
<td style="text-align: right;">167694</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kakaub DEAN</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">429455</td>
<td style="text-align: right;">167904</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Roland MASON†, Sheila MASON†, Marjorie JACKSON, Lisa MILDENHALL</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">433849</td>
<td style="text-align: right;">168176</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kenneth CLEMENTS†</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">434044</td>
<td style="text-align: right;">168133</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Roger BRERETON†, Linda CHAPMAN, Alison CHAPMAN</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">433897</td>
<td style="text-align: right;">168165</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>In this tutorial we will learn how to create this composite map of the locations of the shootings in this crime series.</p>
<p class="full-width-image">
<img src="images/hungerford_map.jpg" alt="A map showing the sequence of events during the Hungerford Massacre" style="max-height: 900px;">
</p>
</section>
</section>
<section id="mapping-linked-cases" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="mapping-linked-cases"><span class="header-section-number">13.2</span> Mapping linked cases</h2>
<p>Mapping crime series can be useful for several reasons. For example, a map of a crime series might help the jurors in a criminal trial to better understand the sequence of events that the suspect is accused of. This can be especially helpful if the sequence is complicated or especially long.</p>
<p>At the moment, the <code>hungerford_shootings</code> dataset contains the <em>point</em> location of each event and the order in which they occurred. To show a sequence of events on a map, we need to link each event with those that happened immediately before and after it.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 73%">
<col style="width: 6%">
<col style="width: 9%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">victims</th>
<th style="text-align: right;">order</th>
<th style="text-align: right;">easting</th>
<th style="text-align: right;">northing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Susan GODFREY†</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">423168</td>
<td style="text-align: right;">167694</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kakaub DEAN</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">429455</td>
<td style="text-align: right;">167904</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Roland MASON†, Sheila MASON†, Marjorie JACKSON, Lisa MILDENHALL</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">433849</td>
<td style="text-align: right;">168176</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kenneth CLEMENTS†</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">434044</td>
<td style="text-align: right;">168133</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Roger BRERETON†, Linda CHAPMAN, Alison CHAPMAN</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">433897</td>
<td style="text-align: right;">168165</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>One way to do this is to draw lines on the map connecting each incident in turn. To do this, we will create a dataset where each row contains <em>two</em> pairs of co-ordinates: one representing the location of a particular shooting and the other representing the location of the <em>previous</em> shooting. To do that, we will:</p>
<ol type="1">
<li>Take the <code>hungerford_shootings</code> dataset and rename the existing columns holding the co-ordinates so that it is clear those co-ordinates are for the <em>end</em> of each line between points. To do this we will use the <code>rename()</code> function from the <code>dplyr</code> package.</li>
<li>Add two new columns to each row that show the co-ordinates of the row in the dataset immediately above the current row (i.e.&nbsp;the row that represents the location before the current location. We will do this with the <code>lag()</code> function, also from <code>dplyr</code>.</li>
<li>Use these two pairs of co-ordinates to plot lines on a map.</li>
</ol>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>hungerford_lines <span class="ot">&lt;-</span> hungerford_shootings <span class="sc">|&gt;</span> </span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="fu">rename</span>(<span class="at">x_end =</span> easting, <span class="at">y_end =</span> northing) <span class="sc">|&gt;</span> </span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="fu">mutate</span>(<span class="at">x_start =</span> <span class="fu">lag</span>(x_end), <span class="at">y_start =</span> <span class="fu">lag</span>(y_end)) <span class="sc">|&gt;</span> </span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="co"># Remove the first line, which contains missing values and which we don't need</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="fu">remove_missing</span>(<span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"x_start"</span>, <span class="st">"y_start"</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">head</span>(hungerford_lines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 6 × 6
  victims                                    order  x_end  y_end x_start y_start
  &lt;chr&gt;                                      &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 "Kakaub DEAN"                                  2 429455 167904  423168  167694
2 "Roland MASON†\nSheila MASON†\nMarjorie J…     3 433849 168176  429455  167904
3 "Kenneth CLEMENTS†"                            4 434044 168133  433849  168176
4 "Roger BRERETON†\nLinda CHAPMAN\nAlison C…     5 433897 168165  434044  168133
5 "Abdur KHAN†\nAlan LEPETIT\nHazel HASLETT…     6 433821 168176  433897  168165
6 "Betty TOLLADAY"                               7 433954 168032  433821  168176</code></pre>
</div>
</div>
<div class="box extra-detail">
<h5 id="linked-box1-title" class="box-title anchored">
Why does this code include <code>remove_missing()</code>?
</h5>
<div id="linked-box1" class="box-content">
<p>You might notice that the values in the first row of the <code>x_start</code> and <code>x_end</code> columns in the <code>hungerford_lines</code> object are <code>NA</code> values. This is because these columns have been created using the <code>lag()</code> function, which gets the value from the same column in the row immediately above. The first row doesn’t have a row immediately above it, so <code>lag()</code> returns <code>NA</code>. Since the first row does not represent a link between shootings in any case, we can remove it with <code>remove_missing()</code>.</p>
</div>
</div>
<script>
$("#linked-box1-title").click(function () { $("#linked-box1").toggle("slow") })
</script>
<p>This method for creating lines between points is one of several ways we could achieve the same result. For example, we could create lines connecting the points and store them as SF objects. However, the code to do that is more complicated and gives us slightly less control over the appearance of the lines, so we will not use that method. Using the method shown in the box above means the lines on our map are not SF objects, so we cannot use <code>geom_sf()</code> to add them to the map. Instead, we will create a map using the <code>geom_segment()</code> function from the <code>ggplot2</code> package.</p>
<div class="cell" data-exercise="true" data-exercise.lines="23">
<div class="sourceCode cell-code" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Convert the `hungerford_shootings` object to SF</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>hungerford_shootings_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(</span>
<span id="cb3-3"><a href="#cb3-3"></a>  hungerford_shootings, </span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"easting"</span>, <span class="st">"northing"</span>), </span>
<span id="cb3-5"><a href="#cb3-5"></a>  <span class="at">crs =</span> <span class="st">"EPSG:27700"</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>)</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co"># Plot a basic map</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>  <span class="co"># Plot base map</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>  <span class="fu">annotation_map_tile</span>(<span class="at">zoomin =</span> <span class="dv">0</span>, <span class="at">progress =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>  <span class="co"># Plot lines between points</span></span>
<span id="cb3-13"><a href="#cb3-13"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb3-14"><a href="#cb3-14"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x_start, <span class="at">y =</span> y_start, <span class="at">xend =</span> x_end, <span class="at">yend =</span> y_end), </span>
<span id="cb3-15"><a href="#cb3-15"></a>    <span class="at">data =</span> hungerford_lines</span>
<span id="cb3-16"><a href="#cb3-16"></a>  ) <span class="sc">+</span></span>
<span id="cb3-17"><a href="#cb3-17"></a>  <span class="co"># Plot points</span></span>
<span id="cb3-18"><a href="#cb3-18"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> hungerford_shootings_sf) <span class="sc">+</span></span>
<span id="cb3-19"><a href="#cb3-19"></a>  <span class="co"># Since one of our layers is not an SF object, tell `ggplot()` what </span></span>
<span id="cb3-20"><a href="#cb3-20"></a>  <span class="co"># co-ordinate system to use</span></span>
<span id="cb3-21"><a href="#cb3-21"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"EPSG:27700"</span>) <span class="sc">+</span></span>
<span id="cb3-22"><a href="#cb3-22"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>Loading required namespace: raster</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/linked-exercise2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This map is not particularly useful – we will return to that in a minute.</p>
<p>If you look at this code, you’ll see that we’ve included the function <code>coord_sf()</code> in our <code>ggplot()</code> stack. In all the previous maps that we have made, we have used <code>geom_sf()</code> to plot geographic data on our maps. <code>geom_sf()</code> understands how to translate co-ordinates specified using different co-ordinate systems to locations on the surface of each map. Other functions in the <code>geom_*()</code> family of functions do not know how to do this automatically, so we must specify the co-ordinate system by adding the <code>coord_sf()</code> function to the stack. We only need to use one argument to <code>coord_sf()</code>: the <code>crs</code> argument to specify the co-ordinate system that our data uses. In this case, we know that the co-ordinates in the <code>hungerford_lines</code> object are specified using the British National Grid, which has the EPSG code 27700.</p>
<p>The map we have made above shows the sequence of events, but there are at least four ways that we can make it better.</p>
<ol type="1">
<li>It would be useful to be able to see a larger area around the shooting locations, to see more of the town surrounding the area in which the crimes occurred.</li>
<li>We don’t know which order to move through the sequence of lines. We can deal with this by adding arrows to show the direction of travel.</li>
<li>The straight lines make it look like the offender travelled across fields between locations, which is probably not true. Since we do not have data on what routes the offender took, we can replace the straight lines with curves to indicate that the exact route is unknown.</li>
<li>Because the first two shootings occurred outside the town, the map has to cover a large area and this makes it harder to see the sequence of events in the town itself.</li>
</ol>
<section id="extending-the-map-area" class="level3" data-number="13.2.1">
<h3 data-number="13.2.1" class="anchored" data-anchor-id="extending-the-map-area"><span class="header-section-number">13.2.1</span> Extending the map area</h3>
<p>By default, <code>ggplot()</code> works out the limits of the area shown on the map based on the area covered by the data we add to each stack with functions from the <code>geom_*()</code> family of functions. Usually this works well, but in this case the distribution of the shootings means that the map shows only a small slice of the town of Hungerford and the surrounding area. It would be useful for readers to be able to see a larger area, to be able to better identify where the shootings occurred.</p>
<p>To expand the area shown on the map, we can use <code>scale_y_continuous()</code> function from the <code>ggplot2</code> package. We have used the <code>scale_fill_distiller()</code> and <code>scale_fill_gradient()</code> functions in previous tutorials to control how columns in the data are represented as colours on the map. The <code>scale_y_continuous()</code> function is similar, in that it controls the vertical (Y) axis on the map. We don’t need to use most of the capabilities of <code>scale_y_continuous()</code> because <code>ggplot()</code> sets reasonable default values. The only argument we need to set is the <code>expand</code> argument, which controls how far the map should extend around the area covered by the data.</p>
<p>The easiest way to set the correct values for the <code>expand</code> function is to use the <code>expansion()</code> helper function. We can use this to specify how much extra area around the data we want to include on the map. For example, <code>expansion(2)</code> means that the Y axis of the map should cover the area covered by the data and twice that distance either side of the data.</p>
<div class="cell" data-exercise="true" data-exercise.lines="15">
<div class="sourceCode cell-code" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Plot a basic map</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="co"># Plot base map</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="fu">annotation_map_tile</span>(<span class="at">zoomin =</span> <span class="dv">0</span>, <span class="at">progress =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="co"># Plot lines between points</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x_start, <span class="at">y =</span> y_start, <span class="at">xend =</span> x_end, <span class="at">yend =</span> y_end), </span>
<span id="cb5-8"><a href="#cb5-8"></a>    <span class="at">data =</span> hungerford_lines</span>
<span id="cb5-9"><a href="#cb5-9"></a>  ) <span class="sc">+</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>  <span class="co"># Plot points</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> hungerford_shootings_sf) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"EPSG:27700"</span>) <span class="sc">+</span></span>
<span id="cb5-14"><a href="#cb5-14"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/linked-exercise3-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="box notewell">
<p>The <code>scale_y_continuous()</code> function specifically controls the vertical (Y) axis of the map, so it only adds space above and below the data on the map. If we wanted to add space to the left and right of the data, we would need to use the <code>scale_x_continuous()</code> function. But in this case, since the map is already very wide relative to its height, we will not make the map any wider.</p>
</div>
</section>
<section id="adding-arrows-and-curves" class="level3" data-number="13.2.2">
<h3 data-number="13.2.2" class="anchored" data-anchor-id="adding-arrows-and-curves"><span class="header-section-number">13.2.2</span> Adding arrows and curves</h3>
<p>To add an arrow to the end of each line segment we can use the <code>arrow()</code> helper function from the <code>ggplot2</code> package to specify the <code>arrow</code> argument of the <code>geom_segment()</code> function in our <code>ggplot()</code> stack. Here, we make the arrow head smaller than the default by setting <code>length = unit(3, "mm")</code> and choose the style of the arrow head with <code>type = "closed"</code>.</p>
<p>To prevent the arrow heads from obscuring the points, we will give the points a thin white border by specifying <code>shape = 21</code> (a circle with a separate border) and <code>colour = "white"</code>, as well as making the points slightly bigger with <code>size = 2</code>.</p>
<div class="cell" data-exercise="true" data-exercise.lines="22">
<div class="sourceCode cell-code" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="co"># Plot base map</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="fu">annotation_map_tile</span>(<span class="at">zoomin =</span> <span class="dv">0</span>, <span class="at">progress =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="co"># Plot lines between points</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb6-6"><a href="#cb6-6"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x_start, <span class="at">y =</span> y_start, <span class="at">xend =</span> x_end, <span class="at">yend =</span> y_end),</span>
<span id="cb6-7"><a href="#cb6-7"></a>    <span class="at">data =</span> hungerford_lines, </span>
<span id="cb6-8"><a href="#cb6-8"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">3</span>, <span class="st">"mm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb6-9"><a href="#cb6-9"></a>    <span class="at">colour =</span> <span class="st">"orange3"</span></span>
<span id="cb6-10"><a href="#cb6-10"></a>  ) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11"></a>  <span class="co"># Plot points</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb6-13"><a href="#cb6-13"></a>    <span class="at">data =</span> hungerford_shootings_sf,</span>
<span id="cb6-14"><a href="#cb6-14"></a>    <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb6-15"><a href="#cb6-15"></a>    <span class="at">colour =</span> <span class="st">"white"</span>,</span>
<span id="cb6-16"><a href="#cb6-16"></a>    <span class="at">fill =</span> <span class="st">"orange3"</span>,</span>
<span id="cb6-17"><a href="#cb6-17"></a>    <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>  ) <span class="sc">+</span></span>
<span id="cb6-19"><a href="#cb6-19"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"EPSG:27700"</span>) <span class="sc">+</span></span>
<span id="cb6-21"><a href="#cb6-21"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/linked-exercise4-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>This makes it easier to see that the shootings started at the point on the left of the map, but makes the problem of understanding the sequence of events in the town itself even worse. We will deal with this in the next section.</p>
<p>In the map above, we used the <code>geom_segment()</code> function to add the lines to our map. If we change this to <code>geom_curve()</code> the lines will become curved rather than straight. By specifying <code>curvature = -0.2</code> we get a slightly straighter line than the default, and a left-hand curve because the value of <code>curvature</code> is negative.</p>
<p>The other change we can make at this point is to add a layer of labels showing the order in which the shootings occurred. We don’t want the labels to overlap the points, so we will use <code>geom_label_repel()</code> from the <code>ggrepel</code> package to create labels that are automatically offset from the points they relate to. For now, we will just label the first two locations.</p>
<p>At this point we can also make some minor changes to the map – adding a title and scale bar, putting a neat line around the map – the purpose of which will become clear in the next section.</p>
<div class="cell" data-exercise="true" data-exercise.lines="41">
<div class="sourceCode cell-code" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a>hungerford_map_overall <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="co"># Plot base map</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="fu">annotation_map_tile</span>(<span class="at">zoomin =</span> <span class="dv">0</span>, <span class="at">progress =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="co"># Plot lines between points</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="fu">geom_curve</span>(</span>
<span id="cb7-8"><a href="#cb7-8"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x_start, <span class="at">y =</span> y_start, <span class="at">xend =</span> x_end, <span class="at">yend =</span> y_end),</span>
<span id="cb7-9"><a href="#cb7-9"></a>    <span class="at">data =</span> hungerford_lines, </span>
<span id="cb7-10"><a href="#cb7-10"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">3</span>, <span class="st">"mm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb7-11"><a href="#cb7-11"></a>    <span class="at">curvature =</span> <span class="sc">-</span><span class="fl">0.2</span>,</span>
<span id="cb7-12"><a href="#cb7-12"></a>    <span class="at">colour =</span> <span class="st">"orange3"</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>  ) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>  <span class="co"># Plot points</span></span>
<span id="cb7-15"><a href="#cb7-15"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb7-16"><a href="#cb7-16"></a>    <span class="at">data =</span> hungerford_shootings_sf, </span>
<span id="cb7-17"><a href="#cb7-17"></a>    <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb7-18"><a href="#cb7-18"></a>    <span class="at">colour =</span> <span class="st">"white"</span>,</span>
<span id="cb7-19"><a href="#cb7-19"></a>    <span class="at">fill =</span> <span class="st">"orange3"</span>,</span>
<span id="cb7-20"><a href="#cb7-20"></a>    <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb7-21"><a href="#cb7-21"></a>  ) <span class="sc">+</span></span>
<span id="cb7-22"><a href="#cb7-22"></a>  <span class="fu">geom_label_repel</span>(</span>
<span id="cb7-23"><a href="#cb7-23"></a>    <span class="fu">aes</span>(<span class="at">x =</span> easting, <span class="at">y =</span> northing, <span class="at">label =</span> order),</span>
<span id="cb7-24"><a href="#cb7-24"></a>    <span class="at">data =</span> <span class="fu">filter</span>(hungerford_shootings, order <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), </span>
<span id="cb7-25"><a href="#cb7-25"></a>    <span class="at">colour =</span> <span class="st">"white"</span>,</span>
<span id="cb7-26"><a href="#cb7-26"></a>    <span class="at">fill =</span> <span class="st">"orange3"</span>,</span>
<span id="cb7-27"><a href="#cb7-27"></a>    <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb7-28"><a href="#cb7-28"></a>    <span class="at">label.size =</span> <span class="cn">NA</span></span>
<span id="cb7-29"><a href="#cb7-29"></a>  ) <span class="sc">+</span></span>
<span id="cb7-30"><a href="#cb7-30"></a>  <span class="fu">annotation_scale</span>(<span class="at">style =</span> <span class="st">"ticks"</span>, <span class="at">line_col =</span> <span class="st">"grey40"</span>, <span class="at">text_col =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb7-31"><a href="#cb7-31"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb7-32"><a href="#cb7-32"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">" Shootings in Wiltshire"</span>) <span class="sc">+</span></span>
<span id="cb7-33"><a href="#cb7-33"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"EPSG:27700"</span>) <span class="sc">+</span></span>
<span id="cb7-34"><a href="#cb7-34"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb7-35"><a href="#cb7-35"></a>  <span class="fu">theme</span>(</span>
<span id="cb7-36"><a href="#cb7-36"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"grey20"</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb7-37"><a href="#cb7-37"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="sc">-</span><span class="dv">18</span>))</span>
<span id="cb7-38"><a href="#cb7-38"></a>  )</span>
<span id="cb7-39"><a href="#cb7-39"></a></span>
<span id="cb7-40"><a href="#cb7-40"></a>hungerford_map_overall</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/linked-exercise5-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Now we have added arrow heads and curved lines, in the next section we will learn how to solve the problem of the events in the town itself being unclear on the map.</p>
</section>
</section>
<section id="multiple-maps" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="multiple-maps"><span class="header-section-number">13.3</span> Multiple maps</h2>
<p class="full-width-image">
<img src="images/patchwork_1.jpg" alt="Cartoon showing furry monsters arranging three picture frames hanging from a wall.">
</p>
<p>Our existing map is difficult to understand because we have a mix of some events very close together (including several on the same street) and some that occurred further away. This means the closer events overlap on the map, especially now that we have made the points larger to distinguish them from the lines linking each event.</p>
<p><a href="https://patchwork.data-imaginist.com/"><img src="images/patchwork.png" alt="patchwork package logo" class="right-side-image"></a></p>
<p>To deal with this problem we can display two maps: one showing the whole area covered by the points and a second (sometimes called an <em>inset map</em>) showing only the events in the town of Hungerford itself. We will do this using the <a href="https://patchwork.data-imaginist.com/"><code>patchwork</code> package</a> to combine multiple maps made using <code>ggplot()</code>.</p>
<p>We have already saved the first map as <code>hungerford_map_overall</code>. We can create a map showing only the shootings in Hungerford itself by removing the first two points from <code>hungerford_points_sf</code> (since they represent shootings outside the town itself). We can do this for all the existing layers using <code>slice()</code>.</p>
<p>We will use the <code>plot.margin</code> argument to the <code>theme()</code> function to add a small amount of space at the top of this map, which will help separate it from the first map when we put them together. We will also get the map to cover a slightly larger area than it would by default by using the <code>scale_x_continuous()</code> and <code>scale_y_continuous()</code> functions.</p>
<div class="cell" data-exercise="true" data-exercise.lines="41">
<div class="sourceCode cell-code" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>hungerford_map_town <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">annotation_map_tile</span>(<span class="at">zoomin =</span> <span class="dv">0</span>, <span class="at">progress =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="co"># Plot lines between points</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">geom_curve</span>(</span>
<span id="cb8-5"><a href="#cb8-5"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x_start, <span class="at">y =</span> y_start, <span class="at">xend =</span> x_end, <span class="at">yend =</span> y_end),</span>
<span id="cb8-6"><a href="#cb8-6"></a>    <span class="at">data =</span> <span class="fu">slice</span>(hungerford_lines, <span class="dv">3</span><span class="sc">:</span><span class="fu">n</span>()), </span>
<span id="cb8-7"><a href="#cb8-7"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">3</span>, <span class="st">"mm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb8-8"><a href="#cb8-8"></a>    <span class="at">curvature =</span> <span class="sc">-</span><span class="fl">0.2</span>,</span>
<span id="cb8-9"><a href="#cb8-9"></a>    <span class="at">colour =</span> <span class="st">"orange3"</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>  ) <span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>  <span class="co"># Plot points</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb8-13"><a href="#cb8-13"></a>    <span class="at">data =</span> <span class="fu">slice</span>(hungerford_shootings_sf, <span class="dv">3</span><span class="sc">:</span><span class="fu">n</span>()), </span>
<span id="cb8-14"><a href="#cb8-14"></a>    <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb8-15"><a href="#cb8-15"></a>    <span class="at">colour =</span> <span class="st">"white"</span>,</span>
<span id="cb8-16"><a href="#cb8-16"></a>    <span class="at">fill =</span> <span class="st">"orange3"</span>,</span>
<span id="cb8-17"><a href="#cb8-17"></a>    <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb8-18"><a href="#cb8-18"></a>  ) <span class="sc">+</span></span>
<span id="cb8-19"><a href="#cb8-19"></a>  <span class="fu">geom_label_repel</span>(</span>
<span id="cb8-20"><a href="#cb8-20"></a>    <span class="fu">aes</span>(<span class="at">x =</span> easting, <span class="at">y =</span> northing, <span class="at">label =</span> order),</span>
<span id="cb8-21"><a href="#cb8-21"></a>    <span class="at">data =</span> <span class="fu">slice</span>(hungerford_shootings, <span class="dv">3</span><span class="sc">:</span><span class="fu">n</span>()), </span>
<span id="cb8-22"><a href="#cb8-22"></a>    <span class="at">colour =</span> <span class="st">"white"</span>,</span>
<span id="cb8-23"><a href="#cb8-23"></a>    <span class="at">fill =</span> <span class="st">"orange3"</span>,</span>
<span id="cb8-24"><a href="#cb8-24"></a>    <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb8-25"><a href="#cb8-25"></a>    <span class="at">label.size =</span> <span class="cn">NA</span></span>
<span id="cb8-26"><a href="#cb8-26"></a>  ) <span class="sc">+</span></span>
<span id="cb8-27"><a href="#cb8-27"></a>  <span class="fu">annotation_scale</span>(<span class="at">style =</span> <span class="st">"ticks"</span>, <span class="at">line_col =</span> <span class="st">"grey40"</span>, <span class="at">text_col =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb8-28"><a href="#cb8-28"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="fl">0.3</span>)) <span class="sc">+</span></span>
<span id="cb8-29"><a href="#cb8-29"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="fl">0.3</span>)) <span class="sc">+</span></span>
<span id="cb8-30"><a href="#cb8-30"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"EPSG:27700"</span>) <span class="sc">+</span></span>
<span id="cb8-31"><a href="#cb8-31"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-32"><a href="#cb8-32"></a>    <span class="at">title =</span> <span class="st">"Shootings in Hungerford town"</span></span>
<span id="cb8-33"><a href="#cb8-33"></a>  ) <span class="sc">+</span></span>
<span id="cb8-34"><a href="#cb8-34"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb8-35"><a href="#cb8-35"></a>  <span class="fu">theme</span>(</span>
<span id="cb8-36"><a href="#cb8-36"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"grey20"</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb8-37"><a href="#cb8-37"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">12</span>)</span>
<span id="cb8-38"><a href="#cb8-38"></a>  )</span>
<span id="cb8-39"><a href="#cb8-39"></a></span>
<span id="cb8-40"><a href="#cb8-40"></a>hungerford_map_town</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/multiple-exercise1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can now combine the two maps using the <code>patchwork</code> package. To place two plots next to each other using <code>patchwork</code> you just add one map object to the other using the <code>|</code> operator. To place one plot on top of the other, you use the <code>/</code> operator (you can combine plots in more-complicated ways by combining these operators, together with parentheses).</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a>(hungerford_map_overall <span class="sc">/</span> hungerford_map_town)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/multiple-exercise2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>When we created the <code>hungerford_map_overall</code> object in the previous section, we gave the map title a <em>negative</em> border using the <code>plot.title</code> argument to the <code>theme()</code> function. This had the effect of moving the title downwards onto the map to save space, since the top-left corner of the map was empty. We also added a scale bar, since when you present two related maps of different scales next to one another, it is useful to show the scales of both maps to help readers relate them to one another.</p>
<p>We can add shared titles and captions to combined maps created with <code>patchwork</code> using the <code>plot_annotation()</code> function. This function has a <code>theme</code> argument, which we can use to change the appearance of the shared title and caption just as we use <code>theme()</code> to change the appearance of elements on single maps.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>(hungerford_map_overall <span class="sc">/</span> hungerford_map_town) <span class="sc">+</span> </span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="at">title =</span> <span class="st">"Shootings during the Hungerford massacre"</span>,</span>
<span id="cb10-4"><a href="#cb10-4"></a>    <span class="at">caption =</span> <span class="st">"data from the official report into the shootings"</span>,</span>
<span id="cb10-5"><a href="#cb10-5"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb10-6"><a href="#cb10-6"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey40"</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb10-7"><a href="#cb10-7"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey50"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>)</span>
<span id="cb10-8"><a href="#cb10-8"></a>    )</span>
<span id="cb10-9"><a href="#cb10-9"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/multiple-exercise4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There are various other improvements that we could make to this map based on the mapping skills we have already learned during this course. For example, we could add the locations of buildings or particular facilities using data from OpenStreetMap. What information we choose to present on the map will depend on what information we think it is important to communicate to our audience.</p>
<!--
## Plotting the journey to crime

For many crimes (especially predatory crimes), offenders must travel to and from 
the location of the offence. Investigators will sometimes know some points along
this journey, but not the whole route. For example, detectives investigating a
kidnapping murder may know where the victim was taken from and where the body 
was found, but not know where the offender or victim were between those points.
For a more-common crime such as car theft, police may know where a car was 
stolen from and where it was recovered, but not have any information about where
it was between those times.

When investigating crimes involving travel between points, it will often be 
useful to work out the route taken between two points. For example, establishing
a possible route might make it possible to check CCTV cameras, analyse toll-road 
records or seek witnesses along the way. A potential route might also allow an
analyst to consider whether any other crimes along that route might be part of a
crime series. If pairs of points are known for multiple crimes that are believed
to be a linked series, it is possible that looking for overlapping parts of the 
routes between pairs of points might help identify the offender's anchor point.

We can plot the fastest route between two locations on foot or in a vehicle 
using tools that were designed for transport planning. The 
[`stplanr` package](https://docs.ropensci.org/stplanr/) uses data from the
OpenStreetMap routing service to work out the fastest route between two points.
-->
</section>
<section id="putting-it-all-together" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="putting-it-all-together"><span class="header-section-number">13.4</span> Putting it all together</h2>
<div class="box">
<p>In this tutorial we have learned how to map crime series, focusing on displaying a sequence of events on a map. We have also learned how to combine maps using the <code>patchwork</code> package.</p>
</div>
<p>When we are mapping crime data, it is important to remember that the rows in the data we are using often represent traumatic events that have happened to people. In this tutorial, every row in the data represents one or more people who were killed or injured during the massacre. The people killed during the tragedy were Marcus Barnard, Roger Brereton, Francis Butler, Kenneth Clements, Victor Gibbs, Myrtle Gibbs, Susan Godfrey, Sandra Hill, Abdur Khan, Roland Mason, Sheila Mason, Ian Playle, Dorothy Ryan, Eric Vardy, Douglas Wainwright and George White.</p>
<p class="full-width-image image-border">
<img src="images/roger_brereton.jpg" alt="Photograph from the funeral of police constable Roger Brereton, one of the people killed in the Hungerford Massacre">
</p>
<p>You can put the code from this tutorial together to see everything that is needed to make a composite map of the Hungerford massacre from the original data file called <code>hungerford_shootings</code>.</p>
<div class="cell" data-exercise="true" data-exercise.lines="117">
<div class="sourceCode cell-code" id="cb11" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="fu">library</span>(sf)</span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb11-6"><a href="#cb11-6"></a></span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co"># Prepare data -----------------------------------------------------------------</span></span>
<span id="cb11-10"><a href="#cb11-10"></a></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co"># Create lines showing progression between points</span></span>
<span id="cb11-12"><a href="#cb11-12"></a>hungerford_lines <span class="ot">&lt;-</span> hungerford_shootings <span class="sc">|&gt;</span> </span>
<span id="cb11-13"><a href="#cb11-13"></a>  <span class="fu">rename</span>(<span class="at">x_end =</span> easting, <span class="at">y_end =</span> northing) <span class="sc">|&gt;</span> </span>
<span id="cb11-14"><a href="#cb11-14"></a>  <span class="fu">mutate</span>(<span class="at">x_start =</span> <span class="fu">lag</span>(x_end), <span class="at">y_start =</span> <span class="fu">lag</span>(y_end)) <span class="sc">|&gt;</span> </span>
<span id="cb11-15"><a href="#cb11-15"></a>  <span class="co"># Remove the first line, which contains missing values and which we don't need</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>  <span class="fu">remove_missing</span>(<span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"x_start"</span>, <span class="st">"y_start"</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-17"><a href="#cb11-17"></a></span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="co"># Convert the `hungerford_shootings` object to SF</span></span>
<span id="cb11-19"><a href="#cb11-19"></a>hungerford_shootings_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(</span>
<span id="cb11-20"><a href="#cb11-20"></a>  hungerford_shootings, </span>
<span id="cb11-21"><a href="#cb11-21"></a>  <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"easting"</span>, <span class="st">"northing"</span>), </span>
<span id="cb11-22"><a href="#cb11-22"></a>  <span class="at">crs =</span> <span class="st">"EPSG:27700"</span></span>
<span id="cb11-23"><a href="#cb11-23"></a>)</span>
<span id="cb11-24"><a href="#cb11-24"></a></span>
<span id="cb11-25"><a href="#cb11-25"></a></span>
<span id="cb11-26"><a href="#cb11-26"></a></span>
<span id="cb11-27"><a href="#cb11-27"></a><span class="co"># Make component maps ----------------------------------------------------------</span></span>
<span id="cb11-28"><a href="#cb11-28"></a></span>
<span id="cb11-29"><a href="#cb11-29"></a>hungerford_map_overall <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb11-30"><a href="#cb11-30"></a>  <span class="co"># Plot base map</span></span>
<span id="cb11-31"><a href="#cb11-31"></a>  <span class="fu">annotation_map_tile</span>(<span class="at">zoomin =</span> <span class="dv">0</span>, <span class="at">progress =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb11-32"><a href="#cb11-32"></a>  <span class="co"># Plot lines between points</span></span>
<span id="cb11-33"><a href="#cb11-33"></a>  <span class="fu">geom_curve</span>(</span>
<span id="cb11-34"><a href="#cb11-34"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x_start, <span class="at">y =</span> y_start, <span class="at">xend =</span> x_end, <span class="at">yend =</span> y_end),</span>
<span id="cb11-35"><a href="#cb11-35"></a>    <span class="at">data =</span> hungerford_lines, </span>
<span id="cb11-36"><a href="#cb11-36"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">3</span>, <span class="st">"mm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb11-37"><a href="#cb11-37"></a>    <span class="at">curvature =</span> <span class="sc">-</span><span class="fl">0.2</span>,</span>
<span id="cb11-38"><a href="#cb11-38"></a>    <span class="at">colour =</span> <span class="st">"orange3"</span></span>
<span id="cb11-39"><a href="#cb11-39"></a>  ) <span class="sc">+</span></span>
<span id="cb11-40"><a href="#cb11-40"></a>  <span class="co"># Plot points</span></span>
<span id="cb11-41"><a href="#cb11-41"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb11-42"><a href="#cb11-42"></a>    <span class="at">data =</span> hungerford_shootings_sf, </span>
<span id="cb11-43"><a href="#cb11-43"></a>    <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb11-44"><a href="#cb11-44"></a>    <span class="at">colour =</span> <span class="st">"white"</span>,</span>
<span id="cb11-45"><a href="#cb11-45"></a>    <span class="at">fill =</span> <span class="st">"orange3"</span>,</span>
<span id="cb11-46"><a href="#cb11-46"></a>    <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb11-47"><a href="#cb11-47"></a>  ) <span class="sc">+</span></span>
<span id="cb11-48"><a href="#cb11-48"></a>  <span class="fu">geom_label_repel</span>(</span>
<span id="cb11-49"><a href="#cb11-49"></a>    <span class="fu">aes</span>(<span class="at">x =</span> easting, <span class="at">y =</span> northing, <span class="at">label =</span> order),</span>
<span id="cb11-50"><a href="#cb11-50"></a>    <span class="at">data =</span> <span class="fu">filter</span>(hungerford_shootings, order <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), </span>
<span id="cb11-51"><a href="#cb11-51"></a>    <span class="at">colour =</span> <span class="st">"white"</span>,</span>
<span id="cb11-52"><a href="#cb11-52"></a>    <span class="at">fill =</span> <span class="st">"orange3"</span>,</span>
<span id="cb11-53"><a href="#cb11-53"></a>    <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb11-54"><a href="#cb11-54"></a>    <span class="at">label.size =</span> <span class="cn">NA</span></span>
<span id="cb11-55"><a href="#cb11-55"></a>  ) <span class="sc">+</span></span>
<span id="cb11-56"><a href="#cb11-56"></a>  <span class="fu">annotation_scale</span>(<span class="at">style =</span> <span class="st">"ticks"</span>, <span class="at">line_col =</span> <span class="st">"grey40"</span>, <span class="at">text_col =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb11-57"><a href="#cb11-57"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb11-58"><a href="#cb11-58"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">" Shootings in Wiltshire"</span>) <span class="sc">+</span></span>
<span id="cb11-59"><a href="#cb11-59"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"EPSG:27700"</span>) <span class="sc">+</span></span>
<span id="cb11-60"><a href="#cb11-60"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb11-61"><a href="#cb11-61"></a>  <span class="fu">theme</span>(</span>
<span id="cb11-62"><a href="#cb11-62"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"grey20"</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb11-63"><a href="#cb11-63"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="sc">-</span><span class="dv">18</span>))</span>
<span id="cb11-64"><a href="#cb11-64"></a>  )</span>
<span id="cb11-65"><a href="#cb11-65"></a></span>
<span id="cb11-66"><a href="#cb11-66"></a>hungerford_map_town <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb11-67"><a href="#cb11-67"></a>  <span class="fu">annotation_map_tile</span>(<span class="at">zoomin =</span> <span class="dv">0</span>, <span class="at">progress =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb11-68"><a href="#cb11-68"></a>  <span class="co"># Plot lines between points</span></span>
<span id="cb11-69"><a href="#cb11-69"></a>  <span class="fu">geom_curve</span>(</span>
<span id="cb11-70"><a href="#cb11-70"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x_start, <span class="at">y =</span> y_start, <span class="at">xend =</span> x_end, <span class="at">yend =</span> y_end),</span>
<span id="cb11-71"><a href="#cb11-71"></a>    <span class="at">data =</span> <span class="fu">slice</span>(hungerford_lines, <span class="dv">3</span><span class="sc">:</span><span class="fu">n</span>()), </span>
<span id="cb11-72"><a href="#cb11-72"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">3</span>, <span class="st">"mm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb11-73"><a href="#cb11-73"></a>    <span class="at">curvature =</span> <span class="sc">-</span><span class="fl">0.2</span>,</span>
<span id="cb11-74"><a href="#cb11-74"></a>    <span class="at">colour =</span> <span class="st">"orange3"</span></span>
<span id="cb11-75"><a href="#cb11-75"></a>  ) <span class="sc">+</span></span>
<span id="cb11-76"><a href="#cb11-76"></a>  <span class="co"># Plot points</span></span>
<span id="cb11-77"><a href="#cb11-77"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb11-78"><a href="#cb11-78"></a>    <span class="at">data =</span> <span class="fu">slice</span>(hungerford_shootings_sf, <span class="dv">3</span><span class="sc">:</span><span class="fu">n</span>()), </span>
<span id="cb11-79"><a href="#cb11-79"></a>    <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb11-80"><a href="#cb11-80"></a>    <span class="at">colour =</span> <span class="st">"white"</span>,</span>
<span id="cb11-81"><a href="#cb11-81"></a>    <span class="at">fill =</span> <span class="st">"orange3"</span>,</span>
<span id="cb11-82"><a href="#cb11-82"></a>    <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb11-83"><a href="#cb11-83"></a>  ) <span class="sc">+</span></span>
<span id="cb11-84"><a href="#cb11-84"></a>  <span class="fu">geom_label_repel</span>(</span>
<span id="cb11-85"><a href="#cb11-85"></a>    <span class="fu">aes</span>(<span class="at">x =</span> easting, <span class="at">y =</span> northing, <span class="at">label =</span> order),</span>
<span id="cb11-86"><a href="#cb11-86"></a>    <span class="at">data =</span> <span class="fu">slice</span>(hungerford_shootings, <span class="dv">3</span><span class="sc">:</span><span class="fu">n</span>()), </span>
<span id="cb11-87"><a href="#cb11-87"></a>    <span class="at">colour =</span> <span class="st">"white"</span>,</span>
<span id="cb11-88"><a href="#cb11-88"></a>    <span class="at">fill =</span> <span class="st">"orange3"</span>,</span>
<span id="cb11-89"><a href="#cb11-89"></a>    <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb11-90"><a href="#cb11-90"></a>    <span class="at">label.size =</span> <span class="cn">NA</span></span>
<span id="cb11-91"><a href="#cb11-91"></a>  ) <span class="sc">+</span></span>
<span id="cb11-92"><a href="#cb11-92"></a>  <span class="fu">annotation_scale</span>(<span class="at">style =</span> <span class="st">"ticks"</span>, <span class="at">line_col =</span> <span class="st">"grey40"</span>, <span class="at">text_col =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb11-93"><a href="#cb11-93"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="fl">0.3</span>)) <span class="sc">+</span></span>
<span id="cb11-94"><a href="#cb11-94"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="fl">0.3</span>)) <span class="sc">+</span></span>
<span id="cb11-95"><a href="#cb11-95"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"EPSG:27700"</span>) <span class="sc">+</span></span>
<span id="cb11-96"><a href="#cb11-96"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-97"><a href="#cb11-97"></a>    <span class="at">title =</span> <span class="st">"Shootings in Hungerford town"</span></span>
<span id="cb11-98"><a href="#cb11-98"></a>  ) <span class="sc">+</span></span>
<span id="cb11-99"><a href="#cb11-99"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb11-100"><a href="#cb11-100"></a>  <span class="fu">theme</span>(</span>
<span id="cb11-101"><a href="#cb11-101"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"grey20"</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb11-102"><a href="#cb11-102"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">12</span>)</span>
<span id="cb11-103"><a href="#cb11-103"></a>  )</span>
<span id="cb11-104"><a href="#cb11-104"></a></span>
<span id="cb11-105"><a href="#cb11-105"></a></span>
<span id="cb11-106"><a href="#cb11-106"></a></span>
<span id="cb11-107"><a href="#cb11-107"></a><span class="co"># Combine maps and add titles --------------------------------------------------</span></span>
<span id="cb11-108"><a href="#cb11-108"></a></span>
<span id="cb11-109"><a href="#cb11-109"></a>(hungerford_map_overall <span class="sc">/</span> hungerford_map_town) <span class="sc">+</span> </span>
<span id="cb11-110"><a href="#cb11-110"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb11-111"><a href="#cb11-111"></a>    <span class="at">title =</span> <span class="st">"Shootings during the Hungerford massacre"</span>,</span>
<span id="cb11-112"><a href="#cb11-112"></a>    <span class="at">caption =</span> <span class="st">"data from the official report into the shootings"</span>,</span>
<span id="cb11-113"><a href="#cb11-113"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb11-114"><a href="#cb11-114"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey40"</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb11-115"><a href="#cb11-115"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey50"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>)</span>
<span id="cb11-116"><a href="#cb11-116"></a>    )</span>
<span id="cb11-117"><a href="#cb11-117"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/summary-exercise1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p class="credits">
<a href="https://www.getreading.co.uk/news/berkshire-history/gallery/30-years-hungerford-massacre-13495555">Photograph of PC Roger Brereton’s funeral from Berkshire Live</a>
</p>
<p class="credits">
<a href="https://twitter.com/allison_horst">Artwork by <span class="citation" data-cites="allison_horst">@allison_horst</span></a>
</p>


<!-- -->

</section>

</main> <!-- /main -->
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../12_messy_data/index.html" class="pagination-link" aria-label="Handling messy data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Handling messy data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../14_writing_reports/index.html" class="pagination-link" aria-label="Writing reports in R">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Writing reports in R</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb12" data-shortcodes="false" data-code-line-numbers=""><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu"># Mapping crime series {#sec-crime-series}</span></span>
<span id="cb12-2"><a href="#cb12-2"></a></span>
<span id="cb12-3"><a href="#cb12-3"></a>**Learn how to map crime series, including mapping movement over time and the journey to crime.**</span>
<span id="cb12-4"><a href="#cb12-4"></a></span>
<span id="cb12-5"><a href="#cb12-5"></a>::: {.callout-important}</span>
<span id="cb12-6"><a href="#cb12-6"></a>This chapter has not yet been updated for 2025, so some material is out of date. Check back for an update in mid-February 2025.</span>
<span id="cb12-7"><a href="#cb12-7"></a>:::</span>
<span id="cb12-8"><a href="#cb12-8"></a></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="in">```{r setup}</span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="in">#| echo: false</span></span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="in">#| include: false</span></span>
<span id="cb12-12"><a href="#cb12-12"></a></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="in">source(here::here("mask_learnr_functions.R"))</span></span>
<span id="cb12-14"><a href="#cb12-14"></a></span>
<span id="cb12-15"><a href="#cb12-15"></a><span class="in"># Load packages</span></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="in">library(ggrepel)</span></span>
<span id="cb12-17"><a href="#cb12-17"></a><span class="in">library(ggspatial)</span></span>
<span id="cb12-18"><a href="#cb12-18"></a><span class="in">library(patchwork)</span></span>
<span id="cb12-19"><a href="#cb12-19"></a><span class="in">library(sf)</span></span>
<span id="cb12-20"><a href="#cb12-20"></a><span class="in">library(tidyverse)</span></span>
<span id="cb12-21"><a href="#cb12-21"></a></span>
<span id="cb12-22"><a href="#cb12-22"></a></span>
<span id="cb12-23"><a href="#cb12-23"></a><span class="in"># Load data --------------------------------------------------------------------</span></span>
<span id="cb12-24"><a href="#cb12-24"></a></span>
<span id="cb12-25"><a href="#cb12-25"></a><span class="in">## Hungerford data ----</span></span>
<span id="cb12-26"><a href="#cb12-26"></a><span class="in">hungerford_shootings &lt;- tribble(</span></span>
<span id="cb12-27"><a href="#cb12-27"></a><span class="in">  ~latitude, ~longitude, ~victims,</span></span>
<span id="cb12-28"><a href="#cb12-28"></a><span class="in">  51.4078, -1.6683, "Susan GODFREY†",</span></span>
<span id="cb12-29"><a href="#cb12-29"></a><span class="in">  51.4094, -1.5779, "Kakaub DEAN",</span></span>
<span id="cb12-30"><a href="#cb12-30"></a><span class="in">  51.4116, -1.5147, "Roland MASON†\nSheila MASON†\nMarjorie JACKSON\nLisa MILDENHALL",</span></span>
<span id="cb12-31"><a href="#cb12-31"></a><span class="in">  51.4112, -1.5119, "Kenneth CLEMENTS†",</span></span>
<span id="cb12-32"><a href="#cb12-32"></a><span class="in">  51.4115, -1.5140, "Roger BRERETON†\nLinda CHAPMAN\nAlison CHAPMAN",</span></span>
<span id="cb12-33"><a href="#cb12-33"></a><span class="in">  51.4116, -1.5151, "Abdur KHAN†\nAlan LEPETIT\nHazel HASLETT\nGeorge WHITE†\nDorothy RYAN†\nIvor JACKSON",</span></span>
<span id="cb12-34"><a href="#cb12-34"></a><span class="in">  51.4103, -1.5132, "Betty TOLLADAY",</span></span>
<span id="cb12-35"><a href="#cb12-35"></a><span class="in">  51.4081, -1.5132, "Francis BUTLER†",</span></span>
<span id="cb12-36"><a href="#cb12-36"></a><span class="in">  51.4079, -1.5144, "Marcus BARNARD†",</span></span>
<span id="cb12-37"><a href="#cb12-37"></a><span class="in">  51.4080, -1.5150, "Ann HONEYBONE",</span></span>
<span id="cb12-38"><a href="#cb12-38"></a><span class="in">  51.4098, -1.5156, "John STORMS",</span></span>
<span id="cb12-39"><a href="#cb12-39"></a><span class="in">  51.4102, -1.5156, "Douglas WAINWRIGHT†\nKathleen WAINWRIGHT\nKevin LANCE\nEric VARDY†",</span></span>
<span id="cb12-40"><a href="#cb12-40"></a><span class="in">  51.4088, -1.5173, "Sandra HILL†",</span></span>
<span id="cb12-41"><a href="#cb12-41"></a><span class="in">  51.4076, -1.5174, "Victor GIBBS†\nMyrtle GIBBS†\nMichael JENNINGS\nMyra GEATER",</span></span>
<span id="cb12-42"><a href="#cb12-42"></a><span class="in">  51.4065, -1.5175, "Ian PLAYLE†",</span></span>
<span id="cb12-43"><a href="#cb12-43"></a><span class="in">  51.4062, -1.5152, "George NOON"</span></span>
<span id="cb12-44"><a href="#cb12-44"></a><span class="in">) |&gt; </span></span>
<span id="cb12-45"><a href="#cb12-45"></a><span class="in">  mutate(</span></span>
<span id="cb12-46"><a href="#cb12-46"></a><span class="in">    coords = xy_transform(</span></span>
<span id="cb12-47"><a href="#cb12-47"></a><span class="in">      longitude, </span></span>
<span id="cb12-48"><a href="#cb12-48"></a><span class="in">      latitude, </span></span>
<span id="cb12-49"><a href="#cb12-49"></a><span class="in">      from = "EPSG:4326", </span></span>
<span id="cb12-50"><a href="#cb12-50"></a><span class="in">      to = "EPSG:27700"</span></span>
<span id="cb12-51"><a href="#cb12-51"></a><span class="in">    ),</span></span>
<span id="cb12-52"><a href="#cb12-52"></a><span class="in">    order = row_number()</span></span>
<span id="cb12-53"><a href="#cb12-53"></a><span class="in">  ) |&gt; </span></span>
<span id="cb12-54"><a href="#cb12-54"></a><span class="in">  unnest(cols = "coords") |&gt; </span></span>
<span id="cb12-55"><a href="#cb12-55"></a><span class="in">  mutate(across(c(x, y), round)) |&gt; </span></span>
<span id="cb12-56"><a href="#cb12-56"></a><span class="in">  select(victims, order, easting = x, northing = y)</span></span>
<span id="cb12-57"><a href="#cb12-57"></a></span>
<span id="cb12-58"><a href="#cb12-58"></a><span class="in">hungerford_lines &lt;- hungerford_shootings |&gt; </span></span>
<span id="cb12-59"><a href="#cb12-59"></a><span class="in">  rename(x_end = easting, y_end = northing) |&gt; </span></span>
<span id="cb12-60"><a href="#cb12-60"></a><span class="in">  mutate(x_start = lag(x_end), y_start = lag(y_end)) |&gt; </span></span>
<span id="cb12-61"><a href="#cb12-61"></a><span class="in">  remove_missing(vars = c("x_start", "y_start"), na.rm = TRUE)</span></span>
<span id="cb12-62"><a href="#cb12-62"></a></span>
<span id="cb12-63"><a href="#cb12-63"></a><span class="in">hungerford_shootings_sf &lt;- hungerford_shootings |&gt; </span></span>
<span id="cb12-64"><a href="#cb12-64"></a><span class="in">  st_as_sf(coords = c("easting", "northing"), crs = "EPSG:27700")</span></span>
<span id="cb12-65"><a href="#cb12-65"></a></span>
<span id="cb12-66"><a href="#cb12-66"></a></span>
<span id="cb12-67"><a href="#cb12-67"></a></span>
<span id="cb12-68"><a href="#cb12-68"></a><span class="in"># Create stored maps -----------------------------------------------------------</span></span>
<span id="cb12-69"><a href="#cb12-69"></a></span>
<span id="cb12-70"><a href="#cb12-70"></a><span class="in">hungerford_map_overall &lt;- ggplot() +</span></span>
<span id="cb12-71"><a href="#cb12-71"></a><span class="in">  # Plot base map</span></span>
<span id="cb12-72"><a href="#cb12-72"></a><span class="in">  annotation_map_tile(zoomin = 1, progress = "none") +</span></span>
<span id="cb12-73"><a href="#cb12-73"></a><span class="in">  # Plot lines between points</span></span>
<span id="cb12-74"><a href="#cb12-74"></a><span class="in">  geom_curve(</span></span>
<span id="cb12-75"><a href="#cb12-75"></a><span class="in">    aes(x = x_start, y = y_start, xend = x_end, yend = y_end),</span></span>
<span id="cb12-76"><a href="#cb12-76"></a><span class="in">    data = hungerford_lines, </span></span>
<span id="cb12-77"><a href="#cb12-77"></a><span class="in">    arrow = arrow(length = unit(3, "mm"), type = "closed"),</span></span>
<span id="cb12-78"><a href="#cb12-78"></a><span class="in">    curvature = -0.2,</span></span>
<span id="cb12-79"><a href="#cb12-79"></a><span class="in">    colour = "orange3"</span></span>
<span id="cb12-80"><a href="#cb12-80"></a><span class="in">  ) +</span></span>
<span id="cb12-81"><a href="#cb12-81"></a><span class="in">  # Plot points</span></span>
<span id="cb12-82"><a href="#cb12-82"></a><span class="in">  geom_sf(</span></span>
<span id="cb12-83"><a href="#cb12-83"></a><span class="in">    data = hungerford_shootings_sf, </span></span>
<span id="cb12-84"><a href="#cb12-84"></a><span class="in">    shape = 21,</span></span>
<span id="cb12-85"><a href="#cb12-85"></a><span class="in">    colour = "white",</span></span>
<span id="cb12-86"><a href="#cb12-86"></a><span class="in">    fill = "orange3",</span></span>
<span id="cb12-87"><a href="#cb12-87"></a><span class="in">    size = 3</span></span>
<span id="cb12-88"><a href="#cb12-88"></a><span class="in">  ) +</span></span>
<span id="cb12-89"><a href="#cb12-89"></a><span class="in">  geom_label_repel(</span></span>
<span id="cb12-90"><a href="#cb12-90"></a><span class="in">    aes(x = easting, y = northing, label = order),</span></span>
<span id="cb12-91"><a href="#cb12-91"></a><span class="in">    data = filter(hungerford_shootings, order %in% 1:2), </span></span>
<span id="cb12-92"><a href="#cb12-92"></a><span class="in">    colour = "white",</span></span>
<span id="cb12-93"><a href="#cb12-93"></a><span class="in">    fill = "orange3",</span></span>
<span id="cb12-94"><a href="#cb12-94"></a><span class="in">    fontface = "bold",</span></span>
<span id="cb12-95"><a href="#cb12-95"></a><span class="in">    label.size = NA</span></span>
<span id="cb12-96"><a href="#cb12-96"></a><span class="in">  ) +</span></span>
<span id="cb12-97"><a href="#cb12-97"></a><span class="in">  annotation_scale(style = "ticks", line_col = "grey40", text_col = "grey40") +</span></span>
<span id="cb12-98"><a href="#cb12-98"></a><span class="in">  scale_y_continuous(expand = expansion(2)) +</span></span>
<span id="cb12-99"><a href="#cb12-99"></a><span class="in">  labs(title = " Shootings in Wiltshire") +</span></span>
<span id="cb12-100"><a href="#cb12-100"></a><span class="in">  coord_sf(crs = "EPSG:27700") +</span></span>
<span id="cb12-101"><a href="#cb12-101"></a><span class="in">  theme_void() +</span></span>
<span id="cb12-102"><a href="#cb12-102"></a><span class="in">  theme(</span></span>
<span id="cb12-103"><a href="#cb12-103"></a><span class="in">    panel.border = element_rect(colour = "grey20", fill = NA),</span></span>
<span id="cb12-104"><a href="#cb12-104"></a><span class="in">    plot.title = element_text(margin = margin(b = -18))</span></span>
<span id="cb12-105"><a href="#cb12-105"></a><span class="in">  )</span></span>
<span id="cb12-106"><a href="#cb12-106"></a></span>
<span id="cb12-107"><a href="#cb12-107"></a><span class="in">hungerford_map_town &lt;- ggplot() +</span></span>
<span id="cb12-108"><a href="#cb12-108"></a><span class="in">  annotation_map_tile(zoomin = 1, progress = "none") +</span></span>
<span id="cb12-109"><a href="#cb12-109"></a><span class="in">  # Plot lines between points</span></span>
<span id="cb12-110"><a href="#cb12-110"></a><span class="in">  geom_curve(</span></span>
<span id="cb12-111"><a href="#cb12-111"></a><span class="in">    aes(x = x_start, y = y_start, xend = x_end, yend = y_end),</span></span>
<span id="cb12-112"><a href="#cb12-112"></a><span class="in">    data = slice(hungerford_lines, 3:n()), </span></span>
<span id="cb12-113"><a href="#cb12-113"></a><span class="in">    arrow = arrow(length = unit(3, "mm"), type = "closed"),</span></span>
<span id="cb12-114"><a href="#cb12-114"></a><span class="in">    curvature = -0.2,</span></span>
<span id="cb12-115"><a href="#cb12-115"></a><span class="in">    colour = "orange3"</span></span>
<span id="cb12-116"><a href="#cb12-116"></a><span class="in">  ) +</span></span>
<span id="cb12-117"><a href="#cb12-117"></a><span class="in">  # Plot points</span></span>
<span id="cb12-118"><a href="#cb12-118"></a><span class="in">  geom_sf(</span></span>
<span id="cb12-119"><a href="#cb12-119"></a><span class="in">    data = slice(hungerford_shootings_sf, 3:n()), </span></span>
<span id="cb12-120"><a href="#cb12-120"></a><span class="in">    shape = 21,</span></span>
<span id="cb12-121"><a href="#cb12-121"></a><span class="in">    colour = "white",</span></span>
<span id="cb12-122"><a href="#cb12-122"></a><span class="in">    fill = "orange3",</span></span>
<span id="cb12-123"><a href="#cb12-123"></a><span class="in">    size = 3</span></span>
<span id="cb12-124"><a href="#cb12-124"></a><span class="in">  ) +</span></span>
<span id="cb12-125"><a href="#cb12-125"></a><span class="in">  geom_label_repel(</span></span>
<span id="cb12-126"><a href="#cb12-126"></a><span class="in">    aes(x = easting, y = northing, label = order),</span></span>
<span id="cb12-127"><a href="#cb12-127"></a><span class="in">    data = slice(hungerford_shootings, 3:n()), </span></span>
<span id="cb12-128"><a href="#cb12-128"></a><span class="in">    colour = "white",</span></span>
<span id="cb12-129"><a href="#cb12-129"></a><span class="in">    fill = "orange3",</span></span>
<span id="cb12-130"><a href="#cb12-130"></a><span class="in">    fontface = "bold",</span></span>
<span id="cb12-131"><a href="#cb12-131"></a><span class="in">    label.size = NA</span></span>
<span id="cb12-132"><a href="#cb12-132"></a><span class="in">  ) +</span></span>
<span id="cb12-133"><a href="#cb12-133"></a><span class="in">  annotation_scale(style = "ticks", line_col = "grey40", text_col = "grey40") +</span></span>
<span id="cb12-134"><a href="#cb12-134"></a><span class="in">  scale_x_continuous(expand = expansion(0.3)) +</span></span>
<span id="cb12-135"><a href="#cb12-135"></a><span class="in">  scale_y_continuous(expand = expansion(0.3)) +</span></span>
<span id="cb12-136"><a href="#cb12-136"></a><span class="in">  coord_sf(crs = "EPSG:27700") +</span></span>
<span id="cb12-137"><a href="#cb12-137"></a><span class="in">  labs(</span></span>
<span id="cb12-138"><a href="#cb12-138"></a><span class="in">    title = "Shootings in Hungerford town"</span></span>
<span id="cb12-139"><a href="#cb12-139"></a><span class="in">  ) +</span></span>
<span id="cb12-140"><a href="#cb12-140"></a><span class="in">  theme_void() +</span></span>
<span id="cb12-141"><a href="#cb12-141"></a><span class="in">  theme(</span></span>
<span id="cb12-142"><a href="#cb12-142"></a><span class="in">    panel.border = element_rect(colour = "grey20", fill = NA),</span></span>
<span id="cb12-143"><a href="#cb12-143"></a><span class="in">    plot.margin = margin(t = 12)</span></span>
<span id="cb12-144"><a href="#cb12-144"></a><span class="in">  )</span></span>
<span id="cb12-145"><a href="#cb12-145"></a><span class="in">```</span></span>
<span id="cb12-146"><a href="#cb12-146"></a></span>
<span id="cb12-147"><a href="#cb12-147"></a></span>
<span id="cb12-148"><a href="#cb12-148"></a><span class="co">&lt;!-- Case linkage: http://eknygos.lsmuni.lt/springer/605/117-133.pdf --&gt;</span></span>
<span id="cb12-149"><a href="#cb12-149"></a></span>
<span id="cb12-150"><a href="#cb12-150"></a></span>
<span id="cb12-151"><a href="#cb12-151"></a><span class="fu">## Introduction</span></span>
<span id="cb12-152"><a href="#cb12-152"></a></span>
<span id="cb12-153"><a href="#cb12-153"></a>It's common in crime mapping to treat each crime as a separate event. But a </span>
<span id="cb12-154"><a href="#cb12-154"></a>large proportion of crimes are committed by a relatively small proportion of all</span>
<span id="cb12-155"><a href="#cb12-155"></a>the people who commit crime. These persistent or repeat offenders commit crimes</span>
<span id="cb12-156"><a href="#cb12-156"></a>frequently, maybe several times a day in the case of some people. One type of</span>
<span id="cb12-157"><a href="#cb12-157"></a>repeat offending is the *crime series*, in which an offender or group of </span>
<span id="cb12-158"><a href="#cb12-158"></a>offenders commits the same or related crimes in different places over time. </span>
<span id="cb12-159"><a href="#cb12-159"></a></span>
<span id="cb12-160"><a href="#cb12-160"></a></span>
<span id="cb12-161"><a href="#cb12-161"></a><span class="fu">### Case linkage</span></span>
<span id="cb12-162"><a href="#cb12-162"></a></span>
<span id="cb12-163"><a href="#cb12-163"></a>One of the difficulties in studying serial offending is in identifying which </span>
<span id="cb12-164"><a href="#cb12-164"></a>offences are committed by the same offender. *Case linkage* is the process of </span>
<span id="cb12-165"><a href="#cb12-165"></a>identifying crime series by looking for similarities in the method used by an </span>
<span id="cb12-166"><a href="#cb12-166"></a>offender (e.g. entering a house by  breaking a lock on a side door out of sight </span>
<span id="cb12-167"><a href="#cb12-167"></a>from the street) or by evidence left at the scene (such as fingerprints or DNA). </span>
<span id="cb12-168"><a href="#cb12-168"></a>Case linkage is typically an imperfect process -- investigators might believe </span>
<span id="cb12-169"><a href="#cb12-169"></a>that two offences were committed by the same person, but in most cases they are </span>
<span id="cb12-170"><a href="#cb12-170"></a>unlikely to know for sure unless the offender has been caught (and sometimes not</span>
<span id="cb12-171"><a href="#cb12-171"></a>even then).</span>
<span id="cb12-172"><a href="#cb12-172"></a></span>
<span id="cb12-173"><a href="#cb12-173"></a>Watch this video to learn a bit more about crime linkage.</span>
<span id="cb12-174"><a href="#cb12-174"></a></span>
<span id="cb12-175"><a href="#cb12-175"></a>{{&lt; video https://youtu.be/XPOtaFRYrQs?t=13 &gt;}}</span>
<span id="cb12-176"><a href="#cb12-176"></a></span>
<span id="cb12-177"><a href="#cb12-177"></a>Once crimes have been linked together as being part of the same series, it can </span>
<span id="cb12-178"><a href="#cb12-178"></a>be useful to map them to better understand how the series has progressed. In </span>
<span id="cb12-179"><a href="#cb12-179"></a>this tutorial we will learn how to map linked cases.</span>
<span id="cb12-180"><a href="#cb12-180"></a></span>
<span id="cb12-181"><a href="#cb12-181"></a></span>
<span id="cb12-182"><a href="#cb12-182"></a><span class="fu">### The case used in this tutorial</span></span>
<span id="cb12-183"><a href="#cb12-183"></a></span>
<span id="cb12-184"><a href="#cb12-184"></a>Due to the uncertainty of case linkage, there is little publicly available data</span>
<span id="cb12-185"><a href="#cb12-185"></a>on the locations of serial crimes. The available data tends to focus on serial</span>
<span id="cb12-186"><a href="#cb12-186"></a>murders. To minimise the likelihood of anyone taking this course having been</span>
<span id="cb12-187"><a href="#cb12-187"></a>directly affected by -- or know anyone affected by -- the cases we use in this</span>
<span id="cb12-188"><a href="#cb12-188"></a>tutorial, we will use a historical example.</span>
<span id="cb12-189"><a href="#cb12-189"></a></span>
<span id="cb12-190"><a href="#cb12-190"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb12-191"><a href="#cb12-191"></a><span class="in">hungerford_murder_count &lt;- hungerford_shootings |&gt; </span></span>
<span id="cb12-192"><a href="#cb12-192"></a><span class="in">  mutate(murder_count = str_count(victims, "†")) |&gt;  </span></span>
<span id="cb12-193"><a href="#cb12-193"></a><span class="in">  summarise(murder_count = sum(murder_count)) |&gt; </span></span>
<span id="cb12-194"><a href="#cb12-194"></a><span class="in">  pull(murder_count)</span></span>
<span id="cb12-195"><a href="#cb12-195"></a><span class="in">```</span></span>
<span id="cb12-196"><a href="#cb12-196"></a></span>
<span id="cb12-197"><a href="#cb12-197"></a>The <span class="co">[</span><span class="ot">Hungerford massacre</span><span class="co">](https://en.wikipedia.org/wiki/Hungerford_massacre)</span> </span>
<span id="cb12-198"><a href="#cb12-198"></a>occurred in southern England in August 1987, when a marauding attacker (also </span>
<span id="cb12-199"><a href="#cb12-199"></a>known as a spree offender) killed <span class="in">`r hungerford_murder_count`</span> people and shot </span>
<span id="cb12-200"><a href="#cb12-200"></a>many others in the space of about 90 minutes. We will use a dataset called </span>
<span id="cb12-201"><a href="#cb12-201"></a><span class="in">`hungerford_shootings`</span> that contains the names of each victim and the </span>
<span id="cb12-202"><a href="#cb12-202"></a>approximate location at which they were shot (recorded as eastings and northings </span>
<span id="cb12-203"><a href="#cb12-203"></a>in the British National Grid). This data is taken from the </span>
<span id="cb12-204"><a href="#cb12-204"></a><span class="co">[</span><span class="ot">official report into the massacre</span><span class="co">](https://www.jesip.org.uk/uploads/media/incident_reports_and_inquiries/Hungerford%20Shootings.pdf)</span>. </span>
<span id="cb12-205"><a href="#cb12-205"></a>The <span class="in">`order`</span> column shows the order in which the victims were shot. These are the </span>
<span id="cb12-206"><a href="#cb12-206"></a>first few rows of the dataset (the dagger symbol † shows that the victim was </span>
<span id="cb12-207"><a href="#cb12-207"></a>killed):</span>
<span id="cb12-208"><a href="#cb12-208"></a></span>
<span id="cb12-209"><a href="#cb12-209"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb12-210"><a href="#cb12-210"></a><span class="in">hungerford_shootings |&gt; </span></span>
<span id="cb12-211"><a href="#cb12-211"></a><span class="in">  mutate(victims = str_replace_all(victims, "\\n", ", ")) |&gt; </span></span>
<span id="cb12-212"><a href="#cb12-212"></a><span class="in">  head(5) |&gt; </span></span>
<span id="cb12-213"><a href="#cb12-213"></a><span class="in">  knitr::kable()</span></span>
<span id="cb12-214"><a href="#cb12-214"></a><span class="in">```</span></span>
<span id="cb12-215"><a href="#cb12-215"></a></span>
<span id="cb12-216"><a href="#cb12-216"></a>In this tutorial we will learn how to create this composite map of the locations</span>
<span id="cb12-217"><a href="#cb12-217"></a>of the shootings in this crime series.</span>
<span id="cb12-218"><a href="#cb12-218"></a></span>
<span id="cb12-219"><a href="#cb12-219"></a><span class="in">```{r make-hungerford-map, eval=FALSE, echo=FALSE}</span></span>
<span id="cb12-220"><a href="#cb12-220"></a><span class="in">hungerford_map &lt;- (hungerford_map_overall / hungerford_map_town) + </span></span>
<span id="cb12-221"><a href="#cb12-221"></a><span class="in">  plot_annotation(</span></span>
<span id="cb12-222"><a href="#cb12-222"></a><span class="in">    title = "Shootings during the Hungerford massacre",</span></span>
<span id="cb12-223"><a href="#cb12-223"></a><span class="in">    caption = "data from the official report into the shootings",</span></span>
<span id="cb12-224"><a href="#cb12-224"></a><span class="in">    theme = theme(</span></span>
<span id="cb12-225"><a href="#cb12-225"></a><span class="in">      plot.caption = element_text(colour = "grey40", hjust = 0),</span></span>
<span id="cb12-226"><a href="#cb12-226"></a><span class="in">      plot.title = element_text(colour = "grey50", face = "bold", size = 14)</span></span>
<span id="cb12-227"><a href="#cb12-227"></a><span class="in">    )</span></span>
<span id="cb12-228"><a href="#cb12-228"></a><span class="in">  )</span></span>
<span id="cb12-229"><a href="#cb12-229"></a></span>
<span id="cb12-230"><a href="#cb12-230"></a><span class="in">ggsave(</span></span>
<span id="cb12-231"><a href="#cb12-231"></a><span class="in">  here::here("inst/tutorials/13_crime_series/images/hungerford_map.jpg"), </span></span>
<span id="cb12-232"><a href="#cb12-232"></a><span class="in">  hungerford_map,</span></span>
<span id="cb12-233"><a href="#cb12-233"></a><span class="in">  width = 900 / 150,</span></span>
<span id="cb12-234"><a href="#cb12-234"></a><span class="in">  height = 900 / 150,</span></span>
<span id="cb12-235"><a href="#cb12-235"></a><span class="in">  dpi = 150</span></span>
<span id="cb12-236"><a href="#cb12-236"></a><span class="in">)</span></span>
<span id="cb12-237"><a href="#cb12-237"></a><span class="in">```</span></span>
<span id="cb12-238"><a href="#cb12-238"></a></span>
<span id="cb12-239"><a href="#cb12-239"></a></span>
<span id="cb12-240"><a href="#cb12-240"></a>&lt;p class="full-width-image"&gt;&lt;img src="images/hungerford_map.jpg" alt="A map showing the sequence of events during the Hungerford Massacre" style="max-height: 900px;"&gt;&lt;/p&gt;</span>
<span id="cb12-241"><a href="#cb12-241"></a></span>
<span id="cb12-242"><a href="#cb12-242"></a></span>
<span id="cb12-243"><a href="#cb12-243"></a></span>
<span id="cb12-244"><a href="#cb12-244"></a><span class="fu">## Mapping linked cases</span></span>
<span id="cb12-245"><a href="#cb12-245"></a></span>
<span id="cb12-246"><a href="#cb12-246"></a>Mapping crime series can be useful for several reasons. For example, a map of a</span>
<span id="cb12-247"><a href="#cb12-247"></a>crime series might help the jurors in a criminal trial to better understand the</span>
<span id="cb12-248"><a href="#cb12-248"></a>sequence of events that the suspect is accused of. This can be especially </span>
<span id="cb12-249"><a href="#cb12-249"></a>helpful if the sequence is complicated or especially long.</span>
<span id="cb12-250"><a href="#cb12-250"></a></span>
<span id="cb12-251"><a href="#cb12-251"></a>At the moment, the <span class="in">`hungerford_shootings`</span> dataset contains the *point* location </span>
<span id="cb12-252"><a href="#cb12-252"></a>of each event and the order in which they occurred. To show a sequence of events </span>
<span id="cb12-253"><a href="#cb12-253"></a>on a map, we need to link each event with those that happened immediately before </span>
<span id="cb12-254"><a href="#cb12-254"></a>and after it. </span>
<span id="cb12-255"><a href="#cb12-255"></a></span>
<span id="cb12-256"><a href="#cb12-256"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb12-257"><a href="#cb12-257"></a><span class="in">hungerford_shootings |&gt; </span></span>
<span id="cb12-258"><a href="#cb12-258"></a><span class="in">  mutate(victims = str_replace_all(victims, "\\n", ", ")) |&gt; </span></span>
<span id="cb12-259"><a href="#cb12-259"></a><span class="in">  head(5) |&gt; </span></span>
<span id="cb12-260"><a href="#cb12-260"></a><span class="in">  knitr::kable()</span></span>
<span id="cb12-261"><a href="#cb12-261"></a><span class="in">```</span></span>
<span id="cb12-262"><a href="#cb12-262"></a></span>
<span id="cb12-263"><a href="#cb12-263"></a>One way to do this is to draw lines on the map connecting each incident in turn. </span>
<span id="cb12-264"><a href="#cb12-264"></a>To do this, we will create a dataset where each row contains _two_ pairs of </span>
<span id="cb12-265"><a href="#cb12-265"></a>co-ordinates: one representing the location of a particular shooting and the</span>
<span id="cb12-266"><a href="#cb12-266"></a>other representing the location of the _previous_ shooting. To do that, we will:</span>
<span id="cb12-267"><a href="#cb12-267"></a></span>
<span id="cb12-268"><a href="#cb12-268"></a><span class="ss">  1. </span>Take the <span class="in">`hungerford_shootings`</span> dataset and rename the existing columns</span>
<span id="cb12-269"><a href="#cb12-269"></a>     holding the co-ordinates so that it is clear those co-ordinates are for the</span>
<span id="cb12-270"><a href="#cb12-270"></a>     _end_ of each line between points. To do this we will use the <span class="in">`rename()`</span></span>
<span id="cb12-271"><a href="#cb12-271"></a>     function from the <span class="in">`dplyr`</span> package.</span>
<span id="cb12-272"><a href="#cb12-272"></a><span class="ss">  2. </span>Add two new columns to each row that show the co-ordinates of the row in</span>
<span id="cb12-273"><a href="#cb12-273"></a>     the dataset immediately above the current row (i.e. the row that represents</span>
<span id="cb12-274"><a href="#cb12-274"></a>     the location before the current location. We will do this with the <span class="in">`lag()`</span> </span>
<span id="cb12-275"><a href="#cb12-275"></a>     function, also from <span class="in">`dplyr`</span>.</span>
<span id="cb12-276"><a href="#cb12-276"></a><span class="ss">  3. </span>Use these two pairs of co-ordinates to plot lines on a map.</span>
<span id="cb12-277"><a href="#cb12-277"></a></span>
<span id="cb12-278"><a href="#cb12-278"></a><span class="in">```{r linked-exercise1, exercise=TRUE}</span></span>
<span id="cb12-279"><a href="#cb12-279"></a><span class="in">hungerford_lines &lt;- hungerford_shootings |&gt; </span></span>
<span id="cb12-280"><a href="#cb12-280"></a><span class="in">  rename(x_end = easting, y_end = northing) |&gt; </span></span>
<span id="cb12-281"><a href="#cb12-281"></a><span class="in">  mutate(x_start = lag(x_end), y_start = lag(y_end)) |&gt; </span></span>
<span id="cb12-282"><a href="#cb12-282"></a><span class="in">  # Remove the first line, which contains missing values and which we don't need</span></span>
<span id="cb12-283"><a href="#cb12-283"></a><span class="in">  remove_missing(vars = c("x_start", "y_start"), na.rm = TRUE)</span></span>
<span id="cb12-284"><a href="#cb12-284"></a></span>
<span id="cb12-285"><a href="#cb12-285"></a><span class="in">head(hungerford_lines)</span></span>
<span id="cb12-286"><a href="#cb12-286"></a><span class="in">```</span></span>
<span id="cb12-287"><a href="#cb12-287"></a></span>
<span id="cb12-288"><a href="#cb12-288"></a>&lt;div class="box extra-detail"&gt;</span>
<span id="cb12-289"><a href="#cb12-289"></a></span>
<span id="cb12-290"><a href="#cb12-290"></a>&lt;h5 id="linked-box1-title" class="box-title"&gt;Why does this code include <span class="in">`remove_missing()`</span>?&lt;/h5&gt;</span>
<span id="cb12-291"><a href="#cb12-291"></a></span>
<span id="cb12-292"><a href="#cb12-292"></a>&lt;div id="linked-box1" class="box-content"&gt;</span>
<span id="cb12-293"><a href="#cb12-293"></a></span>
<span id="cb12-294"><a href="#cb12-294"></a>You might notice that the values in the first row of the <span class="in">`x_start`</span> and <span class="in">`x_end`</span> </span>
<span id="cb12-295"><a href="#cb12-295"></a>columns in the <span class="in">`hungerford_lines`</span> object are <span class="in">`NA`</span> values. This is because these</span>
<span id="cb12-296"><a href="#cb12-296"></a>columns have been created using the <span class="in">`lag()`</span> function, which gets the value from</span>
<span id="cb12-297"><a href="#cb12-297"></a>the same column in the row immediately above. The first row doesn't have a row</span>
<span id="cb12-298"><a href="#cb12-298"></a>immediately above it, so <span class="in">`lag()`</span> returns <span class="in">`NA`</span>. Since the first row does not</span>
<span id="cb12-299"><a href="#cb12-299"></a>represent a link between shootings in any case, we can remove it with</span>
<span id="cb12-300"><a href="#cb12-300"></a><span class="in">`remove_missing()`</span>.</span>
<span id="cb12-301"><a href="#cb12-301"></a></span>
<span id="cb12-302"><a href="#cb12-302"></a>&lt;/div&gt;</span>
<span id="cb12-303"><a href="#cb12-303"></a></span>
<span id="cb12-304"><a href="#cb12-304"></a>&lt;/div&gt;</span>
<span id="cb12-305"><a href="#cb12-305"></a></span>
<span id="cb12-306"><a href="#cb12-306"></a>&lt;script&gt;</span>
<span id="cb12-307"><a href="#cb12-307"></a><span class="fu">$</span>(<span class="st">"#linked-box1-title"</span>)<span class="op">.</span><span class="fu">click</span>(<span class="kw">function</span> () { <span class="fu">$</span>(<span class="st">"#linked-box1"</span>)<span class="op">.</span><span class="fu">toggle</span>(<span class="st">"slow"</span>) })</span>
<span id="cb12-308"><a href="#cb12-308"></a>&lt;/script&gt;</span>
<span id="cb12-309"><a href="#cb12-309"></a></span>
<span id="cb12-310"><a href="#cb12-310"></a>This method for creating lines between points is one of several ways we could</span>
<span id="cb12-311"><a href="#cb12-311"></a>achieve the same result. For example, we could create lines connecting the </span>
<span id="cb12-312"><a href="#cb12-312"></a>points and store them as SF objects. However, the code to do that is more </span>
<span id="cb12-313"><a href="#cb12-313"></a>complicated and gives us slightly less control over the appearance of the lines, </span>
<span id="cb12-314"><a href="#cb12-314"></a>so we will not use that method. Using the method shown in the box above means </span>
<span id="cb12-315"><a href="#cb12-315"></a>the lines on our map are not SF objects, so we cannot use <span class="in">`geom_sf()`</span> to add </span>
<span id="cb12-316"><a href="#cb12-316"></a>them to the map. Instead, we will create a map using the <span class="in">`geom_segment()`</span> </span>
<span id="cb12-317"><a href="#cb12-317"></a>function from the <span class="in">`ggplot2`</span> package.</span>
<span id="cb12-318"><a href="#cb12-318"></a></span>
<span id="cb12-319"><a href="#cb12-319"></a><span class="in">```{r linked-exercise2, exercise=TRUE, exercise.lines=23}</span></span>
<span id="cb12-320"><a href="#cb12-320"></a><span class="in"># Convert the `hungerford_shootings` object to SF</span></span>
<span id="cb12-321"><a href="#cb12-321"></a><span class="in">hungerford_shootings_sf &lt;- st_as_sf(</span></span>
<span id="cb12-322"><a href="#cb12-322"></a><span class="in">  hungerford_shootings, </span></span>
<span id="cb12-323"><a href="#cb12-323"></a><span class="in">  coords = c("easting", "northing"), </span></span>
<span id="cb12-324"><a href="#cb12-324"></a><span class="in">  crs = "EPSG:27700"</span></span>
<span id="cb12-325"><a href="#cb12-325"></a><span class="in">)</span></span>
<span id="cb12-326"><a href="#cb12-326"></a></span>
<span id="cb12-327"><a href="#cb12-327"></a><span class="in"># Plot a basic map</span></span>
<span id="cb12-328"><a href="#cb12-328"></a><span class="in">ggplot() +</span></span>
<span id="cb12-329"><a href="#cb12-329"></a><span class="in">  # Plot base map</span></span>
<span id="cb12-330"><a href="#cb12-330"></a><span class="in">  annotation_map_tile(zoomin = 0, progress = "none") +</span></span>
<span id="cb12-331"><a href="#cb12-331"></a><span class="in">  # Plot lines between points</span></span>
<span id="cb12-332"><a href="#cb12-332"></a><span class="in">  geom_segment(</span></span>
<span id="cb12-333"><a href="#cb12-333"></a><span class="in">    aes(x = x_start, y = y_start, xend = x_end, yend = y_end), </span></span>
<span id="cb12-334"><a href="#cb12-334"></a><span class="in">    data = hungerford_lines</span></span>
<span id="cb12-335"><a href="#cb12-335"></a><span class="in">  ) +</span></span>
<span id="cb12-336"><a href="#cb12-336"></a><span class="in">  # Plot points</span></span>
<span id="cb12-337"><a href="#cb12-337"></a><span class="in">  geom_sf(data = hungerford_shootings_sf) +</span></span>
<span id="cb12-338"><a href="#cb12-338"></a><span class="in">  # Since one of our layers is not an SF object, tell `ggplot()` what </span></span>
<span id="cb12-339"><a href="#cb12-339"></a><span class="in">  # co-ordinate system to use</span></span>
<span id="cb12-340"><a href="#cb12-340"></a><span class="in">  coord_sf(crs = "EPSG:27700") +</span></span>
<span id="cb12-341"><a href="#cb12-341"></a><span class="in">  theme_void()</span></span>
<span id="cb12-342"><a href="#cb12-342"></a><span class="in">```</span></span>
<span id="cb12-343"><a href="#cb12-343"></a></span>
<span id="cb12-344"><a href="#cb12-344"></a>This map is not particularly useful -- we will return to that in a minute.</span>
<span id="cb12-345"><a href="#cb12-345"></a></span>
<span id="cb12-346"><a href="#cb12-346"></a>If you look at this code, you'll see that we've included the function</span>
<span id="cb12-347"><a href="#cb12-347"></a><span class="in">`coord_sf()`</span> in our <span class="in">`ggplot()`</span> stack. In all the previous maps that we have </span>
<span id="cb12-348"><a href="#cb12-348"></a>made, we have used <span class="in">`geom_sf()`</span> to plot geographic data on our maps. <span class="in">`geom_sf()`</span></span>
<span id="cb12-349"><a href="#cb12-349"></a>understands how to translate co-ordinates specified using different co-ordinate</span>
<span id="cb12-350"><a href="#cb12-350"></a>systems to locations on the surface of each map. Other functions in the </span>
<span id="cb12-351"><a href="#cb12-351"></a><span class="in">`geom_*()`</span> family of functions do not know how to do this automatically, so we</span>
<span id="cb12-352"><a href="#cb12-352"></a>must specify the co-ordinate system by adding the <span class="in">`coord_sf()`</span> function to the</span>
<span id="cb12-353"><a href="#cb12-353"></a>stack. We only need to use one argument to <span class="in">`coord_sf()`</span>: the <span class="in">`crs`</span> argument to</span>
<span id="cb12-354"><a href="#cb12-354"></a>specify the co-ordinate system that our data uses. In this case, we know that</span>
<span id="cb12-355"><a href="#cb12-355"></a>the co-ordinates in the <span class="in">`hungerford_lines`</span> object are specified using the </span>
<span id="cb12-356"><a href="#cb12-356"></a>British National Grid, which has the EPSG code 27700.</span>
<span id="cb12-357"><a href="#cb12-357"></a></span>
<span id="cb12-358"><a href="#cb12-358"></a>The map we have made above shows the sequence of events, but there are at least </span>
<span id="cb12-359"><a href="#cb12-359"></a>four ways that we can make it better.</span>
<span id="cb12-360"><a href="#cb12-360"></a></span>
<span id="cb12-361"><a href="#cb12-361"></a><span class="ss">  1. </span>It would be useful to be able to see a larger area around the shooting</span>
<span id="cb12-362"><a href="#cb12-362"></a>     locations, to see more of the town surrounding the area in which the crimes</span>
<span id="cb12-363"><a href="#cb12-363"></a>     occurred.</span>
<span id="cb12-364"><a href="#cb12-364"></a><span class="ss">  2. </span>We don't know which order to move through the sequence of lines. We can </span>
<span id="cb12-365"><a href="#cb12-365"></a>     deal with this by adding arrows to show the direction of travel.</span>
<span id="cb12-366"><a href="#cb12-366"></a><span class="ss">  3. </span>The straight lines make it look like the offender travelled across fields</span>
<span id="cb12-367"><a href="#cb12-367"></a>     between locations, which is probably not true. Since we do not have data on</span>
<span id="cb12-368"><a href="#cb12-368"></a>     what routes the offender took, we can replace the straight lines with </span>
<span id="cb12-369"><a href="#cb12-369"></a>     curves to indicate that the exact route is unknown.</span>
<span id="cb12-370"><a href="#cb12-370"></a><span class="ss">  4. </span>Because the first two shootings occurred outside the town, the map has to</span>
<span id="cb12-371"><a href="#cb12-371"></a>     cover a large area and this makes it harder to see the sequence of events </span>
<span id="cb12-372"><a href="#cb12-372"></a>     in the town itself.</span>
<span id="cb12-373"><a href="#cb12-373"></a></span>
<span id="cb12-374"><a href="#cb12-374"></a></span>
<span id="cb12-375"><a href="#cb12-375"></a><span class="fu">### Extending the map area</span></span>
<span id="cb12-376"><a href="#cb12-376"></a></span>
<span id="cb12-377"><a href="#cb12-377"></a>By default, <span class="in">`ggplot()`</span> works out the limits of the area shown on the map based</span>
<span id="cb12-378"><a href="#cb12-378"></a>on the area covered by the data we add to each stack with functions from the</span>
<span id="cb12-379"><a href="#cb12-379"></a><span class="in">`geom_*()`</span> family of functions. Usually this works well, but in this case the</span>
<span id="cb12-380"><a href="#cb12-380"></a>distribution of the shootings means that the map shows only a small slice of the </span>
<span id="cb12-381"><a href="#cb12-381"></a>town of Hungerford and the surrounding area. It would be useful for readers to</span>
<span id="cb12-382"><a href="#cb12-382"></a>be able to see a larger area, to be able to better identify where the shootings</span>
<span id="cb12-383"><a href="#cb12-383"></a>occurred. </span>
<span id="cb12-384"><a href="#cb12-384"></a></span>
<span id="cb12-385"><a href="#cb12-385"></a>To expand the area shown on the map, we can use <span class="in">`scale_y_continuous()`</span> function</span>
<span id="cb12-386"><a href="#cb12-386"></a>from the <span class="in">`ggplot2`</span> package. We have used the <span class="in">`scale_fill_distiller()`</span></span>
<span id="cb12-387"><a href="#cb12-387"></a>and <span class="in">`scale_fill_gradient()`</span> functions in previous tutorials to control how </span>
<span id="cb12-388"><a href="#cb12-388"></a>columns in the data are represented as colours on the map. The </span>
<span id="cb12-389"><a href="#cb12-389"></a><span class="in">`scale_y_continuous()`</span> function is similar, in that it controls the vertical</span>
<span id="cb12-390"><a href="#cb12-390"></a>(Y) axis on the map. We don't need to use most of the capabilities of</span>
<span id="cb12-391"><a href="#cb12-391"></a><span class="in">`scale_y_continuous()`</span> because <span class="in">`ggplot()`</span> sets reasonable default values. The</span>
<span id="cb12-392"><a href="#cb12-392"></a>only argument we need to set is the <span class="in">`expand`</span> argument, which controls how far</span>
<span id="cb12-393"><a href="#cb12-393"></a>the map should extend around the area covered by the data.</span>
<span id="cb12-394"><a href="#cb12-394"></a></span>
<span id="cb12-395"><a href="#cb12-395"></a>The easiest way to set the correct values for the <span class="in">`expand`</span> function is to use </span>
<span id="cb12-396"><a href="#cb12-396"></a>the <span class="in">`expansion()`</span> helper function. We can use this to specify how much extra </span>
<span id="cb12-397"><a href="#cb12-397"></a>area around the data we want to include on the map. For example, <span class="in">`expansion(2)`</span></span>
<span id="cb12-398"><a href="#cb12-398"></a>means that the Y axis of the map should cover the area covered by the data and </span>
<span id="cb12-399"><a href="#cb12-399"></a>twice that distance either side of the data.</span>
<span id="cb12-400"><a href="#cb12-400"></a></span>
<span id="cb12-401"><a href="#cb12-401"></a></span>
<span id="cb12-402"><a href="#cb12-402"></a><span class="in">```{r linked-exercise3, exercise=TRUE, exercise.lines=15, out.width="100%"}</span></span>
<span id="cb12-403"><a href="#cb12-403"></a><span class="in"># Plot a basic map</span></span>
<span id="cb12-404"><a href="#cb12-404"></a><span class="in">ggplot() +</span></span>
<span id="cb12-405"><a href="#cb12-405"></a><span class="in">  # Plot base map</span></span>
<span id="cb12-406"><a href="#cb12-406"></a><span class="in">  annotation_map_tile(zoomin = 0, progress = "none") +</span></span>
<span id="cb12-407"><a href="#cb12-407"></a><span class="in">  # Plot lines between points</span></span>
<span id="cb12-408"><a href="#cb12-408"></a><span class="in">  geom_segment(</span></span>
<span id="cb12-409"><a href="#cb12-409"></a><span class="in">    aes(x = x_start, y = y_start, xend = x_end, yend = y_end), </span></span>
<span id="cb12-410"><a href="#cb12-410"></a><span class="in">    data = hungerford_lines</span></span>
<span id="cb12-411"><a href="#cb12-411"></a><span class="in">  ) +</span></span>
<span id="cb12-412"><a href="#cb12-412"></a><span class="in">  # Plot points</span></span>
<span id="cb12-413"><a href="#cb12-413"></a><span class="in">  geom_sf(data = hungerford_shootings_sf) +</span></span>
<span id="cb12-414"><a href="#cb12-414"></a><span class="in">  scale_y_continuous(expand = expansion(2)) +</span></span>
<span id="cb12-415"><a href="#cb12-415"></a><span class="in">  coord_sf(crs = "EPSG:27700") +</span></span>
<span id="cb12-416"><a href="#cb12-416"></a><span class="in">  theme_void()</span></span>
<span id="cb12-417"><a href="#cb12-417"></a><span class="in">```</span></span>
<span id="cb12-418"><a href="#cb12-418"></a></span>
<span id="cb12-419"><a href="#cb12-419"></a>::: {.box .notewell}</span>
<span id="cb12-420"><a href="#cb12-420"></a></span>
<span id="cb12-421"><a href="#cb12-421"></a>The <span class="in">`scale_y_continuous()`</span> function specifically controls the vertical (Y) axis</span>
<span id="cb12-422"><a href="#cb12-422"></a>of the map, so it only adds space above and below the data on the map. If we</span>
<span id="cb12-423"><a href="#cb12-423"></a>wanted to add space to the left and right of the data, we would need to use the</span>
<span id="cb12-424"><a href="#cb12-424"></a><span class="in">`scale_x_continuous()`</span> function. But in this case, since the map is already very </span>
<span id="cb12-425"><a href="#cb12-425"></a>wide relative to its height, we will not make the map any wider.</span>
<span id="cb12-426"><a href="#cb12-426"></a></span>
<span id="cb12-427"><a href="#cb12-427"></a>:::</span>
<span id="cb12-428"><a href="#cb12-428"></a></span>
<span id="cb12-429"><a href="#cb12-429"></a></span>
<span id="cb12-430"><a href="#cb12-430"></a><span class="fu">### Adding arrows and curves</span></span>
<span id="cb12-431"><a href="#cb12-431"></a></span>
<span id="cb12-432"><a href="#cb12-432"></a>To add an arrow to the end of each line segment we can use the <span class="in">`arrow()`</span></span>
<span id="cb12-433"><a href="#cb12-433"></a>helper function from the <span class="in">`ggplot2`</span> package to specify the <span class="in">`arrow`</span> argument of</span>
<span id="cb12-434"><a href="#cb12-434"></a>the <span class="in">`geom_segment()`</span> function in our <span class="in">`ggplot()`</span> stack. Here, we make the arrow</span>
<span id="cb12-435"><a href="#cb12-435"></a>head smaller than the default by setting <span class="in">`length = unit(3, "mm")`</span> and choose the</span>
<span id="cb12-436"><a href="#cb12-436"></a>style of the arrow head with <span class="in">`type = "closed"`</span>.</span>
<span id="cb12-437"><a href="#cb12-437"></a></span>
<span id="cb12-438"><a href="#cb12-438"></a>To prevent the arrow heads from obscuring the points, we will give the points a</span>
<span id="cb12-439"><a href="#cb12-439"></a>thin white border by specifying <span class="in">`shape = 21`</span> (a circle with a separate border)</span>
<span id="cb12-440"><a href="#cb12-440"></a>and <span class="in">`colour = "white"`</span>, as well as making the points slightly bigger with </span>
<span id="cb12-441"><a href="#cb12-441"></a><span class="in">`size = 2`</span>.</span>
<span id="cb12-442"><a href="#cb12-442"></a></span>
<span id="cb12-443"><a href="#cb12-443"></a><span class="in">```{r linked-exercise4, exercise=TRUE, exercise.lines=22, out.width="100%"}</span></span>
<span id="cb12-444"><a href="#cb12-444"></a><span class="in">ggplot() +</span></span>
<span id="cb12-445"><a href="#cb12-445"></a><span class="in">  # Plot base map</span></span>
<span id="cb12-446"><a href="#cb12-446"></a><span class="in">  annotation_map_tile(zoomin = 0, progress = "none") +</span></span>
<span id="cb12-447"><a href="#cb12-447"></a><span class="in">  # Plot lines between points</span></span>
<span id="cb12-448"><a href="#cb12-448"></a><span class="in">  geom_segment(</span></span>
<span id="cb12-449"><a href="#cb12-449"></a><span class="in">    aes(x = x_start, y = y_start, xend = x_end, yend = y_end),</span></span>
<span id="cb12-450"><a href="#cb12-450"></a><span class="in">    data = hungerford_lines, </span></span>
<span id="cb12-451"><a href="#cb12-451"></a><span class="in">    arrow = arrow(length = unit(3, "mm"), type = "closed"),</span></span>
<span id="cb12-452"><a href="#cb12-452"></a><span class="in">    colour = "orange3"</span></span>
<span id="cb12-453"><a href="#cb12-453"></a><span class="in">  ) +</span></span>
<span id="cb12-454"><a href="#cb12-454"></a><span class="in">  # Plot points</span></span>
<span id="cb12-455"><a href="#cb12-455"></a><span class="in">  geom_sf(</span></span>
<span id="cb12-456"><a href="#cb12-456"></a><span class="in">    data = hungerford_shootings_sf,</span></span>
<span id="cb12-457"><a href="#cb12-457"></a><span class="in">    shape = 21,</span></span>
<span id="cb12-458"><a href="#cb12-458"></a><span class="in">    colour = "white",</span></span>
<span id="cb12-459"><a href="#cb12-459"></a><span class="in">    fill = "orange3",</span></span>
<span id="cb12-460"><a href="#cb12-460"></a><span class="in">    size = 3</span></span>
<span id="cb12-461"><a href="#cb12-461"></a><span class="in">  ) +</span></span>
<span id="cb12-462"><a href="#cb12-462"></a><span class="in">  scale_y_continuous(expand = expansion(2)) +</span></span>
<span id="cb12-463"><a href="#cb12-463"></a><span class="in">  coord_sf(crs = "EPSG:27700") +</span></span>
<span id="cb12-464"><a href="#cb12-464"></a><span class="in">  theme_void()</span></span>
<span id="cb12-465"><a href="#cb12-465"></a><span class="in">```</span></span>
<span id="cb12-466"><a href="#cb12-466"></a></span>
<span id="cb12-467"><a href="#cb12-467"></a>This makes it easier to see that the shootings started at the point on the left</span>
<span id="cb12-468"><a href="#cb12-468"></a>of the map, but makes the problem of understanding the sequence of events in the</span>
<span id="cb12-469"><a href="#cb12-469"></a>town itself even worse. We will deal with this in the next section.</span>
<span id="cb12-470"><a href="#cb12-470"></a></span>
<span id="cb12-471"><a href="#cb12-471"></a>In the map above, we used the <span class="in">`geom_segment()`</span> function to add the lines to our</span>
<span id="cb12-472"><a href="#cb12-472"></a>map. If we change this to <span class="in">`geom_curve()`</span> the lines will become curved rather</span>
<span id="cb12-473"><a href="#cb12-473"></a>than straight. By specifying <span class="in">`curvature = -0.2`</span> we get a slightly straighter</span>
<span id="cb12-474"><a href="#cb12-474"></a>line than the default, and a left-hand curve because the value of <span class="in">`curvature`</span> is</span>
<span id="cb12-475"><a href="#cb12-475"></a>negative.</span>
<span id="cb12-476"><a href="#cb12-476"></a></span>
<span id="cb12-477"><a href="#cb12-477"></a>The other change we can make at this point is to add a layer of labels showing </span>
<span id="cb12-478"><a href="#cb12-478"></a>the order in which the shootings occurred. We don't want the labels to overlap </span>
<span id="cb12-479"><a href="#cb12-479"></a>the points, so we will use <span class="in">`geom_label_repel()`</span> from the <span class="in">`ggrepel`</span> package to </span>
<span id="cb12-480"><a href="#cb12-480"></a>create labels that are automatically offset from the points they relate to. </span>
<span id="cb12-481"><a href="#cb12-481"></a>For now, we will just label the first two locations. </span>
<span id="cb12-482"><a href="#cb12-482"></a></span>
<span id="cb12-483"><a href="#cb12-483"></a>At this point we can also make some minor changes to the map -- adding a title</span>
<span id="cb12-484"><a href="#cb12-484"></a>and scale bar, putting a neat line around the map -- the purpose of which will</span>
<span id="cb12-485"><a href="#cb12-485"></a>become clear in the next section.</span>
<span id="cb12-486"><a href="#cb12-486"></a></span>
<span id="cb12-487"><a href="#cb12-487"></a><span class="in">```{r linked-exercise5, exercise=TRUE, exercise.lines=41, out.width="100%"}</span></span>
<span id="cb12-488"><a href="#cb12-488"></a><span class="in">library(ggrepel)</span></span>
<span id="cb12-489"><a href="#cb12-489"></a></span>
<span id="cb12-490"><a href="#cb12-490"></a><span class="in">hungerford_map_overall &lt;- ggplot() +</span></span>
<span id="cb12-491"><a href="#cb12-491"></a><span class="in">  # Plot base map</span></span>
<span id="cb12-492"><a href="#cb12-492"></a><span class="in">  annotation_map_tile(zoomin = 0, progress = "none") +</span></span>
<span id="cb12-493"><a href="#cb12-493"></a><span class="in">  # Plot lines between points</span></span>
<span id="cb12-494"><a href="#cb12-494"></a><span class="in">  geom_curve(</span></span>
<span id="cb12-495"><a href="#cb12-495"></a><span class="in">    aes(x = x_start, y = y_start, xend = x_end, yend = y_end),</span></span>
<span id="cb12-496"><a href="#cb12-496"></a><span class="in">    data = hungerford_lines, </span></span>
<span id="cb12-497"><a href="#cb12-497"></a><span class="in">    arrow = arrow(length = unit(3, "mm"), type = "closed"),</span></span>
<span id="cb12-498"><a href="#cb12-498"></a><span class="in">    curvature = -0.2,</span></span>
<span id="cb12-499"><a href="#cb12-499"></a><span class="in">    colour = "orange3"</span></span>
<span id="cb12-500"><a href="#cb12-500"></a><span class="in">  ) +</span></span>
<span id="cb12-501"><a href="#cb12-501"></a><span class="in">  # Plot points</span></span>
<span id="cb12-502"><a href="#cb12-502"></a><span class="in">  geom_sf(</span></span>
<span id="cb12-503"><a href="#cb12-503"></a><span class="in">    data = hungerford_shootings_sf, </span></span>
<span id="cb12-504"><a href="#cb12-504"></a><span class="in">    shape = 21,</span></span>
<span id="cb12-505"><a href="#cb12-505"></a><span class="in">    colour = "white",</span></span>
<span id="cb12-506"><a href="#cb12-506"></a><span class="in">    fill = "orange3",</span></span>
<span id="cb12-507"><a href="#cb12-507"></a><span class="in">    size = 3</span></span>
<span id="cb12-508"><a href="#cb12-508"></a><span class="in">  ) +</span></span>
<span id="cb12-509"><a href="#cb12-509"></a><span class="in">  geom_label_repel(</span></span>
<span id="cb12-510"><a href="#cb12-510"></a><span class="in">    aes(x = easting, y = northing, label = order),</span></span>
<span id="cb12-511"><a href="#cb12-511"></a><span class="in">    data = filter(hungerford_shootings, order %in% 1:2), </span></span>
<span id="cb12-512"><a href="#cb12-512"></a><span class="in">    colour = "white",</span></span>
<span id="cb12-513"><a href="#cb12-513"></a><span class="in">    fill = "orange3",</span></span>
<span id="cb12-514"><a href="#cb12-514"></a><span class="in">    fontface = "bold",</span></span>
<span id="cb12-515"><a href="#cb12-515"></a><span class="in">    label.size = NA</span></span>
<span id="cb12-516"><a href="#cb12-516"></a><span class="in">  ) +</span></span>
<span id="cb12-517"><a href="#cb12-517"></a><span class="in">  annotation_scale(style = "ticks", line_col = "grey40", text_col = "grey40") +</span></span>
<span id="cb12-518"><a href="#cb12-518"></a><span class="in">  scale_y_continuous(expand = expansion(2)) +</span></span>
<span id="cb12-519"><a href="#cb12-519"></a><span class="in">  labs(title = " Shootings in Wiltshire") +</span></span>
<span id="cb12-520"><a href="#cb12-520"></a><span class="in">  coord_sf(crs = "EPSG:27700") +</span></span>
<span id="cb12-521"><a href="#cb12-521"></a><span class="in">  theme_void() +</span></span>
<span id="cb12-522"><a href="#cb12-522"></a><span class="in">  theme(</span></span>
<span id="cb12-523"><a href="#cb12-523"></a><span class="in">    panel.border = element_rect(colour = "grey20", fill = NA),</span></span>
<span id="cb12-524"><a href="#cb12-524"></a><span class="in">    plot.title = element_text(margin = margin(b = -18))</span></span>
<span id="cb12-525"><a href="#cb12-525"></a><span class="in">  )</span></span>
<span id="cb12-526"><a href="#cb12-526"></a></span>
<span id="cb12-527"><a href="#cb12-527"></a><span class="in">hungerford_map_overall</span></span>
<span id="cb12-528"><a href="#cb12-528"></a><span class="in">```</span></span>
<span id="cb12-529"><a href="#cb12-529"></a></span>
<span id="cb12-530"><a href="#cb12-530"></a>Now we have added arrow heads and curved lines, in the next section we will</span>
<span id="cb12-531"><a href="#cb12-531"></a>learn how to solve the problem of the events in the town itself being unclear on</span>
<span id="cb12-532"><a href="#cb12-532"></a>the map.</span>
<span id="cb12-533"><a href="#cb12-533"></a></span>
<span id="cb12-534"><a href="#cb12-534"></a></span>
<span id="cb12-535"><a href="#cb12-535"></a></span>
<span id="cb12-536"><a href="#cb12-536"></a><span class="fu">## Multiple maps</span></span>
<span id="cb12-537"><a href="#cb12-537"></a></span>
<span id="cb12-538"><a href="#cb12-538"></a>&lt;p class="full-width-image"&gt;&lt;img src="images/patchwork_1.jpg" alt="Cartoon showing furry monsters arranging three picture frames hanging from a wall."&gt;&lt;/p&gt;</span>
<span id="cb12-539"><a href="#cb12-539"></a></span>
<span id="cb12-540"><a href="#cb12-540"></a>Our existing map is difficult to understand because we have a mix of some events</span>
<span id="cb12-541"><a href="#cb12-541"></a>very close together (including several on the same street) and some that </span>
<span id="cb12-542"><a href="#cb12-542"></a>occurred further away. This means the closer events overlap on the map, </span>
<span id="cb12-543"><a href="#cb12-543"></a>especially now that we have made the points larger to distinguish them from the</span>
<span id="cb12-544"><a href="#cb12-544"></a>lines linking each event.</span>
<span id="cb12-545"><a href="#cb12-545"></a></span>
<span id="cb12-546"><a href="#cb12-546"></a>&lt;a href="https://patchwork.data-imaginist.com/"&gt;&lt;img src="images/patchwork.png" alt="patchwork package logo" class="right-side-image"&gt;&lt;/a&gt;</span>
<span id="cb12-547"><a href="#cb12-547"></a></span>
<span id="cb12-548"><a href="#cb12-548"></a>To deal with this problem we can display two maps: one showing the whole area </span>
<span id="cb12-549"><a href="#cb12-549"></a>covered by the points and a second (sometimes called an *inset map*) showing </span>
<span id="cb12-550"><a href="#cb12-550"></a>only the events in the town of Hungerford itself. We will do this using the </span>
<span id="cb12-551"><a href="#cb12-551"></a><span class="co">[</span><span class="ot">`patchwork` package</span><span class="co">](https://patchwork.data-imaginist.com/)</span> to combine multiple</span>
<span id="cb12-552"><a href="#cb12-552"></a>maps made using <span class="in">`ggplot()`</span>.</span>
<span id="cb12-553"><a href="#cb12-553"></a></span>
<span id="cb12-554"><a href="#cb12-554"></a>We have already saved the first map as <span class="in">`hungerford_map_overall`</span>. We can create a</span>
<span id="cb12-555"><a href="#cb12-555"></a>map showing only the shootings in Hungerford itself by removing the first two</span>
<span id="cb12-556"><a href="#cb12-556"></a>points from <span class="in">`hungerford_points_sf`</span> (since they represent shootings outside the</span>
<span id="cb12-557"><a href="#cb12-557"></a>town itself). We can do this for all the existing layers using <span class="in">`slice()`</span>.</span>
<span id="cb12-558"><a href="#cb12-558"></a></span>
<span id="cb12-559"><a href="#cb12-559"></a>We will use the <span class="in">`plot.margin`</span> argument to the <span class="in">`theme()`</span> function to add a small </span>
<span id="cb12-560"><a href="#cb12-560"></a>amount of space at the top of this map, which will help separate it from the </span>
<span id="cb12-561"><a href="#cb12-561"></a>first map when we put them together. We will also get the map to cover a </span>
<span id="cb12-562"><a href="#cb12-562"></a>slightly larger area than it would by default by using the </span>
<span id="cb12-563"><a href="#cb12-563"></a><span class="in">`scale_x_continuous()`</span> and <span class="in">`scale_y_continuous()`</span> functions.</span>
<span id="cb12-564"><a href="#cb12-564"></a></span>
<span id="cb12-565"><a href="#cb12-565"></a><span class="in">```{r multiple-exercise1, exercise=TRUE, exercise.lines=41, fig.asp=1}</span></span>
<span id="cb12-566"><a href="#cb12-566"></a><span class="in">hungerford_map_town &lt;- ggplot() +</span></span>
<span id="cb12-567"><a href="#cb12-567"></a><span class="in">  annotation_map_tile(zoomin = 0, progress = "none") +</span></span>
<span id="cb12-568"><a href="#cb12-568"></a><span class="in">  # Plot lines between points</span></span>
<span id="cb12-569"><a href="#cb12-569"></a><span class="in">  geom_curve(</span></span>
<span id="cb12-570"><a href="#cb12-570"></a><span class="in">    aes(x = x_start, y = y_start, xend = x_end, yend = y_end),</span></span>
<span id="cb12-571"><a href="#cb12-571"></a><span class="in">    data = slice(hungerford_lines, 3:n()), </span></span>
<span id="cb12-572"><a href="#cb12-572"></a><span class="in">    arrow = arrow(length = unit(3, "mm"), type = "closed"),</span></span>
<span id="cb12-573"><a href="#cb12-573"></a><span class="in">    curvature = -0.2,</span></span>
<span id="cb12-574"><a href="#cb12-574"></a><span class="in">    colour = "orange3"</span></span>
<span id="cb12-575"><a href="#cb12-575"></a><span class="in">  ) +</span></span>
<span id="cb12-576"><a href="#cb12-576"></a><span class="in">  # Plot points</span></span>
<span id="cb12-577"><a href="#cb12-577"></a><span class="in">  geom_sf(</span></span>
<span id="cb12-578"><a href="#cb12-578"></a><span class="in">    data = slice(hungerford_shootings_sf, 3:n()), </span></span>
<span id="cb12-579"><a href="#cb12-579"></a><span class="in">    shape = 21,</span></span>
<span id="cb12-580"><a href="#cb12-580"></a><span class="in">    colour = "white",</span></span>
<span id="cb12-581"><a href="#cb12-581"></a><span class="in">    fill = "orange3",</span></span>
<span id="cb12-582"><a href="#cb12-582"></a><span class="in">    size = 3</span></span>
<span id="cb12-583"><a href="#cb12-583"></a><span class="in">  ) +</span></span>
<span id="cb12-584"><a href="#cb12-584"></a><span class="in">  geom_label_repel(</span></span>
<span id="cb12-585"><a href="#cb12-585"></a><span class="in">    aes(x = easting, y = northing, label = order),</span></span>
<span id="cb12-586"><a href="#cb12-586"></a><span class="in">    data = slice(hungerford_shootings, 3:n()), </span></span>
<span id="cb12-587"><a href="#cb12-587"></a><span class="in">    colour = "white",</span></span>
<span id="cb12-588"><a href="#cb12-588"></a><span class="in">    fill = "orange3",</span></span>
<span id="cb12-589"><a href="#cb12-589"></a><span class="in">    fontface = "bold",</span></span>
<span id="cb12-590"><a href="#cb12-590"></a><span class="in">    label.size = NA</span></span>
<span id="cb12-591"><a href="#cb12-591"></a><span class="in">  ) +</span></span>
<span id="cb12-592"><a href="#cb12-592"></a><span class="in">  annotation_scale(style = "ticks", line_col = "grey40", text_col = "grey40") +</span></span>
<span id="cb12-593"><a href="#cb12-593"></a><span class="in">  scale_x_continuous(expand = expansion(0.3)) +</span></span>
<span id="cb12-594"><a href="#cb12-594"></a><span class="in">  scale_y_continuous(expand = expansion(0.3)) +</span></span>
<span id="cb12-595"><a href="#cb12-595"></a><span class="in">  coord_sf(crs = "EPSG:27700") +</span></span>
<span id="cb12-596"><a href="#cb12-596"></a><span class="in">  labs(</span></span>
<span id="cb12-597"><a href="#cb12-597"></a><span class="in">    title = "Shootings in Hungerford town"</span></span>
<span id="cb12-598"><a href="#cb12-598"></a><span class="in">  ) +</span></span>
<span id="cb12-599"><a href="#cb12-599"></a><span class="in">  theme_void() +</span></span>
<span id="cb12-600"><a href="#cb12-600"></a><span class="in">  theme(</span></span>
<span id="cb12-601"><a href="#cb12-601"></a><span class="in">    panel.border = element_rect(colour = "grey20", fill = NA),</span></span>
<span id="cb12-602"><a href="#cb12-602"></a><span class="in">    plot.margin = margin(t = 12)</span></span>
<span id="cb12-603"><a href="#cb12-603"></a><span class="in">  )</span></span>
<span id="cb12-604"><a href="#cb12-604"></a></span>
<span id="cb12-605"><a href="#cb12-605"></a><span class="in">hungerford_map_town</span></span>
<span id="cb12-606"><a href="#cb12-606"></a><span class="in">```</span></span>
<span id="cb12-607"><a href="#cb12-607"></a></span>
<span id="cb12-608"><a href="#cb12-608"></a>We can now combine the two maps using the <span class="in">`patchwork`</span> package. To place two </span>
<span id="cb12-609"><a href="#cb12-609"></a>plots next to each other using <span class="in">`patchwork`</span> you just add one map object to the</span>
<span id="cb12-610"><a href="#cb12-610"></a>other using the <span class="in">`|`</span> operator. To place one plot on top of the other, you use the</span>
<span id="cb12-611"><a href="#cb12-611"></a><span class="in">`/`</span> operator (you can combine plots in more-complicated ways by combining these</span>
<span id="cb12-612"><a href="#cb12-612"></a>operators, together with parentheses).</span>
<span id="cb12-613"><a href="#cb12-613"></a></span>
<span id="cb12-614"><a href="#cb12-614"></a><span class="in">```{r multiple-exercise2, exercise=TRUE, fig.asp=1.3}</span></span>
<span id="cb12-615"><a href="#cb12-615"></a><span class="in">library(patchwork)</span></span>
<span id="cb12-616"><a href="#cb12-616"></a></span>
<span id="cb12-617"><a href="#cb12-617"></a><span class="in">(hungerford_map_overall / hungerford_map_town)</span></span>
<span id="cb12-618"><a href="#cb12-618"></a><span class="in">```</span></span>
<span id="cb12-619"><a href="#cb12-619"></a></span>
<span id="cb12-620"><a href="#cb12-620"></a>When we created the <span class="in">`hungerford_map_overall`</span> object in the previous section, we</span>
<span id="cb12-621"><a href="#cb12-621"></a>gave the map title a _negative_ border using the <span class="in">`plot.title`</span> argument to the</span>
<span id="cb12-622"><a href="#cb12-622"></a><span class="in">`theme()`</span> function. This had the effect of moving the title downwards onto the</span>
<span id="cb12-623"><a href="#cb12-623"></a>map to save space, since the top-left corner of the map was empty. We also added</span>
<span id="cb12-624"><a href="#cb12-624"></a>a scale bar, since when you present two related maps of different scales next to </span>
<span id="cb12-625"><a href="#cb12-625"></a>one another, it is useful to show the scales of both maps to help readers relate</span>
<span id="cb12-626"><a href="#cb12-626"></a>them to one another.</span>
<span id="cb12-627"><a href="#cb12-627"></a></span>
<span id="cb12-628"><a href="#cb12-628"></a>We can add shared titles and captions to combined maps created with <span class="in">`patchwork`</span></span>
<span id="cb12-629"><a href="#cb12-629"></a>using the <span class="in">`plot_annotation()`</span> function. This function has a <span class="in">`theme`</span> argument,</span>
<span id="cb12-630"><a href="#cb12-630"></a>which we can use to change the appearance of the shared title and caption just</span>
<span id="cb12-631"><a href="#cb12-631"></a>as we use <span class="in">`theme()`</span> to change the appearance of elements on single maps.</span>
<span id="cb12-632"><a href="#cb12-632"></a></span>
<span id="cb12-633"><a href="#cb12-633"></a><span class="in">```{r multiple-exercise4, exercise=TRUE, fig.asp=1.3}</span></span>
<span id="cb12-634"><a href="#cb12-634"></a><span class="in">(hungerford_map_overall / hungerford_map_town) + </span></span>
<span id="cb12-635"><a href="#cb12-635"></a><span class="in">  plot_annotation(</span></span>
<span id="cb12-636"><a href="#cb12-636"></a><span class="in">    title = "Shootings during the Hungerford massacre",</span></span>
<span id="cb12-637"><a href="#cb12-637"></a><span class="in">    caption = "data from the official report into the shootings",</span></span>
<span id="cb12-638"><a href="#cb12-638"></a><span class="in">    theme = theme(</span></span>
<span id="cb12-639"><a href="#cb12-639"></a><span class="in">      plot.caption = element_text(colour = "grey40", hjust = 0),</span></span>
<span id="cb12-640"><a href="#cb12-640"></a><span class="in">      plot.title = element_text(colour = "grey50", face = "bold", size = 14)</span></span>
<span id="cb12-641"><a href="#cb12-641"></a><span class="in">    )</span></span>
<span id="cb12-642"><a href="#cb12-642"></a><span class="in">  )</span></span>
<span id="cb12-643"><a href="#cb12-643"></a><span class="in">```</span></span>
<span id="cb12-644"><a href="#cb12-644"></a></span>
<span id="cb12-645"><a href="#cb12-645"></a>There are various other improvements that we could make to this map based on the</span>
<span id="cb12-646"><a href="#cb12-646"></a>mapping skills we have already learned during this course. For example, we could</span>
<span id="cb12-647"><a href="#cb12-647"></a>add the locations of buildings or particular facilities using data from </span>
<span id="cb12-648"><a href="#cb12-648"></a>OpenStreetMap. What information we choose to present on the map will depend on </span>
<span id="cb12-649"><a href="#cb12-649"></a>what information we think it is important to communicate to our audience.</span>
<span id="cb12-650"><a href="#cb12-650"></a></span>
<span id="cb12-651"><a href="#cb12-651"></a></span>
<span id="cb12-652"><a href="#cb12-652"></a><span class="co">&lt;!--</span></span>
<span id="cb12-653"><a href="#cb12-653"></a><span class="co">## Plotting the journey to crime</span></span>
<span id="cb12-654"><a href="#cb12-654"></a></span>
<span id="cb12-655"><a href="#cb12-655"></a><span class="co">For many crimes (especially predatory crimes), offenders must travel to and from </span></span>
<span id="cb12-656"><a href="#cb12-656"></a><span class="co">the location of the offence. Investigators will sometimes know some points along</span></span>
<span id="cb12-657"><a href="#cb12-657"></a><span class="co">this journey, but not the whole route. For example, detectives investigating a</span></span>
<span id="cb12-658"><a href="#cb12-658"></a><span class="co">kidnapping murder may know where the victim was taken from and where the body </span></span>
<span id="cb12-659"><a href="#cb12-659"></a><span class="co">was found, but not know where the offender or victim were between those points.</span></span>
<span id="cb12-660"><a href="#cb12-660"></a><span class="co">For a more-common crime such as car theft, police may know where a car was </span></span>
<span id="cb12-661"><a href="#cb12-661"></a><span class="co">stolen from and where it was recovered, but not have any information about where</span></span>
<span id="cb12-662"><a href="#cb12-662"></a><span class="co">it was between those times.</span></span>
<span id="cb12-663"><a href="#cb12-663"></a></span>
<span id="cb12-664"><a href="#cb12-664"></a><span class="co">When investigating crimes involving travel between points, it will often be </span></span>
<span id="cb12-665"><a href="#cb12-665"></a><span class="co">useful to work out the route taken between two points. For example, establishing</span></span>
<span id="cb12-666"><a href="#cb12-666"></a><span class="co">a possible route might make it possible to check CCTV cameras, analyse toll-road </span></span>
<span id="cb12-667"><a href="#cb12-667"></a><span class="co">records or seek witnesses along the way. A potential route might also allow an</span></span>
<span id="cb12-668"><a href="#cb12-668"></a><span class="co">analyst to consider whether any other crimes along that route might be part of a</span></span>
<span id="cb12-669"><a href="#cb12-669"></a><span class="co">crime series. If pairs of points are known for multiple crimes that are believed</span></span>
<span id="cb12-670"><a href="#cb12-670"></a><span class="co">to be a linked series, it is possible that looking for overlapping parts of the </span></span>
<span id="cb12-671"><a href="#cb12-671"></a><span class="co">routes between pairs of points might help identify the offender's anchor point.</span></span>
<span id="cb12-672"><a href="#cb12-672"></a></span>
<span id="cb12-673"><a href="#cb12-673"></a><span class="co">We can plot the fastest route between two locations on foot or in a vehicle </span></span>
<span id="cb12-674"><a href="#cb12-674"></a><span class="co">using tools that were designed for transport planning. The </span></span>
<span id="cb12-675"><a href="#cb12-675"></a><span class="co">[`stplanr` package](https://docs.ropensci.org/stplanr/) uses data from the</span></span>
<span id="cb12-676"><a href="#cb12-676"></a><span class="co">OpenStreetMap routing service to work out the fastest route between two points.</span></span>
<span id="cb12-677"><a href="#cb12-677"></a><span class="co">--&gt;</span></span>
<span id="cb12-678"><a href="#cb12-678"></a></span>
<span id="cb12-679"><a href="#cb12-679"></a></span>
<span id="cb12-680"><a href="#cb12-680"></a></span>
<span id="cb12-681"><a href="#cb12-681"></a><span class="fu">## Putting it all together</span></span>
<span id="cb12-682"><a href="#cb12-682"></a></span>
<span id="cb12-683"><a href="#cb12-683"></a>::: {.box}</span>
<span id="cb12-684"><a href="#cb12-684"></a></span>
<span id="cb12-685"><a href="#cb12-685"></a>In this tutorial we have learned how to map crime series, focusing on displaying</span>
<span id="cb12-686"><a href="#cb12-686"></a>a sequence of events on a map. We have also learned how to combine maps using </span>
<span id="cb12-687"><a href="#cb12-687"></a>the <span class="in">`patchwork`</span> package.</span>
<span id="cb12-688"><a href="#cb12-688"></a></span>
<span id="cb12-689"><a href="#cb12-689"></a>:::</span>
<span id="cb12-690"><a href="#cb12-690"></a></span>
<span id="cb12-691"><a href="#cb12-691"></a><span class="in">```{r names-killed, echo=FALSE}</span></span>
<span id="cb12-692"><a href="#cb12-692"></a><span class="in">names_killed &lt;- hungerford_shootings |&gt; </span></span>
<span id="cb12-693"><a href="#cb12-693"></a><span class="in">  pull("victims") |&gt; </span></span>
<span id="cb12-694"><a href="#cb12-694"></a><span class="in">  str_split("\n") |&gt; </span></span>
<span id="cb12-695"><a href="#cb12-695"></a><span class="in">  unlist() |&gt; </span></span>
<span id="cb12-696"><a href="#cb12-696"></a><span class="in">  str_subset("†") |&gt; </span></span>
<span id="cb12-697"><a href="#cb12-697"></a><span class="in">  str_remove("†") |&gt; </span></span>
<span id="cb12-698"><a href="#cb12-698"></a><span class="in">  as_tibble() |&gt; </span></span>
<span id="cb12-699"><a href="#cb12-699"></a><span class="in">  separate(value, into = c("first", "last")) |&gt; </span></span>
<span id="cb12-700"><a href="#cb12-700"></a><span class="in">  arrange(last) |&gt; </span></span>
<span id="cb12-701"><a href="#cb12-701"></a><span class="in">  mutate(name = str_glue("{first} {last}")) |&gt; </span></span>
<span id="cb12-702"><a href="#cb12-702"></a><span class="in">  pull("name") |&gt; </span></span>
<span id="cb12-703"><a href="#cb12-703"></a><span class="in">  str_to_title() |&gt; </span></span>
<span id="cb12-704"><a href="#cb12-704"></a><span class="in">  knitr::combine_words(oxford_comma = FALSE)</span></span>
<span id="cb12-705"><a href="#cb12-705"></a><span class="in">```</span></span>
<span id="cb12-706"><a href="#cb12-706"></a></span>
<span id="cb12-707"><a href="#cb12-707"></a>When we are mapping crime data, it is important to remember that the rows in the</span>
<span id="cb12-708"><a href="#cb12-708"></a>data we are using often represent traumatic events that have happened to people.</span>
<span id="cb12-709"><a href="#cb12-709"></a>In this tutorial, every row in the data represents one or more people who were</span>
<span id="cb12-710"><a href="#cb12-710"></a>killed or injured during the massacre. The people killed during the tragedy were</span>
<span id="cb12-711"><a href="#cb12-711"></a><span class="in">`r names_killed`</span>.</span>
<span id="cb12-712"><a href="#cb12-712"></a></span>
<span id="cb12-713"><a href="#cb12-713"></a>&lt;p class="full-width-image image-border"&gt;&lt;img src="images/roger_brereton.jpg" alt="Photograph from the funeral of police constable Roger Brereton, one of the people killed in the Hungerford Massacre"&gt;&lt;/p&gt;</span>
<span id="cb12-714"><a href="#cb12-714"></a></span>
<span id="cb12-715"><a href="#cb12-715"></a>You can put the code from this tutorial together to see everything that is </span>
<span id="cb12-716"><a href="#cb12-716"></a>needed to make a composite map of the Hungerford massacre from the original data </span>
<span id="cb12-717"><a href="#cb12-717"></a>file called <span class="in">`hungerford_shootings`</span>.</span>
<span id="cb12-718"><a href="#cb12-718"></a></span>
<span id="cb12-719"><a href="#cb12-719"></a><span class="in">```{r summary-exercise1, exercise=TRUE, exercise.lines=117, fig.asp=1.3}</span></span>
<span id="cb12-720"><a href="#cb12-720"></a><span class="in">library(ggrepel)</span></span>
<span id="cb12-721"><a href="#cb12-721"></a><span class="in">library(ggspatial)</span></span>
<span id="cb12-722"><a href="#cb12-722"></a><span class="in">library(patchwork)</span></span>
<span id="cb12-723"><a href="#cb12-723"></a><span class="in">library(sf)</span></span>
<span id="cb12-724"><a href="#cb12-724"></a><span class="in">library(tidyverse)</span></span>
<span id="cb12-725"><a href="#cb12-725"></a></span>
<span id="cb12-726"><a href="#cb12-726"></a></span>
<span id="cb12-727"><a href="#cb12-727"></a></span>
<span id="cb12-728"><a href="#cb12-728"></a><span class="in"># Prepare data -----------------------------------------------------------------</span></span>
<span id="cb12-729"><a href="#cb12-729"></a></span>
<span id="cb12-730"><a href="#cb12-730"></a><span class="in"># Create lines showing progression between points</span></span>
<span id="cb12-731"><a href="#cb12-731"></a><span class="in">hungerford_lines &lt;- hungerford_shootings |&gt; </span></span>
<span id="cb12-732"><a href="#cb12-732"></a><span class="in">  rename(x_end = easting, y_end = northing) |&gt; </span></span>
<span id="cb12-733"><a href="#cb12-733"></a><span class="in">  mutate(x_start = lag(x_end), y_start = lag(y_end)) |&gt; </span></span>
<span id="cb12-734"><a href="#cb12-734"></a><span class="in">  # Remove the first line, which contains missing values and which we don't need</span></span>
<span id="cb12-735"><a href="#cb12-735"></a><span class="in">  remove_missing(vars = c("x_start", "y_start"), na.rm = TRUE)</span></span>
<span id="cb12-736"><a href="#cb12-736"></a></span>
<span id="cb12-737"><a href="#cb12-737"></a><span class="in"># Convert the `hungerford_shootings` object to SF</span></span>
<span id="cb12-738"><a href="#cb12-738"></a><span class="in">hungerford_shootings_sf &lt;- st_as_sf(</span></span>
<span id="cb12-739"><a href="#cb12-739"></a><span class="in">  hungerford_shootings, </span></span>
<span id="cb12-740"><a href="#cb12-740"></a><span class="in">  coords = c("easting", "northing"), </span></span>
<span id="cb12-741"><a href="#cb12-741"></a><span class="in">  crs = "EPSG:27700"</span></span>
<span id="cb12-742"><a href="#cb12-742"></a><span class="in">)</span></span>
<span id="cb12-743"><a href="#cb12-743"></a></span>
<span id="cb12-744"><a href="#cb12-744"></a></span>
<span id="cb12-745"><a href="#cb12-745"></a></span>
<span id="cb12-746"><a href="#cb12-746"></a><span class="in"># Make component maps ----------------------------------------------------------</span></span>
<span id="cb12-747"><a href="#cb12-747"></a></span>
<span id="cb12-748"><a href="#cb12-748"></a><span class="in">hungerford_map_overall &lt;- ggplot() +</span></span>
<span id="cb12-749"><a href="#cb12-749"></a><span class="in">  # Plot base map</span></span>
<span id="cb12-750"><a href="#cb12-750"></a><span class="in">  annotation_map_tile(zoomin = 0, progress = "none") +</span></span>
<span id="cb12-751"><a href="#cb12-751"></a><span class="in">  # Plot lines between points</span></span>
<span id="cb12-752"><a href="#cb12-752"></a><span class="in">  geom_curve(</span></span>
<span id="cb12-753"><a href="#cb12-753"></a><span class="in">    aes(x = x_start, y = y_start, xend = x_end, yend = y_end),</span></span>
<span id="cb12-754"><a href="#cb12-754"></a><span class="in">    data = hungerford_lines, </span></span>
<span id="cb12-755"><a href="#cb12-755"></a><span class="in">    arrow = arrow(length = unit(3, "mm"), type = "closed"),</span></span>
<span id="cb12-756"><a href="#cb12-756"></a><span class="in">    curvature = -0.2,</span></span>
<span id="cb12-757"><a href="#cb12-757"></a><span class="in">    colour = "orange3"</span></span>
<span id="cb12-758"><a href="#cb12-758"></a><span class="in">  ) +</span></span>
<span id="cb12-759"><a href="#cb12-759"></a><span class="in">  # Plot points</span></span>
<span id="cb12-760"><a href="#cb12-760"></a><span class="in">  geom_sf(</span></span>
<span id="cb12-761"><a href="#cb12-761"></a><span class="in">    data = hungerford_shootings_sf, </span></span>
<span id="cb12-762"><a href="#cb12-762"></a><span class="in">    shape = 21,</span></span>
<span id="cb12-763"><a href="#cb12-763"></a><span class="in">    colour = "white",</span></span>
<span id="cb12-764"><a href="#cb12-764"></a><span class="in">    fill = "orange3",</span></span>
<span id="cb12-765"><a href="#cb12-765"></a><span class="in">    size = 3</span></span>
<span id="cb12-766"><a href="#cb12-766"></a><span class="in">  ) +</span></span>
<span id="cb12-767"><a href="#cb12-767"></a><span class="in">  geom_label_repel(</span></span>
<span id="cb12-768"><a href="#cb12-768"></a><span class="in">    aes(x = easting, y = northing, label = order),</span></span>
<span id="cb12-769"><a href="#cb12-769"></a><span class="in">    data = filter(hungerford_shootings, order %in% 1:2), </span></span>
<span id="cb12-770"><a href="#cb12-770"></a><span class="in">    colour = "white",</span></span>
<span id="cb12-771"><a href="#cb12-771"></a><span class="in">    fill = "orange3",</span></span>
<span id="cb12-772"><a href="#cb12-772"></a><span class="in">    fontface = "bold",</span></span>
<span id="cb12-773"><a href="#cb12-773"></a><span class="in">    label.size = NA</span></span>
<span id="cb12-774"><a href="#cb12-774"></a><span class="in">  ) +</span></span>
<span id="cb12-775"><a href="#cb12-775"></a><span class="in">  annotation_scale(style = "ticks", line_col = "grey40", text_col = "grey40") +</span></span>
<span id="cb12-776"><a href="#cb12-776"></a><span class="in">  scale_y_continuous(expand = expansion(2)) +</span></span>
<span id="cb12-777"><a href="#cb12-777"></a><span class="in">  labs(title = " Shootings in Wiltshire") +</span></span>
<span id="cb12-778"><a href="#cb12-778"></a><span class="in">  coord_sf(crs = "EPSG:27700") +</span></span>
<span id="cb12-779"><a href="#cb12-779"></a><span class="in">  theme_void() +</span></span>
<span id="cb12-780"><a href="#cb12-780"></a><span class="in">  theme(</span></span>
<span id="cb12-781"><a href="#cb12-781"></a><span class="in">    panel.border = element_rect(colour = "grey20", fill = NA),</span></span>
<span id="cb12-782"><a href="#cb12-782"></a><span class="in">    plot.title = element_text(margin = margin(b = -18))</span></span>
<span id="cb12-783"><a href="#cb12-783"></a><span class="in">  )</span></span>
<span id="cb12-784"><a href="#cb12-784"></a></span>
<span id="cb12-785"><a href="#cb12-785"></a><span class="in">hungerford_map_town &lt;- ggplot() +</span></span>
<span id="cb12-786"><a href="#cb12-786"></a><span class="in">  annotation_map_tile(zoomin = 0, progress = "none") +</span></span>
<span id="cb12-787"><a href="#cb12-787"></a><span class="in">  # Plot lines between points</span></span>
<span id="cb12-788"><a href="#cb12-788"></a><span class="in">  geom_curve(</span></span>
<span id="cb12-789"><a href="#cb12-789"></a><span class="in">    aes(x = x_start, y = y_start, xend = x_end, yend = y_end),</span></span>
<span id="cb12-790"><a href="#cb12-790"></a><span class="in">    data = slice(hungerford_lines, 3:n()), </span></span>
<span id="cb12-791"><a href="#cb12-791"></a><span class="in">    arrow = arrow(length = unit(3, "mm"), type = "closed"),</span></span>
<span id="cb12-792"><a href="#cb12-792"></a><span class="in">    curvature = -0.2,</span></span>
<span id="cb12-793"><a href="#cb12-793"></a><span class="in">    colour = "orange3"</span></span>
<span id="cb12-794"><a href="#cb12-794"></a><span class="in">  ) +</span></span>
<span id="cb12-795"><a href="#cb12-795"></a><span class="in">  # Plot points</span></span>
<span id="cb12-796"><a href="#cb12-796"></a><span class="in">  geom_sf(</span></span>
<span id="cb12-797"><a href="#cb12-797"></a><span class="in">    data = slice(hungerford_shootings_sf, 3:n()), </span></span>
<span id="cb12-798"><a href="#cb12-798"></a><span class="in">    shape = 21,</span></span>
<span id="cb12-799"><a href="#cb12-799"></a><span class="in">    colour = "white",</span></span>
<span id="cb12-800"><a href="#cb12-800"></a><span class="in">    fill = "orange3",</span></span>
<span id="cb12-801"><a href="#cb12-801"></a><span class="in">    size = 3</span></span>
<span id="cb12-802"><a href="#cb12-802"></a><span class="in">  ) +</span></span>
<span id="cb12-803"><a href="#cb12-803"></a><span class="in">  geom_label_repel(</span></span>
<span id="cb12-804"><a href="#cb12-804"></a><span class="in">    aes(x = easting, y = northing, label = order),</span></span>
<span id="cb12-805"><a href="#cb12-805"></a><span class="in">    data = slice(hungerford_shootings, 3:n()), </span></span>
<span id="cb12-806"><a href="#cb12-806"></a><span class="in">    colour = "white",</span></span>
<span id="cb12-807"><a href="#cb12-807"></a><span class="in">    fill = "orange3",</span></span>
<span id="cb12-808"><a href="#cb12-808"></a><span class="in">    fontface = "bold",</span></span>
<span id="cb12-809"><a href="#cb12-809"></a><span class="in">    label.size = NA</span></span>
<span id="cb12-810"><a href="#cb12-810"></a><span class="in">  ) +</span></span>
<span id="cb12-811"><a href="#cb12-811"></a><span class="in">  annotation_scale(style = "ticks", line_col = "grey40", text_col = "grey40") +</span></span>
<span id="cb12-812"><a href="#cb12-812"></a><span class="in">  scale_x_continuous(expand = expansion(0.3)) +</span></span>
<span id="cb12-813"><a href="#cb12-813"></a><span class="in">  scale_y_continuous(expand = expansion(0.3)) +</span></span>
<span id="cb12-814"><a href="#cb12-814"></a><span class="in">  coord_sf(crs = "EPSG:27700") +</span></span>
<span id="cb12-815"><a href="#cb12-815"></a><span class="in">  labs(</span></span>
<span id="cb12-816"><a href="#cb12-816"></a><span class="in">    title = "Shootings in Hungerford town"</span></span>
<span id="cb12-817"><a href="#cb12-817"></a><span class="in">  ) +</span></span>
<span id="cb12-818"><a href="#cb12-818"></a><span class="in">  theme_void() +</span></span>
<span id="cb12-819"><a href="#cb12-819"></a><span class="in">  theme(</span></span>
<span id="cb12-820"><a href="#cb12-820"></a><span class="in">    panel.border = element_rect(colour = "grey20", fill = NA),</span></span>
<span id="cb12-821"><a href="#cb12-821"></a><span class="in">    plot.margin = margin(t = 12)</span></span>
<span id="cb12-822"><a href="#cb12-822"></a><span class="in">  )</span></span>
<span id="cb12-823"><a href="#cb12-823"></a></span>
<span id="cb12-824"><a href="#cb12-824"></a></span>
<span id="cb12-825"><a href="#cb12-825"></a></span>
<span id="cb12-826"><a href="#cb12-826"></a><span class="in"># Combine maps and add titles --------------------------------------------------</span></span>
<span id="cb12-827"><a href="#cb12-827"></a></span>
<span id="cb12-828"><a href="#cb12-828"></a><span class="in">(hungerford_map_overall / hungerford_map_town) + </span></span>
<span id="cb12-829"><a href="#cb12-829"></a><span class="in">  plot_annotation(</span></span>
<span id="cb12-830"><a href="#cb12-830"></a><span class="in">    title = "Shootings during the Hungerford massacre",</span></span>
<span id="cb12-831"><a href="#cb12-831"></a><span class="in">    caption = "data from the official report into the shootings",</span></span>
<span id="cb12-832"><a href="#cb12-832"></a><span class="in">    theme = theme(</span></span>
<span id="cb12-833"><a href="#cb12-833"></a><span class="in">      plot.caption = element_text(colour = "grey40", hjust = 0),</span></span>
<span id="cb12-834"><a href="#cb12-834"></a><span class="in">      plot.title = element_text(colour = "grey50", face = "bold", size = 14)</span></span>
<span id="cb12-835"><a href="#cb12-835"></a><span class="in">    )</span></span>
<span id="cb12-836"><a href="#cb12-836"></a><span class="in">  )</span></span>
<span id="cb12-837"><a href="#cb12-837"></a></span>
<span id="cb12-838"><a href="#cb12-838"></a><span class="in">```</span></span>
<span id="cb12-839"><a href="#cb12-839"></a></span>
<span id="cb12-840"><a href="#cb12-840"></a>&lt;p class="credits"&gt;&lt;a href="https://www.getreading.co.uk/news/berkshire-history/gallery/30-years-hungerford-massacre-13495555"&gt;Photograph of PC Roger Brereton's funeral from Berkshire Live&lt;/a&gt;&lt;/p&gt;</span>
<span id="cb12-841"><a href="#cb12-841"></a></span>
<span id="cb12-842"><a href="#cb12-842"></a>&lt;p class="credits"&gt;&lt;a href="https://twitter.com/allison_horst"&gt;Artwork by @allison_horst&lt;/a&gt;&lt;/p&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://creativecommons.org/licenses/by/4.0/">
<p>This book is available under a Creative Commons Attribution 4.0 International licence</p>
</a>
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mpjashby/crimemappingbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>