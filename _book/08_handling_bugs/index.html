<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>8&nbsp; Handling bugs in your code – Learn Crime Mapping with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../09_mapping_areas/index.html" rel="next">
<link href="../07_map_context/index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- START OF INCLUDED HEADER -->

<!--
This file contains code that will be included in the header of each page of the
quarto book
-->

<script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>

<!-- END OF INCLUDED HEADER -->


<link rel="stylesheet" href="../css/styles.css">
<link rel="stylesheet" href="../include/webex.css">
<meta name="twitter:title" content="8&nbsp; Handling bugs in your code – Learn Crime Mapping with R">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="../images/cover_image.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../08_handling_bugs/index.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Handling bugs in your code</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/cover_image.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Learn Crime Mapping with R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/mpjashby/crimemappingbook/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contents</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Install the software needed for this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_getting_started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_your_first_crime_map/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Your first crime map</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_data_wrangling/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Wrangling data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_your_second_crime_map/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Your second crime map</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_code_with_style/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Code with style</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_mapping_crime_patterns/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Mapping crime patterns</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_map_context/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Giving a map context</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08_handling_bugs/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Handling bugs in your code</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../09_mapping_areas/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Mapping area data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../10_place_data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Using data about places</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../11_mapping_hotspots/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Mapping hotspots</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../12_messy_data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Handling messy data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../13_crime_series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Mapping crime series</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../14_writing_reports/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Writing reports in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../15_no_maps/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Presenting spatial data without maps</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../16_mapping_time/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Mapping crime over time</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/read_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Functions for reading data into R #sec-load-functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/map_checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Checklist: Making a good crime map</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/common_errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Common R errors and how to fix them</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/functions_to_avoid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Some R functions you should avoid</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/handling_errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Checklist: handling code errors</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">In this chapter</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">8.1</span> Introduction</a></li>
  <li><a href="#errors-warnings-and-messages" id="toc-errors-warnings-and-messages" class="nav-link" data-scroll-target="#errors-warnings-and-messages"><span class="header-section-number">8.2</span> Errors, warnings and messages</a>
  <ul class="collapse">
  <li><a href="#messages" id="toc-messages" class="nav-link" data-scroll-target="#messages"><span class="header-section-number">8.2.1</span> Messages</a></li>
  <li><a href="#warnings" id="toc-warnings" class="nav-link" data-scroll-target="#warnings"><span class="header-section-number">8.2.2</span> Warnings</a></li>
  <li><a href="#errors" id="toc-errors" class="nav-link" data-scroll-target="#errors"><span class="header-section-number">8.2.3</span> Errors</a></li>
  </ul></li>
  <li><a href="#finding-problems" id="toc-finding-problems" class="nav-link" data-scroll-target="#finding-problems"><span class="header-section-number">8.3</span> Finding problems</a>
  <ul class="collapse">
  <li><a href="#errors-caused-by-data-problems" id="toc-errors-caused-by-data-problems" class="nav-link" data-scroll-target="#errors-caused-by-data-problems"><span class="header-section-number">8.3.1</span> Errors caused by data problems</a></li>
  </ul></li>
  <li><a href="#understanding-a-problem" id="toc-understanding-a-problem" class="nav-link" data-scroll-target="#understanding-a-problem"><span class="header-section-number">8.4</span> Understanding a problem</a></li>
  <li><a href="#how-to-fix-some-common-errors" id="toc-how-to-fix-some-common-errors" class="nav-link" data-scroll-target="#how-to-fix-some-common-errors"><span class="header-section-number">8.5</span> How to fix some common errors</a></li>
  <li><a href="#sec-reprex" id="toc-sec-reprex" class="nav-link" data-scroll-target="#sec-reprex"><span class="header-section-number">8.6</span> Getting external help using a reproducible example</a>
  <ul class="collapse">
  <li><a href="#reproducible-code" id="toc-reproducible-code" class="nav-link" data-scroll-target="#reproducible-code"><span class="header-section-number">8.6.1</span> Reproducible code</a></li>
  <li><a href="#reproducible-data" id="toc-reproducible-data" class="nav-link" data-scroll-target="#reproducible-data"><span class="header-section-number">8.6.2</span> Reproducible data</a></li>
  <li><a href="#checking-your-reprex-is-reproducible" id="toc-checking-your-reprex-is-reproducible" class="nav-link" data-scroll-target="#checking-your-reprex-is-reproducible"><span class="header-section-number">8.6.3</span> Checking your reprex is reproducible</a></li>
  </ul></li>
  <li><a href="#sources-of-help" id="toc-sources-of-help" class="nav-link" data-scroll-target="#sources-of-help"><span class="header-section-number">8.7</span> Sources of help</a></li>
  <li><a href="#getting-help-from-online-tutorials-and-blogs" id="toc-getting-help-from-online-tutorials-and-blogs" class="nav-link" data-scroll-target="#getting-help-from-online-tutorials-and-blogs"><span class="header-section-number">8.8</span> Getting help from online tutorials and blogs</a></li>
  <li><a href="#coding-with-ai" id="toc-coding-with-ai" class="nav-link" data-scroll-target="#coding-with-ai"><span class="header-section-number">8.9</span> Coding with AI</a>
  <ul class="collapse">
  <li><a href="#coding-with-ai-an-example" id="toc-coding-with-ai-an-example" class="nav-link" data-scroll-target="#coding-with-ai-an-example"><span class="header-section-number">8.9.1</span> Coding with AI: an example</a></li>
  <li><a href="#why-does-chatgpt-sometimes-produce-code-that-doesnt-work" id="toc-why-does-chatgpt-sometimes-produce-code-that-doesnt-work" class="nav-link" data-scroll-target="#why-does-chatgpt-sometimes-produce-code-that-doesnt-work"><span class="header-section-number">8.9.2</span> Why does ChatGPT sometimes produce code that doesn’t work?</a></li>
  <li><a href="#should-i-use-ai-to-help-me-code" id="toc-should-i-use-ai-to-help-me-code" class="nav-link" data-scroll-target="#should-i-use-ai-to-help-me-code"><span class="header-section-number">8.9.3</span> Should I use AI to help me code?</a></li>
  <li><a href="#using-ai-to-help-map-crime" id="toc-using-ai-to-help-map-crime" class="nav-link" data-scroll-target="#using-ai-to-help-map-crime"><span class="header-section-number">8.9.4</span> Using AI to help map crime</a></li>
  </ul></li>
  <li><a href="#in-summary" id="toc-in-summary" class="nav-link" data-scroll-target="#in-summary"><span class="header-section-number">8.10</span> In summary</a>
  <ul class="collapse">
  <li><a href="#what-caused-the-error-in-our-reproducible-example" id="toc-what-caused-the-error-in-our-reproducible-example" class="nav-link" data-scroll-target="#what-caused-the-error-in-our-reproducible-example">What caused the error in our reproducible example?</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/mpjashby/crimemappingbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-bugs" class="quarto-section-identifier"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Handling bugs in your code</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="abstract">
<p>This chapter will teach you how to identify and fix bugs in your R code. You’ll learn how to interpret error messages, warnings, and messages, distinguishing between minor issues and critical problems that halt code execution. The chapter also covers systematic debugging techniques, such as isolating problematic lines and checking data structures, with practical examples using a dataset on frauds. You’ll explore the differences between syntax and logical errors and gain tools to resolve them effectively. By the end of this chapter, you’ll feel more confident tackling errors in your code, an invaluable skill for any programming project.</p>
</div>
<section id="introduction" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">8.1</span> Introduction</h2>
<p>In this chapter we will learn how to deal with bugs in the R code that we write. It’s inevitable that you will make mistakes in the R code that you write. Everyone types the wrong command every now and again, just as everyone sometimes clicks the wrong button in other pieces of software. Learning how to identify and fix bugs is part of the process of learning to code.</p>
<p>In this chapter we will look at examples of errors using a dataset of frauds in Kansas City in the United States. We can load this dataset with this code:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load packages</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># Load data</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>frauds <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/kansas_city_frauds.csv.gz"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>Rows: 6 Columns: 6
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (2): offense_code, offense_type
dbl  (3): uid, longitude, latitude
dttm (1): date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why did we run this code in the R Console?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Normally when we load packages and data, we do it in an R script file. We do that because this code is needed as part of the complete script that produces a particular map. In this chapter we won’t be creating a map, just looking at examples of errors, so we won’t need to keep any of the code for later.</p>
</div>
</div>
</div>
<p>This is what the first few lines of the dataset look like:</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 7%">
<col style="width: 12%">
<col style="width: 41%">
<col style="width: 19%">
<col style="width: 9%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">uid</th>
<th style="text-align: left;">offense_code</th>
<th style="text-align: left;">offense_type</th>
<th style="text-align: left;">date</th>
<th style="text-align: right;">longitude</th>
<th style="text-align: right;">latitude</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">9362175</td>
<td style="text-align: left;">26B</td>
<td style="text-align: left;">credit card/automated teller machine fraud</td>
<td style="text-align: left;">2015-02-14 11:05:00</td>
<td style="text-align: right;">-94.5715</td>
<td style="text-align: right;">39.1086</td>
</tr>
<tr class="even">
<td style="text-align: right;">9362176</td>
<td style="text-align: left;">26B</td>
<td style="text-align: left;">credit card/automated teller machine fraud</td>
<td style="text-align: left;">2015-02-14 11:05:00</td>
<td style="text-align: right;">-94.5715</td>
<td style="text-align: right;">39.1086</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9362201</td>
<td style="text-align: left;">26A</td>
<td style="text-align: left;">false pretenses/swindle/confidence game</td>
<td style="text-align: left;">2015-02-14 13:30:00</td>
<td style="text-align: right;">-94.6568</td>
<td style="text-align: right;">39.2453</td>
</tr>
<tr class="even">
<td style="text-align: right;">9362202</td>
<td style="text-align: left;">26A</td>
<td style="text-align: left;">false pretenses/swindle/confidence game</td>
<td style="text-align: left;">2015-02-14 13:30:00</td>
<td style="text-align: right;">-94.6568</td>
<td style="text-align: right;">39.2453</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9362213</td>
<td style="text-align: left;">26C</td>
<td style="text-align: left;">impersonation</td>
<td style="text-align: left;">2015-02-14 15:00:00</td>
<td style="text-align: right;">-94.5886</td>
<td style="text-align: right;">38.9956</td>
</tr>
<tr class="even">
<td style="text-align: right;">9362214</td>
<td style="text-align: left;">26C</td>
<td style="text-align: left;">impersonation</td>
<td style="text-align: left;">2015-02-14 15:00:00</td>
<td style="text-align: right;">-94.5886</td>
<td style="text-align: right;">38.9956</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>If you were to try to run this code:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">select</span>(frauds, offense_category)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>You can see that R produces an error message saying something like:</p>
<div class="cell">
<div class="cell-output cell-output-error">
<pre data-code-line-numbers=""><code>Error in `select()`:
! Can't select columns that don't exist.
✖ Column `offense_category` doesn't exist.</code></pre>
</div>
</div>
<p>In this case it is fairly easy to identify that one of the columns you have tried to select does not exist. Maybe you mis-remembered the name of the column. To find out what the correct column name is, you can either print the first few rows of the object (by typing the code <code>head(frauds)</code> into the R console) or use the <code>names()</code> function to print a list of column names present in the data:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">names</span>(frauds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] "uid"          "offense_code" "offense_type" "date"         "longitude"   
[6] "latitude"    </code></pre>
</div>
</div>
<p>From this, we can see that the column we want to select is called <code>offense_type</code>, not <code>offense_category</code>.</p>
<p>Other errors will be harder to identify and fix. In this chapter we will go through the process of debugging – identifying, understanding and fixing errors in your code. Sometimes fixing issues with your code can feel like a bit of a roller coaster, but (like most things) it becomes much easier with practice, and if you approach errors in a systematic way.</p>
<p class="full-width-image">
<img src="../images/debugging.jpg" alt="Cartoon showing 10 furry monsters showing different stages of learning to debug code. The monsters are marked '1. I got this', '2. Huh, really though that was it', '3. (...)', '4. Fine. Restarting.', '5. OH WTF', '6. Zombie meltdown', '7. [crying]', '8. A NEW HOPE!', '9. [insert awesome theme song]' and '10. I LOVE CODING!'">
</p>
</section>
<section id="errors-warnings-and-messages" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="errors-warnings-and-messages"><span class="header-section-number">8.2</span> Errors, warnings and messages</h2>
<p>When something is not quite right, or just when there is an issue in your code that you should be aware of, R has three ways of communicating with you: messages, warnings and errors.</p>
<section id="messages" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="messages"><span class="header-section-number">8.2.1</span> Messages</h3>
<p><em>Messages</em> are usually for information only and typically don’t require you to take any action. For example, the function <code>get_crime_data()</code> from the <code>crimedata</code> package issues a message to tell you what data it is downloading. It does this because downloading data sometimes takes a few seconds and without a message you might wonder if the code was working.</p>
<p>By default, messages are displayed in RStudio in <span style="color: rgb(197, 6, 11); background-color: #FFFFFF; font-family: monospace; font-weight: normal;">dark red text</span>, although this might vary if you have changed any settings in the Appearance tab of the RStudio Options dialogue. You can generate a message for yourself using the <code>message()</code> function. This is useful if you are writing code and you want to remind yourself of something, or record a particular value. For example, if your code is likely to take a long time to run, you might want to record the time your code started running by generating a message on the first line of your code:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">message</span>(<span class="fu">str_glue</span>(<span class="st">"Code started: {now()}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>Code started: 2025-01-23 12:10:55.935678</code></pre>
</div>
</div>
<p>When R prints a message about your code, any code underneath the code that generated the message will still run. For example, if you run these three lines of code (the second of which prints a message), the line after the message will run as expected:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="dv">2</span> <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="fu">message</span>(<span class="st">"This is a message. It might be important so make sure you understand it."</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] 4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>This is a message. It might be important so make sure you understand it.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] 1</code></pre>
</div>
</div>
</section>
<section id="warnings" class="level3" data-number="8.2.2">
<h3 data-number="8.2.2" class="anchored" data-anchor-id="warnings"><span class="header-section-number">8.2.2</span> Warnings</h3>
<p><em>Warnings</em> are generated when there is a potential problem with your code, but the problem was not serious enough to stop your code running entirely. For example, ggplot2 functions like <code>geom_point()</code> will send a warning if some of the rows in your data contain missing values (e.g.&nbsp;if some crimes have missing co-ordinates).</p>
<p>Warnings are important and you should take time to read and understand them, but it is <em>possible</em> that having done so it will be safe to not take any action. <em>Whether</em> it is safe to take no action will often depend on exactly what you are trying to do, which is why it is important that you understand each warning that you see. For example, if you already know that some rows in your data contain missing values and are happy to plot the remaining values, it will be safe to ignore the warning produced by <code>geom_point()</code>. But if your dataset should not have any missing values in it, you will need to investigate why <code>geom_point()</code> is warning you about missing values and whether those values have been accidentally introduced by some part of your code.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
It is not safe to ignore warnings
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>It is not safe to ignore warnings</strong> unless you are sure why they occurred and certain that you don’t need to take any action. If your code produces a warning, it is not safe to ‘leave it until later’ and carry on writing the rest of your code: work out straight away if you need to take any action.</p>
<p>One particularly dangerous scenario is where your code produces warnings but still produces what looks like a reasonable result. In these circumstances it can be tempting to ignore the warnings and assume that everything is fine, since the code still produced roughly what you were expecting. However, it’s possible that the plausible answer is nevertheless wrong because of whatever problem is generating the warning in R. Do not assume that warnings are safe to ignore just because they don’t stop your code running.</p>
</div>
</div>
<p>Warnings are displayed in the same font as messages, but with the text <code>Warning:</code> at the start. You can generate your own warning messages using the <code>warning()</code> function:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb13" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">warning</span>(<span class="st">"Something might be wrong. Check to make sure."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>Warning: Something might be wrong. Check to make sure.</code></pre>
</div>
</div>
<p>As with messages, warnings will not stop your code running. This means that if the warning signalled a genuine problem with your code, the results of the lines underneath the warning might not be reliable. That is why it is important to understand warnings when you see them.</p>
</section>
<section id="errors" class="level3" data-number="8.2.3">
<h3 data-number="8.2.3" class="anchored" data-anchor-id="errors"><span class="header-section-number">8.2.3</span> Errors</h3>
<p><em>Errors</em> are generated when there is something wrong with your code or the results it produces that means the code cannot continue running any further. An error might occur, for example, because the function <code>read_csv()</code> could not open the requested file (maybe because the file does not exist). In this case, it would make no sense for the rest of the code to run because it probably depends on the data that <code>read_csv()</code> was supposed to load but could not.</p>
<p>It would make sense to be able to generate your own errors using the <code>error()</code> function, but this is one of those times when the function to do something in R has a different name from that you might be expecting. In fact, you can generate an error using the <code>stop()</code> function:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb15" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">stop</span>(<span class="st">"Something is defintely wrong. Don't go any further until you've fixed it."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-error">
<pre data-code-line-numbers=""><code>Error: Something is defintely wrong. Don't go any further until you've fixed it.</code></pre>
</div>
</div>
<p>There are two types of errors in R: <em>syntax</em> errors and <em>logical</em> errors. Syntax errors happen when R cannot read your code because of a mistake in how it has been typed out. For example, if you forget to put a comma between the arguments of a function, you will get this error:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb17" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">message</span>(<span class="st">"A"</span> <span class="st">"B"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-error">
<pre data-code-line-numbers=""><code>Error in parse(text = input): &lt;text&gt;:1:13: unexpected string constant
1: message("A" "B"
                ^</code></pre>
</div>
</div>
<p>This error is caused by a missing comma between <code>"A"</code> and <code>"B"</code>.</p>
<p>When you run R code, R reads all the code and checks if it can be interpreted as valid R code. If not, R will produce a syntax error. Because all of your code is checked for syntax errors before any code is actually run, a syntax error <em>anywhere</em> in your code will stop <em>all</em> of your code running. Syntax errors are typically fairly easy to fix, because they are usually caused by typos.</p>
<p>The second type of error that can happen is a logical error. This happens when R is able to interpret what you have written, but something is wrong with what you have asked it to do. These are called logical errors because there is usually some problem with the logic of what you are asking R to do. Like syntax errors, logical errors can be caused by typos, but logical errors can also have many other causes.</p>
<p>There is a saying in programming that a computer will do exactly what you tell it to do, which may not be the same thing as what you <em>wanted</em> it do. Logical errors happen when you have told R to do something that it cannot do. For example, you might be asking R to multiply together a numeric value and a character value (e.g.&nbsp;<code>3 * "A"</code>), which is illogical.</p>
<p>Since every step in your code depends on the steps that went before it, it is only possible to identify a logical error during the process of running the code. This means that a lot of your code might run successfully before an error occurs.</p>
<p>Logical errors are typically harder to fix than syntax errors are, because fixing a logical error involves understanding (a) what you have asked R to do and (b) the current state of everything in your code at the moment when the error occurs. Fortunately, there are lots of ways to identify and fix logical errors.</p>
<p>Now we know what errors, warning and messages are, we need to find out how to deal with them when they happen.</p>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Messages, warnings and errors
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Which of the following terms is used in R to describe the way of communicating something for information only?</strong></p>
<div id="radio_IOZTFMKWQE" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_IOZTFMKWQE" value="answer"> <span>A message</span></label><label><input type="radio" autocomplete="off" name="radio_IOZTFMKWQE" value=""> <span>A warning</span></label><label><input type="radio" autocomplete="off" name="radio_IOZTFMKWQE" value=""> <span>An error</span></label><label><input type="radio" autocomplete="off" name="radio_IOZTFMKWQE" value=""> <span>A condition</span></label>
</div>
<p><strong>Which of these statements is true?</strong></p>
<div id="radio_RCSMFDRIXH" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_RCSMFDRIXH" value=""> <span>It is generally okay not to worry about warnings produced by R code – in most cases you won't need to take any action anyway</span></label><label><input type="radio" autocomplete="off" name="radio_RCSMFDRIXH" value="answer"> <span>While you will often not need to take any action in response to a warning produced by your R code, it is still important to understand what caused the warning just in case you need to take action</span></label>
</div>
</div>
</div>
</section>
</section>
<section id="finding-problems" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="finding-problems"><span class="header-section-number">8.3</span> Finding problems</h2>
<p>If an error or warning has a simple cause, such as the example of the incorrect column name in the previous section, you can just fix the problem and re-run the code. For problems that are more difficult to handle, you will need to follow a step-by-step process to find and fix them. Think of this as like being a mechanic fixing a car – first you work out what the problem is, then you fix it.</p>
<p>If you code only has one line, it will probably be obvious where any problem lies. But most of your code does several things to achieve a particular goal, such as making a map. The first task in dealing with a problem is therefore to work out exactly which function or other piece of code has caused it. For example, take this data-wrangling code to reduce the size of a dataset and sort it in date order:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb19" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>frauds <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="fu">select</span>(offense_type, date, longitude, latitude) <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="fu">filter</span>(offence_type <span class="sc">==</span> <span class="st">"impersonation"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="fu">arrange</span>(date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-error">
<pre data-code-line-numbers=""><code>Error in `filter()`:
ℹ In argument: `offence_type == "impersonation"`.
Caused by error:
! object 'offence_type' not found</code></pre>
</div>
</div>
<p>This code produces a fairly complicated error message. As is often the case, the most useful part of the error message is the last part:</p>
<pre data-code-line-numbers=""><code>! object 'offence_type' not found</code></pre>
<p>This suggests the error is on line 3 of the code, since that is the only line containing reference to the object <code>offence_type</code>. To check this, we can <em>comment out</em> that line by placing a <code>#</code> symbol at the start of the line. Do this and re-run the code above – it should now run without a problem.</p>
<p>Now we know the problem is on the line <code>filter(offence_type == "impersonation")</code>, we can look at that line in more detail. Can you spot the problem with that line?</p>
<p>The error message in this case has been caused by a typo – the code <code>offence_type == "impersonation"</code> uses the British spelling of the word ‘offence’ but in the dataset the variable is spelled using the American English ‘offense’ (you can see the US spelling in the line of code above the line that is causing the error). Fix the typo and re-run the code above in RStudio.</p>
<p>Sometimes it will not be as clear as this where to start in looking for the problem. In particular, some errors can be <em>caused</em> by a problem on one line of code, but only actually have a negative <em>effect</em> on a subsequent line of code. For example, if you run this code you will see an error:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb22" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>frauds <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="fu">select</span>(offense_code, longitude, latitude) <span class="sc">|&gt;</span> </span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="fu">filter</span>(offense_code <span class="sc">==</span> <span class="st">"26E"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="fu">arrange</span>(date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-error">
<pre data-code-line-numbers=""><code>Error in `arrange()`:
ℹ In argument: `..1 = date`.
Caused by error:
! `..1` must be a vector, not a function.</code></pre>
</div>
</div>
<p>The error message produced suggests the problem is with the <code>arrange()</code> function, but everything is correct with that function since <code>arrange()</code> is a correct function name and we already know that <code>date</code> is a column in the tibble named <code>frauds</code>. So the problem must lie elsewhere. In cases like this, it can be helpful to comment out all the lines of code except the first one and then uncomment one line at a time until you find the one that causes the problem.</p>
<p>Re-run the code above, but comment out all the lines except the first one by putting <code>#</code> at the start of each line. Remember to remove the <code>|&gt;</code> from the end of the last <em>uncommented</em> line of code, since otherwise you will find the code does not run as expected. Your code should now look like this:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb24" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>frauds</span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="co"># select(offense_code, longitude, latitude) |&gt; </span></span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="co"># filter(offense_code == "26E") |&gt; </span></span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="co"># arrange(date)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>If you run this code, it will simply print the first few lines of the dataset. Remove the <code>#</code> comment symbol from the second line of the code and run it again, remembering to replace the pipe operator (<code>|&gt;</code>) at the end of line 1 and remove the <code>|&gt;</code> at the end of line 2.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb25" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>frauds <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="fu">select</span>(offense_code, longitude, latitude)</span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="co"># filter(offense_code == "26E") |&gt; </span></span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="co"># arrange(date)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Again, the code does not produce an error – the result is the same as before, except now the dataset has only three columns.</p>
<p>Repeat the process again by removing the comment symbol from the start of line three, replacing the pipe operators as before.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb26" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>frauds <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">select</span>(offense_code, longitude, latitude) <span class="sc">|&gt;</span> </span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">filter</span>(offense_code <span class="sc">==</span> <span class="st">"26E"</span>)</span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="co"># arrange(date)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 0 × 3
# ℹ 3 variables: offense_code &lt;chr&gt;, longitude &lt;dbl&gt;, latitude &lt;dbl&gt;</code></pre>
</div>
</div>
<p>There is still no error message, but you can see the problem: there are no rows left in the data. That’s because there are no rows in the data for which the column <code>offense_code</code> has the value “26E”. If we use the <code>count()</code> function from the dplyr package to list all the unique values of the <code>offense_code</code> column, we’ll see the only values are “26A”, “26B”, and “26C”:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb28" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="fu">count</span>(frauds, offense_code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 3 × 2
  offense_code     n
  &lt;chr&gt;        &lt;int&gt;
1 26A              2
2 26B              2
3 26C              2</code></pre>
</div>
</div>
<p>Uncommenting one line at a time until you find an error or output that is not what you expected is a useful way to isolate problems, but it will not always work. In particular, it will not work if the problem is caused by some code that should have been included but is missing from your code entirely. For example, if you try to run the function <code>st_transform()</code> on a tibble without first changing it into an SF object:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb30" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>frauds <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="fu">select</span>(offense_code, longitude, latitude) <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="fu">filter</span>(offense_code <span class="sc">==</span> <span class="st">"26A"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-4"><a href="#cb30-4"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="st">"EPSG:3603"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-error">
<pre data-code-line-numbers=""><code>Error in UseMethod("st_transform"): no applicable method for 'st_transform' applied to an object of class "c('tbl_df', 'tbl', 'data.frame')"</code></pre>
</div>
</div>
<p>In these cases it is particularly useful to check every argument that you have used in a function to track down the error. We will look at this later in this chapter.</p>
<section id="errors-caused-by-data-problems" class="level3" data-number="8.3.1">
<h3 data-number="8.3.1" class="anchored" data-anchor-id="errors-caused-by-data-problems"><span class="header-section-number">8.3.1</span> Errors caused by data problems</h3>
<p>Many logical errors will be caused by problems with the code you have written, such as when you try to use a function (e.g.&nbsp;<code>st_intersection()</code>) that only works on an SF object but specify that it should use an object of another type. But sometimes logical errors are caused not by your code, but by a mis-match between the structure that your data actually has and the structure you think your data has. We have already seen an example of this in this chapter, in the code that tried to refer to a column called <code>offense_category</code> in a dataset that did not have a column with that name.</p>
<p>Errors caused by a mismatch between the data you think you have and the data you actually have can be particularly frustrating, because there is no way to identify them from just looking at your code. For this reason, it is often important when trying to identify problems in your code to <em>look</em> at the data that is used as the input for your code, <em>and</em> the data that is produced by each step in your code. We used this technique to find the error in our code above that was caused by <code>filter()</code> removing all the rows from a dataset because we had told <code>filter()</code> to only keep rows containing a value that was not present in the dataset. There were no obvious problems with the code we had written, so the only way to find the cause of this problem was to view the dataset returned by the <code>filter()</code> function.</p>
<p>Finding data problems is one of the reasons why we have used the <code>head()</code> function so often in previous chapters to look at the data at each step in writing a block of code. Looking at the results of a particular block of code before moving on to writing the next block can often save you from frustrating errors later on.</p>
<p><code>head()</code> only shows us the first few rows of a dataset, which will not always be enough to identify a problem if the problem is caused by values that are only present in a few rows in the data. For small datasets, we can use the <code>View()</code> function (note the capital letter) to open the entire dataset in a new tab in RStudio.</p>
<p>For bigger datasets, this will not work. In that case, we can use the <code>sample_n()</code> or <code>sample_frac()</code> functions from the dplyr package to return a random sample of rows from the data. This can be useful to let us look at a representative sample of a large dataset. <code>sample_n()</code> returns a specific number of rows, e.g.&nbsp;<code>sample_n(frauds, 10)</code> returns 10 rows at random from the <code>frauds</code> dataset. <code>sample_frac()</code> returns a specific proportion of the dataset, e.g.&nbsp;<code>sample_frac(frauds, 0.1)</code> returns a sample of 10% of rows from the data.</p>
</section>
</section>
<section id="understanding-a-problem" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="understanding-a-problem"><span class="header-section-number">8.4</span> Understanding a problem</h2>
<p>So far, we have tried two ways to deal with errors:</p>
<ol type="1">
<li>reading a simple error message that makes the problem obvious,</li>
<li>commenting out all the code and then uncommenting one line a time until the error appears.</li>
</ol>
<p>Sometimes you will encounter an error that is still not simple to solve. In this case, it is still important to identify the line of code causing the problem, either by working it out from the text of the error message or commenting out lines of code in turn.</p>
<p>Once you know what line is causing the problem, you should focus on understanding exactly what that line of code does. In particular:</p>
<ol type="1">
<li>What data do any functions on that line expect to work on?</li>
<li>What are the values of any arguments to the functions on that line?</li>
<li>What value do the functions on that line produce?</li>
</ol>
<p>You can get a lot of help in understanding each function by referring to its manual page. You can access the manual page for a function by:</p>
<ul>
<li>typing a question mark followed by the function name without parentheses (e.g.&nbsp;<code>?mutate</code>) into the R console,</li>
<li>typing the function name without parentheses into the search box in the Help panel in RStudio, or</li>
<li>clicking on the function name anywhere in your R code to place the cursor on the function name, then pressing <code>F1</code> on your keyboard.</li>
</ul>
<p>Any of these options opens up a manual page for that function in the Help panel in RStudio. For example, this is the manual page for the <code>str_wrap()</code> function from the <code>stringr</code> package. You can load it by typing <code>?str_wrap</code> in the R console.</p>
<p class="full-width-image">
<img src="../images/man_page.png" alt="Screenshot of the R manual page for the ">
</p>
<p>All manual pages have the same format.</p>
<dl>
<dt>Description</dt>
<dd>
This section gives a short description of what the function does. If multiple related functions are described in a single manual page, this section will explain the differences between them. For example, the manual page for the <code>mutate()</code> function from the <code>dplyr</code> package explains the difference between the <code>mutate()</code> function and the closely related <code>transmute()</code> function.
</dd>
<dt>Usage</dt>
<dd>
This section shows a single example of how the function works. If there are any optional arguments to the function, this section will show what the default values of those optional arguments are. For example, the manual page for the <code>str_wrap()</code> function from the <code>stringr</code> package show that the default value of the <code>width</code> argument is <code>width = 80</code>.
</dd>
<dt>Arguments</dt>
<dd>
This section gives a list of arguments and the values they can take. It is particularly important to note the type of value expected. So the <code>st_transform()</code> function from the <code>sf</code> package expects an SF object as its first argument – if you provide another sort of object (such as a tibble), this will cause an error.
</dd>
<dt>Value</dt>
<dd>
This section explains the type of value that the function will return, and whether this value might be of a different type depending on the values of particular arguments. For example, the <code>mean()</code> function in base R returns the arithmetic mean of a vector of numbers. However, if any of the numbers is <code>NA</code> then mean will return <code>NA</code> <em>unless</em> the argument <code>na.rm = TRUE</code> is used. In that case, <code>mean()</code> will ignore the missing values and return the mean of the values that are present.
</dd>
<dt>Examples</dt>
<dd>
This section gives more examples of how the function can be used.
</dd>
</dl>
<p>Checking the manual page for a function can often help you understand why a particular piece of code is not working. If you have set any optional arguments for a function that is producing an error, it may help to reset those arguments to their default values (as shown in the Usage section of the manual page) one by one to understand what effect this has on your code.</p>
<p>By reading the error message, isolating the error by commenting out and then reading the manual page, you will be able to fix almost all the errors you will come across in writing R code. Occasionally, however, you will find an error that you just can’t understand. In that case, you will need to get some help from others.</p>
</section>
<section id="how-to-fix-some-common-errors" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="how-to-fix-some-common-errors"><span class="header-section-number">8.5</span> How to fix some common errors</h2>
<p>There are some mistakes that it is common for people to make when writing code. As you get more experience in writing R code and dealing with error messages, you are likely to start to recognise some simple errors (especially those caused by typos) and know how to fix them quickly. One useful way to quickly find help on common errors is to check if the error (and the corresponding solution) appears in <a href="../appendices/common_errors.html" class="quarto-xref"><span>Appendix C</span></a>. Use the information in <a href="../appendices/common_errors.html" class="quarto-xref"><span>Appendix C</span></a> to answer these questions.</p>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Fixing common errors
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What might cause the error message <code>could not find function "blah"</code>?</strong></p>
<div id="radio_VXSUXDRZQR" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_VXSUXDRZQR" value=""> <span>You have loaded packages in the wrong order</span></label><label><input type="radio" autocomplete="off" name="radio_VXSUXDRZQR" value=""> <span>You have mis-typed the name of the <code>blah</code> object</span></label><label><input type="radio" autocomplete="off" name="radio_VXSUXDRZQR" value="answer"> <span>You have not loaded the package that contains the <code>blah()</code> function</span></label><label><input type="radio" autocomplete="off" name="radio_VXSUXDRZQR" value=""> <span>You have tried to use a generic function with a type of object the function does not know how to use</span></label>
</div>
<p><strong>What might cause the error message <code>non-numeric argument to binary operator</code>?</strong></p>
<div id="radio_QECIXWTXUQ" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_QECIXWTXUQ" value=""> <span>You have tried to use a function as if it is an object</span></label><label><input type="radio" autocomplete="off" name="radio_QECIXWTXUQ" value="answer"> <span>You have tried to use a mathematical operator such as <code>+</code> or <code>-</code> with a non-numeric value such as a character value</span></label><label><input type="radio" autocomplete="off" name="radio_QECIXWTXUQ" value=""> <span>You have used an argument name in a function that does not understand it</span></label><label><input type="radio" autocomplete="off" name="radio_QECIXWTXUQ" value=""> <span>You have either mis-typed the function name or the package containing that function is not loaded</span></label>
</div>
</div>
</div>
</section>
<section id="sec-reprex" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="sec-reprex"><span class="header-section-number">8.6</span> Getting external help using a reproducible example</h2>
<p>If you cannot fix an error using any of the techniques we have already covered, it is probably time to get some help from others. Fortunately, one of the big benefits of using R is that there is a friendly, welcoming community of R coders online who are willing to help fix problems. Almost everyone in this community will remember when they were knew to using R and so will be gentle with people who are asking their first question.</p>
<p><img src="../images/code_hero.jpg" style="width: 60%; max-width: 500px; float: right; margin: 0 0 2em 2em;"></p>
<p>One of the things that makes it much more likely that you will find help with your problem in the R community is if you phrase your plea for help in a way that makes it easier to help you. We can do this by providing a <em>reproducible example</em> of our problem (also sometimes called a <em>reprex</em> or a <em>minimum working example</em>).</p>
<p>Producing a reprex makes it much easier for someone to understand your issue. This not only makes it easier for someone to help you, but also shows that you know it will make it easier for them and that you value their time:</p>
<blockquote class="blockquote">
<p><a href="https://www.jessemaegan.com/post/so-you-ve-been-asked-to-make-a-reprex/">Imagine that you’ve made a cake</a>, and for some reason it’s turned out absolutely awful – we’re talking completely inedible. Asking a question without a reprex is like asking, “Why didn’t my cake turn out right?” – there are hundreds of possible answers to that question, and it’s going to take a long time to narrow in on the exact cause for your inedible cake creation.</p>
<p>Asking a question with a reprex is like asking, “My cake didn’t turn out, and here’s the recipe I used and the steps that I followed. Where did I go wrong?” Using this method is going to significantly increase the likelihood of you getting a helpful response, faster!</p>
</blockquote>
<p>To make a reprex, we have to do two things:</p>
<ol type="1">
<li>Remove everything from our code that does not contribute to causing the error. We do this by removing each line from our code in turn and only keeping those lines that are necessary to produce the specific error you are asking for help with – this is why a reproducible example is sometimes called a <em>minimum</em> working example.</li>
<li>Make sure that someone trying to help us can reproduce the issue on their own computer even if they don’t have access to the particular dataset we are using. We do this by replacing our own dataset with a publicly available one, preferably one of the datasets that are built into R for exactly this purpose.</li>
</ol>
<!-- Watch this video to see the process of making a reprex in RStudio: -->
<!--  -->
<p>To practice making a reproducible example, let’s create a new R script that we know will produce an error. Create a new R script file (<code>File &gt; New File &gt; R Script</code> in RStudio), save it as <code>chapter_08.R</code>, then paste the following code into it:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter_08.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb32" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># Load packages</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span>
<span id="cb32-3"><a href="#cb32-3"></a></span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="co"># Load a dataset from your computer and wrangle it</span></span>
<span id="cb32-5"><a href="#cb32-5"></a>road_deaths <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"road_deaths_data.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-6"><a href="#cb32-6"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb32-7"><a href="#cb32-7"></a>  <span class="fu">rename</span>(<span class="at">ksi_drivers =</span> drivers, <span class="at">ksi_pass_front =</span> front, <span class="at">ksi_pass_rear =</span> rear) <span class="sc">|&gt;</span> </span>
<span id="cb32-8"><a href="#cb32-8"></a>  <span class="fu">select</span>(<span class="sc">-</span>petrol_price, <span class="sc">-</span>van_killed) <span class="sc">|&gt;</span> </span>
<span id="cb32-9"><a href="#cb32-9"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-10"><a href="#cb32-10"></a>    <span class="at">law =</span> <span class="fu">as.logical</span>(law),</span>
<span id="cb32-11"><a href="#cb32-11"></a>    <span class="at">ksi_driver_rate =</span> ksi_drivers <span class="sc">/</span> (kms <span class="sc">/</span> <span class="dv">1000</span>)</span>
<span id="cb32-12"><a href="#cb32-12"></a>  )</span>
<span id="cb32-13"><a href="#cb32-13"></a></span>
<span id="cb32-14"><a href="#cb32-14"></a><span class="co"># Make a time-series chart of two continuous variables, coloured by a </span></span>
<span id="cb32-15"><a href="#cb32-15"></a><span class="co"># categorical variable, then add a trend line</span></span>
<span id="cb32-16"><a href="#cb32-16"></a>road_deaths <span class="sc">+</span> </span>
<span id="cb32-17"><a href="#cb32-17"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> month_beginning, <span class="at">y =</span> ksi_driver_rate)) <span class="sc">+</span> </span>
<span id="cb32-18"><a href="#cb32-18"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> law)) <span class="sc">+</span> </span>
<span id="cb32-19"><a href="#cb32-19"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb32-20"><a href="#cb32-20"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">"2 years"</span>, <span class="at">date_labels =</span> <span class="st">"%Y"</span>) <span class="sc">+</span></span>
<span id="cb32-21"><a href="#cb32-21"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb32-22"><a href="#cb32-22"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">type =</span> <span class="st">"qual"</span>) <span class="sc">+</span></span>
<span id="cb32-23"><a href="#cb32-23"></a>  <span class="fu">labs</span>(</span>
<span id="cb32-24"><a href="#cb32-24"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, </span>
<span id="cb32-25"><a href="#cb32-25"></a>    <span class="at">y =</span> <span class="st">"drivers killed or seriously injured per 1,000km travelled"</span>, </span>
<span id="cb32-26"><a href="#cb32-26"></a>    <span class="at">colour =</span> <span class="st">"after seat belts made mandatory"</span></span>
<span id="cb32-27"><a href="#cb32-27"></a>  ) <span class="sc">+</span></span>
<span id="cb32-28"><a href="#cb32-28"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb32-29"><a href="#cb32-29"></a>  <span class="fu">theme</span>(</span>
<span id="cb32-30"><a href="#cb32-30"></a>    <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey90"</span>),</span>
<span id="cb32-31"><a href="#cb32-31"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey90"</span>),</span>
<span id="cb32-32"><a href="#cb32-32"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb32-33"><a href="#cb32-33"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb32-34"><a href="#cb32-34"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb32-35"><a href="#cb32-35"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>At the moment, you can’t run this code because you don’t have the <code>road_deaths_data.csv</code> file. Download that file by clicking this link and saving the file into the same directory (folder) as the <code>chapter_08.R</code> file.</p>
<p class="center">
<a href="../data/road_deaths_data.csv" download="" class="btn btn-info">Download the road deaths data file</a>
</p>
<p>Now run all the code in the <code>chapter_08.R</code> file. You should see this error:</p>
<div class="cell">
<div class="cell-output cell-output-error">
<pre data-code-line-numbers=""><code>Error in `fortify()`:
! `data` must be a &lt;data.frame&gt;, or an object coercible by `fortify()`,
  or a valid &lt;data.frame&gt;-like object coercible by `as.data.frame()`, not a
  &lt;uneval&gt; object.
ℹ Did you accidentally pass `aes()` to the `data` argument?</code></pre>
</div>
</div>
<p>As you can see, this error is not easy to decipher, so we might need help to deal with it.</p>
<section id="reproducible-code" class="level3" data-number="8.6.1">
<h3 data-number="8.6.1" class="anchored" data-anchor-id="reproducible-code"><span class="header-section-number">8.6.1</span> Reproducible code</h3>
<p>The first step in producing a reprex is to remove every line from our code that isn’t necessary to produce the error. To do that, we start with the <em>last</em> line of code and remove it, then re-run the code. If the code produces <em>the same error</em>, we know that the error wasn’t caused or affected by anything on the line that we have removed. In that case, we don’t need to include that line of code in the reprex. On the other hand, if the error message disappears and the code runs successfully, <em>or</em> the error message changes to a different error, we know that the line of code we removed influenced the error in some way. In that case, we need to include that line of code in the reprex.</p>
<p>Following this process line by line, it is actually possible to remove a lot of the original code and still produce the same error. In fact, we only need to keep five lines of the original code:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter_08.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb34" data-source-line-numbers="nil" data-code-line-numbers="2,5,16,17,18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># Load packages</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse) </span>
<span id="cb34-3"><a href="#cb34-3"></a></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="co"># Load a dataset from your computer and wrangle it</span></span>
<span id="cb34-5"><a href="#cb34-5"></a>road_deaths <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"road_deaths_data.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-6"><a href="#cb34-6"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb34-7"><a href="#cb34-7"></a>  <span class="fu">rename</span>(<span class="at">ksi_drivers =</span> drivers, <span class="at">ksi_pass_front =</span> front, <span class="at">ksi_pass_rear =</span> rear) <span class="sc">|&gt;</span></span>
<span id="cb34-8"><a href="#cb34-8"></a>  <span class="fu">select</span>(<span class="sc">-</span>petrol_price, <span class="sc">-</span>van_killed) <span class="sc">|&gt;</span></span>
<span id="cb34-9"><a href="#cb34-9"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-10"><a href="#cb34-10"></a>    <span class="at">law =</span> <span class="fu">as.logical</span>(law),</span>
<span id="cb34-11"><a href="#cb34-11"></a>    <span class="at">ksi_driver_rate =</span> ksi_drivers <span class="sc">/</span> (kms <span class="sc">/</span> <span class="dv">1000</span>)</span>
<span id="cb34-12"><a href="#cb34-12"></a>  )</span>
<span id="cb34-13"><a href="#cb34-13"></a></span>
<span id="cb34-14"><a href="#cb34-14"></a><span class="co"># Make a time-series chart of two continuous variables, coloured by a </span></span>
<span id="cb34-15"><a href="#cb34-15"></a><span class="co"># categorical variable, then add a trend line</span></span>
<span id="cb34-16"><a href="#cb34-16"></a>road_deaths <span class="sc">+</span>  </span>
<span id="cb34-17"><a href="#cb34-17"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> month_beginning, <span class="at">y =</span> ksi_driver_rate)) <span class="sc">+</span>  </span>
<span id="cb34-18"><a href="#cb34-18"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> law)) <span class="sc">+</span>  </span>
<span id="cb34-19"><a href="#cb34-19"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb34-20"><a href="#cb34-20"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">"2 years"</span>, <span class="at">date_labels =</span> <span class="st">"%Y"</span>) <span class="sc">+</span></span>
<span id="cb34-21"><a href="#cb34-21"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb34-22"><a href="#cb34-22"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">type =</span> <span class="st">"qual"</span>) <span class="sc">+</span></span>
<span id="cb34-23"><a href="#cb34-23"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-24"><a href="#cb34-24"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, </span>
<span id="cb34-25"><a href="#cb34-25"></a>    <span class="at">y =</span> <span class="st">"drivers killed or seriously injured per 1,000km travelled"</span>, </span>
<span id="cb34-26"><a href="#cb34-26"></a>    <span class="at">colour =</span> <span class="st">"after seat belts made mandatory"</span></span>
<span id="cb34-27"><a href="#cb34-27"></a>  ) <span class="sc">+</span></span>
<span id="cb34-28"><a href="#cb34-28"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-29"><a href="#cb34-29"></a>  <span class="fu">theme</span>(</span>
<span id="cb34-30"><a href="#cb34-30"></a>    <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey90"</span>),</span>
<span id="cb34-31"><a href="#cb34-31"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey90"</span>),</span>
<span id="cb34-32"><a href="#cb34-32"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb34-33"><a href="#cb34-33"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb34-34"><a href="#cb34-34"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb34-35"><a href="#cb34-35"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>That means we can remove:</p>
<ol type="1">
<li>The comments (lines 1, 4, 14 and 15, above).</li>
<li>The code that wrangles the data in ways that don’t affect the error (lines 6–12).</li>
<li>The code that adds a trend line to the chart (line 19).</li>
<li>The code that fine-tune the appearance of the chart (lines 20–35).</li>
</ol>
<p>We cannot remove the code that loads necessary packages (line 2), loads the data (line 5) or produces the basic unformatted chart (lines 16–18), because if we remove any of those then the error message either changes or disappears.</p>
<p>This leaves us with the following code, which produces the same error message but is much easier for someone to check for errors because it is much shorter. Because we have removed the data-wrangling code, we have had to change the name of the argument on line 17 of the code above from <code>y = ksi_driver_rate</code> to <code>y = drivers</code>, since the column <code>ksi_driver_rate</code> is no longer in the data (because we have removed line 7 of the code above). We also have to remove the pipe operator (<code>|&gt;</code>) at the end of line 5 and the <code>+</code> operator at the end of line 18, since they are no longer needed because we have removed the lines of code that follow them.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
If the error message changes, keep that line of code
</div>
</div>
<div class="callout-body-container callout-body">
<p>If we forgot to change <code>y = ksi_driver_rate</code> to <code>y = drivers</code>, or to remove <code>|&gt;</code> on line 7, then the code would still produce an error, <em>but it would be a different error</em>. The purpose of producing a reprex is to find the minimum code that still produces <em>the same error</em> we are interested in. If you remove a line of code and the error message you see changes, put that line of code back.</p>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb35" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span>
<span id="cb35-2"><a href="#cb35-2"></a></span>
<span id="cb35-3"><a href="#cb35-3"></a>road_deaths <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"road_deaths_data.csv"</span>)</span>
<span id="cb35-4"><a href="#cb35-4"></a></span>
<span id="cb35-5"><a href="#cb35-5"></a>road_deaths <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> month_beginning, <span class="at">y =</span> ksi_driver_rate)) <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> law))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-error">
<pre data-code-line-numbers=""><code>Error in `fortify()`:
! `data` must be a &lt;data.frame&gt;, or an object coercible by `fortify()`,
  or a valid &lt;data.frame&gt;-like object coercible by `as.data.frame()`, not a
  &lt;uneval&gt; object.
ℹ Did you accidentally pass `aes()` to the `data` argument?</code></pre>
</div>
</div>
<p>You can see that even though we have removed 80% of the previous code, this shorter code still produces the same error message. That means the problem must be on line of these 5 lines of code. This makes the problem much easier to find and fix, since we only have to understand what is happening (on what might be going wrong) on 5 lines of code, not in the 35 lines of our original code.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
But wouldn’t this map look very different?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>If this shortened code ran successfully rather than producing an error, the resulting chart would look very different to the original chart we wanted. But that does not matter, because what we are interested in is isolating the lines of code that produce the specific error we want to find and fix.</p>
</div>
</div>
</div>
</section>
<section id="reproducible-data" class="level3" data-number="8.6.2">
<h3 data-number="8.6.2" class="anchored" data-anchor-id="reproducible-data"><span class="header-section-number">8.6.2</span> Reproducible data</h3>
<p>Our shortened code would make a great reproducible example except for one thing: the data file <code>road_deaths_data.csv</code> only exists on your computer. This means the example is not actually <em>reproducible</em>, since anyone trying to run this code on their computer to identify the error would find that they instead got a different error saying that the file <code>road_deaths_data.csv</code> was not found.</p>
<p>You could deal with this by uploading your dataset to a website and then having the <code>read_csv()</code> function read it from that URL. But you might not want to share your data (perhaps it is sensitive in some way), or your dataset might be too large to post online. For this reason, many R packages come with toy datasets that can be used in learning or in testing for errors. You can see a list of all the toy datasets available in the packages you have loaded by typing <code>data()</code> in the R console. This will produce a file that gives the name and description of each available dataset.</p>
<p>To use one of these toy datasets, you just use the the name of the dataset as you would use any other R object (like the <code>road_deaths</code> object we created above). One commonly used toy dataset is the <code>mpg</code> dataset from the ggplot2 package, which contains fuel economy data for 38 models of car.</p>
<p>The data in this dataset are on a completely different topic to the data we were trying to use, but this does not matter as long as the data contains variables of the same type (numeric, character, etc.) as the original data. We can see what variables are in the <code>mpg</code> dataset using the <code>head()</code> function as usual.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb37" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="fu">head</span>(mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 6 × 11
  manufacturer model displ  year   cyl trans      drv     cty   hwy fl    class 
  &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; 
1 audi         a4      1.8  1999     4 auto(l5)   f        18    29 p     compa…
2 audi         a4      1.8  1999     4 manual(m5) f        21    29 p     compa…
3 audi         a4      2    2008     4 manual(m6) f        20    31 p     compa…
4 audi         a4      2    2008     4 auto(av)   f        21    30 p     compa…
5 audi         a4      2.8  1999     6 auto(l5)   f        16    26 p     compa…
6 audi         a4      2.8  1999     6 manual(m5) f        18    26 p     compa…</code></pre>
</div>
</div>
<p>From this, we can see that there is:</p>
<ul>
<li>a <code>year</code> variable that we can use as a substitute for the <code>month_beginning</code> variable in our original code,</li>
<li>a variable called <code>hwy</code> that is numeric and so can be substituted for the <code>drivers</code> variable in our code, and</li>
<li>a categorical variable called <code>trans</code> that we can substitute for the <code>law</code> variable in our data.</li>
</ul>
<p>This means we can use this data instead of our own data, knowing that anyone on any computer with the ggplot2 package installed can run the code and should get the same result. It also makes our code slightly shorter still, since we no longer need to load the data from a file with <code>read_csv()</code>. All we need to do is load the ggplot2 package and replace the reference to the <code>road_deaths</code> object on line 5 of our shortened code to a reference to the built-in <code>mpg</code> object:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb39" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggplot2)</span>
<span id="cb39-2"><a href="#cb39-2"></a></span>
<span id="cb39-3"><a href="#cb39-3"></a>mpg <span class="sc">+</span></span>
<span id="cb39-4"><a href="#cb39-4"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> hwy)) <span class="sc">+</span> </span>
<span id="cb39-5"><a href="#cb39-5"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> trans))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-error">
<pre data-code-line-numbers=""><code>Error in `fortify()`:
! `data` must be a &lt;data.frame&gt;, or an object coercible by `fortify()`,
  or a valid &lt;data.frame&gt;-like object coercible by `as.data.frame()`, not a
  &lt;uneval&gt; object.
ℹ Did you accidentally pass `aes()` to the `data` argument?</code></pre>
</div>
</div>
<p>We have now managed to reduce our original 37 lines of code down to 4 lines, as well as making the example reproducible by using a widely available toy dataset. The shorter code still produces the same error while being much easier to read, so we are much more likely to get help quickly than if we had just sent someone our original code.</p>
<p>Most of the time, the act of producing a reprex will be enough for us to find and fix the error without any external help. Can you see the problem with our code that is making this error happen? If not, we will reveal it at the end of this chapter.</p>
</section>
<section id="checking-your-reprex-is-reproducible" class="level3" data-number="8.6.3">
<h3 data-number="8.6.3" class="anchored" data-anchor-id="checking-your-reprex-is-reproducible"><span class="header-section-number">8.6.3</span> Checking your reprex is reproducible</h3>
<p>Now that you have the minimum code needed to reproduce the error, it’s almost time to share it with people who can help you. But before you do that, it’s worth checking that the code is truly reproducible. To do this we will use the reprex package, which is part of the tidyverse suite of packages you already have installed.</p>
<p class="full-width-image">
<img src="../images/reprex-cartoon.jpg" alt="Cartoon of furry monsters celebrating, with the caption 'reprex: make reproducible examples'">
</p>
<p><a href="https://reprex.tidyverse.org/" title="reprex website"><img src="../images/reprex.png" class="right-side-image"></a></p>
<p>To use the reprex package, first put your code in a separate R document in the Source panel in RStudio. Open a new R script in RStudio now and paste the final three-line reprex code above into it. Once you’ve done that, select all the code in that document. Now click the <code>Addins</code> button in RStudio and scroll down until you can choose <code>Reprex selection</code>.</p>
<p>After a few seconds, some code should appear in the RStudio Viewer panel showing your code and the error message that it produces. This code has also been copied to your computer clipboard so that you can paste it into an email or web form when you are asking for help.</p>
<p>If the error message that you see along with the code in the Viewer panel is not the error message you were expecting, your example is not yet reproducible. For example if you tried to run the <code>Reprex selection</code> command on the original code that we started this section with, we would get an error message <code>'road_deaths_data.csv' does not exist in current working directory</code>.</p>
<p>Once your reprex produces <em>the same error</em> as the code you originally had the issue with, you’re ready to share it to get help.</p>
</section>
</section>
<section id="sources-of-help" class="level2" data-number="8.7">
<h2 data-number="8.7" class="anchored" data-anchor-id="sources-of-help"><span class="header-section-number">8.7</span> Sources of help</h2>
<p>If you are being taught R by a formal instructor, or you have friends or colleagues who can help, they will probably be the first people that you go to for help.</p>
<p>If this doesn’t work, or if you are the most proficient R user that you know, you might need another place to turn to. Fortunately, R has a large community of volunteers who will help you. Before you ask people online for help, it’s important to check that someone hasn’t already asked the same question and had it answered. Duplicate questions increase the workload of the volunteers who answer questions and slow everything down, so if your question has frequently been answered already it’s possible your question will just be ignored.</p>
<p>To find out if there is an answer to your question, the easiest thing to do is to search the error message online. Google, or another search engine of your choice, is definitely your friend. If you search online for the error message that was produced by our reprex code, you will see that there are over 100 pages discussing this error message and how to fix it.</p>
<p>Let’s imagine, though, that there were no relevant hits when we searched for the error message, or that none of the results was useful. In that case, we need to pose a new question to the R community. The place to find the largest slice of that community is probably the website <a href="https://stackoverflow.com/">Stack Overflow</a>. This is a website for people who are writing code in any programming language imaginable to get help. It is part of the larger <a href="https://stackexchange.com/">Stack Exchange Network</a> of question-and-answer websites covering everything from <a href="https://travel.stackexchange.com/">travel</a> to <a href="https://vegetarianism.stackexchange.com/">veganism</a>.</p>
<p>To ask a new question on Stack Overflow, go to <a href="https://stackoverflow.com/questions/ask">stackoverflow.com/questions/ask</a> and create an account or log in. You will now be asked to complete a short form with your question. Questions are more likely to get an answer faster if you:</p>
<ul>
<li>Give the question a specific title. Over 20 million questions have been asked on Stack Overflow since it launched, so a generic title like ‘Help’, ‘R error’ or even ‘ggplot error’ will not help other people find your question. <a href="https://stackoverflow.com/questions/tagged/r">Look at some recent questions about R on Stack Overflow</a> to get some ideas on what title to give for your question.</li>
<li>In the body of your question, <em>briefly</em> (2–3 lines should do it) explain what you were trying to do, then paste the reprex output that the <code>Reprex selection</code> addin copied to your clipboard into the question body box underneath your brief explanation. You will see that Stack Overflow recognises the format of your code and shows you a preview of it underneath the question box.</li>
<li>Finally, add the tag <code>r</code> to the Tags box so that people know your question is about coding in R. This is crucial – if you do not tag your question as being about R, it is very unlikely that volunteers who know about R will be able to find your question.</li>
</ul>
<p>Submit your question and wait for an answer. As soon as someone answers your question, or comments on it to ask for more detail, you will get an email alert. Many questions are typically answered within a few hours. Hopefully this will help you get to the final stage of the emotional roller coaster of debugging:</p>
<p class="full-width-image">
<img src="../images/debugging.jpg" alt="Cartoon showing 10 furry monsters showing different stages of learning to debug code. The monsters are marked '1. I got this', '2. Huh, really though that was it', '3. (...)', '4. Fine. Restarting.', '5. OH WTF', '6. Zombie meltdown', '7. [crying]', '8. A NEW HOPE!', '9. [insert awesome theme song]' and '10. I LOVE CODING!'">
</p>
</section>
<section id="getting-help-from-online-tutorials-and-blogs" class="level2" data-number="8.8">
<h2 data-number="8.8" class="anchored" data-anchor-id="getting-help-from-online-tutorials-and-blogs"><span class="header-section-number">8.8</span> Getting help from online tutorials and blogs</h2>
<p>One of the nice things about learning R is that there is a large online community of people who write about how to get things done using R. The <a href="https://www.r-bloggers.com/">R-Bloggers</a> website hosts thousands of tutorials on different R topics, written by hundreds of different authors, while institutions such as the UCLA Statistical Consulting group provide <a href="https://stats.oarc.ucla.edu/r/">detailed tutorials on statistical analysis using R</a>. There are also many free online books and websites on how to get different things done in R, many of which are linked as further reading throughout this book. One example of this is the <a href="https://r-graph-gallery.com/">R Graph Gallery</a> that gives examples of many different types of visualisations you can make in R.</p>
<p>Many online tutorials are very helpful. But the R language has developed over time, so some older tutorials may use methods that have since been replaced by better ones. Occasionally, older tutorials might even you bad advice. So how can you know which tutorials you can trust? Generally, online posts from the past 3 years or so are more likely to use methods that are reasonably up to date. You might also want to consider who wrote the tutorial. For example, is the tutorial hosted on the website of an R package you are using? If so, it’s likely to have been written by the author of the package and so is likely to be reliable.</p>
<p><a href="../appendices/functions_to_avoid.html" class="quarto-xref"><span>Appendix D</span></a> explains some obsolete R functions that you should avoid using if you see them suggested in online tutorials or blog posts.</p>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Some R functions to avoid
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Why should you avoid using the <code>attach()</code> function?</strong></p>
<div id="radio_VIGPKRCBQI" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_VIGPKRCBQI" value=""> <span>It deletes all the objects in your R environment</span></label><label><input type="radio" autocomplete="off" name="radio_VIGPKRCBQI" value=""> <span>It makes it impossible for you to share your code with anyone else</span></label><label><input type="radio" autocomplete="off" name="radio_VIGPKRCBQI" value="answer"> <span>It makes it hard to keep track of which values are stored in which dataset</span></label><label><input type="radio" autocomplete="off" name="radio_VIGPKRCBQI" value=""> <span>It has been superseded by the <code>if_else()</code> function</span></label>
</div>
<p><strong>What function should you generally use instead of <code>%&gt;%</code>?</strong></p>
<div id="radio_XAXGUKWYJG" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_XAXGUKWYJG" value=""> <span><code>pluck()</code></span></label><label><input type="radio" autocomplete="off" name="radio_XAXGUKWYJG" value=""> <span><code>mod()</code></span></label><label><input type="radio" autocomplete="off" name="radio_XAXGUKWYJG" value=""> <span><code>pull()</code></span></label><label><input type="radio" autocomplete="off" name="radio_XAXGUKWYJG" value="answer"> <span><code>|&gt;</code></span></label>
</div>
<p><strong>What happens if you try to run the code <code>as.numeric("100 degrees")</code>?</strong></p>
<div id="radio_TBEFZCYJFC" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_TBEFZCYJFC" value=""> <span>The numeric value <code>100</code> is returned</span></label><label><input type="radio" autocomplete="off" name="radio_TBEFZCYJFC" value="answer"> <span>The value <code>NA</code> is returned</span></label><label><input type="radio" autocomplete="off" name="radio_TBEFZCYJFC" value=""> <span>The text value <code>"100"</code> is returned</span></label><label><input type="radio" autocomplete="off" name="radio_TBEFZCYJFC" value=""> <span>R crashes</span></label>
</div>
</div>
</div>
</section>
<section id="coding-with-ai" class="level2" data-number="8.9">
<h2 data-number="8.9" class="anchored" data-anchor-id="coding-with-ai"><span class="header-section-number">8.9</span> Coding with AI</h2>
<p>One topic that we haven’t covered yet is using artificial intelligence (AI) to help us produce R code. The type of AI that can be used to help produce code is called a <em>large language model</em> (LLM), sometimes known as a <em>generative AI</em> model. The best known of these among the public is probably <a href="https://chat.openai.com/">ChatGPT</a>, but there are lots of similar services available (and new ones being released all the time).</p>
<section id="coding-with-ai-an-example" class="level3" data-number="8.9.1">
<h3 data-number="8.9.1" class="anchored" data-anchor-id="coding-with-ai-an-example"><span class="header-section-number">8.9.1</span> Coding with AI: an example</h3>
<p>Generative AI services can help you to write code, especially code that does very common tasks like loading data. For example, say that I want to load the Vancouver thefts dataset that we used in a previous chapter and convert the column names in the data to <code>snake_case</code>. As a reminder, the code we previously used to do that looked like this:</p>
<div class="sourceCode" id="cb41" data-code-line-numbers=""><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span>
<span id="cb41-2"><a href="#cb41-2"></a></span>
<span id="cb41-3"><a href="#cb41-3"></a>vancouver_thefts <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/vancouver_thefts.csv.gz"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb41-4"><a href="#cb41-4"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To ask ChatGPT to write some code that will do this task, I need to tell it what I want. For example, you might use this <em>prompt</em> text to give instructions to ChatGPT:</p>
<blockquote class="blockquote">
<p>Show me the R code needed to load the CSV dataset at https://mpjashby.github.io/crimemappingdata/vancouver_thefts.csv.gz and make the column names into snake case</p>
</blockquote>
<p>When I give this prompt to ChatGPT version 4o in January 2025 it produced this response:</p>
<div class="sourceCode" id="cb42" data-code-line-numbers=""><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="co"># Install required packages if not already installed</span></span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"janitor"</span>)) <span class="fu">install.packages</span>(<span class="st">"janitor"</span>)</span>
<span id="cb42-3"><a href="#cb42-3"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"readr"</span>)) <span class="fu">install.packages</span>(<span class="st">"readr"</span>)</span>
<span id="cb42-4"><a href="#cb42-4"></a></span>
<span id="cb42-5"><a href="#cb42-5"></a><span class="co"># Load required libraries</span></span>
<span id="cb42-6"><a href="#cb42-6"></a><span class="fu">library</span>(janitor)</span>
<span id="cb42-7"><a href="#cb42-7"></a><span class="fu">library</span>(readr)</span>
<span id="cb42-8"><a href="#cb42-8"></a></span>
<span id="cb42-9"><a href="#cb42-9"></a><span class="co"># Define the URL of the dataset</span></span>
<span id="cb42-10"><a href="#cb42-10"></a>url <span class="ot">&lt;-</span> <span class="st">"https://mpjashby.github.io/crimemappingdata/vancouver_thefts.csv.gz"</span></span>
<span id="cb42-11"><a href="#cb42-11"></a></span>
<span id="cb42-12"><a href="#cb42-12"></a><span class="co"># Read the dataset directly from the URL</span></span>
<span id="cb42-13"><a href="#cb42-13"></a>thefts_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(url)</span>
<span id="cb42-14"><a href="#cb42-14"></a></span>
<span id="cb42-15"><a href="#cb42-15"></a><span class="co"># Convert column names to snake_case</span></span>
<span id="cb42-16"><a href="#cb42-16"></a>thefts_data <span class="ot">&lt;-</span> <span class="fu">clean_names</span>(thefts_data)</span>
<span id="cb42-17"><a href="#cb42-17"></a></span>
<span id="cb42-18"><a href="#cb42-18"></a><span class="co"># View the first few rows of the dataset</span></span>
<span id="cb42-19"><a href="#cb42-19"></a><span class="fu">head</span>(thefts_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ChatGPT also produces a short explanation of what the code does:</p>
<blockquote class="blockquote">
<p>Explanation:</p>
<ol type="1">
<li><strong><code>read_csv()</code></strong>: Reads the compressed <code>.csv.gz</code> file directly from the URL. The <code>readr</code> package handles the compressed file format automatically.</li>
<li><strong><code>clean_names()</code></strong>: Converts column names to snake_case. This function is provided by the <code>janitor</code> package and is useful for making column names consistent and easier to work with in R.</li>
<li><strong><code>head()</code></strong>: Displays the first few rows of the dataset to confirm that the column names have been converted successfully.</li>
</ol>
</blockquote>
<p>This code works, in that it produces the desired result. However, it takes 12 lines of code and creates three objects to do the same work as our original 3 lines of code (lines 1–7 of the ChatGPT code replicate what <code>pacman::p_load(tidyverse)</code> does on the first line of our original code). This might not seem like a problem, and for this simple example it’s not. However, if you wanted to combine this code with other code written with the help of a large language model, the code could quickly get so complicated that it would be hard to understand.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why did I get a different result when I put the same prompt into ChatGPT?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>If you put the text “Show me the R code needed to load the CSV dataset at https://mpjashby.github.io/crimemappingdata/vancouver_thefts.csv.gz and make the column names into snake case” into ChatGPT, it is possible that you will get a slightly different response to the one shown above. This is because large language models are <em>stochastic</em> or <em>non-deterministic</em> models, which means that there is some element of chance involved in exactly what response the model will produce for a particular input. In fact, if you provide exactly the same input to ChatGPT multiple times, it is likely you will get a slightly different answer each time.</p>
</div>
</div>
</div>
</section>
<section id="why-does-chatgpt-sometimes-produce-code-that-doesnt-work" class="level3" data-number="8.9.2">
<h3 data-number="8.9.2" class="anchored" data-anchor-id="why-does-chatgpt-sometimes-produce-code-that-doesnt-work"><span class="header-section-number">8.9.2</span> Why does ChatGPT sometimes produce code that doesn’t work?</h3>
<p>In the example above, ChatGPT 4o produced code that works (the previous version, ChatGPT 3.5, generated code that produced an error). However, there are lots of examples of large language models producing code that doesn’t work in various ways.</p>
<p>To understand why that happens, we need to know just a little bit about how large language models such as ChatGPT work. LLMs work by looking for patterns in very large datasets (e.g.&nbsp;all the pages on the world wide web) and then using those patterns to predict what the most likely answer is to questions or requests that include particular words and phrases. To give a very simple example, an LLM might be able to identify that if the first few words in a sentence are ‘Today was Sunday, which meant that tomorrow …’ then it is likely (but not certain) that the next words would be ‘is Monday’.</p>
<p>Because they are trained on very large samples of data, LLMs can produce answers that are sophisticated enough that they almost look like magic. But behind the scenes, what models like ChatGPT are doing is predicting what the most likely combination of words a response will contain, based on the input that it is given. It is important to remember that models such as ChatGPT do not know the <em>correct</em> answer to a question, since they do not actually understand the question in the way that humans do. This means that ChatGPT cannot give you any indication of how confident it is about the answer it has given: it will be equally confident in its answer whether it is right or wrong. This unjustified confidence can easily lead you to accept an answer from ChatGPT that is actually wrong, so always be careful in using the results produced by LLMs.</p>
<p class="full-width-image">
<img src="../images/need_a_minute.png" alt="A frustrated little monster sits on the ground with his hat next to him, saying 'I just need a minute.' Looking on empathetically is the R logo, with the word 'Error' in many different styles behind it.">
</p>
</section>
<section id="should-i-use-ai-to-help-me-code" class="level3" data-number="8.9.3">
<h3 data-number="8.9.3" class="anchored" data-anchor-id="should-i-use-ai-to-help-me-code"><span class="header-section-number">8.9.3</span> Should I use AI to help me code?</h3>
<p>So given these issues, does that mean that we shouldn’t use LLMs to help us write code? Not necessarily. Lots of programmers find LLMs useful for helping them write code. However, LLMs like ChatGPT are useful for <em>supporting</em> humans to write effective code, not for replacing humans writing code. Even if you asked an LLM to write every part of your code for you, it is likely you would need to make some changes to the code it produced to make it work.</p>
<p>That means that to use an LLM effectively to help you write code, you need to understand the code that the LLM produces. That’s why this course teaches you to understand how to write code to produce crime maps in R, rather than just how to use an LLM to write the code for you.</p>
<p>Whether to use an LLM to help you write code is up to you. Some people find it saves them time and helps them get started on how to produce a particular bit of code, while others find that they spend just as much time fixing the code produced by an LLM as it would take them to write the code themselves. You might want to experiment with getting help from an LLM so you can see what works for you.</p>
</section>
<section id="using-ai-to-help-map-crime" class="level3" data-number="8.9.4">
<h3 data-number="8.9.4" class="anchored" data-anchor-id="using-ai-to-help-map-crime"><span class="header-section-number">8.9.4</span> Using AI to help map crime</h3>
<p>There are two further important points to make about using LLMs in the context of crime mapping. First, it is vital that you do not upload any sensitive data to an LLM that is hosted online, since it is likely that the company that runs the LLM will have reserved the right to use any data you submit to improve the model in future. You must make sure that sensitive data such as victim details are not posted online or shared unlawfully.</p>
<p>The second important point is that the analysis that we use crime mapping for is usually done to answer important questions such as where crime-prevention initiatives should be focused or where a serial offender might live. It is vital that the answers we produce to these questions are accurate. Part of making sure the results of our analysis are accurate is to make sure that we understand exactly how our code produces a particular result. If you use an LLM to support your coding, it is vital that you still understand what the code does.</p>
<p>Restart R to start a new session by clicking on the <code>Session</code> menu and then clicking <code>Restart R</code>. This creates a blank canvas for the next chapter.</p>
</section>
</section>
<section id="in-summary" class="level2" data-number="8.10">
<h2 data-number="8.10" class="anchored" data-anchor-id="in-summary"><span class="header-section-number">8.10</span> In summary</h2>
<p>In this chapter we have learned how to handle messages, warnings and errors in R. We have learned to take time to understand error messages, to isolate errors so that we can better understand them, to use manual pages for functions to check that every argument is correct, and how to write reproducible examples so that we can get help online. This will help you become a more independent coder. You can the the checklist in <a href="../appendices/handling_errors.html" class="quarto-xref"><span>Appendix E</span></a> to help you deal with any problems in your code.</p>
<section id="what-caused-the-error-in-our-reproducible-example" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="what-caused-the-error-in-our-reproducible-example">What caused the error in our reproducible example?</h3>
<p>The error in our reproducible example was very simple, but quite difficult to spot. On line 1 of the code below, we try to add the <code>ggplot()</code> function to the <code>mpg</code> object using the <code>+</code> operator when what we wanted to do was pass the <code>mpg</code> object to the <code>ggplot()</code> function using the <code>|&gt;</code> operator. R does not know how to add a dataset to a function in this way, so it produced an error message.</p>
<p>If you replaced <code>+</code> with <code>|&gt;</code> on line 1 of the code below, the code would now run normally. Since we have removed almost all of our original code to make a reproducible example, the resulting plot looks nothing like what we wanted. This does not matter – when we are producing a reprex we only care about reliably producing <em>the same</em> error. Now that we have fixed the error, we could go back and fix the original code to produce the chart we wanted.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb43" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggplot2)</span>
<span id="cb43-2"><a href="#cb43-2"></a></span>
<span id="cb43-3"><a href="#cb43-3"></a>mpg <span class="sc">+</span> <span class="co"># &lt;---- THE `+` OPERATOR HERE SHOULD BE A `|&gt;` OPERATOR INSTEAD</span></span>
<span id="cb43-4"><a href="#cb43-4"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> hwy)) <span class="sc">+</span> </span>
<span id="cb43-5"><a href="#cb43-5"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> trans))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The mistake in this code is a very easy one to make, because what <code>+</code> does inside a <code>ggplot()</code> stack is so similar to what <code>|&gt;</code> does in passing the result of one function to the next function in an data-wrangling pipeline. Remember that we only use <code>+</code> to combine functions inside a <code>ggplot()</code> stack, and use <code>|&gt;</code> to combine functions everywhere else.</p>
<div class="box reading">
<p>For more information on writing reproducible examples, see:</p>
<ul>
<li>Watch the webinar <a href="https://reprex.tidyverse.org/articles/articles/learn-reprex.html">Creating reproducible examples with reprex</a> by Jenny Bryan.</li>
<li>Read the <a href="https://reprex.tidyverse.org/articles/reprex-dos-and-donts.html">Reprex do’s and don’ts</a> on the <code>reprex</code> package website.</li>
<li>Learn more about how to use <a href="https://doi.org/10.1038/d41586-023-01833-0">Six tips for better coding with ChatGPT</a></li>
</ul>
</div>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Revision questions
</div>
</div>
<div class="callout-body-container callout-body">
<p>Answer these questions to check you have understood the main points covered in this chapter. Write between 50 and 100 words to answer each question.</p>
<ol type="1">
<li>What are the key differences between messages, warnings, and errors in R? Provide an example of each and explain how they affect the execution of code.</li>
<li>Explain the difference between syntax errors and logical errors in R. Why are logical errors often harder to identify and fix?</li>
<li>Why is it important to check each line of code when debugging a block of R code? Describe a method for systematically isolating problematic lines.</li>
<li>What role do R manual pages play in understanding and fixing errors? How can you access these pages, and what key sections should you focus on?</li>
<li>Why is it dangerous to ignore warnings in your R code? Provide an example of how a warning could indicate a significant problem with your analysis.</li>
</ol>
</div>
</div>
<p class="credits">
<a href="https://twitter.com/allison_horst">Artwork by <span class="citation" data-cites="allison_horst">@allison_horst</span></a>
</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../07_map_context/index.html" class="pagination-link" aria-label="Giving a map context">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Giving a map context</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../09_mapping_areas/index.html" class="pagination-link" aria-label="Mapping area data">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Mapping area data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb44" data-shortcodes="false" data-code-line-numbers="617,620,631,632,633"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb44-1"><a href="#cb44-1"></a><span class="fu"># Handling bugs in your code {#sec-bugs}</span></span>
<span id="cb44-2"><a href="#cb44-2"></a></span>
<span id="cb44-3"><a href="#cb44-3"></a>::: {.abstract}</span>
<span id="cb44-4"><a href="#cb44-4"></a>This chapter will teach you how to identify and fix bugs in your R code. You'll learn how to interpret error messages, warnings, and messages, distinguishing between minor issues and critical problems that halt code execution. The chapter also covers systematic debugging techniques, such as isolating problematic lines and checking data structures, with practical examples using a dataset on frauds. You'll explore the differences between syntax and logical errors and gain tools to resolve them effectively. By the end of this chapter, you'll feel more confident tackling errors in your code, an invaluable skill for any programming project.</span>
<span id="cb44-5"><a href="#cb44-5"></a>:::</span>
<span id="cb44-6"><a href="#cb44-6"></a></span>
<span id="cb44-7"><a href="#cb44-7"></a></span>
<span id="cb44-8"><a href="#cb44-8"></a><span class="fu">## Introduction</span></span>
<span id="cb44-9"><a href="#cb44-9"></a></span>
<span id="cb44-10"><a href="#cb44-10"></a>In this chapter we will learn how to deal with bugs in the R code that we write. It's inevitable that you will make mistakes in the R code that you write. Everyone types the wrong command every now and again, just as everyone sometimes clicks the wrong button in other pieces of software. Learning how to identify and fix bugs is part of the process of learning to code.</span>
<span id="cb44-11"><a href="#cb44-11"></a></span>
<span id="cb44-12"><a href="#cb44-12"></a>In this chapter we will look at examples of errors using a dataset of frauds in Kansas City in the United States. We can load this dataset with this code:</span>
<span id="cb44-13"><a href="#cb44-13"></a></span>
<span id="cb44-14"><a href="#cb44-14"></a></span>
<span id="cb44-17"><a href="#cb44-17"></a><span class="in">```{r}</span></span>
<span id="cb44-18"><a href="#cb44-18"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-19"><a href="#cb44-19"></a></span>
<span id="cb44-20"><a href="#cb44-20"></a><span class="co"># Load packages</span></span>
<span id="cb44-21"><a href="#cb44-21"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span>
<span id="cb44-22"><a href="#cb44-22"></a></span>
<span id="cb44-23"><a href="#cb44-23"></a><span class="co"># Load data</span></span>
<span id="cb44-24"><a href="#cb44-24"></a>frauds <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/kansas_city_frauds.csv.gz"</span>)</span>
<span id="cb44-25"><a href="#cb44-25"></a><span class="in">```</span></span>
<span id="cb44-26"><a href="#cb44-26"></a></span>
<span id="cb44-27"><a href="#cb44-27"></a></span>
<span id="cb44-28"><a href="#cb44-28"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb44-29"><a href="#cb44-29"></a><span class="fu">#### Why did we run this code in the R Console?</span></span>
<span id="cb44-30"><a href="#cb44-30"></a></span>
<span id="cb44-31"><a href="#cb44-31"></a>Normally when we load packages and data, we do it in an R script file. We do that because this code is needed as part of the complete script that produces a particular map. In this chapter we won't be creating a map, just looking at examples of errors, so we won't need to keep any of the code for later.</span>
<span id="cb44-32"><a href="#cb44-32"></a>:::</span>
<span id="cb44-33"><a href="#cb44-33"></a></span>
<span id="cb44-34"><a href="#cb44-34"></a></span>
<span id="cb44-35"><a href="#cb44-35"></a>This is what the first few lines of the dataset look like:</span>
<span id="cb44-36"><a href="#cb44-36"></a></span>
<span id="cb44-39"><a href="#cb44-39"></a><span class="in">```{r}</span></span>
<span id="cb44-40"><a href="#cb44-40"></a><span class="co">#| echo: false</span></span>
<span id="cb44-41"><a href="#cb44-41"></a></span>
<span id="cb44-42"><a href="#cb44-42"></a>frauds <span class="sc">|&gt;</span> </span>
<span id="cb44-43"><a href="#cb44-43"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb44-44"><a href="#cb44-44"></a><span class="in">```</span></span>
<span id="cb44-45"><a href="#cb44-45"></a></span>
<span id="cb44-46"><a href="#cb44-46"></a>If you were to try to run this code:</span>
<span id="cb44-47"><a href="#cb44-47"></a></span>
<span id="cb44-50"><a href="#cb44-50"></a><span class="in">```{r}</span></span>
<span id="cb44-51"><a href="#cb44-51"></a><span class="co">#| eval: false</span></span>
<span id="cb44-52"><a href="#cb44-52"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-53"><a href="#cb44-53"></a></span>
<span id="cb44-54"><a href="#cb44-54"></a><span class="fu">select</span>(frauds, offense_category)</span>
<span id="cb44-55"><a href="#cb44-55"></a><span class="in">```</span></span>
<span id="cb44-56"><a href="#cb44-56"></a></span>
<span id="cb44-57"><a href="#cb44-57"></a></span>
<span id="cb44-58"><a href="#cb44-58"></a>You can see that R produces an error message saying something like:</span>
<span id="cb44-59"><a href="#cb44-59"></a></span>
<span id="cb44-62"><a href="#cb44-62"></a><span class="in">```{r}</span></span>
<span id="cb44-63"><a href="#cb44-63"></a><span class="co">#| echo: false</span></span>
<span id="cb44-64"><a href="#cb44-64"></a><span class="co">#| error: true</span></span>
<span id="cb44-65"><a href="#cb44-65"></a></span>
<span id="cb44-66"><a href="#cb44-66"></a><span class="fu">select</span>(frauds, offense_category)</span>
<span id="cb44-67"><a href="#cb44-67"></a><span class="in">```</span></span>
<span id="cb44-68"><a href="#cb44-68"></a></span>
<span id="cb44-69"><a href="#cb44-69"></a>In this case it is fairly easy to identify that one of the columns you have tried to select does not exist. Maybe you mis-remembered the name of the column. To find out what the correct column name is, you can either print the first few rows of the object (by typing the code <span class="in">`head(frauds)`</span> into the R console) or use the <span class="in">`names()`</span> function to print a list of column names present in the data:</span>
<span id="cb44-70"><a href="#cb44-70"></a></span>
<span id="cb44-73"><a href="#cb44-73"></a><span class="in">```{r}</span></span>
<span id="cb44-74"><a href="#cb44-74"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-75"><a href="#cb44-75"></a></span>
<span id="cb44-76"><a href="#cb44-76"></a><span class="fu">names</span>(frauds)</span>
<span id="cb44-77"><a href="#cb44-77"></a><span class="in">```</span></span>
<span id="cb44-78"><a href="#cb44-78"></a></span>
<span id="cb44-79"><a href="#cb44-79"></a></span>
<span id="cb44-80"><a href="#cb44-80"></a>From this, we can see that the column we want to select is called <span class="in">`offense_type`</span>, not <span class="in">`offense_category`</span>.</span>
<span id="cb44-81"><a href="#cb44-81"></a></span>
<span id="cb44-82"><a href="#cb44-82"></a>Other errors will be harder to identify and fix. In this chapter we will go through the process of debugging -- identifying, understanding and fixing errors in your code. Sometimes fixing issues with your code can feel like a bit of a roller coaster, but (like most things) it becomes much easier with practice, and if you approach errors in a systematic way.</span>
<span id="cb44-83"><a href="#cb44-83"></a></span>
<span id="cb44-84"><a href="#cb44-84"></a>&lt;p class="full-width-image"&gt;&lt;img src="../images/debugging.jpg" alt="Cartoon showing 10 furry monsters showing different stages of learning to debug code. The monsters are marked '1. I got this', '2. Huh, really though that was it', '3. (...)', '4. Fine. Restarting.', '5. OH WTF', '6. Zombie meltdown', '7. [crying]', '8. A NEW HOPE!', '9. [insert awesome theme song]' and '10. I LOVE CODING!'"&gt;&lt;/p&gt;</span>
<span id="cb44-85"><a href="#cb44-85"></a></span>
<span id="cb44-86"><a href="#cb44-86"></a></span>
<span id="cb44-87"><a href="#cb44-87"></a></span>
<span id="cb44-88"><a href="#cb44-88"></a><span class="fu">## Errors, warnings and messages</span></span>
<span id="cb44-89"><a href="#cb44-89"></a></span>
<span id="cb44-90"><a href="#cb44-90"></a>When something is not quite right, or just when there is an issue in your code that you should be aware of, R has three ways of communicating with you: messages, warnings and errors. </span>
<span id="cb44-91"><a href="#cb44-91"></a></span>
<span id="cb44-92"><a href="#cb44-92"></a></span>
<span id="cb44-93"><a href="#cb44-93"></a><span class="fu">### Messages</span></span>
<span id="cb44-94"><a href="#cb44-94"></a></span>
<span id="cb44-95"><a href="#cb44-95"></a>*Messages* are usually for information only and typically don't require you to take any action. For example, the function <span class="in">`get_crime_data()`</span> from the <span class="in">`crimedata`</span> package issues a message to tell you what data it is downloading. It does this because downloading data sometimes takes a few seconds and without a message you might wonder if the code was working.</span>
<span id="cb44-96"><a href="#cb44-96"></a></span>
<span id="cb44-97"><a href="#cb44-97"></a>By default, messages are displayed in RStudio in &lt;span style="color: rgb(197, 6, 11); background-color: #FFFFFF; font-family: monospace; font-weight: normal;"&gt;dark red text&lt;/span&gt;, although this might vary if you have changed any settings in the Appearance tab of the RStudio Options dialogue. You can generate a message for yourself using the <span class="in">`message()`</span> function. This is useful if you are writing code and you want to remind yourself of something, or record a particular value. For example, if your code is likely to take a long time to run, you might want to record the time your code started running by generating a message on the first line of your code:</span>
<span id="cb44-98"><a href="#cb44-98"></a></span>
<span id="cb44-101"><a href="#cb44-101"></a><span class="in">```{r}</span></span>
<span id="cb44-102"><a href="#cb44-102"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-103"><a href="#cb44-103"></a></span>
<span id="cb44-104"><a href="#cb44-104"></a><span class="fu">message</span>(<span class="fu">str_glue</span>(<span class="st">"Code started: {now()}"</span>))</span>
<span id="cb44-105"><a href="#cb44-105"></a><span class="in">```</span></span>
<span id="cb44-106"><a href="#cb44-106"></a></span>
<span id="cb44-107"><a href="#cb44-107"></a>When R prints a message about your code, any code underneath the code that generated the message will still run. For example, if you run these three lines of code (the second of which prints a message), the line after the message will run as expected:</span>
<span id="cb44-108"><a href="#cb44-108"></a></span>
<span id="cb44-111"><a href="#cb44-111"></a><span class="in">```{r}</span></span>
<span id="cb44-112"><a href="#cb44-112"></a><span class="co">#| eval: false</span></span>
<span id="cb44-113"><a href="#cb44-113"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-114"><a href="#cb44-114"></a></span>
<span id="cb44-115"><a href="#cb44-115"></a><span class="dv">2</span> <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb44-116"><a href="#cb44-116"></a><span class="fu">message</span>(<span class="st">"This is a message. It might be important so make sure you understand it."</span>)</span>
<span id="cb44-117"><a href="#cb44-117"></a><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb44-118"><a href="#cb44-118"></a><span class="in">```</span></span>
<span id="cb44-119"><a href="#cb44-119"></a></span>
<span id="cb44-122"><a href="#cb44-122"></a><span class="in">```{r}</span></span>
<span id="cb44-123"><a href="#cb44-123"></a><span class="co">#| echo: false</span></span>
<span id="cb44-124"><a href="#cb44-124"></a></span>
<span id="cb44-125"><a href="#cb44-125"></a><span class="dv">2</span> <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb44-126"><a href="#cb44-126"></a><span class="fu">message</span>(<span class="st">"This is a message. It might be important so make sure you understand it."</span>)</span>
<span id="cb44-127"><a href="#cb44-127"></a><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb44-128"><a href="#cb44-128"></a><span class="in">```</span></span>
<span id="cb44-129"><a href="#cb44-129"></a></span>
<span id="cb44-130"><a href="#cb44-130"></a></span>
<span id="cb44-131"><a href="#cb44-131"></a><span class="fu">### Warnings</span></span>
<span id="cb44-132"><a href="#cb44-132"></a></span>
<span id="cb44-133"><a href="#cb44-133"></a>*Warnings* are generated when there is a potential problem with your code, but the problem was not serious enough to stop your code running entirely. For example, ggplot2 functions like <span class="in">`geom_point()`</span> will send a warning if some of the rows in your data contain missing values (e.g. if some crimes have missing co-ordinates).</span>
<span id="cb44-134"><a href="#cb44-134"></a></span>
<span id="cb44-135"><a href="#cb44-135"></a>Warnings are important and you should take time to read and understand them, but it is _possible_ that having done so it will be safe to not take any action. *Whether* it is safe to take no action will often depend on exactly what you are trying to do, which is why it is important that you understand each warning that you see. For example, if you already know that some rows in your data contain missing values and are happy to plot the remaining values, it will be safe to ignore the warning produced by <span class="in">`geom_point()`</span>. But if your dataset should not have any missing values in it, you will need to investigate why <span class="in">`geom_point()`</span> is warning you about missing values and whether those values have been accidentally introduced by some part of your code.</span>
<span id="cb44-136"><a href="#cb44-136"></a></span>
<span id="cb44-137"><a href="#cb44-137"></a></span>
<span id="cb44-138"><a href="#cb44-138"></a>::: {.callout-important}</span>
<span id="cb44-139"><a href="#cb44-139"></a><span class="fu">#### It is not safe to ignore warnings</span></span>
<span id="cb44-140"><a href="#cb44-140"></a></span>
<span id="cb44-141"><a href="#cb44-141"></a>**It is not safe to ignore warnings** unless you are sure why they occurred and certain that you don't need to take any action. If your code produces a warning, it is not safe to 'leave it until later' and carry on writing the rest of your code: work out straight away if you need to take any action.</span>
<span id="cb44-142"><a href="#cb44-142"></a></span>
<span id="cb44-143"><a href="#cb44-143"></a>One particularly dangerous scenario is where your code produces warnings but still produces what looks like a reasonable result. In these circumstances it can be tempting to ignore the warnings and assume that everything is fine, since the code still produced roughly what you were expecting. However, it's possible that the plausible answer is nevertheless wrong because of whatever problem is generating the warning in R. Do not assume that warnings are safe to ignore just because they don't stop your code running.</span>
<span id="cb44-144"><a href="#cb44-144"></a></span>
<span id="cb44-145"><a href="#cb44-145"></a>:::</span>
<span id="cb44-146"><a href="#cb44-146"></a></span>
<span id="cb44-147"><a href="#cb44-147"></a></span>
<span id="cb44-148"><a href="#cb44-148"></a>Warnings are displayed in the same font as messages, but with the text <span class="in">`Warning:`</span> at the start. You can generate your own warning messages using the <span class="in">`warning()`</span> function:</span>
<span id="cb44-149"><a href="#cb44-149"></a></span>
<span id="cb44-152"><a href="#cb44-152"></a><span class="in">```{r}</span></span>
<span id="cb44-153"><a href="#cb44-153"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-154"><a href="#cb44-154"></a></span>
<span id="cb44-155"><a href="#cb44-155"></a><span class="fu">warning</span>(<span class="st">"Something might be wrong. Check to make sure."</span>)</span>
<span id="cb44-156"><a href="#cb44-156"></a><span class="in">```</span></span>
<span id="cb44-157"><a href="#cb44-157"></a></span>
<span id="cb44-158"><a href="#cb44-158"></a>As with messages, warnings will not stop your code running. This means that if the warning signalled a genuine problem with your code, the results of the lines underneath the warning might not be reliable. That is why it is important to understand warnings when you see them.</span>
<span id="cb44-159"><a href="#cb44-159"></a></span>
<span id="cb44-160"><a href="#cb44-160"></a></span>
<span id="cb44-161"><a href="#cb44-161"></a><span class="fu">### Errors</span></span>
<span id="cb44-162"><a href="#cb44-162"></a></span>
<span id="cb44-163"><a href="#cb44-163"></a>*Errors* are generated when there is something wrong with your code or the results it produces that means the code cannot continue running any further. An error might occur, for example, because the function <span class="in">`read_csv()`</span> could not open the requested file (maybe because the file does not exist). In this case, it would make no sense for the rest of the code to run because it probably depends on the data that <span class="in">`read_csv()`</span> was supposed to load but could not.</span>
<span id="cb44-164"><a href="#cb44-164"></a></span>
<span id="cb44-165"><a href="#cb44-165"></a>It would make sense to be able to generate your own errors using the <span class="in">`error()`</span> function, but this is one of those times when the function to do something in R has a different name from that you might be expecting. In fact, you can generate an error using the <span class="in">`stop()`</span> function:</span>
<span id="cb44-166"><a href="#cb44-166"></a></span>
<span id="cb44-169"><a href="#cb44-169"></a><span class="in">```{r}</span></span>
<span id="cb44-170"><a href="#cb44-170"></a><span class="co">#| error: true</span></span>
<span id="cb44-171"><a href="#cb44-171"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-172"><a href="#cb44-172"></a></span>
<span id="cb44-173"><a href="#cb44-173"></a><span class="fu">stop</span>(<span class="st">"Something is defintely wrong. Don't go any further until you've fixed it."</span>)</span>
<span id="cb44-174"><a href="#cb44-174"></a><span class="in">```</span></span>
<span id="cb44-175"><a href="#cb44-175"></a></span>
<span id="cb44-176"><a href="#cb44-176"></a>There are two types of errors in R: _syntax_ errors and _logical_ errors. Syntax errors happen when R cannot read your code because of a mistake in how it has been typed out. For example, if you forget to put a comma between the arguments of a function, you will get this error:</span>
<span id="cb44-177"><a href="#cb44-177"></a></span>
<span id="cb44-180"><a href="#cb44-180"></a><span class="in">```{r}</span></span>
<span id="cb44-181"><a href="#cb44-181"></a><span class="co">#| error: true</span></span>
<span id="cb44-182"><a href="#cb44-182"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-183"><a href="#cb44-183"></a></span>
<span id="cb44-184"><a href="#cb44-184"></a><span class="fu">message</span>(<span class="st">"A"</span> <span class="st">"B"</span>)</span>
<span id="cb44-185"><a href="#cb44-185"></a><span class="in">```</span></span>
<span id="cb44-186"><a href="#cb44-186"></a></span>
<span id="cb44-187"><a href="#cb44-187"></a>This error is caused by a missing comma between <span class="in">`"A"`</span> and <span class="in">`"B"`</span>.</span>
<span id="cb44-188"><a href="#cb44-188"></a></span>
<span id="cb44-189"><a href="#cb44-189"></a>When you run R code, R reads all the code and checks if it can be interpreted as valid R code. If not, R will produce a syntax error. Because all of your code is checked for syntax errors before any code is actually run, a syntax error _anywhere_ in your code will stop _all_ of your code running. Syntax errors are typically fairly easy to fix, because they are usually caused by typos.</span>
<span id="cb44-190"><a href="#cb44-190"></a></span>
<span id="cb44-191"><a href="#cb44-191"></a>The second type of error that can happen is a logical error. This happens when R is able to interpret what you have written, but something is wrong with what you have asked it to do. These are called logical errors because there is usually some problem with the logic of what you are asking R to do. Like syntax errors, logical errors can be caused by typos, but logical errors can also have many other causes.</span>
<span id="cb44-192"><a href="#cb44-192"></a></span>
<span id="cb44-193"><a href="#cb44-193"></a>There is a saying in programming that a computer will do exactly what you tell it to do, which may not be the same thing as what you _wanted_ it do. Logical errors happen when you have told R to do something that it cannot do. For example, you might be asking R to multiply together a numeric value and a character value (e.g. <span class="in">`3 * "A"`</span>), which is illogical.</span>
<span id="cb44-194"><a href="#cb44-194"></a></span>
<span id="cb44-195"><a href="#cb44-195"></a>Since every step in your code depends on the steps that went before it, it is only possible to identify a logical error during the process of running the code. This means that a lot of your code might run successfully before an error occurs.</span>
<span id="cb44-196"><a href="#cb44-196"></a></span>
<span id="cb44-197"><a href="#cb44-197"></a>Logical errors are typically harder to fix than syntax errors are, because fixing a logical error involves understanding (a) what you have asked R to do and (b) the current state of everything in your code at the moment when the error occurs. Fortunately, there are lots of ways to identify and fix logical errors.</span>
<span id="cb44-198"><a href="#cb44-198"></a></span>
<span id="cb44-199"><a href="#cb44-199"></a>Now we know what errors, warning and messages are, we need to find out how to deal with them when they happen.</span>
<span id="cb44-200"><a href="#cb44-200"></a></span>
<span id="cb44-201"><a href="#cb44-201"></a></span>
<span id="cb44-202"><a href="#cb44-202"></a>::: {.callout-quiz .callout}</span>
<span id="cb44-203"><a href="#cb44-203"></a><span class="fu">#### Messages, warnings and errors</span></span>
<span id="cb44-204"><a href="#cb44-204"></a></span>
<span id="cb44-205"><a href="#cb44-205"></a><span class="in">```{r messages-quiz}</span></span>
<span id="cb44-206"><a href="#cb44-206"></a><span class="in">#| echo: false</span></span>
<span id="cb44-207"><a href="#cb44-207"></a></span>
<span id="cb44-208"><a href="#cb44-208"></a><span class="in">messages_quiz1 &lt;- c(</span></span>
<span id="cb44-209"><a href="#cb44-209"></a><span class="in">  answer = "A message",</span></span>
<span id="cb44-210"><a href="#cb44-210"></a><span class="in">  "A warning",</span></span>
<span id="cb44-211"><a href="#cb44-211"></a><span class="in">  "An error",</span></span>
<span id="cb44-212"><a href="#cb44-212"></a><span class="in">  "A condition"</span></span>
<span id="cb44-213"><a href="#cb44-213"></a><span class="in">)</span></span>
<span id="cb44-214"><a href="#cb44-214"></a></span>
<span id="cb44-215"><a href="#cb44-215"></a><span class="in">messages_quiz2 &lt;- c(</span></span>
<span id="cb44-216"><a href="#cb44-216"></a><span class="in">  "It is generally okay not to worry about warnings produced by R code -- in most cases you won't need to take any action anyway",</span></span>
<span id="cb44-217"><a href="#cb44-217"></a><span class="in">  answer = "While you will often not need to take any action in response to a warning produced by your R code, it is still important to understand what caused the warning just in case you need to take action"</span></span>
<span id="cb44-218"><a href="#cb44-218"></a><span class="in">)</span></span>
<span id="cb44-219"><a href="#cb44-219"></a><span class="in">```</span></span>
<span id="cb44-220"><a href="#cb44-220"></a></span>
<span id="cb44-221"><a href="#cb44-221"></a></span>
<span id="cb44-222"><a href="#cb44-222"></a>**Which of the following terms is used in R to describe the way of communicating something for information only?**</span>
<span id="cb44-223"><a href="#cb44-223"></a></span>
<span id="cb44-224"><a href="#cb44-224"></a><span class="in">`r webexercises::longmcq(messages_quiz1)`</span></span>
<span id="cb44-225"><a href="#cb44-225"></a></span>
<span id="cb44-226"><a href="#cb44-226"></a></span>
<span id="cb44-227"><a href="#cb44-227"></a>**Which of these statements is true?**</span>
<span id="cb44-228"><a href="#cb44-228"></a></span>
<span id="cb44-229"><a href="#cb44-229"></a><span class="in">`r webexercises::longmcq(messages_quiz2)`</span></span>
<span id="cb44-230"><a href="#cb44-230"></a></span>
<span id="cb44-231"><a href="#cb44-231"></a></span>
<span id="cb44-232"><a href="#cb44-232"></a>:::</span>
<span id="cb44-233"><a href="#cb44-233"></a></span>
<span id="cb44-234"><a href="#cb44-234"></a></span>
<span id="cb44-235"><a href="#cb44-235"></a></span>
<span id="cb44-236"><a href="#cb44-236"></a><span class="fu">## Finding problems</span></span>
<span id="cb44-237"><a href="#cb44-237"></a></span>
<span id="cb44-238"><a href="#cb44-238"></a>If an error or warning has a simple cause, such as the example of the incorrect column name in the previous section, you can just fix the problem and re-run the code. For problems that are more difficult to handle, you will need to follow a step-by-step process to find and fix them. Think of this as like being a mechanic fixing a car -- first you work out what the problem is, then you fix it.</span>
<span id="cb44-239"><a href="#cb44-239"></a></span>
<span id="cb44-240"><a href="#cb44-240"></a>If you code only has one line, it will probably be obvious where any problem lies. But most of your code does several things to achieve a particular goal, such as making a map. The first task in dealing with a problem is therefore to work out exactly which function or other piece of code has caused it. For example, take this data-wrangling code to reduce the size of a dataset and sort it in date order:</span>
<span id="cb44-241"><a href="#cb44-241"></a></span>
<span id="cb44-244"><a href="#cb44-244"></a><span class="in">```{r}</span></span>
<span id="cb44-245"><a href="#cb44-245"></a><span class="co">#| error: true</span></span>
<span id="cb44-246"><a href="#cb44-246"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-247"><a href="#cb44-247"></a></span>
<span id="cb44-248"><a href="#cb44-248"></a>frauds <span class="sc">|&gt;</span> </span>
<span id="cb44-249"><a href="#cb44-249"></a>  <span class="fu">select</span>(offense_type, date, longitude, latitude) <span class="sc">|&gt;</span> </span>
<span id="cb44-250"><a href="#cb44-250"></a>  <span class="fu">filter</span>(offence_type <span class="sc">==</span> <span class="st">"impersonation"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb44-251"><a href="#cb44-251"></a>  <span class="fu">arrange</span>(date)</span>
<span id="cb44-252"><a href="#cb44-252"></a><span class="in">```</span></span>
<span id="cb44-253"><a href="#cb44-253"></a></span>
<span id="cb44-254"><a href="#cb44-254"></a>This code produces a fairly complicated error message. As is often the case, the</span>
<span id="cb44-255"><a href="#cb44-255"></a>most useful part of the error message is the last part: </span>
<span id="cb44-256"><a href="#cb44-256"></a></span>
<span id="cb44-257"><a href="#cb44-257"></a><span class="in">```</span></span>
<span id="cb44-258"><a href="#cb44-258"></a><span class="in">! object 'offence_type' not found</span></span>
<span id="cb44-259"><a href="#cb44-259"></a><span class="in">```</span></span>
<span id="cb44-260"><a href="#cb44-260"></a></span>
<span id="cb44-261"><a href="#cb44-261"></a>This suggests the error is on line 3 of the code, since that is the only line containing reference to the object <span class="in">`offence_type`</span>. To check this, we can *comment out* that line by placing a <span class="in">`#`</span> symbol at the start of the line. Do this and re-run the code above -- it should now run without a problem.</span>
<span id="cb44-262"><a href="#cb44-262"></a></span>
<span id="cb44-263"><a href="#cb44-263"></a>Now we know the problem is on the line <span class="in">`filter(offence_type == "impersonation")`</span>, we can look at that line in more detail. Can you spot the problem with that line?</span>
<span id="cb44-264"><a href="#cb44-264"></a></span>
<span id="cb44-265"><a href="#cb44-265"></a>The error message in this case has been caused by a typo -- the code <span class="in">`offence_type == "impersonation"`</span> uses the British spelling of the word 'offence' but in the dataset the variable is spelled using the American English 'offense' (you can see the US spelling in the line of code above the line that is causing the error). Fix the typo and re-run the code above in RStudio.</span>
<span id="cb44-266"><a href="#cb44-266"></a></span>
<span id="cb44-267"><a href="#cb44-267"></a>Sometimes it will not be as clear as this where to start in looking for the problem. In particular, some errors can be _caused_ by a problem on one line of code, but only actually have a negative _effect_ on a subsequent line of code. For example, if you run this code you will see an error:</span>
<span id="cb44-268"><a href="#cb44-268"></a></span>
<span id="cb44-271"><a href="#cb44-271"></a><span class="in">```{r}</span></span>
<span id="cb44-272"><a href="#cb44-272"></a><span class="co">#| error: true</span></span>
<span id="cb44-273"><a href="#cb44-273"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-274"><a href="#cb44-274"></a></span>
<span id="cb44-275"><a href="#cb44-275"></a>frauds <span class="sc">|&gt;</span> </span>
<span id="cb44-276"><a href="#cb44-276"></a>  <span class="fu">select</span>(offense_code, longitude, latitude) <span class="sc">|&gt;</span> </span>
<span id="cb44-277"><a href="#cb44-277"></a>  <span class="fu">filter</span>(offense_code <span class="sc">==</span> <span class="st">"26E"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb44-278"><a href="#cb44-278"></a>  <span class="fu">arrange</span>(date)</span>
<span id="cb44-279"><a href="#cb44-279"></a><span class="in">```</span></span>
<span id="cb44-280"><a href="#cb44-280"></a></span>
<span id="cb44-281"><a href="#cb44-281"></a>The error message produced suggests the problem is with the <span class="in">`arrange()`</span> function, but everything is correct with that function since <span class="in">`arrange()`</span> is a correct function name and we already know that <span class="in">`date`</span> is a column in the tibble named <span class="in">`frauds`</span>. So the problem must lie elsewhere. In cases like this, it can be helpful to comment out all the lines of code except the first one and then uncomment one line at a time until you find the one that causes the problem. </span>
<span id="cb44-282"><a href="#cb44-282"></a></span>
<span id="cb44-283"><a href="#cb44-283"></a>Re-run the code above, but comment out all the lines except the first one by putting <span class="in">`# `</span> at the start of each line. Remember to remove the <span class="in">`|&gt;`</span> from the end of the last _uncommented_ line of code, since otherwise you will find the code does not run as expected. Your code should now look like this:</span>
<span id="cb44-284"><a href="#cb44-284"></a></span>
<span id="cb44-287"><a href="#cb44-287"></a><span class="in">```{r}</span></span>
<span id="cb44-288"><a href="#cb44-288"></a><span class="co">#| eval: false</span></span>
<span id="cb44-289"><a href="#cb44-289"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-290"><a href="#cb44-290"></a></span>
<span id="cb44-291"><a href="#cb44-291"></a>frauds</span>
<span id="cb44-292"><a href="#cb44-292"></a>  <span class="co"># select(offense_code, longitude, latitude) |&gt; </span></span>
<span id="cb44-293"><a href="#cb44-293"></a>  <span class="co"># filter(offense_code == "26E") |&gt; </span></span>
<span id="cb44-294"><a href="#cb44-294"></a>  <span class="co"># arrange(date)</span></span>
<span id="cb44-295"><a href="#cb44-295"></a><span class="in">```</span></span>
<span id="cb44-296"><a href="#cb44-296"></a></span>
<span id="cb44-297"><a href="#cb44-297"></a>If you run this code, it will simply print the first few lines of the dataset. Remove the <span class="in">`# `</span> comment symbol from the second line of the code and run it again, remembering to replace the pipe operator (<span class="in">`|&gt;`</span>) at the end of line 1 and remove the <span class="in">`|&gt;`</span> at the end of line 2.</span>
<span id="cb44-298"><a href="#cb44-298"></a></span>
<span id="cb44-301"><a href="#cb44-301"></a><span class="in">```{r}</span></span>
<span id="cb44-302"><a href="#cb44-302"></a><span class="co">#| eval: false</span></span>
<span id="cb44-303"><a href="#cb44-303"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-304"><a href="#cb44-304"></a></span>
<span id="cb44-305"><a href="#cb44-305"></a>frauds <span class="sc">|&gt;</span> </span>
<span id="cb44-306"><a href="#cb44-306"></a>  <span class="fu">select</span>(offense_code, longitude, latitude)</span>
<span id="cb44-307"><a href="#cb44-307"></a>  <span class="co"># filter(offense_code == "26E") |&gt; </span></span>
<span id="cb44-308"><a href="#cb44-308"></a>  <span class="co"># arrange(date)</span></span>
<span id="cb44-309"><a href="#cb44-309"></a><span class="in">```</span></span>
<span id="cb44-310"><a href="#cb44-310"></a></span>
<span id="cb44-311"><a href="#cb44-311"></a>Again, the code does not produce an error -- the result is the same as before, except now the dataset has only three columns.</span>
<span id="cb44-312"><a href="#cb44-312"></a></span>
<span id="cb44-313"><a href="#cb44-313"></a>Repeat the process again by removing the comment symbol from the start of line three, replacing the pipe operators as before.</span>
<span id="cb44-314"><a href="#cb44-314"></a></span>
<span id="cb44-317"><a href="#cb44-317"></a><span class="in">```{r}</span></span>
<span id="cb44-318"><a href="#cb44-318"></a><span class="co">#| results: hold</span></span>
<span id="cb44-319"><a href="#cb44-319"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-320"><a href="#cb44-320"></a></span>
<span id="cb44-321"><a href="#cb44-321"></a>frauds <span class="sc">|&gt;</span> </span>
<span id="cb44-322"><a href="#cb44-322"></a>  <span class="fu">select</span>(offense_code, longitude, latitude) <span class="sc">|&gt;</span> </span>
<span id="cb44-323"><a href="#cb44-323"></a>  <span class="fu">filter</span>(offense_code <span class="sc">==</span> <span class="st">"26E"</span>)</span>
<span id="cb44-324"><a href="#cb44-324"></a>  <span class="co"># arrange(date)</span></span>
<span id="cb44-325"><a href="#cb44-325"></a><span class="in">```</span></span>
<span id="cb44-326"><a href="#cb44-326"></a></span>
<span id="cb44-327"><a href="#cb44-327"></a>There is still no error message, but you can see the problem: there are no rows left in the data. That's because there are no rows in the data for which the column <span class="in">`offense_code`</span> has the value "26E". If we use the <span class="in">`count()`</span> function from the dplyr package to list all the unique values of the <span class="in">`offense_code`</span> column, we'll see the only values are <span class="in">`r knitr::combine_words(map_chr(sort(unique(pull(frauds, "offense_code"))), \(x) str_glue('"{x}"')))`</span>:</span>
<span id="cb44-328"><a href="#cb44-328"></a></span>
<span id="cb44-331"><a href="#cb44-331"></a><span class="in">```{r}</span></span>
<span id="cb44-332"><a href="#cb44-332"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-333"><a href="#cb44-333"></a></span>
<span id="cb44-334"><a href="#cb44-334"></a><span class="fu">count</span>(frauds, offense_code)</span>
<span id="cb44-335"><a href="#cb44-335"></a><span class="in">```</span></span>
<span id="cb44-336"><a href="#cb44-336"></a></span>
<span id="cb44-337"><a href="#cb44-337"></a>Uncommenting one line at a time until you find an error or output that is not what you expected is a useful way to isolate problems, but it will not always work. In particular, it will not work if the problem is caused by some code that should have been included but is missing from your code entirely. For example, if you try to run the function <span class="in">`st_transform()`</span> on a tibble without first changing it into an SF object:</span>
<span id="cb44-338"><a href="#cb44-338"></a></span>
<span id="cb44-341"><a href="#cb44-341"></a><span class="in">```{r}</span></span>
<span id="cb44-342"><a href="#cb44-342"></a><span class="co">#| error: true</span></span>
<span id="cb44-343"><a href="#cb44-343"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-344"><a href="#cb44-344"></a></span>
<span id="cb44-345"><a href="#cb44-345"></a>frauds <span class="sc">|&gt;</span> </span>
<span id="cb44-346"><a href="#cb44-346"></a>  <span class="fu">select</span>(offense_code, longitude, latitude) <span class="sc">|&gt;</span> </span>
<span id="cb44-347"><a href="#cb44-347"></a>  <span class="fu">filter</span>(offense_code <span class="sc">==</span> <span class="st">"26A"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb44-348"><a href="#cb44-348"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="st">"EPSG:3603"</span>)</span>
<span id="cb44-349"><a href="#cb44-349"></a><span class="in">```</span></span>
<span id="cb44-350"><a href="#cb44-350"></a></span>
<span id="cb44-351"><a href="#cb44-351"></a>In these cases it is particularly useful to check every argument that you have used in a function to track down the error. We will look at this later in this chapter.</span>
<span id="cb44-352"><a href="#cb44-352"></a></span>
<span id="cb44-353"><a href="#cb44-353"></a></span>
<span id="cb44-354"><a href="#cb44-354"></a><span class="fu">### Errors caused by data problems</span></span>
<span id="cb44-355"><a href="#cb44-355"></a></span>
<span id="cb44-356"><a href="#cb44-356"></a>Many logical errors will be caused by problems with the code you have written, such as when you try to use a function (e.g. <span class="in">`st_intersection()`</span>) that only works on an SF object but specify that it should use an object of another type. But sometimes logical errors are caused not by your code, but by a mis-match between the structure that your data actually has and the structure you think your data has. We have already seen an example of this in this chapter, in the code that tried to refer to a column called <span class="in">`offense_category`</span> in a dataset that did not have a column with that name.</span>
<span id="cb44-357"><a href="#cb44-357"></a></span>
<span id="cb44-358"><a href="#cb44-358"></a>Errors caused by a mismatch between the data you think you have and the data you actually have can be particularly frustrating, because there is no way to identify them from just looking at your code. For this reason, it is often important when trying to identify problems in your code to _look_ at the data that is used as the input for your code, _and_ the data that is produced by each step in your code. We used this technique to find the error in our code above that was caused by <span class="in">`filter()`</span> removing all the rows from a dataset because we had told <span class="in">`filter()`</span> to only keep rows containing a value that was not present in the dataset. There were no obvious problems with the code we had written, so the only way to find the cause of this problem was to view the dataset returned by the <span class="in">`filter()`</span> function.</span>
<span id="cb44-359"><a href="#cb44-359"></a></span>
<span id="cb44-360"><a href="#cb44-360"></a>Finding data problems is one of the reasons why we have used the <span class="in">`head()`</span> function so often in previous chapters to look at the data at each step in writing a block of code. Looking at the results of a particular block of code before moving on to writing the next block can often save you from frustrating errors later on.</span>
<span id="cb44-361"><a href="#cb44-361"></a></span>
<span id="cb44-362"><a href="#cb44-362"></a><span class="in">`head()`</span> only shows us the first few rows of a dataset, which will not always be enough to identify a problem if the problem is caused by values that are only present in a few rows in the data. For small datasets, we can use the <span class="in">`View()`</span> function (note the capital letter) to open the entire dataset in a new tab in RStudio. </span>
<span id="cb44-363"><a href="#cb44-363"></a></span>
<span id="cb44-364"><a href="#cb44-364"></a>For bigger datasets, this will not work. In that case, we can use the <span class="in">`sample_n()`</span> or <span class="in">`sample_frac()`</span> functions from the dplyr package to return a random sample of rows from the data. This can be useful to let us look at a representative sample of a large dataset. <span class="in">`sample_n()`</span> returns a specific number of rows, e.g. <span class="in">`sample_n(frauds, 10)`</span> returns 10 rows at random from the <span class="in">`frauds`</span> dataset. <span class="in">`sample_frac()`</span> returns a specific proportion of the dataset, e.g. <span class="in">`sample_frac(frauds, 0.1)`</span> returns a sample of 10% of rows from</span>
<span id="cb44-365"><a href="#cb44-365"></a>the data.</span>
<span id="cb44-366"><a href="#cb44-366"></a></span>
<span id="cb44-367"><a href="#cb44-367"></a></span>
<span id="cb44-368"><a href="#cb44-368"></a></span>
<span id="cb44-369"><a href="#cb44-369"></a><span class="fu">## Understanding a problem</span></span>
<span id="cb44-370"><a href="#cb44-370"></a></span>
<span id="cb44-371"><a href="#cb44-371"></a>So far, we have tried two ways to deal with errors:</span>
<span id="cb44-372"><a href="#cb44-372"></a></span>
<span id="cb44-373"><a href="#cb44-373"></a><span class="ss">  1. </span>reading a simple error message that makes the problem obvious,</span>
<span id="cb44-374"><a href="#cb44-374"></a><span class="ss">  2. </span>commenting out all the code and then uncommenting one line a time until the error appears.</span>
<span id="cb44-375"><a href="#cb44-375"></a></span>
<span id="cb44-376"><a href="#cb44-376"></a>Sometimes you will encounter an error that is still not simple to solve. In this case, it is still important to identify the line of code causing the problem, either by working it out from the text of the error message or commenting out lines of code in turn.</span>
<span id="cb44-377"><a href="#cb44-377"></a></span>
<span id="cb44-378"><a href="#cb44-378"></a>Once you know what line is causing the problem, you should focus on understanding exactly what that line of code does. In particular:</span>
<span id="cb44-379"><a href="#cb44-379"></a></span>
<span id="cb44-380"><a href="#cb44-380"></a><span class="ss">  1. </span>What data do any functions on that line expect to work on?</span>
<span id="cb44-381"><a href="#cb44-381"></a><span class="ss">  2. </span>What are the values of any arguments to the functions on that line?</span>
<span id="cb44-382"><a href="#cb44-382"></a><span class="ss">  3. </span>What value do the functions on that line produce?</span>
<span id="cb44-383"><a href="#cb44-383"></a>  </span>
<span id="cb44-384"><a href="#cb44-384"></a>You can get a lot of help in understanding each function by referring to its manual page. You can access the manual page for a function by:</span>
<span id="cb44-385"><a href="#cb44-385"></a></span>
<span id="cb44-386"><a href="#cb44-386"></a><span class="ss">  * </span>typing a question mark followed by the function name without parentheses (e.g. <span class="in">`?mutate`</span>) into the R console,</span>
<span id="cb44-387"><a href="#cb44-387"></a><span class="ss">  * </span>typing the function name without parentheses into the search box in the Help panel in RStudio, or</span>
<span id="cb44-388"><a href="#cb44-388"></a><span class="ss">  * </span>clicking on the function name anywhere in your R code to place the cursor on the function name, then pressing <span class="in">`F1`</span> on your keyboard.</span>
<span id="cb44-389"><a href="#cb44-389"></a></span>
<span id="cb44-390"><a href="#cb44-390"></a>Any of these options opens up a manual page for that function in the Help panel in RStudio. For example, this is the manual page for the <span class="in">`str_wrap()`</span> function from the <span class="in">`stringr`</span> package. You can load it by typing <span class="in">`?str_wrap`</span> in the R console.</span>
<span id="cb44-391"><a href="#cb44-391"></a></span>
<span id="cb44-392"><a href="#cb44-392"></a></span>
<span id="cb44-393"><a href="#cb44-393"></a>&lt;p class="full-width-image"&gt;&lt;img src="../images/man_page.png" alt="Screenshot of the R manual page for the "&gt;&lt;/p&gt;</span>
<span id="cb44-394"><a href="#cb44-394"></a></span>
<span id="cb44-395"><a href="#cb44-395"></a></span>
<span id="cb44-396"><a href="#cb44-396"></a>All manual pages have the same format.</span>
<span id="cb44-397"><a href="#cb44-397"></a></span>
<span id="cb44-398"><a href="#cb44-398"></a>Description </span>
<span id="cb44-399"><a href="#cb44-399"></a>: This section gives a short description of what the function does. If multiple related functions are described in a single manual page, this section will explain the differences between them. For example, the manual page for the <span class="in">`mutate()`</span> function from the <span class="in">`dplyr`</span> package explains the difference between the <span class="in">`mutate()`</span> function and the closely related <span class="in">`transmute()`</span> function.</span>
<span id="cb44-400"><a href="#cb44-400"></a></span>
<span id="cb44-401"><a href="#cb44-401"></a>Usage </span>
<span id="cb44-402"><a href="#cb44-402"></a>: This section shows a single example of how the function works. If there are any optional arguments to the function, this section will show what the default values of those optional arguments are. For example, the manual page for the <span class="in">`str_wrap()`</span> function from the <span class="in">`stringr`</span> package show that the default value of the <span class="in">`width`</span> argument is <span class="in">`width = 80`</span>.</span>
<span id="cb44-403"><a href="#cb44-403"></a></span>
<span id="cb44-404"><a href="#cb44-404"></a>Arguments</span>
<span id="cb44-405"><a href="#cb44-405"></a>: This section gives a list of arguments and the values they can take. It is particularly important to note the type of value expected. So the <span class="in">`st_transform()`</span> function from the <span class="in">`sf`</span> package expects an SF object as its first argument -- if you provide another sort of object (such as a tibble), this will cause an error.</span>
<span id="cb44-406"><a href="#cb44-406"></a></span>
<span id="cb44-407"><a href="#cb44-407"></a>Value</span>
<span id="cb44-408"><a href="#cb44-408"></a>: This section explains the type of value that the function will return, and whether this value might be of a different type depending on the values of particular arguments. For example, the <span class="in">`mean()`</span> function in base R returns the arithmetic mean of a vector of numbers. However, if any of the numbers is <span class="in">`NA`</span> then mean will return <span class="in">`NA`</span> *unless* the argument <span class="in">`na.rm = TRUE`</span> is used. In that case, <span class="in">`mean()`</span> will ignore the missing values and return the mean of the values that are present.</span>
<span id="cb44-409"><a href="#cb44-409"></a></span>
<span id="cb44-410"><a href="#cb44-410"></a>Examples</span>
<span id="cb44-411"><a href="#cb44-411"></a>: This section gives more examples of how the function can be used.</span>
<span id="cb44-412"><a href="#cb44-412"></a></span>
<span id="cb44-413"><a href="#cb44-413"></a>Checking the manual page for a function can often help you understand why a particular piece of code is not working. If you have set any optional arguments for a function that is producing an error, it may help to reset those arguments to their default values (as shown in the Usage section of the manual page) one by one to understand what effect this has on your code.</span>
<span id="cb44-414"><a href="#cb44-414"></a></span>
<span id="cb44-415"><a href="#cb44-415"></a>By reading the error message, isolating the error by commenting out and then reading the manual page, you will be able to fix almost all the errors you will come across in writing R code. Occasionally, however, you will find an error that you just can't understand. In that case, you will need to get some help from others.</span>
<span id="cb44-416"><a href="#cb44-416"></a></span>
<span id="cb44-417"><a href="#cb44-417"></a></span>
<span id="cb44-418"><a href="#cb44-418"></a></span>
<span id="cb44-419"><a href="#cb44-419"></a><span class="fu">## How to fix some common errors</span></span>
<span id="cb44-420"><a href="#cb44-420"></a></span>
<span id="cb44-421"><a href="#cb44-421"></a>There are some mistakes that it is common for people to make when writing code. As you get more experience in writing R code and dealing with error messages, you are likely to start to recognise some simple errors (especially those caused by typos) and know how to fix them quickly. One useful way to quickly find help on common errors is to check if the error (and the corresponding solution) appears in @sec-common-errors. Use the information in @sec-common-errors to answer these questions.</span>
<span id="cb44-422"><a href="#cb44-422"></a></span>
<span id="cb44-423"><a href="#cb44-423"></a></span>
<span id="cb44-424"><a href="#cb44-424"></a>::: {.callout-quiz .callout}</span>
<span id="cb44-425"><a href="#cb44-425"></a><span class="fu">#### Fixing common errors</span></span>
<span id="cb44-426"><a href="#cb44-426"></a></span>
<span id="cb44-427"><a href="#cb44-427"></a><span class="in">```{r common-errors-quiz}</span></span>
<span id="cb44-428"><a href="#cb44-428"></a><span class="in">#| echo: false</span></span>
<span id="cb44-429"><a href="#cb44-429"></a></span>
<span id="cb44-430"><a href="#cb44-430"></a><span class="in">common_errors_quiz1 &lt;- c(</span></span>
<span id="cb44-431"><a href="#cb44-431"></a><span class="in">  "You have loaded packages in the wrong order",</span></span>
<span id="cb44-432"><a href="#cb44-432"></a><span class="in">  "You have mis-typed the name of the `blah` object",</span></span>
<span id="cb44-433"><a href="#cb44-433"></a><span class="in">  answer = "You have not loaded the package that contains the `blah()` function",</span></span>
<span id="cb44-434"><a href="#cb44-434"></a><span class="in">  "You have tried to use a generic function with a type of object the function does not know how to use"</span></span>
<span id="cb44-435"><a href="#cb44-435"></a><span class="in">)</span></span>
<span id="cb44-436"><a href="#cb44-436"></a></span>
<span id="cb44-437"><a href="#cb44-437"></a><span class="in">common_errors_quiz2 &lt;- c(</span></span>
<span id="cb44-438"><a href="#cb44-438"></a><span class="in">  "You have tried to use a function as if it is an object",</span></span>
<span id="cb44-439"><a href="#cb44-439"></a><span class="in">  answer = "You have tried to use a mathematical operator such as `+` or `-` with a non-numeric value such as a character value",</span></span>
<span id="cb44-440"><a href="#cb44-440"></a><span class="in">  "You have used an argument name in a function that does not understand it",</span></span>
<span id="cb44-441"><a href="#cb44-441"></a><span class="in">  "You have either mis-typed the function name or the package containing that function is not loaded"</span></span>
<span id="cb44-442"><a href="#cb44-442"></a><span class="in">)</span></span>
<span id="cb44-443"><a href="#cb44-443"></a><span class="in">```</span></span>
<span id="cb44-444"><a href="#cb44-444"></a></span>
<span id="cb44-445"><a href="#cb44-445"></a></span>
<span id="cb44-446"><a href="#cb44-446"></a>**What might cause the error message `could not find function "blah"`?**</span>
<span id="cb44-447"><a href="#cb44-447"></a></span>
<span id="cb44-448"><a href="#cb44-448"></a><span class="in">`r webexercises::longmcq(common_errors_quiz1)`</span></span>
<span id="cb44-449"><a href="#cb44-449"></a></span>
<span id="cb44-450"><a href="#cb44-450"></a></span>
<span id="cb44-451"><a href="#cb44-451"></a>**What might cause the error message `non-numeric argument to binary operator`?**</span>
<span id="cb44-452"><a href="#cb44-452"></a></span>
<span id="cb44-453"><a href="#cb44-453"></a><span class="in">`r webexercises::longmcq(common_errors_quiz2)`</span></span>
<span id="cb44-454"><a href="#cb44-454"></a></span>
<span id="cb44-455"><a href="#cb44-455"></a></span>
<span id="cb44-456"><a href="#cb44-456"></a>:::</span>
<span id="cb44-457"><a href="#cb44-457"></a></span>
<span id="cb44-458"><a href="#cb44-458"></a></span>
<span id="cb44-459"><a href="#cb44-459"></a></span>
<span id="cb44-460"><a href="#cb44-460"></a><span class="fu">## Getting external help using a reproducible example {#sec-reprex}</span></span>
<span id="cb44-461"><a href="#cb44-461"></a></span>
<span id="cb44-462"><a href="#cb44-462"></a>If you cannot fix an error using any of the techniques we have already covered, it is probably time to get some help from others. Fortunately, one of the big benefits of using R is that there is a friendly, welcoming community of R coders online who are willing to help fix problems. Almost everyone in this community will remember when they were knew to using R and so will be gentle with people who are asking their first question.</span>
<span id="cb44-463"><a href="#cb44-463"></a></span>
<span id="cb44-464"><a href="#cb44-464"></a>&lt;img src="../images/code_hero.jpg" style="width: 60%; max-width: 500px; float: right; margin: 0 0 2em 2em;"&gt;</span>
<span id="cb44-465"><a href="#cb44-465"></a></span>
<span id="cb44-466"><a href="#cb44-466"></a>One of the things that makes it much more likely that you will find help with your problem in the R community is if you phrase your plea for help in a way that makes it easier to help you. We can do this by providing a *reproducible example* of our problem (also sometimes called a *reprex* or a *minimum working example*).</span>
<span id="cb44-467"><a href="#cb44-467"></a></span>
<span id="cb44-468"><a href="#cb44-468"></a>Producing a reprex makes it much easier for someone to understand your issue. This not only makes it easier for someone to help you, but also shows that you know it will make it easier for them and that you value their time:</span>
<span id="cb44-469"><a href="#cb44-469"></a></span>
<span id="cb44-470"><a href="#cb44-470"></a><span class="at">&gt; </span><span class="co">[</span><span class="ot">Imagine that you’ve made a cake</span><span class="co">](https://www.jessemaegan.com/post/so-you-ve-been-asked-to-make-a-reprex/)</span><span class="at">, and for some reason it’s turned out absolutely awful – we’re talking completely inedible. Asking a question without a reprex is like asking, “Why didn’t my cake turn out right?” – there are hundreds of possible answers to that question, and it’s going to take a long time to narrow in on the exact cause for your inedible cake creation. </span></span>
<span id="cb44-471"><a href="#cb44-471"></a><span class="at">&gt;</span></span>
<span id="cb44-472"><a href="#cb44-472"></a><span class="at">&gt; Asking a question with a reprex is like asking, “My cake didn’t turn out, and here’s the recipe I used and the steps that I followed. Where did I go wrong?” Using this method is going to significantly increase the likelihood of you getting a helpful response, faster!</span></span>
<span id="cb44-473"><a href="#cb44-473"></a></span>
<span id="cb44-474"><a href="#cb44-474"></a>To make a reprex, we have to do two things:</span>
<span id="cb44-475"><a href="#cb44-475"></a></span>
<span id="cb44-476"><a href="#cb44-476"></a><span class="ss">  1. </span>Remove everything from our code that does not contribute to causing the error. We do this by removing each line from our code in turn and only keeping those lines that are necessary to produce the specific error you are asking for help with -- this is why a reproducible example is sometimes called a *minimum* working example.</span>
<span id="cb44-477"><a href="#cb44-477"></a><span class="ss">  2. </span>Make sure that someone trying to help us can reproduce the issue on their own computer even if they don't have access to the particular dataset we are using. We do this by replacing our own dataset with a publicly available one, preferably one of the datasets that are built into R for exactly this purpose.</span>
<span id="cb44-478"><a href="#cb44-478"></a></span>
<span id="cb44-479"><a href="#cb44-479"></a><span class="co">&lt;!-- Watch this video to see the process of making a reprex in RStudio: --&gt;</span></span>
<span id="cb44-480"><a href="#cb44-480"></a></span>
<span id="cb44-481"><a href="#cb44-481"></a><span class="co">&lt;!-- {{&lt; video https://youtu.be/hlcftgeTAyY &gt;}} --&gt;</span></span>
<span id="cb44-482"><a href="#cb44-482"></a></span>
<span id="cb44-483"><a href="#cb44-483"></a></span>
<span id="cb44-484"><a href="#cb44-484"></a>To practice making a reproducible example, let's create a new R script that we know will produce an error. Create a new R script file (<span class="in">`File &gt; New File &gt; R Script`</span> in RStudio), save it as <span class="in">`chapter_08.R`</span>, then paste the following code into it:</span>
<span id="cb44-485"><a href="#cb44-485"></a></span>
<span id="cb44-488"><a href="#cb44-488"></a><span class="in">```{r}</span></span>
<span id="cb44-489"><a href="#cb44-489"></a><span class="co">#| echo: false</span></span>
<span id="cb44-490"><a href="#cb44-490"></a></span>
<span id="cb44-491"><a href="#cb44-491"></a><span class="co"># This code creates a CSV file that users can download and then reference in </span></span>
<span id="cb44-492"><a href="#cb44-492"></a><span class="co"># their code as a local file (which is important in the narrative, since it </span></span>
<span id="cb44-493"><a href="#cb44-493"></a><span class="co"># makes the example non-reproducible)</span></span>
<span id="cb44-494"><a href="#cb44-494"></a>Seatbelts <span class="sc">|&gt;</span> </span>
<span id="cb44-495"><a href="#cb44-495"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb44-496"><a href="#cb44-496"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-497"><a href="#cb44-497"></a>    <span class="at">year =</span> <span class="dv">1969</span> <span class="sc">+</span> <span class="fu">floor</span>(<span class="fu">row_number</span>() <span class="sc">/</span> <span class="fl">12.0001</span>),</span>
<span id="cb44-498"><a href="#cb44-498"></a>    <span class="at">month =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">16</span>),</span>
<span id="cb44-499"><a href="#cb44-499"></a>    <span class="at">month_beginning =</span> <span class="fu">as.Date</span>(<span class="fu">str_glue</span>(<span class="st">"{year}-{month}-01"</span>))</span>
<span id="cb44-500"><a href="#cb44-500"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb44-501"><a href="#cb44-501"></a>  <span class="fu">select</span>(month_beginning, <span class="fu">everything</span>(), <span class="sc">-</span>year, <span class="sc">-</span>month) <span class="sc">|&gt;</span> </span>
<span id="cb44-502"><a href="#cb44-502"></a>  <span class="co"># Save a copy that students can load</span></span>
<span id="cb44-503"><a href="#cb44-503"></a>  <span class="fu">write_csv</span>(<span class="st">"../data/road_deaths_data.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb44-504"><a href="#cb44-504"></a>  <span class="co"># Save a copy that is used to render this chapter</span></span>
<span id="cb44-505"><a href="#cb44-505"></a>  <span class="fu">write_csv</span>(<span class="st">"road_deaths_data.csv"</span>)</span>
<span id="cb44-506"><a href="#cb44-506"></a><span class="in">```</span></span>
<span id="cb44-507"><a href="#cb44-507"></a></span>
<span id="cb44-510"><a href="#cb44-510"></a><span class="in">```{r}</span></span>
<span id="cb44-511"><a href="#cb44-511"></a><span class="co">#| eval: false</span></span>
<span id="cb44-512"><a href="#cb44-512"></a><span class="co">#| filename: "chapter_08.R"</span></span>
<span id="cb44-513"><a href="#cb44-513"></a></span>
<span id="cb44-514"><a href="#cb44-514"></a><span class="co"># Load packages</span></span>
<span id="cb44-515"><a href="#cb44-515"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span>
<span id="cb44-516"><a href="#cb44-516"></a></span>
<span id="cb44-517"><a href="#cb44-517"></a><span class="co"># Load a dataset from your computer and wrangle it</span></span>
<span id="cb44-518"><a href="#cb44-518"></a>road_deaths <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"road_deaths_data.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb44-519"><a href="#cb44-519"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb44-520"><a href="#cb44-520"></a>  <span class="fu">rename</span>(<span class="at">ksi_drivers =</span> drivers, <span class="at">ksi_pass_front =</span> front, <span class="at">ksi_pass_rear =</span> rear) <span class="sc">|&gt;</span> </span>
<span id="cb44-521"><a href="#cb44-521"></a>  <span class="fu">select</span>(<span class="sc">-</span>petrol_price, <span class="sc">-</span>van_killed) <span class="sc">|&gt;</span> </span>
<span id="cb44-522"><a href="#cb44-522"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-523"><a href="#cb44-523"></a>    <span class="at">law =</span> <span class="fu">as.logical</span>(law),</span>
<span id="cb44-524"><a href="#cb44-524"></a>    <span class="at">ksi_driver_rate =</span> ksi_drivers <span class="sc">/</span> (kms <span class="sc">/</span> <span class="dv">1000</span>)</span>
<span id="cb44-525"><a href="#cb44-525"></a>  )</span>
<span id="cb44-526"><a href="#cb44-526"></a></span>
<span id="cb44-527"><a href="#cb44-527"></a><span class="co"># Make a time-series chart of two continuous variables, coloured by a </span></span>
<span id="cb44-528"><a href="#cb44-528"></a><span class="co"># categorical variable, then add a trend line</span></span>
<span id="cb44-529"><a href="#cb44-529"></a>road_deaths <span class="sc">+</span> </span>
<span id="cb44-530"><a href="#cb44-530"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> month_beginning, <span class="at">y =</span> ksi_driver_rate)) <span class="sc">+</span> </span>
<span id="cb44-531"><a href="#cb44-531"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> law)) <span class="sc">+</span> </span>
<span id="cb44-532"><a href="#cb44-532"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb44-533"><a href="#cb44-533"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">"2 years"</span>, <span class="at">date_labels =</span> <span class="st">"%Y"</span>) <span class="sc">+</span></span>
<span id="cb44-534"><a href="#cb44-534"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb44-535"><a href="#cb44-535"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">type =</span> <span class="st">"qual"</span>) <span class="sc">+</span></span>
<span id="cb44-536"><a href="#cb44-536"></a>  <span class="fu">labs</span>(</span>
<span id="cb44-537"><a href="#cb44-537"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, </span>
<span id="cb44-538"><a href="#cb44-538"></a>    <span class="at">y =</span> <span class="st">"drivers killed or seriously injured per 1,000km travelled"</span>, </span>
<span id="cb44-539"><a href="#cb44-539"></a>    <span class="at">colour =</span> <span class="st">"after seat belts made mandatory"</span></span>
<span id="cb44-540"><a href="#cb44-540"></a>  ) <span class="sc">+</span></span>
<span id="cb44-541"><a href="#cb44-541"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb44-542"><a href="#cb44-542"></a>  <span class="fu">theme</span>(</span>
<span id="cb44-543"><a href="#cb44-543"></a>    <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey90"</span>),</span>
<span id="cb44-544"><a href="#cb44-544"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey90"</span>),</span>
<span id="cb44-545"><a href="#cb44-545"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb44-546"><a href="#cb44-546"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb44-547"><a href="#cb44-547"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb44-548"><a href="#cb44-548"></a>  )</span>
<span id="cb44-549"><a href="#cb44-549"></a><span class="in">```</span></span>
<span id="cb44-550"><a href="#cb44-550"></a></span>
<span id="cb44-551"><a href="#cb44-551"></a>At the moment, you can't run this code because you don't have the <span class="in">`road_deaths_data.csv`</span> file. Download that file by clicking this link and saving the file into the same directory (folder) as the <span class="in">`chapter_08.R`</span> file.</span>
<span id="cb44-552"><a href="#cb44-552"></a></span>
<span id="cb44-553"><a href="#cb44-553"></a>&lt;p class="center"&gt;&lt;a href="../data/road_deaths_data.csv" download class="btn btn-info"&gt;Download the road deaths data file&lt;/a&gt;&lt;/p&gt;</span>
<span id="cb44-554"><a href="#cb44-554"></a></span>
<span id="cb44-555"><a href="#cb44-555"></a>Now run all the code in the <span class="in">`chapter_08.R`</span> file. You should see this error:</span>
<span id="cb44-556"><a href="#cb44-556"></a></span>
<span id="cb44-559"><a href="#cb44-559"></a><span class="in">```{r}</span></span>
<span id="cb44-560"><a href="#cb44-560"></a><span class="co">#| echo: false</span></span>
<span id="cb44-561"><a href="#cb44-561"></a><span class="co">#| error: true</span></span>
<span id="cb44-562"><a href="#cb44-562"></a></span>
<span id="cb44-563"><a href="#cb44-563"></a><span class="co"># Load packages</span></span>
<span id="cb44-564"><a href="#cb44-564"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span>
<span id="cb44-565"><a href="#cb44-565"></a></span>
<span id="cb44-566"><a href="#cb44-566"></a><span class="co"># Load a dataset from your computer and wrangle it</span></span>
<span id="cb44-567"><a href="#cb44-567"></a>road_deaths <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"road_deaths_data.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb44-568"><a href="#cb44-568"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb44-569"><a href="#cb44-569"></a>  <span class="fu">rename</span>(<span class="at">ksi_drivers =</span> drivers, <span class="at">ksi_pass_front =</span> front, <span class="at">ksi_pass_rear =</span> rear) <span class="sc">|&gt;</span> </span>
<span id="cb44-570"><a href="#cb44-570"></a>  <span class="fu">select</span>(<span class="sc">-</span>petrol_price, <span class="sc">-</span>van_killed) <span class="sc">|&gt;</span> </span>
<span id="cb44-571"><a href="#cb44-571"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-572"><a href="#cb44-572"></a>    <span class="at">law =</span> <span class="fu">as.logical</span>(law),</span>
<span id="cb44-573"><a href="#cb44-573"></a>    <span class="at">ksi_driver_rate =</span> ksi_drivers <span class="sc">/</span> (kms <span class="sc">/</span> <span class="dv">1000</span>)</span>
<span id="cb44-574"><a href="#cb44-574"></a>  )</span>
<span id="cb44-575"><a href="#cb44-575"></a></span>
<span id="cb44-576"><a href="#cb44-576"></a><span class="co"># Make a time-series chart of two continuous variables, coloured by a </span></span>
<span id="cb44-577"><a href="#cb44-577"></a><span class="co"># categorical variable, then add a trend line</span></span>
<span id="cb44-578"><a href="#cb44-578"></a>road_deaths <span class="sc">+</span> </span>
<span id="cb44-579"><a href="#cb44-579"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> month_beginning, <span class="at">y =</span> ksi_driver_rate)) <span class="sc">+</span> </span>
<span id="cb44-580"><a href="#cb44-580"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> law)) <span class="sc">+</span> </span>
<span id="cb44-581"><a href="#cb44-581"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb44-582"><a href="#cb44-582"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">"2 years"</span>, <span class="at">date_labels =</span> <span class="st">"%Y"</span>) <span class="sc">+</span></span>
<span id="cb44-583"><a href="#cb44-583"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb44-584"><a href="#cb44-584"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">type =</span> <span class="st">"qual"</span>) <span class="sc">+</span></span>
<span id="cb44-585"><a href="#cb44-585"></a>  <span class="fu">labs</span>(</span>
<span id="cb44-586"><a href="#cb44-586"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, </span>
<span id="cb44-587"><a href="#cb44-587"></a>    <span class="at">y =</span> <span class="st">"drivers killed or seriously injured per 1,000km travelled"</span>, </span>
<span id="cb44-588"><a href="#cb44-588"></a>    <span class="at">colour =</span> <span class="st">"after seat belts made mandatory"</span></span>
<span id="cb44-589"><a href="#cb44-589"></a>  ) <span class="sc">+</span></span>
<span id="cb44-590"><a href="#cb44-590"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb44-591"><a href="#cb44-591"></a>  <span class="fu">theme</span>(</span>
<span id="cb44-592"><a href="#cb44-592"></a>    <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey90"</span>),</span>
<span id="cb44-593"><a href="#cb44-593"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey90"</span>),</span>
<span id="cb44-594"><a href="#cb44-594"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb44-595"><a href="#cb44-595"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb44-596"><a href="#cb44-596"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb44-597"><a href="#cb44-597"></a>  )</span>
<span id="cb44-598"><a href="#cb44-598"></a><span class="in">```</span></span>
<span id="cb44-599"><a href="#cb44-599"></a></span>
<span id="cb44-600"><a href="#cb44-600"></a>As you can see, this error is not easy to decipher, so we might need help to deal with it. </span>
<span id="cb44-601"><a href="#cb44-601"></a></span>
<span id="cb44-602"><a href="#cb44-602"></a></span>
<span id="cb44-603"><a href="#cb44-603"></a></span>
<span id="cb44-604"><a href="#cb44-604"></a><span class="fu">### Reproducible code</span></span>
<span id="cb44-605"><a href="#cb44-605"></a></span>
<span id="cb44-606"><a href="#cb44-606"></a>The first step in producing a reprex is to remove every line from our code that isn't necessary to produce the error. To do that, we start with the _last_ line of code and remove it, then re-run the code. If the code produces _the same error_, we know that the error wasn't caused or affected by anything on the line that we have removed. In that case, we don't need to include that line of code in the reprex. On the other hand, if the error message disappears and the code runs successfully, _or_ the error message changes to a different error, we know that the line of code we removed influenced the error in some way. In that case, we need to include that line of code in the reprex.</span>
<span id="cb44-607"><a href="#cb44-607"></a></span>
<span id="cb44-608"><a href="#cb44-608"></a>Following this process line by line, it is actually possible to remove a lot of the original code and still produce the same error. In fact, we only need to keep five lines of the original code:</span>
<span id="cb44-609"><a href="#cb44-609"></a></span>
<span id="cb44-612"><a href="#cb44-612"></a><span class="in">```{r}</span></span>
<span id="cb44-613"><a href="#cb44-613"></a><span class="co">#| eval: false</span></span>
<span id="cb44-614"><a href="#cb44-614"></a><span class="co">#| filename: "chapter_08.R"</span></span>
<span id="cb44-615"><a href="#cb44-615"></a></span>
<span id="cb44-616"><a href="#cb44-616"></a><span class="co"># Load packages</span></span>
<span id="cb44-617"><a href="#cb44-617"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse) </span>
<span id="cb44-618"><a href="#cb44-618"></a></span>
<span id="cb44-619"><a href="#cb44-619"></a><span class="co"># Load a dataset from your computer and wrangle it</span></span>
<span id="cb44-620"><a href="#cb44-620"></a>road_deaths <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"road_deaths_data.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb44-621"><a href="#cb44-621"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb44-622"><a href="#cb44-622"></a>  <span class="fu">rename</span>(<span class="at">ksi_drivers =</span> drivers, <span class="at">ksi_pass_front =</span> front, <span class="at">ksi_pass_rear =</span> rear) <span class="sc">|&gt;</span></span>
<span id="cb44-623"><a href="#cb44-623"></a>  <span class="fu">select</span>(<span class="sc">-</span>petrol_price, <span class="sc">-</span>van_killed) <span class="sc">|&gt;</span></span>
<span id="cb44-624"><a href="#cb44-624"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-625"><a href="#cb44-625"></a>    <span class="at">law =</span> <span class="fu">as.logical</span>(law),</span>
<span id="cb44-626"><a href="#cb44-626"></a>    <span class="at">ksi_driver_rate =</span> ksi_drivers <span class="sc">/</span> (kms <span class="sc">/</span> <span class="dv">1000</span>)</span>
<span id="cb44-627"><a href="#cb44-627"></a>  )</span>
<span id="cb44-628"><a href="#cb44-628"></a></span>
<span id="cb44-629"><a href="#cb44-629"></a><span class="co"># Make a time-series chart of two continuous variables, coloured by a </span></span>
<span id="cb44-630"><a href="#cb44-630"></a><span class="co"># categorical variable, then add a trend line</span></span>
<span id="cb44-631"><a href="#cb44-631"></a>road_deaths <span class="sc">+</span>  </span>
<span id="cb44-632"><a href="#cb44-632"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> month_beginning, <span class="at">y =</span> ksi_driver_rate)) <span class="sc">+</span>  </span>
<span id="cb44-633"><a href="#cb44-633"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> law)) <span class="sc">+</span>  </span>
<span id="cb44-634"><a href="#cb44-634"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb44-635"><a href="#cb44-635"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">"2 years"</span>, <span class="at">date_labels =</span> <span class="st">"%Y"</span>) <span class="sc">+</span></span>
<span id="cb44-636"><a href="#cb44-636"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb44-637"><a href="#cb44-637"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">type =</span> <span class="st">"qual"</span>) <span class="sc">+</span></span>
<span id="cb44-638"><a href="#cb44-638"></a>  <span class="fu">labs</span>(</span>
<span id="cb44-639"><a href="#cb44-639"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, </span>
<span id="cb44-640"><a href="#cb44-640"></a>    <span class="at">y =</span> <span class="st">"drivers killed or seriously injured per 1,000km travelled"</span>, </span>
<span id="cb44-641"><a href="#cb44-641"></a>    <span class="at">colour =</span> <span class="st">"after seat belts made mandatory"</span></span>
<span id="cb44-642"><a href="#cb44-642"></a>  ) <span class="sc">+</span></span>
<span id="cb44-643"><a href="#cb44-643"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb44-644"><a href="#cb44-644"></a>  <span class="fu">theme</span>(</span>
<span id="cb44-645"><a href="#cb44-645"></a>    <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey90"</span>),</span>
<span id="cb44-646"><a href="#cb44-646"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey90"</span>),</span>
<span id="cb44-647"><a href="#cb44-647"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb44-648"><a href="#cb44-648"></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb44-649"><a href="#cb44-649"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb44-650"><a href="#cb44-650"></a>  )</span>
<span id="cb44-651"><a href="#cb44-651"></a><span class="in">```</span></span>
<span id="cb44-652"><a href="#cb44-652"></a></span>
<span id="cb44-653"><a href="#cb44-653"></a>That means we can remove:</span>
<span id="cb44-654"><a href="#cb44-654"></a></span>
<span id="cb44-655"><a href="#cb44-655"></a><span class="ss">1. </span>The comments (lines 1, 4, 14 and 15, above).</span>
<span id="cb44-656"><a href="#cb44-656"></a><span class="ss">2. </span>The code that wrangles the data in ways that don't affect the error (lines 6--12).</span>
<span id="cb44-657"><a href="#cb44-657"></a><span class="ss">3. </span>The code that adds a trend line to the chart (line 19).</span>
<span id="cb44-658"><a href="#cb44-658"></a><span class="ss">4. </span>The code that fine-tune the appearance of the chart (lines 20--35).</span>
<span id="cb44-659"><a href="#cb44-659"></a></span>
<span id="cb44-660"><a href="#cb44-660"></a>We cannot remove the code that loads necessary packages (line 2), loads the data (line 5) or produces the basic unformatted chart (lines 16--18), because if we remove any of those then the error message either changes or disappears.</span>
<span id="cb44-661"><a href="#cb44-661"></a></span>
<span id="cb44-662"><a href="#cb44-662"></a>This leaves us with the following code, which produces the same error message but is much easier for someone to check for errors because it is much shorter. Because we have removed the data-wrangling code, we have had to change the name of the argument on line 17 of the code above from <span class="in">`y = ksi_driver_rate`</span> to</span>
<span id="cb44-663"><a href="#cb44-663"></a><span class="in">`y = drivers`</span>, since the column <span class="in">`ksi_driver_rate`</span> is no longer in the data (because we have removed line 7 of the code above). We also have to remove the pipe operator (<span class="in">`|&gt;`</span>) at the end of line 5 and the <span class="in">`+`</span> operator at the end of line 18, since they are no longer needed because we have removed the lines of code that follow them.</span>
<span id="cb44-664"><a href="#cb44-664"></a></span>
<span id="cb44-665"><a href="#cb44-665"></a></span>
<span id="cb44-666"><a href="#cb44-666"></a>::: {.callout-important}</span>
<span id="cb44-667"><a href="#cb44-667"></a><span class="fu">#### If the error message changes, keep that line of code</span></span>
<span id="cb44-668"><a href="#cb44-668"></a></span>
<span id="cb44-669"><a href="#cb44-669"></a>If we forgot to change <span class="in">`y = ksi_driver_rate`</span> to <span class="in">`y = drivers`</span>, or to remove <span class="in">`|&gt;`</span> on line 7, then the code would still produce an error, _but it would be a different error_. The purpose of producing a reprex is to find the minimum code that still produces _the same error_ we are interested in. If you remove a line of code and the error message you see changes, put that line of code back.</span>
<span id="cb44-670"><a href="#cb44-670"></a></span>
<span id="cb44-671"><a href="#cb44-671"></a>:::</span>
<span id="cb44-672"><a href="#cb44-672"></a></span>
<span id="cb44-673"><a href="#cb44-673"></a></span>
<span id="cb44-676"><a href="#cb44-676"></a><span class="in">```{r}</span></span>
<span id="cb44-677"><a href="#cb44-677"></a><span class="co">#| error: true</span></span>
<span id="cb44-678"><a href="#cb44-678"></a><span class="co">#| message: false</span></span>
<span id="cb44-679"><a href="#cb44-679"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-680"><a href="#cb44-680"></a></span>
<span id="cb44-681"><a href="#cb44-681"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span>
<span id="cb44-682"><a href="#cb44-682"></a></span>
<span id="cb44-683"><a href="#cb44-683"></a>road_deaths <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"road_deaths_data.csv"</span>)</span>
<span id="cb44-684"><a href="#cb44-684"></a></span>
<span id="cb44-685"><a href="#cb44-685"></a>road_deaths <span class="sc">+</span></span>
<span id="cb44-686"><a href="#cb44-686"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> month_beginning, <span class="at">y =</span> ksi_driver_rate)) <span class="sc">+</span></span>
<span id="cb44-687"><a href="#cb44-687"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> law))</span>
<span id="cb44-688"><a href="#cb44-688"></a><span class="in">```</span></span>
<span id="cb44-689"><a href="#cb44-689"></a></span>
<span id="cb44-690"><a href="#cb44-690"></a></span>
<span id="cb44-691"><a href="#cb44-691"></a>You can see that even though we have removed 80% of the previous code, this shorter code still produces the same error message. That means the problem must be on line of these 5 lines of code. This makes the problem much easier to find and fix, since we only have to understand what is happening (on what might be going wrong) on 5 lines of code, not in the 35 lines of our original code.</span>
<span id="cb44-692"><a href="#cb44-692"></a></span>
<span id="cb44-693"><a href="#cb44-693"></a></span>
<span id="cb44-694"><a href="#cb44-694"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb44-695"><a href="#cb44-695"></a><span class="fu">#### But wouldn't this map look very different?</span></span>
<span id="cb44-696"><a href="#cb44-696"></a></span>
<span id="cb44-697"><a href="#cb44-697"></a>If this shortened code ran successfully rather than producing an error, the resulting chart would look very different to the original chart we wanted. But that does not matter, because what we are interested in is isolating the lines of code that produce the specific error we want to find and fix.</span>
<span id="cb44-698"><a href="#cb44-698"></a>:::</span>
<span id="cb44-699"><a href="#cb44-699"></a></span>
<span id="cb44-700"><a href="#cb44-700"></a></span>
<span id="cb44-701"><a href="#cb44-701"></a></span>
<span id="cb44-702"><a href="#cb44-702"></a><span class="fu">### Reproducible data</span></span>
<span id="cb44-703"><a href="#cb44-703"></a></span>
<span id="cb44-704"><a href="#cb44-704"></a>Our shortened code would make a great reproducible example except for one thing: the data file <span class="in">`road_deaths_data.csv`</span> only exists on your computer. This means the example is not actually *reproducible*, since anyone trying to run this code on their computer to identify the error would find that they instead got a different error saying that the file <span class="in">`road_deaths_data.csv`</span> was not found.</span>
<span id="cb44-705"><a href="#cb44-705"></a></span>
<span id="cb44-706"><a href="#cb44-706"></a>You could deal with this by uploading your dataset to a website and then having the <span class="in">`read_csv()`</span> function read it from that URL. But you might not want to share your data (perhaps it is sensitive in some way), or your dataset might be too large to post online. For this reason, many R packages come with toy datasets that can be used in learning or in testing for errors. You can see a list of all the toy datasets available in the packages you have loaded by typing <span class="in">`data()`</span> in the R console. This will produce a file that gives the name and description of each available dataset.</span>
<span id="cb44-707"><a href="#cb44-707"></a></span>
<span id="cb44-708"><a href="#cb44-708"></a>To use one of these toy datasets, you just use the the name of the dataset as you would use any other R object (like the <span class="in">`road_deaths`</span> object we created above). One commonly used toy dataset is the <span class="in">`mpg`</span> dataset from the ggplot2 package, which contains fuel economy data for 38 models of car. </span>
<span id="cb44-709"><a href="#cb44-709"></a></span>
<span id="cb44-710"><a href="#cb44-710"></a>The data in this dataset are on a completely different topic to the data we were trying to use, but this does not matter as long as the data contains variables of the same type (numeric, character, etc.) as the original data. We can see what variables are in the <span class="in">`mpg`</span> dataset using the <span class="in">`head()`</span> function as usual.</span>
<span id="cb44-711"><a href="#cb44-711"></a></span>
<span id="cb44-714"><a href="#cb44-714"></a><span class="in">```{r}</span></span>
<span id="cb44-715"><a href="#cb44-715"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-716"><a href="#cb44-716"></a></span>
<span id="cb44-717"><a href="#cb44-717"></a><span class="fu">head</span>(mpg)</span>
<span id="cb44-718"><a href="#cb44-718"></a><span class="in">```</span></span>
<span id="cb44-719"><a href="#cb44-719"></a></span>
<span id="cb44-720"><a href="#cb44-720"></a>From this, we can see that there is: </span>
<span id="cb44-721"><a href="#cb44-721"></a></span>
<span id="cb44-722"><a href="#cb44-722"></a><span class="ss">* </span>a <span class="in">`year`</span> variable that we can use as a substitute for the <span class="in">`month_beginning`</span> variable in our original code, </span>
<span id="cb44-723"><a href="#cb44-723"></a><span class="ss">* </span>a variable called <span class="in">`hwy`</span> that is numeric and so can be substituted for the <span class="in">`drivers`</span> variable in our code, and </span>
<span id="cb44-724"><a href="#cb44-724"></a><span class="ss">* </span>a categorical variable called <span class="in">`trans`</span> that we can substitute for the <span class="in">`law`</span> variable in our data. </span>
<span id="cb44-725"><a href="#cb44-725"></a></span>
<span id="cb44-726"><a href="#cb44-726"></a>This means we can use this data instead of our own data, knowing that anyone on any computer with the ggplot2 package installed can run the code and should get the same result. It also makes our code slightly shorter still, since we no longer need to load the data from a file with <span class="in">`read_csv()`</span>. All we need to do is load the ggplot2 package and replace the reference to the <span class="in">`road_deaths`</span> object on line 5 of our shortened code to a reference to the built-in <span class="in">`mpg`</span> object:</span>
<span id="cb44-727"><a href="#cb44-727"></a></span>
<span id="cb44-728"><a href="#cb44-728"></a></span>
<span id="cb44-731"><a href="#cb44-731"></a><span class="in">```{r}</span></span>
<span id="cb44-732"><a href="#cb44-732"></a><span class="co">#| error: true</span></span>
<span id="cb44-733"><a href="#cb44-733"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-734"><a href="#cb44-734"></a></span>
<span id="cb44-735"><a href="#cb44-735"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggplot2)</span>
<span id="cb44-736"><a href="#cb44-736"></a></span>
<span id="cb44-737"><a href="#cb44-737"></a>mpg <span class="sc">+</span></span>
<span id="cb44-738"><a href="#cb44-738"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> hwy)) <span class="sc">+</span> </span>
<span id="cb44-739"><a href="#cb44-739"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> trans))</span>
<span id="cb44-740"><a href="#cb44-740"></a><span class="in">```</span></span>
<span id="cb44-741"><a href="#cb44-741"></a></span>
<span id="cb44-742"><a href="#cb44-742"></a>We have now managed to reduce our original 37 lines of code down to 4 lines, as well as making the example reproducible by using a widely available toy dataset. The shorter code still produces the same error while being much easier to read, so we are much more likely to get help quickly than if we had just sent someone our original code.</span>
<span id="cb44-743"><a href="#cb44-743"></a></span>
<span id="cb44-744"><a href="#cb44-744"></a>Most of the time, the act of producing a reprex will be enough for us to find and fix the error without any external help. Can you see the problem with our code that is making this error happen? If not, we will reveal it at the end of this chapter.</span>
<span id="cb44-745"><a href="#cb44-745"></a></span>
<span id="cb44-746"><a href="#cb44-746"></a></span>
<span id="cb44-747"><a href="#cb44-747"></a><span class="fu">### Checking your reprex is reproducible</span></span>
<span id="cb44-748"><a href="#cb44-748"></a></span>
<span id="cb44-749"><a href="#cb44-749"></a>Now that you have the minimum code needed to reproduce the error, it's almost time to share it with people who can help you. But before you do that, it's worth checking that the code is truly reproducible. To do this we will use the reprex package, which is part of the tidyverse suite of packages you already have installed.</span>
<span id="cb44-750"><a href="#cb44-750"></a></span>
<span id="cb44-751"><a href="#cb44-751"></a>&lt;p class="full-width-image"&gt;&lt;img src="../images/reprex-cartoon.jpg" alt="Cartoon of furry monsters celebrating, with the caption 'reprex: make reproducible examples'"&gt;&lt;/p&gt;</span>
<span id="cb44-752"><a href="#cb44-752"></a></span>
<span id="cb44-753"><a href="#cb44-753"></a>&lt;a href="https://reprex.tidyverse.org/" title="reprex website"&gt;&lt;img src="../images/reprex.png" class="right-side-image"&gt;&lt;/a&gt;</span>
<span id="cb44-754"><a href="#cb44-754"></a></span>
<span id="cb44-755"><a href="#cb44-755"></a>To use the reprex package, first put your code in a separate R document in the Source panel in RStudio. Open a new R script in RStudio now and paste the final three-line reprex code above into it. Once you've done that, select all the code in that document. Now click the <span class="in">`Addins`</span> button in RStudio and scroll down until you can choose <span class="in">`Reprex selection`</span>.</span>
<span id="cb44-756"><a href="#cb44-756"></a></span>
<span id="cb44-757"><a href="#cb44-757"></a>After a few seconds, some code should appear in the RStudio Viewer panel showing your code and the error message that it produces. This code has also been copied to your computer clipboard so that you can paste it into an email or web form when you are asking for help.</span>
<span id="cb44-758"><a href="#cb44-758"></a></span>
<span id="cb44-759"><a href="#cb44-759"></a>If the error message that you see along with the code in the Viewer panel is not the error message you were expecting, your example is not yet reproducible. For example if you tried to run the <span class="in">`Reprex selection`</span> command on the original code that we started this section with, we would get an error message <span class="in">`'road_deaths_data.csv' does not exist in current working directory`</span>.</span>
<span id="cb44-760"><a href="#cb44-760"></a></span>
<span id="cb44-761"><a href="#cb44-761"></a>Once your reprex produces _the same error_ as the code you originally had the issue with, you're ready to share it to get help.</span>
<span id="cb44-762"><a href="#cb44-762"></a></span>
<span id="cb44-763"><a href="#cb44-763"></a></span>
<span id="cb44-764"><a href="#cb44-764"></a></span>
<span id="cb44-765"><a href="#cb44-765"></a><span class="fu">## Sources of help</span></span>
<span id="cb44-766"><a href="#cb44-766"></a></span>
<span id="cb44-767"><a href="#cb44-767"></a>If you are being taught R by a formal instructor, or you have friends or colleagues who can help, they will probably be the first people that you go to for help. </span>
<span id="cb44-768"><a href="#cb44-768"></a></span>
<span id="cb44-769"><a href="#cb44-769"></a>If this doesn't work, or if you are the most proficient R user that you know, you might need another place to turn to. Fortunately, R has a large community of volunteers who will help you. Before you ask people online for help, it's important to check that someone hasn't already asked the same question and had it answered. Duplicate questions increase the workload of the volunteers who answer questions and slow everything down, so if your question has frequently been answered already it's possible your question will just be ignored.</span>
<span id="cb44-770"><a href="#cb44-770"></a></span>
<span id="cb44-771"><a href="#cb44-771"></a>To find out if there is an answer to your question, the easiest thing to do is to search the error message online. Google, or another search engine of your choice, is definitely your friend. If you search online for the error message that was produced by our reprex code, you will see that there are over 100 pages discussing this error message and how to fix it.</span>
<span id="cb44-772"><a href="#cb44-772"></a></span>
<span id="cb44-773"><a href="#cb44-773"></a>Let's imagine, though, that there were no relevant hits when we searched for the error message, or that none of the results was useful. In that case, we need to pose a new question to the R community. The place to find the largest slice of that community is probably the website <span class="co">[</span><span class="ot">Stack Overflow</span><span class="co">](https://stackoverflow.com/)</span>. This is a website for people who are writing code in any programming language imaginable to get help. It is part of the larger <span class="co">[</span><span class="ot">Stack Exchange Network</span><span class="co">](https://stackexchange.com/)</span> of question-and-answer websites covering everything from <span class="co">[</span><span class="ot">travel</span><span class="co">](https://travel.stackexchange.com/)</span> to <span class="co">[</span><span class="ot">veganism</span><span class="co">](https://vegetarianism.stackexchange.com/)</span>.</span>
<span id="cb44-774"><a href="#cb44-774"></a></span>
<span id="cb44-775"><a href="#cb44-775"></a>To ask a new question on Stack Overflow, go to <span class="co">[</span><span class="ot">stackoverflow.com/questions/ask</span><span class="co">](https://stackoverflow.com/questions/ask)</span> and create an account or log in. You will now be asked to complete a short form with your question. Questions are more likely to get an answer faster if you:</span>
<span id="cb44-776"><a href="#cb44-776"></a></span>
<span id="cb44-777"><a href="#cb44-777"></a><span class="ss">* </span>Give the question a specific title. Over 20 million questions have been asked on Stack Overflow since it launched, so a generic title like 'Help', 'R error' or even 'ggplot error' will not help other people find your question. <span class="co">[</span><span class="ot">Look at some recent questions about R on Stack Overflow</span><span class="co">](https://stackoverflow.com/questions/tagged/r)</span> to get some ideas on what title to give for your question.</span>
<span id="cb44-778"><a href="#cb44-778"></a><span class="ss">* </span>In the body of your question, *briefly* (2--3 lines should do it) explain what you were trying to do, then paste the reprex output that the <span class="in">`Reprex selection`</span> addin copied to your clipboard into the question body box underneath your brief explanation. You will see that Stack Overflow recognises the format of your code and shows you a preview of it underneath the question box.</span>
<span id="cb44-779"><a href="#cb44-779"></a><span class="ss">* </span>Finally, add the tag <span class="in">`r`</span> to the Tags box so that people know your question is about coding in R. This is crucial -- if you do not tag your question as being about R, it is very unlikely that volunteers who know about R will be able to find your question.</span>
<span id="cb44-780"><a href="#cb44-780"></a></span>
<span id="cb44-781"><a href="#cb44-781"></a>Submit your question and wait for an answer. As soon as someone answers your question, or comments on it to ask for more detail, you will get an email alert. Many questions are typically answered within a few hours. Hopefully this will help you get to the final stage of the emotional roller coaster of debugging:</span>
<span id="cb44-782"><a href="#cb44-782"></a></span>
<span id="cb44-783"><a href="#cb44-783"></a>&lt;p class="full-width-image"&gt;&lt;img src="../images/debugging.jpg" alt="Cartoon showing 10 furry monsters showing different stages of learning to debug code. The monsters are marked '1. I got this', '2. Huh, really though that was it', '3. (...)', '4. Fine. Restarting.', '5. OH WTF', '6. Zombie meltdown', '7. [crying]', '8. A NEW HOPE!', '9. [insert awesome theme song]' and '10. I LOVE CODING!'"&gt;&lt;/p&gt;</span>
<span id="cb44-784"><a href="#cb44-784"></a></span>
<span id="cb44-785"><a href="#cb44-785"></a></span>
<span id="cb44-786"><a href="#cb44-786"></a></span>
<span id="cb44-787"><a href="#cb44-787"></a><span class="fu">## Getting help from online tutorials and blogs</span></span>
<span id="cb44-788"><a href="#cb44-788"></a></span>
<span id="cb44-789"><a href="#cb44-789"></a>One of the nice things about learning R is that there is a large online community of people who write about how to get things done using R. The <span class="co">[</span><span class="ot">R-Bloggers</span><span class="co">](https://www.r-bloggers.com/)</span> website hosts thousands of tutorials on different R topics, written by hundreds of different authors, while institutions such as the UCLA Statistical Consulting group provide <span class="co">[</span><span class="ot">detailed tutorials on statistical analysis using R</span><span class="co">](https://stats.oarc.ucla.edu/r/)</span>. There are also many free online books and websites on how to get different things done in R, many of which are linked as further reading throughout this book. One example of this is the <span class="co">[</span><span class="ot">R Graph Gallery</span><span class="co">](https://r-graph-gallery.com/)</span> that gives examples of many different types of visualisations you can make in R.</span>
<span id="cb44-790"><a href="#cb44-790"></a></span>
<span id="cb44-791"><a href="#cb44-791"></a>Many online tutorials are very helpful. But the R language has developed over time, so some older tutorials may use methods that have since been replaced by better ones. Occasionally, older tutorials might even you bad advice. So how can you know which tutorials you can trust? Generally, online posts from the past 3 years or so are more likely to use methods that are reasonably up to date. You might also want to consider who wrote the tutorial. For example, is the tutorial hosted on the website of an R package you are using? If so, it's likely to have been written by the author of the package and so is likely to be reliable.</span>
<span id="cb44-792"><a href="#cb44-792"></a></span>
<span id="cb44-793"><a href="#cb44-793"></a>@sec-functions-to-avoid explains some obsolete R functions that you should avoid using if you see them suggested in online tutorials or blog posts.</span>
<span id="cb44-794"><a href="#cb44-794"></a></span>
<span id="cb44-795"><a href="#cb44-795"></a></span>
<span id="cb44-796"><a href="#cb44-796"></a>::: {.callout-quiz .callout}</span>
<span id="cb44-797"><a href="#cb44-797"></a><span class="fu">#### Some R functions to avoid</span></span>
<span id="cb44-798"><a href="#cb44-798"></a></span>
<span id="cb44-799"><a href="#cb44-799"></a><span class="in">```{r functions-to-avoid-quiz}</span></span>
<span id="cb44-800"><a href="#cb44-800"></a><span class="in">#| echo: false</span></span>
<span id="cb44-801"><a href="#cb44-801"></a></span>
<span id="cb44-802"><a href="#cb44-802"></a><span class="in">functions_to_avoid_quiz1 &lt;- c(</span></span>
<span id="cb44-803"><a href="#cb44-803"></a><span class="in">  "It deletes all the objects in your R environment",</span></span>
<span id="cb44-804"><a href="#cb44-804"></a><span class="in">  "It makes it impossible for you to share your code with anyone else",</span></span>
<span id="cb44-805"><a href="#cb44-805"></a><span class="in">  answer = "It makes it hard to keep track of which values are stored in which dataset",</span></span>
<span id="cb44-806"><a href="#cb44-806"></a><span class="in">  "It has been superseded by the `if_else()` function"</span></span>
<span id="cb44-807"><a href="#cb44-807"></a><span class="in">)</span></span>
<span id="cb44-808"><a href="#cb44-808"></a></span>
<span id="cb44-809"><a href="#cb44-809"></a><span class="in">functions_to_avoid_quiz2 &lt;- c(</span></span>
<span id="cb44-810"><a href="#cb44-810"></a><span class="in">  "`pluck()`",</span></span>
<span id="cb44-811"><a href="#cb44-811"></a><span class="in">  "`mod()`",</span></span>
<span id="cb44-812"><a href="#cb44-812"></a><span class="in">  "`pull()`",</span></span>
<span id="cb44-813"><a href="#cb44-813"></a><span class="in">  answer = "`|&gt;`"</span></span>
<span id="cb44-814"><a href="#cb44-814"></a><span class="in">)</span></span>
<span id="cb44-815"><a href="#cb44-815"></a></span>
<span id="cb44-816"><a href="#cb44-816"></a><span class="in">functions_to_avoid_quiz3 &lt;- c(</span></span>
<span id="cb44-817"><a href="#cb44-817"></a><span class="in">  "The numeric value `100` is returned",</span></span>
<span id="cb44-818"><a href="#cb44-818"></a><span class="in">  answer = "The value `NA` is returned",</span></span>
<span id="cb44-819"><a href="#cb44-819"></a><span class="in">  'The text value `"100"` is returned',</span></span>
<span id="cb44-820"><a href="#cb44-820"></a><span class="in">  "R crashes"</span></span>
<span id="cb44-821"><a href="#cb44-821"></a><span class="in">)</span></span>
<span id="cb44-822"><a href="#cb44-822"></a><span class="in">```</span></span>
<span id="cb44-823"><a href="#cb44-823"></a></span>
<span id="cb44-824"><a href="#cb44-824"></a></span>
<span id="cb44-825"><a href="#cb44-825"></a>**Why should you avoid using the `attach()` function?**</span>
<span id="cb44-826"><a href="#cb44-826"></a></span>
<span id="cb44-827"><a href="#cb44-827"></a><span class="in">`r webexercises::longmcq(functions_to_avoid_quiz1)`</span></span>
<span id="cb44-828"><a href="#cb44-828"></a></span>
<span id="cb44-829"><a href="#cb44-829"></a></span>
<span id="cb44-830"><a href="#cb44-830"></a>**What function should you generally use instead of `%&gt;%`?**</span>
<span id="cb44-831"><a href="#cb44-831"></a></span>
<span id="cb44-832"><a href="#cb44-832"></a><span class="in">`r webexercises::longmcq(functions_to_avoid_quiz2)`</span></span>
<span id="cb44-833"><a href="#cb44-833"></a></span>
<span id="cb44-834"><a href="#cb44-834"></a></span>
<span id="cb44-835"><a href="#cb44-835"></a>**What happens if you try to run the code `as.numeric("100 degrees")`?**</span>
<span id="cb44-836"><a href="#cb44-836"></a></span>
<span id="cb44-837"><a href="#cb44-837"></a><span class="in">`r webexercises::longmcq(functions_to_avoid_quiz3)`</span></span>
<span id="cb44-838"><a href="#cb44-838"></a></span>
<span id="cb44-839"><a href="#cb44-839"></a></span>
<span id="cb44-840"><a href="#cb44-840"></a>:::</span>
<span id="cb44-841"><a href="#cb44-841"></a></span>
<span id="cb44-842"><a href="#cb44-842"></a></span>
<span id="cb44-843"><a href="#cb44-843"></a></span>
<span id="cb44-844"><a href="#cb44-844"></a><span class="fu">## Coding with AI</span></span>
<span id="cb44-845"><a href="#cb44-845"></a></span>
<span id="cb44-846"><a href="#cb44-846"></a>One topic that we haven't covered yet is using artificial intelligence (AI) to help us produce R code. The type of AI that can be used to help produce code is called a _large language model_ (LLM), sometimes known as a _generative AI_ model. The best known of these among the public is probably <span class="co">[</span><span class="ot">ChatGPT</span><span class="co">](https://chat.openai.com/)</span>, but there are lots of similar services available (and new ones being released all the time).</span>
<span id="cb44-847"><a href="#cb44-847"></a></span>
<span id="cb44-848"><a href="#cb44-848"></a></span>
<span id="cb44-849"><a href="#cb44-849"></a><span class="fu">### Coding with AI: an example</span></span>
<span id="cb44-850"><a href="#cb44-850"></a></span>
<span id="cb44-851"><a href="#cb44-851"></a>Generative AI services can help you to write code, especially code that does very common tasks like loading data. For example, say that I want to load the Vancouver thefts dataset that we used in a previous chapter and convert the column names in the data to <span class="in">`snake_case`</span>. As a reminder, the code we previously used to do that looked like this:</span>
<span id="cb44-852"><a href="#cb44-852"></a></span>
<span id="cb44-853"><a href="#cb44-853"></a><span class="in">```r</span></span>
<span id="cb44-854"><a href="#cb44-854"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span>
<span id="cb44-855"><a href="#cb44-855"></a></span>
<span id="cb44-856"><a href="#cb44-856"></a>vancouver_thefts <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/vancouver_thefts.csv.gz"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb44-857"><a href="#cb44-857"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb44-858"><a href="#cb44-858"></a><span class="in">```</span></span>
<span id="cb44-859"><a href="#cb44-859"></a></span>
<span id="cb44-860"><a href="#cb44-860"></a>To ask ChatGPT to write some code that will do this task, I need to tell it what I want. For example, you might use this _prompt_ text to give instructions to ChatGPT:</span>
<span id="cb44-861"><a href="#cb44-861"></a></span>
<span id="cb44-862"><a href="#cb44-862"></a><span class="at">&gt; Show me the R code needed to load the CSV dataset at https://mpjashby.github.io/crimemappingdata/vancouver_thefts.csv.gz and make the column names into snake case</span></span>
<span id="cb44-863"><a href="#cb44-863"></a></span>
<span id="cb44-864"><a href="#cb44-864"></a>When I give this prompt to ChatGPT version 4o in January 2025 it produced this response:</span>
<span id="cb44-865"><a href="#cb44-865"></a></span>
<span id="cb44-866"><a href="#cb44-866"></a><span class="in">```r</span></span>
<span id="cb44-867"><a href="#cb44-867"></a><span class="co"># Install required packages if not already installed</span></span>
<span id="cb44-868"><a href="#cb44-868"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"janitor"</span>)) <span class="fu">install.packages</span>(<span class="st">"janitor"</span>)</span>
<span id="cb44-869"><a href="#cb44-869"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"readr"</span>)) <span class="fu">install.packages</span>(<span class="st">"readr"</span>)</span>
<span id="cb44-870"><a href="#cb44-870"></a></span>
<span id="cb44-871"><a href="#cb44-871"></a><span class="co"># Load required libraries</span></span>
<span id="cb44-872"><a href="#cb44-872"></a><span class="fu">library</span>(janitor)</span>
<span id="cb44-873"><a href="#cb44-873"></a><span class="fu">library</span>(readr)</span>
<span id="cb44-874"><a href="#cb44-874"></a></span>
<span id="cb44-875"><a href="#cb44-875"></a><span class="co"># Define the URL of the dataset</span></span>
<span id="cb44-876"><a href="#cb44-876"></a>url <span class="ot">&lt;-</span> <span class="st">"https://mpjashby.github.io/crimemappingdata/vancouver_thefts.csv.gz"</span></span>
<span id="cb44-877"><a href="#cb44-877"></a></span>
<span id="cb44-878"><a href="#cb44-878"></a><span class="co"># Read the dataset directly from the URL</span></span>
<span id="cb44-879"><a href="#cb44-879"></a>thefts_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(url)</span>
<span id="cb44-880"><a href="#cb44-880"></a></span>
<span id="cb44-881"><a href="#cb44-881"></a><span class="co"># Convert column names to snake_case</span></span>
<span id="cb44-882"><a href="#cb44-882"></a>thefts_data <span class="ot">&lt;-</span> <span class="fu">clean_names</span>(thefts_data)</span>
<span id="cb44-883"><a href="#cb44-883"></a></span>
<span id="cb44-884"><a href="#cb44-884"></a><span class="co"># View the first few rows of the dataset</span></span>
<span id="cb44-885"><a href="#cb44-885"></a><span class="fu">head</span>(thefts_data)</span>
<span id="cb44-886"><a href="#cb44-886"></a><span class="in">```</span></span>
<span id="cb44-887"><a href="#cb44-887"></a></span>
<span id="cb44-888"><a href="#cb44-888"></a>ChatGPT also produces a short explanation of what the code does:</span>
<span id="cb44-889"><a href="#cb44-889"></a></span>
<span id="cb44-890"><a href="#cb44-890"></a><span class="at">&gt; Explanation: </span></span>
<span id="cb44-891"><a href="#cb44-891"></a><span class="at">&gt; </span></span>
<span id="cb44-892"><a href="#cb44-892"></a><span class="at">&gt; 1. **`read_csv()`**: Reads the compressed </span><span class="in">`.csv.gz`</span><span class="at"> file directly from the URL. The </span><span class="in">`readr`</span><span class="at"> package handles the compressed file format automatically.</span></span>
<span id="cb44-893"><a href="#cb44-893"></a><span class="at">&gt; 2. **`clean_names()`**: Converts column names to snake_case. This function is provided by the </span><span class="in">`janitor`</span><span class="at"> package and is useful for making column names consistent and easier to work with in R.</span></span>
<span id="cb44-894"><a href="#cb44-894"></a><span class="at">&gt; 3. **`head()`**: Displays the first few rows of the dataset to confirm that the column names have been converted successfully. </span></span>
<span id="cb44-895"><a href="#cb44-895"></a></span>
<span id="cb44-896"><a href="#cb44-896"></a>This code works, in that it produces the desired result. However, it takes 12 lines of code and creates three objects to do the same work as our original 3 lines of code (lines 1--7 of the ChatGPT code replicate what <span class="in">`pacman::p_load(tidyverse)`</span> does on the first line of our original code). This might not seem like a problem, and for this simple example it's not. However, if you wanted to combine this code with other code written with the help of a large language model, the code could quickly get so complicated that it would be hard to understand.</span>
<span id="cb44-897"><a href="#cb44-897"></a></span>
<span id="cb44-898"><a href="#cb44-898"></a></span>
<span id="cb44-899"><a href="#cb44-899"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb44-900"><a href="#cb44-900"></a><span class="fu">#### Why did I get a different result when I put the same prompt into ChatGPT?</span></span>
<span id="cb44-901"><a href="#cb44-901"></a></span>
<span id="cb44-902"><a href="#cb44-902"></a>If you put the text "Show me the R code needed to load the CSV dataset at https://mpjashby.github.io/crimemappingdata/vancouver_thefts.csv.gz and make the column names into snake case" into ChatGPT, it is possible that you will get a slightly different response to the one shown above. This is because large language models are _stochastic_ or _non-deterministic_ models, which means that there is some element of chance involved in exactly what response the model will produce for a particular input. In fact, if you provide exactly the same input to ChatGPT multiple times, it is likely you will get a slightly different answer each time.</span>
<span id="cb44-903"><a href="#cb44-903"></a></span>
<span id="cb44-904"><a href="#cb44-904"></a>:::</span>
<span id="cb44-905"><a href="#cb44-905"></a></span>
<span id="cb44-906"><a href="#cb44-906"></a></span>
<span id="cb44-907"><a href="#cb44-907"></a><span class="fu">### Why does ChatGPT sometimes produce code that doesn't work?</span></span>
<span id="cb44-908"><a href="#cb44-908"></a></span>
<span id="cb44-909"><a href="#cb44-909"></a>In the example above, ChatGPT 4o produced code that works (the previous version, ChatGPT 3.5, generated code that produced an error). However, there are lots of examples of large language models producing code that doesn't work in various ways. </span>
<span id="cb44-910"><a href="#cb44-910"></a></span>
<span id="cb44-911"><a href="#cb44-911"></a>To understand why that happens, we need to know just a little bit about how large language models such as ChatGPT work. LLMs work by looking for patterns in very large datasets (e.g. all the pages on the world wide web) and then using those patterns to predict what the most likely answer is to questions or requests that include particular words and phrases. To give a very simple example, an LLM might be able to identify that if the first few words in a sentence are 'Today was Sunday, which meant that tomorrow …' then it is likely (but not certain) that the next words would be 'is Monday'. </span>
<span id="cb44-912"><a href="#cb44-912"></a></span>
<span id="cb44-913"><a href="#cb44-913"></a>Because they are trained on very large samples of data, LLMs can produce answers that are sophisticated enough that they almost look like magic. But behind the scenes, what models like ChatGPT are doing is predicting what the most likely combination of words a response will contain, based on the input that it is given. It is important to remember that models such as ChatGPT do not know the _correct_ answer to a question, since they do not actually understand the question in the way that humans do. This means that ChatGPT cannot give you any indication of how confident it is about the answer it has given: it will be equally confident in its answer whether it is right or wrong. This unjustified confidence can easily lead you to accept an answer from ChatGPT that is actually wrong, so always be careful in using the results produced by LLMs.</span>
<span id="cb44-914"><a href="#cb44-914"></a></span>
<span id="cb44-915"><a href="#cb44-915"></a>&lt;p class="full-width-image"&gt;&lt;img src="../images/need_a_minute.png" alt="A frustrated little monster sits on the ground with his hat next to him, saying 'I just need a minute.' Looking on empathetically is the R logo, with the word 'Error' in many different styles behind it."&gt;&lt;/p&gt;</span>
<span id="cb44-916"><a href="#cb44-916"></a></span>
<span id="cb44-917"><a href="#cb44-917"></a></span>
<span id="cb44-918"><a href="#cb44-918"></a></span>
<span id="cb44-919"><a href="#cb44-919"></a><span class="fu">### Should I use AI to help me code?</span></span>
<span id="cb44-920"><a href="#cb44-920"></a></span>
<span id="cb44-921"><a href="#cb44-921"></a>So given these issues, does that mean that we shouldn't use LLMs to help us write code? Not necessarily. Lots of programmers find LLMs useful for helping them write code. However, LLMs like ChatGPT are useful for _supporting_ humans to write effective code, not for replacing humans writing code. Even if you asked an LLM to write every part of your code for you, it is likely you would need to make some changes to the code it produced to make it work. </span>
<span id="cb44-922"><a href="#cb44-922"></a></span>
<span id="cb44-923"><a href="#cb44-923"></a>That means that to use an LLM effectively to help you write code, you need to understand the code that the LLM produces. That's why this course teaches you to understand how to write code to produce crime maps in R, rather than just how to use an LLM to write the code for you.</span>
<span id="cb44-924"><a href="#cb44-924"></a></span>
<span id="cb44-925"><a href="#cb44-925"></a>Whether to use an LLM to help you write code is up to you. Some people find it saves them time and helps them get started on how to produce a particular bit of code, while others find that they spend just as much time fixing the code produced by an LLM as it would take them to write the code themselves. You might want to experiment with getting help from an LLM so you can see what works for you.</span>
<span id="cb44-926"><a href="#cb44-926"></a></span>
<span id="cb44-927"><a href="#cb44-927"></a></span>
<span id="cb44-928"><a href="#cb44-928"></a><span class="fu">### Using AI to help map crime</span></span>
<span id="cb44-929"><a href="#cb44-929"></a></span>
<span id="cb44-930"><a href="#cb44-930"></a>There are two further important points to make about using LLMs in the context of crime mapping. First, it is vital that you do not upload any sensitive data to an LLM that is hosted online, since it is likely that the company that runs the LLM will have reserved the right to use any data you submit to improve the model in future. You must make sure that sensitive data such as victim details are not posted online or shared unlawfully.</span>
<span id="cb44-931"><a href="#cb44-931"></a></span>
<span id="cb44-932"><a href="#cb44-932"></a>The second important point is that the analysis that we use crime mapping for is usually done to answer important questions such as where crime-prevention initiatives should be focused or where a serial offender might live. It is vital that the answers we produce to these questions are accurate. Part of making sure the results of our analysis are accurate is to make sure that we understand exactly how our code produces a particular result. If you use an LLM to support your coding, it is vital that you still understand what the code does.</span>
<span id="cb44-933"><a href="#cb44-933"></a></span>
<span id="cb44-934"><a href="#cb44-934"></a>Restart R to start a new session by clicking on the <span class="in">`Session`</span> menu and then clicking <span class="in">`Restart R`</span>. This creates a blank canvas for the next chapter.</span>
<span id="cb44-935"><a href="#cb44-935"></a></span>
<span id="cb44-936"><a href="#cb44-936"></a></span>
<span id="cb44-937"><a href="#cb44-937"></a><span class="fu">## In summary</span></span>
<span id="cb44-938"><a href="#cb44-938"></a></span>
<span id="cb44-939"><a href="#cb44-939"></a>In this chapter we have learned how to handle messages, warnings and errors in R. We have learned to take time to understand error messages, to isolate errors so that we can better understand them, to use manual pages for functions to check that every argument is correct, and how to write reproducible examples so</span>
<span id="cb44-940"><a href="#cb44-940"></a>that we can get help online. This will help you become a more independent coder. You can the the checklist in @sec-checklist-errors to help you deal with any problems in your code.</span>
<span id="cb44-941"><a href="#cb44-941"></a></span>
<span id="cb44-942"><a href="#cb44-942"></a></span>
<span id="cb44-943"><a href="#cb44-943"></a><span class="fu">### What caused the error in our reproducible example? {.unnumbered}</span></span>
<span id="cb44-944"><a href="#cb44-944"></a></span>
<span id="cb44-945"><a href="#cb44-945"></a>The error in our reproducible example was very simple, but quite difficult to spot. On line 1 of the code below, we try to add the <span class="in">`ggplot()`</span> function to the <span class="in">`mpg`</span> object using the <span class="in">`+`</span> operator when what we wanted to do was pass the <span class="in">`mpg`</span> object to the <span class="in">`ggplot()`</span> function using the <span class="in">`|&gt;`</span> operator. R does not know how to add a dataset to a function in this way, so it produced an error message.</span>
<span id="cb44-946"><a href="#cb44-946"></a></span>
<span id="cb44-947"><a href="#cb44-947"></a>If you replaced <span class="in">`+`</span> with <span class="in">`|&gt;`</span> on line 1 of the code below, the code would now run normally. Since we have removed almost all of our original code to make a reproducible example, the resulting plot looks nothing like what we wanted. This does not matter -- when we are producing a reprex we only care about reliably producing *the same* error. Now that we have fixed the error, we could go back and fix the original code to produce the chart we wanted.</span>
<span id="cb44-948"><a href="#cb44-948"></a></span>
<span id="cb44-951"><a href="#cb44-951"></a><span class="in">```{r}</span></span>
<span id="cb44-952"><a href="#cb44-952"></a><span class="co">#| eval: false</span></span>
<span id="cb44-953"><a href="#cb44-953"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb44-954"><a href="#cb44-954"></a></span>
<span id="cb44-955"><a href="#cb44-955"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggplot2)</span>
<span id="cb44-956"><a href="#cb44-956"></a></span>
<span id="cb44-957"><a href="#cb44-957"></a>mpg <span class="sc">+</span> <span class="co"># &lt;---- THE `+` OPERATOR HERE SHOULD BE A `|&gt;` OPERATOR INSTEAD</span></span>
<span id="cb44-958"><a href="#cb44-958"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> hwy)) <span class="sc">+</span> </span>
<span id="cb44-959"><a href="#cb44-959"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> trans))</span>
<span id="cb44-960"><a href="#cb44-960"></a><span class="in">```</span></span>
<span id="cb44-961"><a href="#cb44-961"></a></span>
<span id="cb44-962"><a href="#cb44-962"></a>The mistake in this code is a very easy one to make, because what <span class="in">`+`</span> does inside a <span class="in">`ggplot()`</span> stack is so similar to what <span class="in">`|&gt;`</span> does in passing the result of one function to the next function in an data-wrangling pipeline. Remember that we only use <span class="in">`+`</span> to combine functions inside a <span class="in">`ggplot()`</span> stack, and use <span class="in">`|&gt;`</span> to combine functions everywhere else.</span>
<span id="cb44-963"><a href="#cb44-963"></a></span>
<span id="cb44-964"><a href="#cb44-964"></a></span>
<span id="cb44-965"><a href="#cb44-965"></a>::: {.box .reading}</span>
<span id="cb44-966"><a href="#cb44-966"></a></span>
<span id="cb44-967"><a href="#cb44-967"></a>For more information on writing reproducible examples, see:</span>
<span id="cb44-968"><a href="#cb44-968"></a></span>
<span id="cb44-969"><a href="#cb44-969"></a><span class="ss">  * </span>Watch the webinar <span class="co">[</span><span class="ot">Creating reproducible examples with reprex</span><span class="co">](https://reprex.tidyverse.org/articles/articles/learn-reprex.html)</span> by</span>
<span id="cb44-970"><a href="#cb44-970"></a>    Jenny Bryan.</span>
<span id="cb44-971"><a href="#cb44-971"></a><span class="ss">  * </span>Read the <span class="co">[</span><span class="ot">Reprex do’s and don’ts</span><span class="co">](https://reprex.tidyverse.org/articles/reprex-dos-and-donts.html)</span> </span>
<span id="cb44-972"><a href="#cb44-972"></a>    on the <span class="in">`reprex`</span> package website.</span>
<span id="cb44-973"><a href="#cb44-973"></a><span class="ss">  * </span>Learn more about how to use  <span class="co">[</span><span class="ot">Six tips for better coding with ChatGPT</span><span class="co">](https://doi.org/10.1038/d41586-023-01833-0)</span></span>
<span id="cb44-974"><a href="#cb44-974"></a></span>
<span id="cb44-975"><a href="#cb44-975"></a>:::</span>
<span id="cb44-976"><a href="#cb44-976"></a></span>
<span id="cb44-977"><a href="#cb44-977"></a></span>
<span id="cb44-978"><a href="#cb44-978"></a>::: {.callout-quiz .callout}</span>
<span id="cb44-979"><a href="#cb44-979"></a><span class="fu">### Revision questions {.unnumbered}</span></span>
<span id="cb44-980"><a href="#cb44-980"></a></span>
<span id="cb44-981"><a href="#cb44-981"></a>Answer these questions to check you have understood the main points covered in this chapter. Write between 50 and 100 words to answer each question.</span>
<span id="cb44-982"><a href="#cb44-982"></a></span>
<span id="cb44-983"><a href="#cb44-983"></a><span class="ss">1. </span>What are the key differences between messages, warnings, and errors in R? Provide an example of each and explain how they affect the execution of code.</span>
<span id="cb44-984"><a href="#cb44-984"></a><span class="ss">2. </span>Explain the difference between syntax errors and logical errors in R. Why are logical errors often harder to identify and fix?</span>
<span id="cb44-985"><a href="#cb44-985"></a><span class="ss">3. </span>Why is it important to check each line of code when debugging a block of R code? Describe a method for systematically isolating problematic lines.</span>
<span id="cb44-986"><a href="#cb44-986"></a><span class="ss">4. </span>What role do R manual pages play in understanding and fixing errors? How can you access these pages, and what key sections should you focus on?</span>
<span id="cb44-987"><a href="#cb44-987"></a><span class="ss">5. </span>Why is it dangerous to ignore warnings in your R code? Provide an example of how a warning could indicate a significant problem with your analysis.</span>
<span id="cb44-988"><a href="#cb44-988"></a>:::</span>
<span id="cb44-989"><a href="#cb44-989"></a></span>
<span id="cb44-990"><a href="#cb44-990"></a>&lt;p class="credits"&gt;&lt;a href="https://twitter.com/allison_horst"&gt;Artwork by @allison_horst&lt;/a&gt;&lt;/p&gt;</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://creativecommons.org/licenses/by/4.0/">
<p>This book is available under a Creative Commons Attribution 4.0 International licence</p>
</a>
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mpjashby/crimemappingbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>