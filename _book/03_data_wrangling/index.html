<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Wrangling data – Learn Crime Mapping with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../04_your_second_crime_map/index.html" rel="next">
<link href="../02_your_first_crime_map/index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-854d42f42d0f6b455b86ad16a464e311.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- START OF INCLUDED HEADER -->

<!--
This file contains code that will be included in the header of each page of the
quarto book
-->

<script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>

<!-- END OF INCLUDED HEADER -->


<link rel="stylesheet" href="../css/styles.css">
<link rel="stylesheet" href="../include/webex.css">
<meta name="twitter:title" content="3&nbsp; Wrangling data – Learn Crime Mapping with R">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="../images/cover_image.png">
<meta name="twitter:image:alt" content="">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../03_data_wrangling/index.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Wrangling data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/cover_image.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Learn Crime Mapping with R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/mpjashby/crimemappingbook/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contents</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Install the software needed for this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_getting_started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_your_first_crime_map/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Your first crime map</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_data_wrangling/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Wrangling data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_your_second_crime_map/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Your second crime map</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_code_with_style/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Code with style</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_mapping_crime_patterns/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Mapping crime patterns</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_map_context/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Giving a map context</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08_handling_bugs/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Handling bugs in your code</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../09_mapping_areas/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Mapping area data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../10_place_data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Using data about places</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../11_mapping_hotspots/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Mapping hotspots</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../12_messy_data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Handling messy data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../13_crime_series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Mapping crime series</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../14_writing_reports/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Writing reports in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../15_no_maps/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Presenting spatial data without maps</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../16_mapping_time/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Mapping crime over time</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/read_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Functions for reading data into R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/map_checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Checklist: Making a good crime map</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/common_errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Common R errors and how to fix them</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/functions_to_avoid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Some R functions you should avoid</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/handling_errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Checklist: handling code errors</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">In this chapter</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">3.1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions"><span class="header-section-number">3.1.1</span> Functions</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages"><span class="header-section-number">3.1.2</span> Packages</a></li>
  </ul></li>
  <li><a href="#sec-read-data" id="toc-sec-read-data" class="nav-link" data-scroll-target="#sec-read-data"><span class="header-section-number">3.2</span> Loading data</a>
  <ul class="collapse">
  <li><a href="#loading-csv-data" id="toc-loading-csv-data" class="nav-link" data-scroll-target="#loading-csv-data"><span class="header-section-number">3.2.1</span> Loading CSV data</a></li>
  <li><a href="#loading-excel-data" id="toc-loading-excel-data" class="nav-link" data-scroll-target="#loading-excel-data"><span class="header-section-number">3.2.2</span> Loading Excel data</a></li>
  </ul></li>
  <li><a href="#selecting-columns" id="toc-selecting-columns" class="nav-link" data-scroll-target="#selecting-columns"><span class="header-section-number">3.3</span> Selecting columns</a></li>
  <li><a href="#filtering-rows" id="toc-filtering-rows" class="nav-link" data-scroll-target="#filtering-rows"><span class="header-section-number">3.4</span> Filtering rows</a></li>
  <li><a href="#transforming-values" id="toc-transforming-values" class="nav-link" data-scroll-target="#transforming-values"><span class="header-section-number">3.5</span> Transforming values</a></li>
  <li><a href="#summarising-rows" id="toc-summarising-rows" class="nav-link" data-scroll-target="#summarising-rows"><span class="header-section-number">3.6</span> Summarising rows</a>
  <ul class="collapse">
  <li><a href="#counting-rows" id="toc-counting-rows" class="nav-link" data-scroll-target="#counting-rows"><span class="header-section-number">3.6.1</span> Counting rows</a></li>
  </ul></li>
  <li><a href="#arranging-rows" id="toc-arranging-rows" class="nav-link" data-scroll-target="#arranging-rows"><span class="header-section-number">3.7</span> Arranging rows</a></li>
  <li><a href="#saving-data" id="toc-saving-data" class="nav-link" data-scroll-target="#saving-data"><span class="header-section-number">3.8</span> Saving data</a></li>
  <li><a href="#sec-pipe-operator" id="toc-sec-pipe-operator" class="nav-link" data-scroll-target="#sec-pipe-operator"><span class="header-section-number">3.9</span> Stringing functions together</a></li>
  <li><a href="#in-summary" id="toc-in-summary" class="nav-link" data-scroll-target="#in-summary"><span class="header-section-number">3.10</span> In summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/mpjashby/crimemappingbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-wrangling-data" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Wrangling data</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="abstract">
<p>This chapter introduces the essential skills of data wrangling, an important step in preparing data for analysis and presentation. You’ll learn to load, filter, manipulate, and save datasets using R. This chapter guides you through handling tabular and Excel data formats, selecting relevant data, and applying functions from powerful R packages like tidyverse. By the end of this chapter you will be able to confidently transform raw data into a format ready for meaningful insights. Let’s dive in!</p>
</div>
<section id="introduction" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">3.1</span> Introduction</h2>
<p>A major step in using any data to make decisions or draw conclusions is <em>data wrangling</em>: the process of transforming data from the format in which we originally have it to the format needed to analyse and present it to our audience.</p>
<p class="full-width-image">
<img src="../images/datawrangling.jpg" alt="Cartoon of furry monsters putting boxes onto a conveyor belt with machines marked 'wrangle', 'vizualise' and 'model' adjusting the boxes as they move along the belt">
</p>
<!-- Start off by watching this video that walks through the different steps in wrangling a dataset. We will cover all the steps in the video in more detail during the rest of this chapter. -->
<!--  -->
<p>To get started, open RStudio and check that you are working in the Crime Mapping project you created previously. To do this, looking on the top right-hand corner of the RStudio window. If you see the text <code>Crime Mapping</code>, all is well. If you see the text <code>Project: (None)</code>, click on the downward triangle next to that text and then select the Crime Mapping project – this will cause RStudio to restart and open your project.</p>
<p>Now create a new R script file by clicking the <code>File</code> menu, then <code>New File</code> and then <code>R Script</code>. A new file will open in the left-hand panel in RStudio. Click <code>File</code> then <code>Save As...</code> to save this file in the project directory you created when you completed the previous chapter. Save the file as <code>chapter_03a.R</code>.</p>
<section id="functions" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="functions"><span class="header-section-number">3.1.1</span> Functions</h3>
<p>In this chapter we will learn how to wrangle data in R using <em>functions</em> – specialised pieces of code that do something to the data we give it. The code to use a function (sometimes called <em>calling</em> the function) has two parts: the function name followed by a pair of parentheses, inside which are zero or more <em>arguments</em> separated by commas. Arguments are a way of providing input that a function works on, or to fine-tune the way the function works (we will see many examples of this later). Remember that you can identify a function in R because the name will always have parentheses after it.</p>
<p>One basic R function is <code>sqrt()</code>, which calculates the square root of a number. The <code>sqrt()</code> function has only one argument: the number that we want to find the square root of. If we typed the following code into the R Console, R would show us the square root of 2.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">sqrt</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>When you run code in R, by default R prints the output of your code – in this case, just the number <code>1.414214</code> (for now, you can ignore the number <code>[1]</code> in square brackets).</p>
</section>
<section id="packages" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="packages"><span class="header-section-number">3.1.2</span> Packages</h3>
<p>R contains thousands of different functions that do different things. A few functions are contained in the default installation of R that you have already installed (this is sometimes referred to as <em>base R</em>). But most functions are contained in <em>packages</em>, which are extensions to base R. Most packages focus on a particular type of data analysis, so that there are packages devoted to time-series analysis, testing whether events are clustered in particular places, network analysis and thousands of other tasks. Packages are often developed by experts in the field, and are typically updated to introduce new features.</p>
<p>To use a package in R, we must do two things:</p>
<ul>
<li><em>install</em> the package, which we have to do just once on each computer we want to use, then</li>
<li><em>load</em> the package, which we have to do each time we restart R (which happens when we open RStudio or switch between projects).</li>
</ul>
<p>The <code>install.packages()</code> function downloads and installs packages from the <a href="https://cran.r-project.org/">Comprehensive R Archive Network</a> (universally known as CRAN), which contains about 22,000 different packages. Some packages that are still in the early stages of development are not available on CRAN, but all the packages we will use are there.</p>
<p><a href="https://tidyverse.org/" title="tidyverse website"><img src="../images/tidyverse.png" class="right-side-image"></a></p>
<p>So to install (for example) the package called <code>tidyverse</code>, which we will use extensively in this chapter, we would run the R code:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>We only have to <em>install</em> a package once for each computer that we will use to run R, although we would have to do it again if we updated to a new version of R.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Never add <code>install.packages()</code> to an R script
</div>
</div>
<div class="callout-body-container callout-body">
<p>You should only ever use the <code>install.packages()</code> function in the R Console, never in an R script. There are two reasons for this:</p>
<ul>
<li>When you share your code with other people – which you will do often in this course – they may have their system set up in such a way that running <code>install.packages()</code> in a script file might cause other code on their computer to stop working.</li>
<li>Since you don’t need to install a package every time you need it (you only need to install it once), your code will run much more slowly if you needlessly install packages every time you run your code.</li>
</ul>
</div>
</div>
<p>Once a package is installed on our computer, we have to <em>load</em> it so that we can use it in our code. We load packages using the <code>p_load()</code> function from the <a href="https://trinker.github.io/pacman_dev/">pacman package</a>. So to load the tidyverse package, we run the code:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter_03a.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Load packages</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why does this line of code start with <code>pacman::</code>?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The pacman package is an R package that is used to manage other R packages. The <code>p_load()</code> function from that package is used to load packages. But we learned above that we must load a package before we can use it, which means we cannot use functions from the pacman package until we have loaded the pacman package. To get around that, instead of just using the function name <code>p_load()</code>, we can instead specify which package <code>p_load()</code> is from by prefixing the function name with the relevant package name, separated by <code>::</code>.</p>
</div>
</div>
</div>
<p>One major advantage of using <code>p_load()</code> to load packages is that before loading any packages, this function will first install them if they have not already been installed on the computer we are using. This means that once we have the pacman package installed we won’t need to worry about whether a package is installed or not – we can just load the package, knowing it will automatically be installed if necessary.</p>
<p>Many packages are focused on specialist tasks and so are only used occasionally, but a few packages are likely to be useful in almost all the code we write. Fortunately, packages can themselves load other packages, and all the main packages we need are loaded by the <code>tidyverse</code> package. That is why you will often see <code>pacman::p_load(tidyverse)</code> at the top of R code in subsequent chapters – that short line of code loads several packages containing hundreds of functions that we can use in data analysis.</p>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data wrangling
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What is the purpose of data wrangling?</strong></p>
<div id="radio_HROUJQZZQF" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_HROUJQZZQF" value=""> <span>The process of collecting data from multiple sources.</span></label><label><input type="radio" autocomplete="off" name="radio_HROUJQZZQF" value="answer"> <span>The process of transforming raw data into a format suitable for analysis.</span></label><label><input type="radio" autocomplete="off" name="radio_HROUJQZZQF" value=""> <span>The process of visualizing data on a map.</span></label><label><input type="radio" autocomplete="off" name="radio_HROUJQZZQF" value=""> <span>The process of cleaning corrupted data files.</span></label>
</div>
<p><strong>In general, what is a <em>function</em> in R?</strong></p>
<div id="radio_CMIEGIESJM" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_CMIEGIESJM" value=""> <span>A visual representation of data.</span></label><label><input type="radio" autocomplete="off" name="radio_CMIEGIESJM" value=""> <span>A mathematical formula used in graphs.</span></label><label><input type="radio" autocomplete="off" name="radio_CMIEGIESJM" value=""> <span>A set of instructions for saving data.</span></label><label><input type="radio" autocomplete="off" name="radio_CMIEGIESJM" value="answer"> <span>A specialized piece of code that performs a task on data.</span></label>
</div>
</div>
</div>
</section>
</section>
<section id="sec-read-data" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-read-data"><span class="header-section-number">3.2</span> Loading data</h2>
<p>Before we can do anything with any data, we have to load it into R. In this course we will read tabular data in comma-separated values (CSV) and Excel formats, as well as spatial data in different formats (because there are lots of ways to store spatial data). We will learn how to read CSV and Excel data now, but leave loading spatial data until later.</p>
<p><em>Tabular data</em> (sometimes known as <em>rectangular data</em>) describes data formats with multiple columns where every column has the same number of rows. For example, crime data might have columns for the type of crime, date and address at which the crime occurred.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Crime data in rectangular format</caption>
<thead>
<tr class="header">
<th style="text-align: left;">type</th>
<th style="text-align: left;">date</th>
<th style="text-align: left;">address</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">homicide</td>
<td style="text-align: left;">14 Feb 2024</td>
<td style="text-align: left;">274 Main St</td>
</tr>
<tr class="even">
<td style="text-align: left;">non-residential burglary</td>
<td style="text-align: left;">24 Sep 2024</td>
<td style="text-align: left;">541 Station Rd</td>
</tr>
<tr class="odd">
<td style="text-align: left;">personal robbery</td>
<td style="text-align: left;">27 Jan 2025</td>
<td style="text-align: left;">10 North Av</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Almost all the data we will use in this course will be in this rectangular format, and most of the functions we will use expect data to be rectangular.</p>
<section id="loading-csv-data" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="loading-csv-data"><span class="header-section-number">3.2.1</span> Loading CSV data</h3>
<p><a href="https://readr.tidyverse.org/" title="readr website"><img src="../images/readr.png" class="right-side-image"></a></p>
<p>Data stored in CSV format is easy to load with the <code>read_csv()</code> function from the <a href="https://readr.tidyverse.org">readr package</a>. readr is one of the packages loaded by the tidyverse package, so all we need to do to use this package is include the code <code>pacman::p_load(tidyverse)</code> on the first line of our R script. We will use comments (lines of code beginning with <code>#</code>) to help explain the code as we go.</p>
<p><code>read_csv()</code> can handle data stored <em>locally</em> on your computer, as well as data stored <em>remotely</em> on an external website. During this course, most of the data we will use will be remote data stored on the <a href="https://pkgs.lesscrime.info/crimemappingdata/">crimemappingdata website</a>.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># We can load data from a file in the same folder as our R script</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>san_fran_rob <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"san_francisco_robbery.csv"</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co"># Or another folder on your computer ('../' is short for the parent </span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co"># folder of the current folder)</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>san_fran_rob <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../san_francisco_robbery.csv"</span>)</span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co"># Or directly from a file online</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>san_fran_rob <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"http://example.com/san_francisco_robbery.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>In each of these examples, the code stores the result of the <code>read_csv()</code> function in an <em>object</em> named <code>san_fran_rob</code>. Objects are places where we can store data. To create an object and store our data in it, we use the assignment operator <code>&lt;-</code> (a less-than sign followed by a dash). Continually typing <code>&lt;-</code> can be tedious, so in RStudio we can use the keyboard short cut <code>Option+-</code> (on Mac) or <code>Alt+-</code> (on Windows or Linux) to insert the complete operator.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Object names can be overwritten
</div>
</div>
<div class="callout-body-container callout-body">
<p>When choosing object names, it is important to remember that if you assign a value (such as the number <code>1</code> or the result of the function <code>read_csv()</code>) to an object name, R will overwrite any existing value of that object name. We can see this in a simple example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>one_to_ten <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>one_to_ten <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we were to run this code, the object <code>one_to_ten</code> would not actually hold the numbers from one to ten, but instead the value 1.414214 (the square root of two). There is no way to undo assignment of a value to an object, so once you have run the code <code>one_to_ten &lt;- sqrt(2)</code> it is not possible to recover any previous value that was assigned to the object <code>one_to_ten</code>.</p>
</div>
</div>
<p>Objects come in several different types, with tabular data typically being stored as a <em>data frame</em>. The <code>read_csv()</code> function actually produces a modern variation on the data frame called (slightly strangely) a <em>tibble</em>, which makes use of some advances in how R handles data since the data-frame format was set 20 years ago. Tibbles behave just like data frames almost all of the time (so much so that people working with tibbles often call them data frames) except for a few occasions where they behave in a more-convenient way. We will always use tibbles instead of data frames in this course.</p>
<p>We can use <code>read_csv()</code> to load data from <code>https://mpjashby.github.io/crimemappingdata/san_francisco_robbery.csv</code> and store it in an object called <code>san_fran_rob</code>. Add this code to the script file <code>chapter_03a.R</code> and then run that code as you learned about in <a href="../02_your_first_crime_map/index.html#sec-loading-packages" class="quarto-xref"><span>Section 2.3.1</span></a>.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter_03a.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Load San Francisco robbery data</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>san_fran_rob <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/san_francisco_robbery.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>Rows: 951 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (1): offense_type
dbl  (3): uid, longitude, latitude
dttm (1): date_time

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>If the data are loaded successfully, R will list the columns in the data and the type of variable (numeric, date etc.) stored in each column. The format of this is somewhat esoteric, but if you are interested they are explained in the ‘Extra detail’ box below.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What do the messages produced by <code>read_csv()</code> mean?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>By default, the <code>read_csv()</code> function prints a message when it loads data to summarise the format of each data column. In the case of the <code>san_fran_rob</code> dataset, <code>read_csv()</code> tells us that:</p>
<ul>
<li>there is one column called <code>offense_type</code> that contains character (<code>chr</code>) values,</li>
<li>there are three columns called <code>uid</code>, <code>longitude</code> and <code>latitude</code> containing numeric (<code>dbl</code>) values, and</li>
<li>there is one column called <code>date_time</code> that contains values stored as dates and times (<code>dttm</code>).</li>
</ul>
<p>There are some other possible types of data, but we will learn about these later on. The numeric values are referred to as <code>dbl</code> values because they are stored in a format that can handle numbers that are not whole numbers (e.g.&nbsp;123.456). This format for storing numbers is called the double-precision floating-point format, which is often known as the double format for short. Most numbers in R are stored in double format, so you can think of the format code <code>dbl</code> as meaning ‘numeric’.</p>
</div>
</div>
</div>
<p>To see the first few rows of data currently stored in an object, we can use the <code>head()</code> function.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">head</span>(san_fran_rob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 6 × 5
       uid offense_type     date_time           longitude latitude
     &lt;dbl&gt; &lt;chr&gt;            &lt;dttm&gt;                  &lt;dbl&gt;    &lt;dbl&gt;
1 24103841 personal robbery 2019-01-01 19:50:00     -122.     37.8
2 24103948 personal robbery 2019-01-02 08:00:00     -122.     37.8
3 24104162 personal robbery 2019-01-03 00:30:00     -122.     37.8
4 24104203 personal robbery 2019-01-03 03:13:00     -122.     37.8
5 24104237 personal robbery 2019-01-03 09:30:00     -122.     37.7
6 24104238 personal robbery 2019-01-03 09:30:00     -122.     37.7</code></pre>
</div>
</div>
</section>
<section id="loading-excel-data" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="loading-excel-data"><span class="header-section-number">3.2.2</span> Loading Excel data</h3>
<p><a href="https://readxl.tidyverse.org/" title="readxl website"><img src="../images/readxl.png" class="right-side-image"></a></p>
<p>Loading data from Microsoft Excel files is very similar to loading CSV data, with a few important differences. Functions to load Excel data are contained in the <code>readxl</code> package.</p>
<p>There are two main things we must do to import Excel data that are not required for importing CSV data. The first is that the <code>readxl</code> package cannot directly load files from a URL, instead only loading files that are present on your computer. To get round this, we will first download an Excel file and store it in a temporary directory (to avoid cluttering up our computers).</p>
<p>To practice loading data from an Excel file, create a new R script file called <code>chapter_03b.R</code> and paste the following code into it, then run the code.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter_03b.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Load packages</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(readxl, tidyverse)</span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co"># Specify the name of and location of our temporary file: it does not matter</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co"># what this file is called or where it is stored, so we use the tempfile()</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co"># function to create a file in the correct location automatically</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>temp_file <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">".xlsx"</span>)</span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co"># Download the Excel file and store it in the temporary location</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="fu">download.file</span>(</span>
<span id="cb10-11"><a href="#cb10-11"></a>  <span class="at">url =</span> <span class="st">"https://mpjashby.github.io/crimemappingdata/aggravated_assaults.xlsx"</span>,</span>
<span id="cb10-12"><a href="#cb10-12"></a>  <span class="at">destfile =</span> temp_file,</span>
<span id="cb10-13"><a href="#cb10-13"></a>  <span class="at">mode =</span> <span class="st">"wb"</span></span>
<span id="cb10-14"><a href="#cb10-14"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The <code>download.file()</code> function does not produce any output if the file has been successfully downloaded, so you will not see any output when you run this code.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Using <code>download.file()</code> on Windows</strong></p>
<p>If you are using a Windows computer, you may find that the <code>download.file()</code> function in the code below does not work as expected. This is because Windows handles files in a way that distinguishes between <em>plain-text</em> files such as <code>.txt</code> and <code>.csv</code> files and <em>binary</em> files, which includes most other file types (including compressed files). Since Excel files are not plain-text files, on Windows you need to specify that you want them to be downloaded as a binary file. To do this, add the argument <code>mode = "wb"</code> to the <code>download.file()</code> function so that it reads:</p>
<div class="sourceCode" id="cb11" data-code-line-numbers=""><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">download.file</span>(</span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="at">url =</span> <span class="st">"https://mpjashby.github.io/crimemappingdata/aggravated_assaults.xlsx"</span>,</span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="at">destfile =</span> temp_file,</span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="at">mode =</span> <span class="st">"wb"</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you are using a Mac or a Linux computer then you do not need to worry about this.</p>
</div>
</div>
<p>Now we have downloaded our data, we can load it into R. Since Excel files can contain multiple sheets, we need to specify which sheet we would like to load into a tibble. We can use the <code>excel_sheets()</code> function to get a list of sheets in an Excel file:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Get a list of sheets in an Excel file</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">excel_sheets</span>(temp_file)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] "Austin"     "Fort Worth" "Seattle"   </code></pre>
</div>
</div>
<p>We can now load the sheet containing data for Austin and view the first few rows of the resulting object:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter_03b.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>agg_assault_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(temp_file, <span class="at">sheet =</span> <span class="st">"Austin"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>and, as usual, we can use the <code>head()</code> function to look at the data:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb15" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">head</span>(agg_assault_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 6 × 5
  date                longitude latitude location_type location_category
  &lt;dttm&gt;                  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;            
1 2019-01-01 00:00:00     -97.7     30.3 residence     residence        
2 2019-01-01 00:00:00     -97.8     30.2 residence     residence        
3 2019-01-01 00:01:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
4 2019-01-01 00:15:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
5 2019-01-01 00:27:00     -97.8     30.2 residence     residence        
6 2019-01-01 00:30:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             </code></pre>
</div>
</div>
<p>Now we have learned how to load our data into an object, we can use other R functions to work with that data in many different ways.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Different types of data are loaded into R with different functions, e.g.&nbsp;CSV files are loaded with the <code>read_csv()</code> function from the <code>readr</code> package and Microsoft Excel files are loaded with the <code>read_excel()</code> function from the <code>readxl</code> package. <a href="../appendices/read_functions.html" class="quarto-xref"><span>Appendix A</span></a> has a list of which function to use to load each type of file.</p>
</div>
</div>
<div class="box reading">
<p><a href="https://r4ds.had.co.nz/data-import.html">Learn more about how to read data into R</a> by reading this chapter of the free online book <a href="https://r4ds.had.co.nz/">R for Data Science</a>.</p>
<p>Excel data can often be messy and the <code>readxl</code> package contains various other functions that can be used to deal with this. You can <a href="http://lesscrime.info/post/cleaning-ons-data/">learn more about how to handle messy Excel data in this online tutorial</a>.</p>
</div>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reading data
</div>
</div>
<div class="callout-body-container callout-body">
<p>Answer the following questions to check your understanding of what we’ve learned so far in this chapter. If you get a question wrong, you can keep trying until you get the right answer.</p>
<p><strong>What R package contains the function <code>read_csv()</code> to read CSV data?</strong></p>
<div id="radio_UOQYPYIYXF" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_UOQYPYIYXF" value=""> <span><code>readxl</code></span></label><label><input type="radio" autocomplete="off" name="radio_UOQYPYIYXF" value=""> <span><code>reader</code></span></label><label><input type="radio" autocomplete="off" name="radio_UOQYPYIYXF" value="answer"> <span><code>readr</code></span></label><label><input type="radio" autocomplete="off" name="radio_UOQYPYIYXF" value=""> <span><code>readcsv</code></span></label>
</div>
<p><strong>What R code prints the first few rows of the tibble called <code>san_fran_rob</code>?</strong></p>
<div id="radio_OHAZFVQWBW" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_OHAZFVQWBW" value=""> <span><code>message(san_fran_rob)</code></span></label><label><input type="radio" autocomplete="off" name="radio_OHAZFVQWBW" value=""> <span><code>summary(san_fran_rob)</code></span></label><label><input type="radio" autocomplete="off" name="radio_OHAZFVQWBW" value=""> <span><code>peak_inside(san_fran_rob)</code></span></label><label><input type="radio" autocomplete="off" name="radio_OHAZFVQWBW" value="answer"> <span><code>head(san_fran_rob)</code></span></label>
</div>
<p><strong>If we create an object using the code <code>number_ten &lt;- 10</code> and then run the code <code>number_ten &lt;- sqrt(2)</code>, what value will the object <code>number_ten</code> now have?</strong></p>
<div id="radio_MEUKQGPLLQ" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_MEUKQGPLLQ" value=""> <span><code>10</code> (the number 10)</span></label><label><input type="radio" autocomplete="off" name="radio_MEUKQGPLLQ" value="answer"> <span><code>1.414214</code> (the square root of 2)</span></label><label><input type="radio" autocomplete="off" name="radio_MEUKQGPLLQ" value=""> <span><code>10.41421</code> (10 plus the square root of 2)</span></label><label><input type="radio" autocomplete="off" name="radio_MEUKQGPLLQ" value=""> <span><code>14.14214</code> (10 times the square root of 2)</span></label>
</div>
</div>
</div>
</section>
</section>
<section id="selecting-columns" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="selecting-columns"><span class="header-section-number">3.3</span> Selecting columns</h2>
<p>In this section we will learn how to reduce the size of our data by selecting only the columns we need and discarding the rest. This can be particularly useful if we are working with a very-large dataset, or if we want to produce a table containing only some columns.</p>
<p class="full-width-image">
<img src="../images/dplyr.jpg" alt="Cartoon showing a furry monster with 'dplyr' written on it wrangling a bunch of smaller, unruly, monsters.">
</p>
<p>We can use the <code>select()</code> function from the <a href="https://dplyr.tidyverse.org/">dplyr package</a> (one of the packages that is loaded automatically when we call the <code>pacman::p_load(tidyverse)</code> function) to select columns.</p>
<p>If we wanted to select just the <code>date</code> and <code>location_type</code> columns from the <code>agg_assault_data</code> we loaded in the previous section, we can use this code:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb17" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">select</span>(agg_assault_data, date, location_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 8,696 × 2
   date                location_type
   &lt;dttm&gt;              &lt;chr&gt;        
 1 2019-01-01 00:00:00 residence    
 2 2019-01-01 00:00:00 residence    
 3 2019-01-01 00:01:00 &lt;NA&gt;         
 4 2019-01-01 00:15:00 &lt;NA&gt;         
 5 2019-01-01 00:27:00 residence    
 6 2019-01-01 00:30:00 &lt;NA&gt;         
 7 2019-01-01 00:51:00 &lt;NA&gt;         
 8 2019-01-01 01:00:00 residence    
 9 2019-01-01 01:00:00 &lt;NA&gt;         
10 2019-01-01 01:12:00 residence    
# ℹ 8,686 more rows</code></pre>
</div>
</div>
<p><a href="https://dplyr.tidyverse.org/" title="dplyr website"><img src="../images/dplyr.png" class="right-side-image"></a></p>
<p>In a previous section, we mentioned that the code needed to run (or <em>call</em>) a function in R has two parts: the function name followed by a pair of parentheses, inside which are zero or more <em>arguments</em> separated by commas. The arguments in the <code>select()</code> function (and many other functions in the <code>dplyr</code> package) work in a slightly different way to many other functions. Here, the first argument is the name of the data object that we want to select from. All the remaining arguments (here, <code>date</code> and <code>location_type</code>) are the names of the columns we want to select from the data.</p>
<p>We can select as many columns as we want, by just adding the names of the columns separated by commas. The columns in our new dataset will appear in the order in which we specify them in the <code>select()</code> function.</p>
<p>We can also use <code>select()</code> to rename columns at the same time as selecting them. For example, to select the columns <code>date</code> and <code>location_type</code> while also renaming <code>location_type</code> to be called <code>type</code>, can use:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb19" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">select</span>(agg_assault_data, date, <span class="at">type =</span> location_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 8,696 × 2
   date                type     
   &lt;dttm&gt;              &lt;chr&gt;    
 1 2019-01-01 00:00:00 residence
 2 2019-01-01 00:00:00 residence
 3 2019-01-01 00:01:00 &lt;NA&gt;     
 4 2019-01-01 00:15:00 &lt;NA&gt;     
 5 2019-01-01 00:27:00 residence
 6 2019-01-01 00:30:00 &lt;NA&gt;     
 7 2019-01-01 00:51:00 &lt;NA&gt;     
 8 2019-01-01 01:00:00 residence
 9 2019-01-01 01:00:00 &lt;NA&gt;     
10 2019-01-01 01:12:00 residence
# ℹ 8,686 more rows</code></pre>
</div>
</div>
<p><code>select()</code> removes any columns that we don’t explicitly choose to keep. If we want to rename a column while keeping <em>all</em> the existing columns in the data, we can instead use the <code>rename()</code> function (also from the dplyr package):</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb21" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">rename</span>(agg_assault_data, <span class="at">type =</span> location_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 8,696 × 5
   date                longitude latitude type      location_category
   &lt;dttm&gt;                  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;            
 1 2019-01-01 00:00:00     -97.7     30.3 residence residence        
 2 2019-01-01 00:00:00     -97.8     30.2 residence residence        
 3 2019-01-01 00:01:00     -97.7     30.3 &lt;NA&gt;      &lt;NA&gt;             
 4 2019-01-01 00:15:00     -97.7     30.3 &lt;NA&gt;      &lt;NA&gt;             
 5 2019-01-01 00:27:00     -97.8     30.2 residence residence        
 6 2019-01-01 00:30:00     -97.7     30.3 &lt;NA&gt;      &lt;NA&gt;             
 7 2019-01-01 00:51:00     -97.7     30.3 &lt;NA&gt;      &lt;NA&gt;             
 8 2019-01-01 01:00:00     -97.7     30.4 residence residence        
 9 2019-01-01 01:00:00     -97.7     30.3 &lt;NA&gt;      &lt;NA&gt;             
10 2019-01-01 01:12:00     -97.7     30.3 residence residence        
# ℹ 8,686 more rows</code></pre>
</div>
</div>
<p>Remember that functions in R generally do not change existing objects, but instead produce (or <em>return</em>) new ones. This means if we want to store the result of this function so we can use it later, we have to assign the value returned by the function to a new object (or overwrite the existing object):</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb23" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>agg_assault_locations <span class="ot">&lt;-</span> <span class="fu">select</span>(agg_assault_data, <span class="at">lon =</span> longitude, <span class="at">lat =</span> latitude)</span>
<span id="cb23-2"><a href="#cb23-2"></a></span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="fu">head</span>(agg_assault_locations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 6 × 2
    lon   lat
  &lt;dbl&gt; &lt;dbl&gt;
1 -97.7  30.3
2 -97.8  30.2
3 -97.7  30.3
4 -97.7  30.3
5 -97.8  30.2
6 -97.7  30.3</code></pre>
</div>
</div>
<div class="box reading">
<p>You can learn more about selecting, filtering and arranging data using the functions in the <code>dplyr</code> package by reading this <a href="https://dplyr.tidyverse.org/articles/dplyr.html">Introduction to dplyr tutorial</a>.</p>
</div>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>select()</code> and <code>rename()</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Which <code>dplyr</code> function allows you to change the name of columns while keeping all the columns in the original data</strong></p>
<div id="radio_QHJXFCBCET" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_QHJXFCBCET" value="answer"> <span><code>rename()</code></span></label><label><input type="radio" autocomplete="off" name="radio_QHJXFCBCET" value=""> <span><code>select()</code></span></label>
</div>
<p><strong>Which <code>dplyr</code> function allows you to choose only some columns in the original data?</strong></p>
<div id="radio_BUCPUIVHRB" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_BUCPUIVHRB" value=""> <span><code>rename()</code></span></label><label><input type="radio" autocomplete="off" name="radio_BUCPUIVHRB" value="answer"> <span><code>select()</code></span></label>
</div>
</div>
</div>
</section>
<section id="filtering-rows" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="filtering-rows"><span class="header-section-number">3.4</span> Filtering rows</h2>
<p>Often in crime mapping we will only be interested in part of a particular dataset. In the same way that we can <em>select</em> particular <em>columns</em> in our data, we can <em>filter</em> particular <em>rows</em> using the <code>filter()</code> function from the dplyr package.</p>
<p class="full-width-image">
<img src="../images/filter.jpg" alt="Cartoon showing monsters explaining how the filter() function works.">
</p>
<p>If we were only interested in offences in the <code>agg_assault_data</code> dataset that occurred in residences, we could use <code>filter()</code>:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb25" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="fu">filter</span>(agg_assault_data, location_type <span class="sc">==</span> <span class="st">"residence"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 4,385 × 5
   date                longitude latitude location_type location_category
   &lt;dttm&gt;                  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;            
 1 2019-01-01 00:00:00     -97.7     30.3 residence     residence        
 2 2019-01-01 00:00:00     -97.8     30.2 residence     residence        
 3 2019-01-01 00:27:00     -97.8     30.2 residence     residence        
 4 2019-01-01 01:00:00     -97.7     30.4 residence     residence        
 5 2019-01-01 01:12:00     -97.7     30.3 residence     residence        
 6 2019-01-01 01:20:00     -97.7     30.4 residence     residence        
 7 2019-01-01 01:50:00     -97.7     30.3 residence     residence        
 8 2019-01-01 02:21:00     -97.8     30.2 residence     residence        
 9 2019-01-01 02:26:00     -97.8     30.2 residence     residence        
10 2019-01-01 02:35:00     -97.7     30.4 residence     residence        
# ℹ 4,375 more rows</code></pre>
</div>
</div>
<p>Note that:</p>
<ul>
<li>the column <em>name</em> <code>location_type</code> is not surrounded by quotes (because it represents a column in the data) but the column <em>value</em> <code>"residence"</code> is (because it represents the <em>literal</em> character value “residence”), and</li>
<li>the <code>==</code> (equal to) operator is used, since a single equals sign <code>=</code> has another meaning in R.</li>
</ul>
<p>We can filter using the values of more than one column simultaneously. To filter offences in which the <code>location_category</code> is ‘retail’ and the <code>location_type</code> is ‘convenience store’:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb27" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">filter</span>(agg_assault_data, </span>
<span id="cb27-2"><a href="#cb27-2"></a>  location_category <span class="sc">==</span> <span class="st">"retail"</span>, </span>
<span id="cb27-3"><a href="#cb27-3"></a>  location_type <span class="sc">==</span> <span class="st">"convenience store"</span></span>
<span id="cb27-4"><a href="#cb27-4"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 90 × 5
   date                longitude latitude location_type     location_category
   &lt;dttm&gt;                  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;             &lt;chr&gt;            
 1 2019-01-06 16:58:00     -97.8     30.5 convenience store retail           
 2 2019-01-08 17:56:00     -97.7     30.3 convenience store retail           
 3 2019-01-10 01:25:00     -97.7     30.4 convenience store retail           
 4 2019-01-12 00:49:00     -97.6     30.4 convenience store retail           
 5 2019-01-12 05:53:00     -97.7     30.4 convenience store retail           
 6 2019-01-12 17:01:00     -97.7     30.4 convenience store retail           
 7 2019-01-12 19:12:00     -97.8     30.3 convenience store retail           
 8 2019-01-12 19:14:00     -97.7     30.4 convenience store retail           
 9 2019-01-13 04:10:00     -97.8     30.2 convenience store retail           
10 2019-01-22 22:01:00     -97.7     30.3 convenience store retail           
# ℹ 80 more rows</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>filter()</code> returns rows that meet <em>all</em> the criteria you specify
</div>
</div>
<div class="callout-body-container callout-body">
<p>When you run the code above, the result will contain only those rows in the original data for which the <code>location_category</code> column has the value ‘retail’ <em>and</em> the <code>location_type</code> column has the value ‘convenience store’.</p>
</div>
</div>
<p>As well as filtering using the <code>==</code> (equals) operator, we can filter using the greater-than (<code>&gt;</code>), less-than (<code>&lt;</code>), greater-than-or-equal-to (<code>&gt;=</code>) and less-than-or-equal-to (<code>&lt;=</code>) operators. For example, we can choose offences that occurred in residences on or after 1 July 2019:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb29" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">filter</span>(</span>
<span id="cb29-2"><a href="#cb29-2"></a>  agg_assault_data, </span>
<span id="cb29-3"><a href="#cb29-3"></a>  location_type <span class="sc">==</span> <span class="st">"residence"</span>, </span>
<span id="cb29-4"><a href="#cb29-4"></a>  date <span class="sc">&gt;=</span> <span class="fu">ymd</span>(<span class="st">"2019-07-01"</span>)</span>
<span id="cb29-5"><a href="#cb29-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 2,286 × 5
   date                longitude latitude location_type location_category
   &lt;dttm&gt;                  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;            
 1 2019-07-01 02:40:00     -97.8     30.4 residence     residence        
 2 2019-07-01 07:26:00     -97.7     30.3 residence     residence        
 3 2019-07-01 08:25:00     -97.8     30.2 residence     residence        
 4 2019-07-01 09:39:00     -97.7     30.3 residence     residence        
 5 2019-07-01 09:40:00     -97.7     30.4 residence     residence        
 6 2019-07-01 16:24:00     -97.8     30.1 residence     residence        
 7 2019-07-01 17:30:00     -97.8     30.2 residence     residence        
 8 2019-07-01 17:41:00     -97.8     30.2 residence     residence        
 9 2019-07-01 18:03:00     -97.8     30.2 residence     residence        
10 2019-07-01 18:16:00     -97.8     30.1 residence     residence        
# ℹ 2,276 more rows</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What does the <code>ymd()</code> function do?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The <code>ymd()</code> function from the lubridate package (which we will find out more about below) converts a date stored as a text value to a value that R understands represents a calendar date. The function is called <code>ymd()</code> because it processes dates that are stored in year-month-date format. We will learn more about working with dates in <a href="../16_mapping_time/index.html" class="quarto-xref"><span>Chapter 16</span></a>.</p>
</div>
</div>
</div>
<p>Sometimes we will want to filter rows that are one thing <em>or</em> another. We can do this with the <code>|</code> (or) operator. For example, we can filter offences that occurred either in leisure facilities <em>or</em> shopping malls on or after 1 July 2019:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb31" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="fu">filter</span>(</span>
<span id="cb31-2"><a href="#cb31-2"></a>  agg_assault_data, </span>
<span id="cb31-3"><a href="#cb31-3"></a>  location_category <span class="sc">==</span> <span class="st">"leisure"</span> <span class="sc">|</span> location_type <span class="sc">==</span> <span class="st">"mall"</span>, </span>
<span id="cb31-4"><a href="#cb31-4"></a>  date <span class="sc">&gt;=</span> <span class="fu">ymd</span>(<span class="st">"2019-07-01"</span>)</span>
<span id="cb31-5"><a href="#cb31-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 10 × 5
   date                longitude latitude location_type location_category
   &lt;dttm&gt;                  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;            
 1 2019-07-01 09:00:00     -97.7     30.3 entertainment leisure          
 2 2019-07-15 14:06:00     -97.8     30.3 mall          retail           
 3 2019-08-06 23:20:00     -97.7     30.4 mall          retail           
 4 2019-08-18 13:31:00     -97.7     30.3 mall          retail           
 5 2019-08-25 15:35:00     -97.8     30.3 mall          retail           
 6 2019-09-06 15:58:00     -97.7     30.4 mall          retail           
 7 2019-10-05 16:47:00     -97.7     30.2 mall          retail           
 8 2019-11-01 22:23:00     -97.7     30.3 entertainment leisure          
 9 2019-11-18 16:29:00     -97.7     30.4 mall          retail           
10 2019-11-27 14:14:00     -97.8     30.3 mall          retail           </code></pre>
</div>
</div>
<p>If we want to filter offences that have any one of several different values of the same column, we can use the <code>%in%</code> (in) operator. To filter offences that occurred in either streets or publicly accessible open spaces:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb33" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="fu">filter</span>(agg_assault_data, location_category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"open space"</span>, <span class="st">"street"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 165 × 5
   date                longitude latitude location_type location_category
   &lt;dttm&gt;                  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;            
 1 2019-01-07 21:37:00     -97.8     30.5 green space   open space       
 2 2019-01-08 14:02:00     -97.7     30.3 green space   open space       
 3 2019-01-10 01:59:00     -97.6     30.3 green space   open space       
 4 2019-01-11 17:00:00     -97.7     30.3 green space   open space       
 5 2019-01-12 15:50:00     -97.8     30.2 green space   open space       
 6 2019-01-12 16:00:00     -97.8     30.4 green space   open space       
 7 2019-01-15 07:20:00     -97.7     30.2 green space   open space       
 8 2019-01-17 00:00:00     -97.7     30.4 green space   open space       
 9 2019-01-22 22:00:00     -97.7     30.2 green space   open space       
10 2019-01-29 01:40:00     -97.7     30.2 green space   open space       
# ℹ 155 more rows</code></pre>
</div>
</div>
<p>The code <code>c("open space", "street")</code> produces what is referred to in R as a <em>vector</em> (sometimes referred to as an <em>atomic vector</em>, especially in error messages). A vector is a one-dimensional sequence of values of the same type (i.e.&nbsp;all numbers, all character strings etc.). For example, a vector might hold several strings of text (as in the vector <code>c("open space", "street")</code>) or a series of numbers such as <code>c(1, 2, 3)</code>. There is lots we could learn about vectors, but for now it’s only necessary to know that we can create vectors with the <code>c()</code> or <em>combine</em> function.</p>
<p>If we wanted to re-use a vector of values several times in our code, it might make sense to store the vector as an object. For example:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb35" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Create vector of location types we are interested in</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>location_types <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"open space"</span>, <span class="st">"street"</span>)</span>
<span id="cb35-3"><a href="#cb35-3"></a></span>
<span id="cb35-4"><a href="#cb35-4"></a><span class="co"># Filter the data</span></span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="fu">filter</span>(agg_assault_data, location_category <span class="sc">%in%</span> location_types)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 165 × 5
   date                longitude latitude location_type location_category
   &lt;dttm&gt;                  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;            
 1 2019-01-07 21:37:00     -97.8     30.5 green space   open space       
 2 2019-01-08 14:02:00     -97.7     30.3 green space   open space       
 3 2019-01-10 01:59:00     -97.6     30.3 green space   open space       
 4 2019-01-11 17:00:00     -97.7     30.3 green space   open space       
 5 2019-01-12 15:50:00     -97.8     30.2 green space   open space       
 6 2019-01-12 16:00:00     -97.8     30.4 green space   open space       
 7 2019-01-15 07:20:00     -97.7     30.2 green space   open space       
 8 2019-01-17 00:00:00     -97.7     30.4 green space   open space       
 9 2019-01-22 22:00:00     -97.7     30.2 green space   open space       
10 2019-01-29 01:40:00     -97.7     30.2 green space   open space       
# ℹ 155 more rows</code></pre>
</div>
</div>
<p>Finally, you can filter based on the output of any R function that returns <code>TRUE</code> or <code>FALSE</code>. For example, missing values are represented in R as <code>NA</code>. We can test whether a value is missing using the <code>is.na()</code> function. If we wanted to remove rows from our data that had missing location types, we would filter for those rows that are <em>not</em> <code>NA</code>. We can do this by combining the <code>is.na()</code> function with the <code>!</code> (not) operator:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb37" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="fu">filter</span>(agg_assault_data, <span class="sc">!</span><span class="fu">is.na</span>(location_type))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 5,344 × 5
   date                longitude latitude location_type location_category
   &lt;dttm&gt;                  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;            
 1 2019-01-01 00:00:00     -97.7     30.3 residence     residence        
 2 2019-01-01 00:00:00     -97.8     30.2 residence     residence        
 3 2019-01-01 00:27:00     -97.8     30.2 residence     residence        
 4 2019-01-01 01:00:00     -97.7     30.4 residence     residence        
 5 2019-01-01 01:12:00     -97.7     30.3 residence     residence        
 6 2019-01-01 01:20:00     -97.7     30.4 residence     residence        
 7 2019-01-01 01:35:00     -97.7     30.3 hotel         hotel            
 8 2019-01-01 01:50:00     -97.7     30.3 residence     residence        
 9 2019-01-01 02:21:00     -97.8     30.2 residence     residence        
10 2019-01-01 02:26:00     -97.8     30.2 residence     residence        
# ℹ 5,334 more rows</code></pre>
</div>
</div>
<p>We will see lots more examples of how to use <code>filter()</code> in future chapters.</p>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>filter()</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What is a vector (sometimes known as an atomic vector) in R?</strong></p>
<div id="radio_BOHKQDKYHR" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_BOHKQDKYHR" value=""> <span>A type of object that stores a tibble or data frame</span></label><label><input type="radio" autocomplete="off" name="radio_BOHKQDKYHR" value="answer"> <span>A type of object that stores a one-dimensional sequence of values of the same type</span></label><label><input type="radio" autocomplete="off" name="radio_BOHKQDKYHR" value=""> <span>A type of object that stores a one-dimensional sequence of values that can be of different types</span></label><label><input type="radio" autocomplete="off" name="radio_BOHKQDKYHR" value=""> <span>There is no such thing as a vector in R</span></label>
</div>
<p><strong>Which offences (rows) will be returned by the code <code>filter(agg_assault_data, location_type %in% c("restaurant", "mall"))</code>?</strong></p>
<div id="radio_JFQCPMURTE" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_JFQCPMURTE" value=""> <span>Offences that occurred in both restaurants <em>and</em> in shopping malls (e.g.&nbsp;at restaurants inside shopping malls)</span></label><label><input type="radio" autocomplete="off" name="radio_JFQCPMURTE" value=""> <span>Offences that occurred anywhere <em>except</em> restaurants or shopping malls (e.g.&nbsp;in homes)</span></label><label><input type="radio" autocomplete="off" name="radio_JFQCPMURTE" value=""> <span>No offences, because the way the two criteria are combined is illogical</span></label><label><input type="radio" autocomplete="off" name="radio_JFQCPMURTE" value="answer"> <span>Offences that occurred either in restaurants <em>or</em> in shopping malls</span></label>
</div>
<p><strong>What does the <code>&lt;=</code> operator mean?</strong></p>
<div id="radio_VVYAMNJJAZ" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_VVYAMNJJAZ" value=""> <span>greater than</span></label><label><input type="radio" autocomplete="off" name="radio_VVYAMNJJAZ" value=""> <span>less than</span></label><label><input type="radio" autocomplete="off" name="radio_VVYAMNJJAZ" value="answer"> <span>less than or equal to</span></label><label><input type="radio" autocomplete="off" name="radio_VVYAMNJJAZ" value=""> <span>greater than or equal to</span></label>
</div>
</div>
</div>
</section>
<section id="transforming-values" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="transforming-values"><span class="header-section-number">3.5</span> Transforming values</h2>
<p>It is often useful to create new columns in our data, or change the values of existing columns. The <code>mutate()</code> function in the dplyr package gives us a way to transform existing columns in our dataset using almost any R function.</p>
<p class="full-width-image">
<img src="../images/mutate.jpg" alt="Cartoon showing furry monsters moving columns of data using a crane.">
</p>
<p><a href="https://lubridate.tidyverse.org/" title="lubridate website"><img src="../images/lubridate.png" class="right-side-image"></a></p>
<p>For example, say we wanted to create a new column in our aggravated-assault dataset specifying the day of the week on which each crime occurred. We can do this using the <code>wday()</code> function from the <a href="https://lubridate.tidyverse.org/">lubridate package</a> (using the <code>label = TRUE</code> argument to produce weekday names, rather than numbers):</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb39" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="fu">mutate</span>(agg_assault_data, <span class="at">weekday =</span> <span class="fu">wday</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 8,696 × 6
   date                longitude latitude location_type location_category
   &lt;dttm&gt;                  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;            
 1 2019-01-01 00:00:00     -97.7     30.3 residence     residence        
 2 2019-01-01 00:00:00     -97.8     30.2 residence     residence        
 3 2019-01-01 00:01:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 4 2019-01-01 00:15:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 5 2019-01-01 00:27:00     -97.8     30.2 residence     residence        
 6 2019-01-01 00:30:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 7 2019-01-01 00:51:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 8 2019-01-01 01:00:00     -97.7     30.4 residence     residence        
 9 2019-01-01 01:00:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
10 2019-01-01 01:12:00     -97.7     30.3 residence     residence        
# ℹ 8,686 more rows
# ℹ 1 more variable: weekday &lt;ord&gt;</code></pre>
</div>
</div>
<p>We can also change existing columns. However (as with objects) there is no way to undo this, so you should only replace columns if you are sure you will not need them. For example, if we wanted to remove the time portion of the <code>date</code> variable (which may sometimes be useful, as shown in the next section) using the <code>as_date()</code> function (also from the lubridate package) and at the same time create the weekday variable:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb41" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="fu">mutate</span>(</span>
<span id="cb41-2"><a href="#cb41-2"></a>  agg_assault_data, </span>
<span id="cb41-3"><a href="#cb41-3"></a>  <span class="at">date =</span> <span class="fu">as_date</span>(date),</span>
<span id="cb41-4"><a href="#cb41-4"></a>  <span class="at">weekday =</span> <span class="fu">wday</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-5"><a href="#cb41-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 8,696 × 6
   date       longitude latitude location_type location_category weekday
   &lt;date&gt;         &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;             &lt;ord&gt;  
 1 2019-01-01     -97.7     30.3 residence     residence         Tue    
 2 2019-01-01     -97.8     30.2 residence     residence         Tue    
 3 2019-01-01     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;              Tue    
 4 2019-01-01     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;              Tue    
 5 2019-01-01     -97.8     30.2 residence     residence         Tue    
 6 2019-01-01     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;              Tue    
 7 2019-01-01     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;              Tue    
 8 2019-01-01     -97.7     30.4 residence     residence         Tue    
 9 2019-01-01     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;              Tue    
10 2019-01-01     -97.7     30.3 residence     residence         Tue    
# ℹ 8,686 more rows</code></pre>
</div>
</div>
<p>You may sometimes want to change only some values in a column. With a categorical variable, we can change one value to another using the <code>case_match()</code> function from the dplyr package. Look at this code and use the comments (lines starting with <code>#</code>) to understand how it works.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb43" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="fu">mutate</span>(</span>
<span id="cb43-2"><a href="#cb43-2"></a>  agg_assault_data,</span>
<span id="cb43-3"><a href="#cb43-3"></a>  <span class="at">location_category =</span> <span class="fu">case_match</span>(</span>
<span id="cb43-4"><a href="#cb43-4"></a>    location_category, </span>
<span id="cb43-5"><a href="#cb43-5"></a>    <span class="co"># We specify which existing values we want to convert into which new values</span></span>
<span id="cb43-6"><a href="#cb43-6"></a>    <span class="co"># by providing the existing value on the left-hand side and the new value</span></span>
<span id="cb43-7"><a href="#cb43-7"></a>    <span class="co"># on the right hand side, separated by a tilde (~) character</span></span>
<span id="cb43-8"><a href="#cb43-8"></a>    <span class="st">"open space"</span> <span class="sc">~</span> <span class="st">"public open space"</span>,</span>
<span id="cb43-9"><a href="#cb43-9"></a>    <span class="st">"street"</span> <span class="sc">~</span> <span class="st">"street or road"</span>,</span>
<span id="cb43-10"><a href="#cb43-10"></a>    <span class="co"># If we want to keep the existing values for any values we have not</span></span>
<span id="cb43-11"><a href="#cb43-11"></a>    <span class="co"># specified, we can do that using the .default argument</span></span>
<span id="cb43-12"><a href="#cb43-12"></a>    <span class="at">.default =</span> location_category</span>
<span id="cb43-13"><a href="#cb43-13"></a>  )</span>
<span id="cb43-14"><a href="#cb43-14"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 8,696 × 5
   date                longitude latitude location_type location_category
   &lt;dttm&gt;                  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;            
 1 2019-01-01 00:00:00     -97.7     30.3 residence     residence        
 2 2019-01-01 00:00:00     -97.8     30.2 residence     residence        
 3 2019-01-01 00:01:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 4 2019-01-01 00:15:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 5 2019-01-01 00:27:00     -97.8     30.2 residence     residence        
 6 2019-01-01 00:30:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 7 2019-01-01 00:51:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 8 2019-01-01 01:00:00     -97.7     30.4 residence     residence        
 9 2019-01-01 01:00:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
10 2019-01-01 01:12:00     -97.7     30.3 residence     residence        
# ℹ 8,686 more rows</code></pre>
</div>
</div>
<p>We could also make changes based on more-complicated sets of criteria using the <code>case_when()</code> function, but we will return to that in a future chapter.</p>
<p>The R functions that you use inside <code>mutate()</code> must return the same number of values as there are rows in the dataset. This is true for most R functions (which are referred to as <em>vectorised</em> functions), but there are some – such as <code>mean()</code> and <code>max()</code> – that return a single value. These <em>summarising functions</em> cannot be used inside <code>mutate()</code> (you will see an error message if you try) but are instead used with the next data-wrangling function we will learn about: <code>summarise()</code>.</p>
</section>
<section id="summarising-rows" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="summarising-rows"><span class="header-section-number">3.6</span> Summarising rows</h2>
<p>Summarising data is often useful in crime analysis. We can use the <code>summarise()</code> function from the dplyr package to produce summaries of different columns in our data. There is an identical function called <code>summarize()</code> so that you do not have to remember whether to use the US or British spelling.</p>
<p>By default, <code>summarise()</code> collapses data into a single row, with each column summarised using a function that you specify. For example, suppose you want to find out which police station a specialist squad should be based at to most easily respond to reports of serious assaults. You might do this by working out the weighted centre of all the offence locations, i.e.&nbsp;the means of the longitudes and latitudes for all the crimes. You could then base the squad at the police station that was closest to the weighted centre.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb45" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="fu">summarise</span>(</span>
<span id="cb45-2"><a href="#cb45-2"></a>  agg_assault_data, </span>
<span id="cb45-3"><a href="#cb45-3"></a>  <span class="at">mean_lng =</span> <span class="fu">mean</span>(longitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb45-4"><a href="#cb45-4"></a>  <span class="at">mean_lat =</span> <span class="fu">mean</span>(latitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-5"><a href="#cb45-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 1 × 2
  mean_lng mean_lat
     &lt;dbl&gt;    &lt;dbl&gt;
1    -97.7     30.3</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What does the argument <code>na.rm = TRUE</code> do?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Lots of functions in R have an argument called <code>na.rm</code> that can be set to either <code>TRUE</code> or <code>FALSE</code>. Setting <code>na.rm = TRUE</code> in this case specifies that the <code>mean()</code> function should remove (<code>rm</code>) any missing (<code>NA</code>) values before calculating the mean.</p>
<p>If we do not specify this and our data contain any missing values, the <code>mean()</code> function will return <code>NA</code>. Functions in R do this because it is not possible to completely answer the question ‘what is the mean of these values?’ if some of the values are missing.</p>
<p>This logic applies in lots of cases. For example, if you create an R object called <code>value</code> with the code <code>value &lt;- 2</code> and then run the R code <code>value &gt; 1</code>, you will get the answer <code>TRUE</code>. But if you set the object <code>value</code> to be <code>NA</code> using the code <code>value &lt;- NA</code>, when you run the R code <code>value &gt; 1</code> you will get the answer <code>NA</code>. This is because there is no way to know if the missing value represented by <code>NA</code> is greater than 1 or not. This is why it is often useful to calculate statistics such as a mean value after removing any missing values using the <code>na.rm = TRUE</code> argument.</p>
</div>
</div>
</div>
<p><code>summarise()</code> becomes more useful if we first divide our data into groups, since we then get a summary for each group separately. We can use the <code>.by</code> argument of the <code>summarise()</code> function to specify that we want separate summaries for each unique value of one or more columns in the data. For example, to produce a separate summary for each unique value of <code>location_category</code>, we can use this code:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb47" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="fu">summarise</span>(</span>
<span id="cb47-2"><a href="#cb47-2"></a>  agg_assault_data,</span>
<span id="cb47-3"><a href="#cb47-3"></a>  <span class="at">mean_lng =</span> <span class="fu">mean</span>(longitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb47-4"><a href="#cb47-4"></a>  <span class="at">mean_lat =</span> <span class="fu">mean</span>(latitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb47-5"><a href="#cb47-5"></a>  <span class="at">.by =</span> location_category</span>
<span id="cb47-6"><a href="#cb47-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 12 × 3
   location_category mean_lng mean_lat
   &lt;chr&gt;                &lt;dbl&gt;    &lt;dbl&gt;
 1 residence            -97.7     30.3
 2 &lt;NA&gt;                 -97.7     30.3
 3 hotel                -97.7     30.3
 4 other                -97.7     30.3
 5 retail               -97.7     30.3
 6 healthcare           -97.7     30.3
 7 open space           -97.7     30.3
 8 commercial           -97.7     30.3
 9 education            -97.7     30.3
10 government           -97.7     30.3
11 leisure              -97.7     30.4
12 transportation       -97.7     30.2</code></pre>
</div>
</div>
<p>You can add multiple grouping variables using the <code>c()</code> (<em>combine</em>) function if you want to generate summary values for groups within groups:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb49" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="fu">summarise</span>(</span>
<span id="cb49-2"><a href="#cb49-2"></a>  agg_assault_data,</span>
<span id="cb49-3"><a href="#cb49-3"></a>  <span class="at">mean_lng =</span> <span class="fu">mean</span>(longitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb49-4"><a href="#cb49-4"></a>  <span class="at">mean_lat =</span> <span class="fu">mean</span>(latitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb49-5"><a href="#cb49-5"></a>  <span class="at">.by =</span> <span class="fu">c</span>(location_category, location_type)</span>
<span id="cb49-6"><a href="#cb49-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 24 × 4
   location_category location_type     mean_lng mean_lat
   &lt;chr&gt;             &lt;chr&gt;                &lt;dbl&gt;    &lt;dbl&gt;
 1 residence         residence            -97.7     30.3
 2 &lt;NA&gt;              &lt;NA&gt;                 -97.7     30.3
 3 hotel             hotel                -97.7     30.3
 4 other             other                -97.7     30.3
 5 retail            other retail         -97.7     30.3
 6 healthcare        healthcare           -97.7     30.3
 7 retail            mall                 -97.8     30.3
 8 retail            convenience store    -97.7     30.3
 9 open space        green space          -97.7     30.3
10 commercial        office               -97.7     30.3
# ℹ 14 more rows</code></pre>
</div>
</div>
<section id="counting-rows" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="counting-rows"><span class="header-section-number">3.6.1</span> Counting rows</h3>
<p>One very common way of summarising data is to count the number of rows in a dataset that have each unique value of one or more columns. For example, if we have a dataset of crimes in which each row represents a single crime, we might want to count how many crimes happened on each day of the week, or how many crimes of each type are in the dataset. We can use <code>summarise()</code> to do that, together with the <code>n()</code> function (from the same dplyr package as <code>summarise()</code>). For example, if we wanted to count how many rows in the <code>agg_assault_data</code> dataset had each unique combination of <code>location_category</code> and <code>location_type</code>:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb51" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="fu">summarise</span>(agg_assault_data, <span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(location_category, location_type))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 24 × 3
   location_category location_type         n
   &lt;chr&gt;             &lt;chr&gt;             &lt;int&gt;
 1 residence         residence          4385
 2 &lt;NA&gt;              &lt;NA&gt;               3352
 3 hotel             hotel               248
 4 other             other               205
 5 retail            other retail         30
 6 healthcare        healthcare           36
 7 retail            mall                 11
 8 retail            convenience store    90
 9 open space        green space         165
10 commercial        office               28
# ℹ 14 more rows</code></pre>
</div>
</div>
<p>In this code, the <code>n()</code> function simply returns the number of rows of data in each group, i.e.&nbsp;the number of rows with each unique combination of values of <code>location_category</code> and <code>location_type</code>.</p>
<p>Since counting the number of rows in each group a dataset is a very common task, dplyr includes another function called <code>count()</code> that allows you to do the same thing as in the code above, but with slightly less typing:</p>
<p>So if you wanted to know how many aggravated assaults had occurred in each location category and type, you could this code instead of using <code>summarise()</code>:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb53" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="fu">count</span>(agg_assault_data, location_category, location_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 24 × 3
   location_category location_type         n
   &lt;chr&gt;             &lt;chr&gt;             &lt;int&gt;
 1 commercial        construction         11
 2 commercial        factory/warehouse     2
 3 commercial        finance               1
 4 commercial        office               28
 5 commercial        storage               4
 6 education         child care           11
 7 education         college               5
 8 education         school               25
 9 government        government           18
10 healthcare        healthcare           36
# ℹ 14 more rows</code></pre>
</div>
</div>
<p>Note that the first argument of <code>count()</code> is the dataset, and every subsequent argument specifies another variable that should be used to group the data.</p>
</section>
</section>
<section id="arranging-rows" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="arranging-rows"><span class="header-section-number">3.7</span> Arranging rows</h2>
<p>It is sometimes useful to be able to place rows in a dataset into a particular order. We can do this using the <code>arrange()</code> function from the dplyr package. For example, we can sort the aggravated-assault data by date:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb55" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="fu">arrange</span>(agg_assault_data, date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 8,696 × 5
   date                longitude latitude location_type location_category
   &lt;dttm&gt;                  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;            
 1 2019-01-01 00:00:00     -97.7     30.3 residence     residence        
 2 2019-01-01 00:00:00     -97.8     30.2 residence     residence        
 3 2019-01-01 00:01:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 4 2019-01-01 00:15:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 5 2019-01-01 00:27:00     -97.8     30.2 residence     residence        
 6 2019-01-01 00:30:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 7 2019-01-01 00:51:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 8 2019-01-01 01:00:00     -97.7     30.4 residence     residence        
 9 2019-01-01 01:00:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
10 2019-01-01 01:12:00     -97.7     30.3 residence     residence        
# ℹ 8,686 more rows</code></pre>
</div>
</div>
<p>By default, <code>arrange()</code> sorts rows in ascending order, i.e.&nbsp;it sorts numeric values from the smallest to the largest, dates from earliest to latest and character values alphabetically. We can instead sort values in descending order by wrapping the name of a column in the <code>desc()</code> function:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb57" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="fu">arrange</span>(agg_assault_data, <span class="fu">desc</span>(date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 8,696 × 5
   date                longitude latitude location_type location_category
   &lt;dttm&gt;                  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;            
 1 2019-12-31 23:33:00     -97.7     30.4 residence     residence        
 2 2019-12-31 23:26:00     -97.7     30.4 residence     residence        
 3 2019-12-31 23:20:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 4 2019-12-31 23:19:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 5 2019-12-31 22:39:00     -97.7     30.3 other         other            
 6 2019-12-31 22:29:00     -97.7     30.3 residence     residence        
 7 2019-12-31 21:13:00     -97.8     30.2 residence     residence        
 8 2019-12-31 20:52:00     -97.7     30.3 residence     residence        
 9 2019-12-31 20:44:00     -97.7     30.3 residence     residence        
10 2019-12-31 20:19:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
# ℹ 8,686 more rows</code></pre>
</div>
</div>
<p>We can also sort the data based on multiple columns – the data are sorted first on the first column that you specify, with tied rows then sorted on the subsequent columns in order.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb59" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="fu">arrange</span>(agg_assault_data, date, <span class="fu">desc</span>(location_type), location_category)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 8,696 × 5
   date                longitude latitude location_type location_category
   &lt;dttm&gt;                  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;            
 1 2019-01-01 00:00:00     -97.7     30.3 residence     residence        
 2 2019-01-01 00:00:00     -97.8     30.2 residence     residence        
 3 2019-01-01 00:01:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 4 2019-01-01 00:15:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 5 2019-01-01 00:27:00     -97.8     30.2 residence     residence        
 6 2019-01-01 00:30:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 7 2019-01-01 00:51:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
 8 2019-01-01 01:00:00     -97.7     30.4 residence     residence        
 9 2019-01-01 01:00:00     -97.7     30.3 &lt;NA&gt;          &lt;NA&gt;             
10 2019-01-01 01:12:00     -97.7     30.3 residence     residence        
# ℹ 8,686 more rows</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Arranging rows in data
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the R Console, type the code necessary to arrange <code>agg_assault_data</code> in order of latitude, in descending order (from largest to smallest). Once you’ve tried writing the code, if you need help you can click the ‘Solution’ button below.</p>
<div class="webex-solution">
<button>
Solution
</button>
<p><code>arrange(agg_assault_data, desc(latitude))</code></p>
</div>
</div>
</div>
</section>
<section id="saving-data" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="saving-data"><span class="header-section-number">3.8</span> Saving data</h2>
<p>Once we have finished wrangling a particular dataset, it is often useful to save it to a file so that we can use it again in future without going through all the steps of data wrangling again.</p>
<p>Most R functions that begin with <code>read_</code> (like <code>read_csv()</code> and <code>read_excel()</code>) have equivalent functions that begin <code>write_</code> and which save data into a particular file format. In this example, we will use the <code>write_csv()</code> function from the readr package, which is loaded when we load the tidyverse package.</p>
<p>Just as <code>read_csv()</code> can read files from a variety of different locations, so <code>write_csv()</code> can write files to different locations. Look at this code and use the comments (lines beginning with <code>#</code>) to understand the different options for saving data.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb61" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># We can write data to a file in the same folder as our R script</span></span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="fu">write_csv</span>(agg_assault_data, <span class="st">"fort_worth_agg_assault.csv"</span>)</span>
<span id="cb61-3"><a href="#cb61-3"></a></span>
<span id="cb61-4"><a href="#cb61-4"></a><span class="co"># Or another folder on your computer ('../../' is short for the parent folder of</span></span>
<span id="cb61-5"><a href="#cb61-5"></a><span class="co"># the parent folder of the current folder)</span></span>
<span id="cb61-6"><a href="#cb61-6"></a><span class="fu">write_csv</span>(agg_assault_data, <span class="st">"../../fort_worth_agg_assault.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>There are corresponding write functions for other types of data (which we will come back to when we learn how to handle spatial data), but in this course we will store all non-spatial data in CSV format because it can be read by many different programs.</p>
</section>
<section id="sec-pipe-operator" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="sec-pipe-operator"><span class="header-section-number">3.9</span> Stringing functions together</h2>
<p>In this chapter we have learned how to use the dplyr functions <code>select()</code>, <code>filter()</code>, <code>mutate()</code>, <code>summarise()</code> and <code>arrange()</code> to wrangle data from one format to another. Data wrangling is part of almost all data analysis, so these are skills we will use frequently.</p>
<p>Data wrangling often involves multiple steps. For example, we might want to load some data, select certain columns, filter some rows, mutate some of the variables, summarise the dataset and save the result. We can do each of these steps separately, assigning the result of each step to a new object.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter_03a.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb62" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="co"># Select only the columns we need</span></span>
<span id="cb62-2"><a href="#cb62-2"></a>robbery2 <span class="ot">&lt;-</span> <span class="fu">select</span>(san_fran_rob, date_time)</span>
<span id="cb62-3"><a href="#cb62-3"></a></span>
<span id="cb62-4"><a href="#cb62-4"></a><span class="co"># Filter only those offences that occurred in the first quarter of 2019</span></span>
<span id="cb62-5"><a href="#cb62-5"></a>robbery3 <span class="ot">&lt;-</span> <span class="fu">filter</span>(robbery2, <span class="fu">as_date</span>(date_time) <span class="sc">&lt;=</span> <span class="fu">ymd</span>(<span class="st">"2019-03-31"</span>))</span>
<span id="cb62-6"><a href="#cb62-6"></a></span>
<span id="cb62-7"><a href="#cb62-7"></a><span class="co"># Create a new weekday variable</span></span>
<span id="cb62-8"><a href="#cb62-8"></a>robbery4 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(robbery3, <span class="at">weekday =</span> <span class="fu">wday</span>(date_time, <span class="at">label =</span> <span class="cn">TRUE</span>))</span>
<span id="cb62-9"><a href="#cb62-9"></a></span>
<span id="cb62-10"><a href="#cb62-10"></a><span class="co"># Count how many offences occurred on each weekday</span></span>
<span id="cb62-11"><a href="#cb62-11"></a>q1_weekday_counts <span class="ot">&lt;-</span> <span class="fu">count</span>(robbery4, weekday)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>This code works, but involves creating six new objects, even though we only need the final <code>q1_weekday_counts</code> object for our analysis. You may notice that the first argument expected by <code>select()</code>, <code>filter()</code>, <code>mutate()</code> and <code>count()</code> is always the data tibble produced by the previous step. For example, the <code>filter()</code> function on line 5 of this code uses the <code>robbery2</code> object created by line 2 of the code.</p>
<p>Whenever you write code that (a) consists of several sequential steps, and (b) each step uses the data produced by the previous step, there is a better way to do it. This method uses the <code>|&gt;</code> (or <em>pipe</em>) operator. The pipe operator works by using the result of the code on the left-hand side of the pipe as the first argument to a function on the right-hand side. So the code <code>x  |&gt; fun1() |&gt; fun2()</code> starts with an object called <code>x</code>, uses that as the input to the function <code>fun1()</code>, then passes the result produced by <code>fun1()</code> and uses that as the input to <code>fun2()</code>.</p>
<p>It may be useful to read the pipe operator as ‘and then’, since piped code does the first thing <em>and then</em> the second thing with the result <em>and then</em> the third thing with the result of that, and so on. Piped code (sometimes called a <em>pipeline</em>) is a lot like the series of steps in a recipe.</p>
<p>Delete all the code from the file <code>chapter_03a.R</code>, since we are now going to replace it with a piped version of the same code. This pipeline of code is better because it is shorter than the previous code, is easier to maintain and (once you get used to the pipeline) is easier to understand.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter_03a.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb63" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># Load packages</span></span>
<span id="cb63-2"><a href="#cb63-2"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span>
<span id="cb63-3"><a href="#cb63-3"></a></span>
<span id="cb63-4"><a href="#cb63-4"></a><span class="co"># Load data</span></span>
<span id="cb63-5"><a href="#cb63-5"></a>san_fran_rob <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/san_francisco_robbery.csv"</span>)</span>
<span id="cb63-6"><a href="#cb63-6"></a></span>
<span id="cb63-7"><a href="#cb63-7"></a><span class="co"># Produce counts of robberies each weekday</span></span>
<span id="cb63-8"><a href="#cb63-8"></a>q1_weekday_counts <span class="ot">&lt;-</span> san_fran_rob <span class="sc">|&gt;</span> </span>
<span id="cb63-9"><a href="#cb63-9"></a>  <span class="fu">select</span>(<span class="sc">-</span>offense_type) <span class="sc">|&gt;</span> </span>
<span id="cb63-10"><a href="#cb63-10"></a>  <span class="fu">filter</span>(<span class="fu">as_date</span>(date_time) <span class="sc">&lt;=</span> <span class="fu">ymd</span>(<span class="st">"2019-03-31"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb63-11"><a href="#cb63-11"></a>  <span class="fu">mutate</span>(<span class="at">weekday =</span> <span class="fu">wday</span>(date_time, <span class="at">label =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb63-12"><a href="#cb63-12"></a>  <span class="fu">count</span>(weekday)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>Rows: 951 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (1): offense_type
dbl  (3): uid, longitude, latitude
dttm (1): date_time

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>You might not find the pipe operator completely intuitive at the moment, but it will become easier as you see more examples in future chapters.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What about the <code>%&gt;%</code> pipe operator?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>If you have learned any R coding before, you might have learned to use the <code>%&gt;%</code> pipe operator from the magrittr package. The <code>%&gt;%</code> pipe operator was introduced several years ago to allow people to construct pipelines of code in R. The <code>%&gt;%</code> operator was so widely used that the team that writes the R programming language decided to provide the <code>|&gt;</code> pipe operator in R itself, to avoid the need to load the magrittr package. You might sometimes see the <code>|&gt;</code> referred to as the <em>native</em> pipe operator.</p>
<p>You will still see the <code>%&gt;%</code> pipe operator used in lots of R code examples online. In almost all cases, when you see <code>%&gt;%</code> you can replace it with the R pipe operator <code>|&gt;</code>, since they both work in very similar ways.</p>
</div>
</div>
</div>
<p>Save the <code>chapter_03a.R</code> file, then restart R to start a new session by clicking on the <code>Session</code> menu and then clicking <code>Restart R</code>. This creates a blank canvas for the next chapter.</p>
</section>
<section id="in-summary" class="level2" data-number="3.10">
<h2 data-number="3.10" class="anchored" data-anchor-id="in-summary"><span class="header-section-number">3.10</span> In summary</h2>
<p>In this chapter, you have learned how to wrangle data in R using functions from packages in the <code>tidyverse</code> suite of packages. You can now construct a complete pipeline of R code to take raw data and transform it into the format(s) we need to effectively map crimes.</p>
<div class="box reading">
<p>Developing your data wrangling skills will help you to produce better, faster analysis of crime (and other) data. If you would like to develop your skills further, you might be interested in:</p>
<ul>
<li><a href="https://cengel.github.io/R-data-wrangling/">Data Wrangling with R</a> by Claudia Engel, a free online book that explains the functions introduced in this tutorial (and some others) in more detail.</li>
<li><a href="https://posit.co/wp-content/uploads/2022/10/data-transformation-1.pdf">Data transformation with dplyr cheat sheet</a> by the team that makes RStudio, which provides a handy two-page guide to the main functions in the <code>dplyr</code> package, which is very useful for reminding you of the code needed to run each of the functions we have used in this tutorial.</li>
<li><a href="https://rstudio.com/resources/webinars/data-wrangling-with-r-and-rstudio/">Data wrangling with R and RStudio</a> by Garrett Grolemund, a recording of a webinar covering the data-wrangling functions introduced in this tutorial and some other very-useful related functions.</li>
<li><a href="https://r4ds.had.co.nz/">R for Data Science</a> by Hadley Wickham and Garrett Grolemund, a free online book that is the bible for wrangling data in R.</li>
</ul>
</div>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Revision questions
</div>
</div>
<div class="callout-body-container callout-body">
<p>Answer these questions to check you have understood the main points covered in this chapter. Write between 50 and 100 words to answer each question.</p>
<ol type="1">
<li>What is data wrangling, and why is it an important step in data analysis?</li>
<li>Describe the difference between loading data from a CSV file and an Excel file in R. What additional steps are required when working with Excel files?</li>
<li>What is the purpose of the <code>select()</code> function in the dplyr package? How can it be used to both choose and rename columns? Include a brief example in your explanation.</li>
<li>Explain why should should never include the function <code>install.packages()</code> in an R script file.</li>
<li>What are the benefits of using the pipe (<code>|&gt;</code>) operator in R?</li>
</ol>
</div>
</div>
<p class="credits">
<a href="https://twitter.com/allison_horst">Artwork by <span class="citation" data-cites="allison_horst">@allison_horst</span></a>
</p>


<!-- -->

</section>

</main> <!-- /main -->
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../02_your_first_crime_map/index.html" class="pagination-link" aria-label="Your first crime map">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Your first crime map</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../04_your_second_crime_map/index.html" class="pagination-link" aria-label="Your second crime map">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Your second crime map</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb65" data-shortcodes="false" data-code-line-numbers=""><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb65-1"><a href="#cb65-1"></a><span class="fu"># Wrangling data {#sec-wrangling-data}</span></span>
<span id="cb65-2"><a href="#cb65-2"></a></span>
<span id="cb65-3"><a href="#cb65-3"></a>::: {.abstract}</span>
<span id="cb65-4"><a href="#cb65-4"></a>This chapter introduces the essential skills of data wrangling, an important step in preparing data for analysis and presentation. You'll learn to load, filter, manipulate, and save datasets using R. This chapter guides you through handling tabular and Excel data formats, selecting relevant data, and applying functions from powerful R packages like tidyverse. By the end of this chapter you will be able to confidently transform raw data into a format ready for meaningful insights. Let’s dive in!</span>
<span id="cb65-5"><a href="#cb65-5"></a>:::</span>
<span id="cb65-6"><a href="#cb65-6"></a></span>
<span id="cb65-7"><a href="#cb65-7"></a></span>
<span id="cb65-8"><a href="#cb65-8"></a><span class="in">```{r setup}</span></span>
<span id="cb65-9"><a href="#cb65-9"></a><span class="in">#| echo: false</span></span>
<span id="cb65-10"><a href="#cb65-10"></a><span class="in">#| include: false</span></span>
<span id="cb65-11"><a href="#cb65-11"></a></span>
<span id="cb65-12"><a href="#cb65-12"></a><span class="in"># Load packages</span></span>
<span id="cb65-13"><a href="#cb65-13"></a><span class="in">pacman::p_load(tidyverse)</span></span>
<span id="cb65-14"><a href="#cb65-14"></a></span>
<span id="cb65-15"><a href="#cb65-15"></a><span class="in"># Load data</span></span>
<span id="cb65-16"><a href="#cb65-16"></a><span class="in">agg_assault_data &lt;- crimemappingdata::aggravated_assaults</span></span>
<span id="cb65-17"><a href="#cb65-17"></a><span class="in">san_fran_rob &lt;- crimemappingdata::san_francisco_robbery</span></span>
<span id="cb65-18"><a href="#cb65-18"></a><span class="in">```</span></span>
<span id="cb65-19"><a href="#cb65-19"></a></span>
<span id="cb65-20"><a href="#cb65-20"></a></span>
<span id="cb65-21"><a href="#cb65-21"></a></span>
<span id="cb65-22"><a href="#cb65-22"></a><span class="fu">## Introduction</span></span>
<span id="cb65-23"><a href="#cb65-23"></a></span>
<span id="cb65-24"><a href="#cb65-24"></a>A major step in using any data to make decisions or draw conclusions is *data wrangling*: the process of transforming data from the format in which we originally have it to the format needed to analyse and present it to our audience. </span>
<span id="cb65-25"><a href="#cb65-25"></a></span>
<span id="cb65-26"><a href="#cb65-26"></a>&lt;p class="full-width-image"&gt;&lt;img src="../images/datawrangling.jpg" alt="Cartoon of furry monsters putting boxes onto a conveyor belt with machines marked 'wrangle', 'vizualise' and 'model' adjusting the boxes as they move along the belt"&gt;&lt;/p&gt;</span>
<span id="cb65-27"><a href="#cb65-27"></a></span>
<span id="cb65-28"><a href="#cb65-28"></a><span class="co">&lt;!-- Start off by watching this video that walks through the different steps in wrangling a dataset. We will cover all the steps in the video in more detail during the rest of this chapter. --&gt;</span></span>
<span id="cb65-29"><a href="#cb65-29"></a></span>
<span id="cb65-30"><a href="#cb65-30"></a><span class="co">&lt;!-- {{&lt; video https://youtu.be/pQeJKt6O9dU &gt;}} --&gt;</span></span>
<span id="cb65-31"><a href="#cb65-31"></a></span>
<span id="cb65-32"><a href="#cb65-32"></a>To get started, open RStudio and check that you are working in the Crime Mapping project you created previously. To do this, looking on the top right-hand corner of the RStudio window. If you see the text <span class="in">`Crime Mapping`</span>, all is well. If you see the text <span class="in">`Project: (None)`</span>, click on the downward triangle next to that text and then select the Crime Mapping project -- this will cause RStudio to restart and open your project.</span>
<span id="cb65-33"><a href="#cb65-33"></a></span>
<span id="cb65-34"><a href="#cb65-34"></a>Now create a new R script file by clicking the <span class="in">`File`</span> menu, then <span class="in">`New File`</span> and then <span class="in">`R Script`</span>. A new file will open in the left-hand panel in RStudio. Click <span class="in">`File`</span> then <span class="in">`Save As...`</span> to save this file in the project directory you created when you completed the previous chapter. Save the file as <span class="in">`chapter_03a.R`</span>.</span>
<span id="cb65-35"><a href="#cb65-35"></a></span>
<span id="cb65-36"><a href="#cb65-36"></a></span>
<span id="cb65-37"><a href="#cb65-37"></a><span class="fu">### Functions</span></span>
<span id="cb65-38"><a href="#cb65-38"></a></span>
<span id="cb65-39"><a href="#cb65-39"></a>In this chapter we will learn how to wrangle data in R using *functions* – specialised pieces of code that do something to the data we give it. The code to use a function (sometimes called *calling* the function) has two parts: the function name followed by a pair of parentheses, inside which are zero or more *arguments* separated by commas. Arguments are a way of providing input that a function works on, or to fine-tune the way the function works (we will see many examples of this later). Remember that you can identify a function in R because the name will always have parentheses after it.</span>
<span id="cb65-40"><a href="#cb65-40"></a></span>
<span id="cb65-41"><a href="#cb65-41"></a>One basic R function is <span class="in">`sqrt()`</span>, which calculates the square root of a number. The <span class="in">`sqrt()`</span> function has only one argument: the number that we want to find the square root of. If we typed the following code into the R Console, R would show us the square root of 2.</span>
<span id="cb65-42"><a href="#cb65-42"></a></span>
<span id="cb65-45"><a href="#cb65-45"></a><span class="in">```{r}</span></span>
<span id="cb65-46"><a href="#cb65-46"></a><span class="co">#| eval: false</span></span>
<span id="cb65-47"><a href="#cb65-47"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-48"><a href="#cb65-48"></a></span>
<span id="cb65-49"><a href="#cb65-49"></a><span class="fu">sqrt</span>(<span class="dv">2</span>)</span>
<span id="cb65-50"><a href="#cb65-50"></a><span class="in">```</span></span>
<span id="cb65-51"><a href="#cb65-51"></a></span>
<span id="cb65-52"><a href="#cb65-52"></a>When you run code in R, by default R prints the output of your code – in this case, just the number ``r format(sqrt(2), digits = 7)`<span class="in">` (for now, you can ignore the number `</span><span class="co">[</span><span class="ot">1</span><span class="co">]</span>` in square brackets).</span>
<span id="cb65-53"><a href="#cb65-53"></a></span>
<span id="cb65-54"><a href="#cb65-54"></a></span>
<span id="cb65-55"><a href="#cb65-55"></a></span>
<span id="cb65-56"><a href="#cb65-56"></a><span class="fu">### Packages</span></span>
<span id="cb65-57"><a href="#cb65-57"></a></span>
<span id="cb65-58"><a href="#cb65-58"></a><span class="in">```{r count-cran-packages}</span></span>
<span id="cb65-59"><a href="#cb65-59"></a><span class="in">#| echo: false</span></span>
<span id="cb65-60"><a href="#cb65-60"></a></span>
<span id="cb65-61"><a href="#cb65-61"></a><span class="in">package_count &lt;- available.packages(repos = "https://cran.rstudio.com/") |&gt; </span></span>
<span id="cb65-62"><a href="#cb65-62"></a><span class="in">  nrow() |&gt; </span></span>
<span id="cb65-63"><a href="#cb65-63"></a><span class="in">  scales::comma(accuracy = 100)</span></span>
<span id="cb65-64"><a href="#cb65-64"></a><span class="in">```</span></span>
<span id="cb65-65"><a href="#cb65-65"></a></span>
<span id="cb65-66"><a href="#cb65-66"></a>R contains thousands of different functions that do different things. A few functions are contained in the default installation of R that you have already installed (this is sometimes referred to as *base R*). But most functions are contained in *packages*, which are extensions to base R. Most packages focus on a particular type of data analysis, so that there are packages devoted to time-series analysis, testing whether events are clustered in particular places, network analysis and thousands of other tasks. Packages are often developed by experts in the field, and are typically updated to introduce new features.</span>
<span id="cb65-67"><a href="#cb65-67"></a></span>
<span id="cb65-68"><a href="#cb65-68"></a>To use a package in R, we must do two things:</span>
<span id="cb65-69"><a href="#cb65-69"></a></span>
<span id="cb65-70"><a href="#cb65-70"></a><span class="ss">  * </span>*install* the package, which we have to do just once on each computer we want to use, then</span>
<span id="cb65-71"><a href="#cb65-71"></a><span class="ss">  * </span>*load* the package, which we have to do each time we restart R (which happens when we open RStudio or switch between projects).</span>
<span id="cb65-72"><a href="#cb65-72"></a>    </span>
<span id="cb65-73"><a href="#cb65-73"></a>The <span class="in">`install.packages()`</span> function downloads and installs packages from the <span class="co">[</span><span class="ot">Comprehensive R Archive Network</span><span class="co">](https://cran.r-project.org/)</span> (universally known as CRAN), which contains about <span class="in">`r package_count`</span> different packages. Some packages that are still in the early stages of development are not available on CRAN, but all the packages we will use are there.</span>
<span id="cb65-74"><a href="#cb65-74"></a></span>
<span id="cb65-75"><a href="#cb65-75"></a>&lt;a href="https://tidyverse.org/" title="tidyverse website"&gt;&lt;img src="../images/tidyverse.png" class="right-side-image"&gt;&lt;/a&gt;</span>
<span id="cb65-76"><a href="#cb65-76"></a></span>
<span id="cb65-77"><a href="#cb65-77"></a>So to install (for example) the package called <span class="in">`tidyverse`</span>, which we will use extensively in this chapter, we would run the R code:</span>
<span id="cb65-78"><a href="#cb65-78"></a></span>
<span id="cb65-81"><a href="#cb65-81"></a><span class="in">```{r}</span></span>
<span id="cb65-82"><a href="#cb65-82"></a><span class="co">#| eval: false</span></span>
<span id="cb65-83"><a href="#cb65-83"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-84"><a href="#cb65-84"></a></span>
<span id="cb65-85"><a href="#cb65-85"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb65-86"><a href="#cb65-86"></a><span class="in">```</span></span>
<span id="cb65-87"><a href="#cb65-87"></a></span>
<span id="cb65-88"><a href="#cb65-88"></a>We only have to _install_ a package once for each computer that we will use to run R, although we would have to do it again if we updated to a new version of R. </span>
<span id="cb65-89"><a href="#cb65-89"></a></span>
<span id="cb65-90"><a href="#cb65-90"></a></span>
<span id="cb65-91"><a href="#cb65-91"></a>::: {.callout-important}</span>
<span id="cb65-92"><a href="#cb65-92"></a><span class="fu">#### Never add `install.packages()` to an R script</span></span>
<span id="cb65-93"><a href="#cb65-93"></a></span>
<span id="cb65-94"><a href="#cb65-94"></a>You should only ever use the <span class="in">`install.packages()`</span> function in the R Console, never in an R script. There are two reasons for this:</span>
<span id="cb65-95"><a href="#cb65-95"></a></span>
<span id="cb65-96"><a href="#cb65-96"></a><span class="ss">* </span>When you share your code with other people -- which you will do often in this course -- they may have their system set up in such a way that running <span class="in">`install.packages()`</span> in a script file might cause other code on their computer to stop working.</span>
<span id="cb65-97"><a href="#cb65-97"></a><span class="ss">* </span>Since you don't need to install a package every time you need it (you only need to install it once), your code will run much more slowly if you needlessly install packages every time you run your code.</span>
<span id="cb65-98"><a href="#cb65-98"></a>:::</span>
<span id="cb65-99"><a href="#cb65-99"></a></span>
<span id="cb65-100"><a href="#cb65-100"></a></span>
<span id="cb65-101"><a href="#cb65-101"></a>Once a package is installed on our computer, we have to _load_ it so that we can use it in our code. We load packages using the <span class="in">`p_load()`</span> function from the <span class="co">[</span><span class="ot">pacman package</span><span class="co">](https://trinker.github.io/pacman_dev/)</span>. So to load the tidyverse package, we run the code:</span>
<span id="cb65-102"><a href="#cb65-102"></a></span>
<span id="cb65-105"><a href="#cb65-105"></a><span class="in">```{r}</span></span>
<span id="cb65-106"><a href="#cb65-106"></a><span class="co">#| filename: "chapter_03a.R"</span></span>
<span id="cb65-107"><a href="#cb65-107"></a></span>
<span id="cb65-108"><a href="#cb65-108"></a><span class="co"># Load packages</span></span>
<span id="cb65-109"><a href="#cb65-109"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span>
<span id="cb65-110"><a href="#cb65-110"></a><span class="in">```</span></span>
<span id="cb65-111"><a href="#cb65-111"></a></span>
<span id="cb65-112"><a href="#cb65-112"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb65-113"><a href="#cb65-113"></a><span class="fu">#### Why does this line of code start with `pacman::`?</span></span>
<span id="cb65-114"><a href="#cb65-114"></a></span>
<span id="cb65-115"><a href="#cb65-115"></a>The pacman package is an R package that is used to manage other R packages. The <span class="in">`p_load()`</span> function from that package is used to load packages. But we learned above that we must load a package before we can use it, which means we cannot use functions from the pacman package until we have loaded the pacman package. To get around that, instead of just using the function name <span class="in">`p_load()`</span>, we can instead specify which package <span class="in">`p_load()`</span> is from by prefixing the function name with the relevant package name, separated by <span class="in">`::`</span>.</span>
<span id="cb65-116"><a href="#cb65-116"></a>:::</span>
<span id="cb65-117"><a href="#cb65-117"></a></span>
<span id="cb65-118"><a href="#cb65-118"></a>One major advantage of using <span class="in">`p_load()`</span> to load packages is that before loading any packages, this function will first install them if they have not already been installed on the computer we are using. This means that once we have the pacman package installed we won't need to worry about whether a package is installed or not -- we can just load the package, knowing it will automatically be installed if necessary.</span>
<span id="cb65-119"><a href="#cb65-119"></a></span>
<span id="cb65-120"><a href="#cb65-120"></a>Many packages are focused on specialist tasks and so are only used occasionally, but a few packages are likely to be useful in almost all the code we write. Fortunately, packages can themselves load other packages, and all the main packages we need are loaded by the <span class="in">`tidyverse`</span> package. That is why you will often see <span class="in">`pacman::p_load(tidyverse)`</span> at the top of R code in subsequent chapters – that short line of code loads several packages containing hundreds of functions that we can use in data analysis.</span>
<span id="cb65-121"><a href="#cb65-121"></a></span>
<span id="cb65-122"><a href="#cb65-122"></a></span>
<span id="cb65-123"><a href="#cb65-123"></a>::: {.callout-quiz .callout}</span>
<span id="cb65-124"><a href="#cb65-124"></a><span class="fu">#### Data wrangling</span></span>
<span id="cb65-125"><a href="#cb65-125"></a></span>
<span id="cb65-126"><a href="#cb65-126"></a><span class="in">```{r data-wrangling-quiz}</span></span>
<span id="cb65-127"><a href="#cb65-127"></a><span class="in">#| echo: false</span></span>
<span id="cb65-128"><a href="#cb65-128"></a></span>
<span id="cb65-129"><a href="#cb65-129"></a><span class="in">data_wrangling_quiz1 &lt;- c(</span></span>
<span id="cb65-130"><a href="#cb65-130"></a><span class="in">  "The process of collecting data from multiple sources.",</span></span>
<span id="cb65-131"><a href="#cb65-131"></a><span class="in">  answer = "The process of transforming raw data into a format suitable for analysis.",</span></span>
<span id="cb65-132"><a href="#cb65-132"></a><span class="in">  "The process of visualizing data on a map.",</span></span>
<span id="cb65-133"><a href="#cb65-133"></a><span class="in">  "The process of cleaning corrupted data files."</span></span>
<span id="cb65-134"><a href="#cb65-134"></a><span class="in">)</span></span>
<span id="cb65-135"><a href="#cb65-135"></a></span>
<span id="cb65-136"><a href="#cb65-136"></a><span class="in">data_wrangling_quiz2 &lt;- c(</span></span>
<span id="cb65-137"><a href="#cb65-137"></a><span class="in">  "A visual representation of data.",</span></span>
<span id="cb65-138"><a href="#cb65-138"></a><span class="in">  "A mathematical formula used in graphs.",</span></span>
<span id="cb65-139"><a href="#cb65-139"></a><span class="in">  "A set of instructions for saving data.",</span></span>
<span id="cb65-140"><a href="#cb65-140"></a><span class="in">  answer = "A specialized piece of code that performs a task on data."</span></span>
<span id="cb65-141"><a href="#cb65-141"></a><span class="in">)</span></span>
<span id="cb65-142"><a href="#cb65-142"></a><span class="in">```</span></span>
<span id="cb65-143"><a href="#cb65-143"></a></span>
<span id="cb65-144"><a href="#cb65-144"></a></span>
<span id="cb65-145"><a href="#cb65-145"></a>**What is the purpose of data wrangling?**</span>
<span id="cb65-146"><a href="#cb65-146"></a></span>
<span id="cb65-147"><a href="#cb65-147"></a><span class="in">`r webexercises::longmcq(data_wrangling_quiz1)`</span></span>
<span id="cb65-148"><a href="#cb65-148"></a></span>
<span id="cb65-149"><a href="#cb65-149"></a></span>
<span id="cb65-150"><a href="#cb65-150"></a>**In general, what is a _function_ in R?**</span>
<span id="cb65-151"><a href="#cb65-151"></a></span>
<span id="cb65-152"><a href="#cb65-152"></a><span class="in">`r webexercises::longmcq(data_wrangling_quiz2)`</span></span>
<span id="cb65-153"><a href="#cb65-153"></a></span>
<span id="cb65-154"><a href="#cb65-154"></a></span>
<span id="cb65-155"><a href="#cb65-155"></a>:::</span>
<span id="cb65-156"><a href="#cb65-156"></a></span>
<span id="cb65-157"><a href="#cb65-157"></a></span>
<span id="cb65-158"><a href="#cb65-158"></a><span class="fu">## Loading data {#sec-read-data}</span></span>
<span id="cb65-159"><a href="#cb65-159"></a></span>
<span id="cb65-160"><a href="#cb65-160"></a>Before we can do anything with any data, we have to load it into R. In this course we will read tabular data in comma-separated values (CSV) and Excel formats, as well as spatial data in different formats (because there are lots of ways to store spatial data). We will learn how to read CSV and Excel data now, but leave loading spatial data until later.</span>
<span id="cb65-161"><a href="#cb65-161"></a></span>
<span id="cb65-162"><a href="#cb65-162"></a>_Tabular data_ (sometimes known as _rectangular data_) describes data formats with multiple columns where every column has the same number of rows. For example, crime data might have columns for the type of crime, date and address at which the crime occurred.</span>
<span id="cb65-163"><a href="#cb65-163"></a></span>
<span id="cb65-164"><a href="#cb65-164"></a><span class="in">```{r tabular-data}</span></span>
<span id="cb65-165"><a href="#cb65-165"></a><span class="in">#| echo: false</span></span>
<span id="cb65-166"><a href="#cb65-166"></a></span>
<span id="cb65-167"><a href="#cb65-167"></a><span class="in">tibble::tribble(</span></span>
<span id="cb65-168"><a href="#cb65-168"></a><span class="in">  ~type, ~date, ~address,</span></span>
<span id="cb65-169"><a href="#cb65-169"></a><span class="in">  "homicide", as_date(now(tzone = "UTC") - years(1) + days(10)), "274 Main St",</span></span>
<span id="cb65-170"><a href="#cb65-170"></a><span class="in">  "non-residential burglary", as_date(now(tzone = "UTC") - months(5) + days(20)), "541 Station Rd",</span></span>
<span id="cb65-171"><a href="#cb65-171"></a><span class="in">  "personal robbery", as_date(now(tzone = "UTC") - days(8)), "10 North Av"</span></span>
<span id="cb65-172"><a href="#cb65-172"></a><span class="in">) |&gt; </span></span>
<span id="cb65-173"><a href="#cb65-173"></a><span class="in">  dplyr::mutate(date = strftime(date, "%d %b %Y")) |&gt;  </span></span>
<span id="cb65-174"><a href="#cb65-174"></a><span class="in">  knitr::kable(caption = "Crime data in rectangular format")</span></span>
<span id="cb65-175"><a href="#cb65-175"></a><span class="in">```</span></span>
<span id="cb65-176"><a href="#cb65-176"></a></span>
<span id="cb65-177"><a href="#cb65-177"></a>Almost all the data we will use in this course will be in this rectangular format, and most of the functions we will use expect data to be rectangular.</span>
<span id="cb65-178"><a href="#cb65-178"></a></span>
<span id="cb65-179"><a href="#cb65-179"></a></span>
<span id="cb65-180"><a href="#cb65-180"></a></span>
<span id="cb65-181"><a href="#cb65-181"></a><span class="fu">### Loading CSV data</span></span>
<span id="cb65-182"><a href="#cb65-182"></a></span>
<span id="cb65-183"><a href="#cb65-183"></a>&lt;a href="https://readr.tidyverse.org/" title="readr website"&gt;&lt;img src="../images/readr.png" class="right-side-image"&gt;&lt;/a&gt;</span>
<span id="cb65-184"><a href="#cb65-184"></a></span>
<span id="cb65-185"><a href="#cb65-185"></a>Data stored in CSV format is easy to load with the <span class="in">`read_csv()`</span> function from the <span class="co">[</span><span class="ot">readr package</span><span class="co">](https://readr.tidyverse.org)</span>. readr is one of the packages loaded by the tidyverse package, so all we need to do to use this package is include the code <span class="in">`pacman::p_load(tidyverse)`</span> on the first line of our R script. We will use comments (lines of code beginning with <span class="in">`#`</span>) to help explain the code as we go.</span>
<span id="cb65-186"><a href="#cb65-186"></a></span>
<span id="cb65-187"><a href="#cb65-187"></a><span class="in">`read_csv()`</span> can handle data stored _locally_ on your computer, as well as data stored _remotely_ on an external website. During this course, most of the data we will use will be remote data stored on the <span class="co">[</span><span class="ot">crimemappingdata website</span><span class="co">](https://pkgs.lesscrime.info/crimemappingdata/)</span>.</span>
<span id="cb65-188"><a href="#cb65-188"></a></span>
<span id="cb65-191"><a href="#cb65-191"></a><span class="in">```{r}</span></span>
<span id="cb65-192"><a href="#cb65-192"></a><span class="co">#| eval: false</span></span>
<span id="cb65-193"><a href="#cb65-193"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-194"><a href="#cb65-194"></a></span>
<span id="cb65-195"><a href="#cb65-195"></a><span class="co"># We can load data from a file in the same folder as our R script</span></span>
<span id="cb65-196"><a href="#cb65-196"></a>san_fran_rob <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"san_francisco_robbery.csv"</span>)</span>
<span id="cb65-197"><a href="#cb65-197"></a></span>
<span id="cb65-198"><a href="#cb65-198"></a><span class="co"># Or another folder on your computer ('../' is short for the parent </span></span>
<span id="cb65-199"><a href="#cb65-199"></a><span class="co"># folder of the current folder)</span></span>
<span id="cb65-200"><a href="#cb65-200"></a>san_fran_rob <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../san_francisco_robbery.csv"</span>)</span>
<span id="cb65-201"><a href="#cb65-201"></a></span>
<span id="cb65-202"><a href="#cb65-202"></a><span class="co"># Or directly from a file online</span></span>
<span id="cb65-203"><a href="#cb65-203"></a>san_fran_rob <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"http://example.com/san_francisco_robbery.csv"</span>)</span>
<span id="cb65-204"><a href="#cb65-204"></a><span class="in">```</span></span>
<span id="cb65-205"><a href="#cb65-205"></a></span>
<span id="cb65-206"><a href="#cb65-206"></a>In each of these examples, the code stores the result of the <span class="in">`read_csv()`</span> function in an *object* named <span class="in">`san_fran_rob`</span>. Objects are places where we can store data. To create an object and store our data in it, we use the assignment operator <span class="in">`&lt;-`</span> (a less-than sign followed by a dash). Continually typing <span class="in">`&lt;-`</span> can be tedious, so in RStudio we can use the keyboard short cut <span class="in">`Option+-`</span> (on Mac) or <span class="in">`Alt+-`</span> (on Windows or Linux) to insert the complete operator.</span>
<span id="cb65-207"><a href="#cb65-207"></a></span>
<span id="cb65-208"><a href="#cb65-208"></a></span>
<span id="cb65-209"><a href="#cb65-209"></a>::: {.callout-important}</span>
<span id="cb65-210"><a href="#cb65-210"></a><span class="fu">#### Object names can be overwritten</span></span>
<span id="cb65-211"><a href="#cb65-211"></a></span>
<span id="cb65-212"><a href="#cb65-212"></a>When choosing object names, it is important to remember that if you assign a value (such as the number <span class="in">`1`</span> or the result of the function <span class="in">`read_csv()`</span>) to an object name, R will overwrite any existing value of that object name. We can see this in a simple example:</span>
<span id="cb65-213"><a href="#cb65-213"></a></span>
<span id="cb65-216"><a href="#cb65-216"></a><span class="in">```{r}</span></span>
<span id="cb65-217"><a href="#cb65-217"></a><span class="co">#| eval: false</span></span>
<span id="cb65-218"><a href="#cb65-218"></a></span>
<span id="cb65-219"><a href="#cb65-219"></a>one_to_ten <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb65-220"><a href="#cb65-220"></a>one_to_ten <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">2</span>)</span>
<span id="cb65-221"><a href="#cb65-221"></a><span class="in">```</span></span>
<span id="cb65-222"><a href="#cb65-222"></a></span>
<span id="cb65-223"><a href="#cb65-223"></a>If we were to run this code, the object <span class="in">`one_to_ten`</span> would not actually hold the numbers from one to ten, but instead the value <span class="in">`r format(sqrt(2), digits = 7)`</span> (the square root of two). There is no way to undo assignment of a value to an object, so once you have run the code <span class="in">`one_to_ten &lt;- sqrt(2)`</span> it is not possible to recover any previous value that was assigned to the object <span class="in">`one_to_ten`</span>.</span>
<span id="cb65-224"><a href="#cb65-224"></a>:::</span>
<span id="cb65-225"><a href="#cb65-225"></a></span>
<span id="cb65-226"><a href="#cb65-226"></a></span>
<span id="cb65-227"><a href="#cb65-227"></a>Objects come in several different types, with tabular data typically being stored as a *data frame*. The `read_csv()` function actually produces a modern variation on the data frame called (slightly strangely) a *tibble*, which makes use of some advances in how R handles data since the data-frame format was set 20 years ago. Tibbles behave just like data frames almost all of the time (so much so that people working with tibbles often call them data frames) except for a few occasions where they behave in a more-convenient way. We will always use tibbles instead of data frames in this course.</span>
<span id="cb65-228"><a href="#cb65-228"></a></span>
<span id="cb65-229"><a href="#cb65-229"></a>We can use <span class="in">`read_csv()`</span> to load data from <span class="in">`https://mpjashby.github.io/crimemappingdata/san_francisco_robbery.csv`</span> and store it in an object called <span class="in">`san_fran_rob`</span>. Add this code to the script file <span class="in">`chapter_03a.R`</span> and then run that code as you learned about in @sec-loading-packages.</span>
<span id="cb65-230"><a href="#cb65-230"></a></span>
<span id="cb65-231"><a href="#cb65-231"></a></span>
<span id="cb65-234"><a href="#cb65-234"></a><span class="in">```{r}</span></span>
<span id="cb65-235"><a href="#cb65-235"></a><span class="co">#| filename: "chapter_03a.R"</span></span>
<span id="cb65-236"><a href="#cb65-236"></a></span>
<span id="cb65-237"><a href="#cb65-237"></a><span class="co"># Load San Francisco robbery data</span></span>
<span id="cb65-238"><a href="#cb65-238"></a>san_fran_rob <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/san_francisco_robbery.csv"</span>)</span>
<span id="cb65-239"><a href="#cb65-239"></a><span class="in">```</span></span>
<span id="cb65-240"><a href="#cb65-240"></a></span>
<span id="cb65-241"><a href="#cb65-241"></a>If the data are loaded successfully, R will list the columns in the data and the type of variable (numeric, date etc.) stored in each column. The format of this is somewhat esoteric, but if you are interested they are explained in the 'Extra detail' box below.</span>
<span id="cb65-242"><a href="#cb65-242"></a></span>
<span id="cb65-243"><a href="#cb65-243"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb65-244"><a href="#cb65-244"></a><span class="fu">#### What do the messages produced by `read_csv()` mean?</span></span>
<span id="cb65-245"><a href="#cb65-245"></a></span>
<span id="cb65-246"><a href="#cb65-246"></a>By default, the <span class="in">`read_csv()`</span> function prints a message when it loads data to summarise the format of each data column. In the case of the <span class="in">`san_fran_rob`</span> dataset, <span class="in">`read_csv()`</span> tells us that: </span>
<span id="cb65-247"><a href="#cb65-247"></a></span>
<span id="cb65-248"><a href="#cb65-248"></a><span class="ss">  * </span>there is one column called <span class="in">`offense_type`</span> that contains character (<span class="in">`chr`</span>) values,</span>
<span id="cb65-249"><a href="#cb65-249"></a><span class="ss">  * </span>there are three columns called <span class="in">`uid`</span>, <span class="in">`longitude`</span> and <span class="in">`latitude`</span> containing numeric (<span class="in">`dbl`</span>) values, and</span>
<span id="cb65-250"><a href="#cb65-250"></a><span class="ss">  * </span>there is one column called <span class="in">`date_time`</span> that contains values stored as dates and times (<span class="in">`dttm`</span>).</span>
<span id="cb65-251"><a href="#cb65-251"></a></span>
<span id="cb65-252"><a href="#cb65-252"></a>There are some other possible types of data, but we will learn about these later on. The numeric values are referred to as <span class="in">`dbl`</span> values because they are stored in a format that can handle numbers that are not whole numbers (e.g. 123.456). This format for storing numbers is called the double-precision floating-point format, which is often known as the double format for short. Most numbers in R are stored in double format, so you can think of the format code <span class="in">`dbl`</span> as meaning 'numeric'.</span>
<span id="cb65-253"><a href="#cb65-253"></a>:::</span>
<span id="cb65-254"><a href="#cb65-254"></a></span>
<span id="cb65-255"><a href="#cb65-255"></a></span>
<span id="cb65-256"><a href="#cb65-256"></a>To see the first few rows of data currently stored in an object, we can use the <span class="in">`head()`</span> function. </span>
<span id="cb65-257"><a href="#cb65-257"></a></span>
<span id="cb65-258"><a href="#cb65-258"></a></span>
<span id="cb65-261"><a href="#cb65-261"></a><span class="in">```{r}</span></span>
<span id="cb65-262"><a href="#cb65-262"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-263"><a href="#cb65-263"></a></span>
<span id="cb65-264"><a href="#cb65-264"></a><span class="fu">head</span>(san_fran_rob)</span>
<span id="cb65-265"><a href="#cb65-265"></a><span class="in">```</span></span>
<span id="cb65-266"><a href="#cb65-266"></a></span>
<span id="cb65-267"><a href="#cb65-267"></a></span>
<span id="cb65-268"><a href="#cb65-268"></a><span class="fu">### Loading Excel data</span></span>
<span id="cb65-269"><a href="#cb65-269"></a></span>
<span id="cb65-270"><a href="#cb65-270"></a>&lt;a href="https://readxl.tidyverse.org/" title="readxl website"&gt;&lt;img src="../images/readxl.png" class="right-side-image"&gt;&lt;/a&gt;</span>
<span id="cb65-271"><a href="#cb65-271"></a></span>
<span id="cb65-272"><a href="#cb65-272"></a>Loading data from Microsoft Excel files is very similar to loading CSV data, with a few important differences. Functions to load Excel data are contained in the <span class="in">`readxl`</span> package.</span>
<span id="cb65-273"><a href="#cb65-273"></a></span>
<span id="cb65-274"><a href="#cb65-274"></a>There are two main things we must do to import Excel data that are not required for importing CSV data. The first is that the <span class="in">`readxl`</span> package cannot directly load files from a URL, instead only loading files that are present on your computer. To get round this, we will first download an Excel file and store it in a temporary directory (to avoid cluttering up our computers).</span>
<span id="cb65-275"><a href="#cb65-275"></a></span>
<span id="cb65-276"><a href="#cb65-276"></a>To practice loading data from an Excel file, create a new R script file called <span class="in">`chapter_03b.R`</span> and paste the following code into it, then run the code.</span>
<span id="cb65-277"><a href="#cb65-277"></a></span>
<span id="cb65-280"><a href="#cb65-280"></a><span class="in">```{r}</span></span>
<span id="cb65-281"><a href="#cb65-281"></a><span class="co">#| filename: "chapter_03b.R"</span></span>
<span id="cb65-282"><a href="#cb65-282"></a></span>
<span id="cb65-283"><a href="#cb65-283"></a><span class="co"># Load packages</span></span>
<span id="cb65-284"><a href="#cb65-284"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(readxl, tidyverse)</span>
<span id="cb65-285"><a href="#cb65-285"></a></span>
<span id="cb65-286"><a href="#cb65-286"></a><span class="co"># Specify the name of and location of our temporary file: it does not matter</span></span>
<span id="cb65-287"><a href="#cb65-287"></a><span class="co"># what this file is called or where it is stored, so we use the tempfile()</span></span>
<span id="cb65-288"><a href="#cb65-288"></a><span class="co"># function to create a file in the correct location automatically</span></span>
<span id="cb65-289"><a href="#cb65-289"></a>temp_file <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">".xlsx"</span>)</span>
<span id="cb65-290"><a href="#cb65-290"></a></span>
<span id="cb65-291"><a href="#cb65-291"></a><span class="co"># Download the Excel file and store it in the temporary location</span></span>
<span id="cb65-292"><a href="#cb65-292"></a><span class="fu">download.file</span>(</span>
<span id="cb65-293"><a href="#cb65-293"></a>  <span class="at">url =</span> <span class="st">"https://mpjashby.github.io/crimemappingdata/aggravated_assaults.xlsx"</span>,</span>
<span id="cb65-294"><a href="#cb65-294"></a>  <span class="at">destfile =</span> temp_file,</span>
<span id="cb65-295"><a href="#cb65-295"></a>  <span class="at">mode =</span> <span class="st">"wb"</span></span>
<span id="cb65-296"><a href="#cb65-296"></a>)</span>
<span id="cb65-297"><a href="#cb65-297"></a><span class="in">```</span></span>
<span id="cb65-298"><a href="#cb65-298"></a></span>
<span id="cb65-299"><a href="#cb65-299"></a>The <span class="in">`download.file()`</span> function does not produce any output if the file has been successfully downloaded, so you will not see any output when you run this code.</span>
<span id="cb65-300"><a href="#cb65-300"></a></span>
<span id="cb65-301"><a href="#cb65-301"></a></span>
<span id="cb65-302"><a href="#cb65-302"></a>::: {.callout-important}</span>
<span id="cb65-303"><a href="#cb65-303"></a></span>
<span id="cb65-304"><a href="#cb65-304"></a>**Using `download.file()` on Windows**</span>
<span id="cb65-305"><a href="#cb65-305"></a></span>
<span id="cb65-306"><a href="#cb65-306"></a>If you are using a Windows computer, you may find that the <span class="in">`download.file()`</span> function in the code below does not work as expected. This is because Windows handles files in a way that distinguishes between *plain-text* files such as `.txt` and `.csv` files and *binary* files, which includes most other file types (including compressed files). Since Excel files are not plain-text files, on Windows you need to specify that you want them to be downloaded as a binary file. To do this, add the argument <span class="in">`mode = "wb"`</span> to the <span class="in">`download.file()`</span> function so that it reads:</span>
<span id="cb65-307"><a href="#cb65-307"></a></span>
<span id="cb65-308"><a href="#cb65-308"></a><span class="in">```r</span></span>
<span id="cb65-309"><a href="#cb65-309"></a><span class="fu">download.file</span>(</span>
<span id="cb65-310"><a href="#cb65-310"></a>  <span class="at">url =</span> <span class="st">"https://mpjashby.github.io/crimemappingdata/aggravated_assaults.xlsx"</span>,</span>
<span id="cb65-311"><a href="#cb65-311"></a>  <span class="at">destfile =</span> temp_file,</span>
<span id="cb65-312"><a href="#cb65-312"></a>  <span class="at">mode =</span> <span class="st">"wb"</span></span>
<span id="cb65-313"><a href="#cb65-313"></a>)</span>
<span id="cb65-314"><a href="#cb65-314"></a><span class="in">```</span></span>
<span id="cb65-315"><a href="#cb65-315"></a></span>
<span id="cb65-316"><a href="#cb65-316"></a>If you are using a Mac or a Linux computer then you do not need to worry about this.</span>
<span id="cb65-317"><a href="#cb65-317"></a></span>
<span id="cb65-318"><a href="#cb65-318"></a>:::</span>
<span id="cb65-319"><a href="#cb65-319"></a></span>
<span id="cb65-320"><a href="#cb65-320"></a></span>
<span id="cb65-321"><a href="#cb65-321"></a>Now we have downloaded our data, we can load it into R. Since Excel files can contain multiple sheets, we need to specify which sheet we would like to load into a tibble. We can use the <span class="in">`excel_sheets()`</span> function to get a list of sheets in an Excel file:</span>
<span id="cb65-322"><a href="#cb65-322"></a></span>
<span id="cb65-325"><a href="#cb65-325"></a><span class="in">```{r}</span></span>
<span id="cb65-326"><a href="#cb65-326"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-327"><a href="#cb65-327"></a></span>
<span id="cb65-328"><a href="#cb65-328"></a><span class="co"># Get a list of sheets in an Excel file</span></span>
<span id="cb65-329"><a href="#cb65-329"></a><span class="fu">excel_sheets</span>(temp_file)</span>
<span id="cb65-330"><a href="#cb65-330"></a><span class="in">```</span></span>
<span id="cb65-331"><a href="#cb65-331"></a></span>
<span id="cb65-332"><a href="#cb65-332"></a>We can now load the sheet containing data for Austin and view the first few rows</span>
<span id="cb65-333"><a href="#cb65-333"></a>of the resulting object:</span>
<span id="cb65-334"><a href="#cb65-334"></a></span>
<span id="cb65-337"><a href="#cb65-337"></a><span class="in">```{r}</span></span>
<span id="cb65-338"><a href="#cb65-338"></a><span class="co">#| filename: "chapter_03b.R"</span></span>
<span id="cb65-339"><a href="#cb65-339"></a></span>
<span id="cb65-340"><a href="#cb65-340"></a>agg_assault_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(temp_file, <span class="at">sheet =</span> <span class="st">"Austin"</span>)</span>
<span id="cb65-341"><a href="#cb65-341"></a><span class="in">```</span></span>
<span id="cb65-342"><a href="#cb65-342"></a></span>
<span id="cb65-343"><a href="#cb65-343"></a>and, as usual, we can use the <span class="in">`head()`</span> function to look at the data:</span>
<span id="cb65-344"><a href="#cb65-344"></a></span>
<span id="cb65-347"><a href="#cb65-347"></a><span class="in">```{r}</span></span>
<span id="cb65-348"><a href="#cb65-348"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-349"><a href="#cb65-349"></a><span class="fu">head</span>(agg_assault_data)</span>
<span id="cb65-350"><a href="#cb65-350"></a><span class="in">```</span></span>
<span id="cb65-351"><a href="#cb65-351"></a></span>
<span id="cb65-352"><a href="#cb65-352"></a>Now we have learned how to load our data into an object, we can use other R functions to work with that data in many different ways.</span>
<span id="cb65-353"><a href="#cb65-353"></a></span>
<span id="cb65-354"><a href="#cb65-354"></a></span>
<span id="cb65-355"><a href="#cb65-355"></a>::: {.callout-important}</span>
<span id="cb65-356"><a href="#cb65-356"></a></span>
<span id="cb65-357"><a href="#cb65-357"></a>Different types of data are loaded into R with different functions, e.g. CSV files are loaded with the <span class="in">`read_csv()`</span> function from the <span class="in">`readr`</span> package and Microsoft Excel files are loaded with the <span class="in">`read_excel()`</span> function from the <span class="in">`readxl`</span> package. @sec-load-functions has a list of which function to use to load each type of file.</span>
<span id="cb65-358"><a href="#cb65-358"></a></span>
<span id="cb65-359"><a href="#cb65-359"></a>:::</span>
<span id="cb65-360"><a href="#cb65-360"></a></span>
<span id="cb65-361"><a href="#cb65-361"></a></span>
<span id="cb65-362"><a href="#cb65-362"></a>::: {.box .reading}</span>
<span id="cb65-363"><a href="#cb65-363"></a></span>
<span id="cb65-364"><a href="#cb65-364"></a><span class="co">[</span><span class="ot">Learn more about how to read data into R</span><span class="co">](https://r4ds.had.co.nz/data-import.html)</span> </span>
<span id="cb65-365"><a href="#cb65-365"></a>by reading this chapter of the free online book <span class="co">[</span><span class="ot">R for Data Science</span><span class="co">](https://r4ds.had.co.nz/)</span>.</span>
<span id="cb65-366"><a href="#cb65-366"></a></span>
<span id="cb65-367"><a href="#cb65-367"></a>Excel data can often be messy and the <span class="in">`readxl`</span> package contains various other functions that can be used to deal with this. You can <span class="co">[</span><span class="ot">learn more about how to handle messy Excel data in this online tutorial</span><span class="co">](http://lesscrime.info/post/cleaning-ons-data/)</span>.</span>
<span id="cb65-368"><a href="#cb65-368"></a></span>
<span id="cb65-369"><a href="#cb65-369"></a>:::</span>
<span id="cb65-370"><a href="#cb65-370"></a></span>
<span id="cb65-371"><a href="#cb65-371"></a></span>
<span id="cb65-372"><a href="#cb65-372"></a>::: {.callout-quiz .callout}</span>
<span id="cb65-373"><a href="#cb65-373"></a><span class="fu">#### Reading data</span></span>
<span id="cb65-374"><a href="#cb65-374"></a></span>
<span id="cb65-375"><a href="#cb65-375"></a>Answer the following questions to check your understanding of what we've learned so far in this chapter. If you get a question wrong, you can keep trying until you get the right answer.</span>
<span id="cb65-376"><a href="#cb65-376"></a></span>
<span id="cb65-377"><a href="#cb65-377"></a><span class="in">```{r read-quiz}</span></span>
<span id="cb65-378"><a href="#cb65-378"></a><span class="in">#| echo: false</span></span>
<span id="cb65-379"><a href="#cb65-379"></a></span>
<span id="cb65-380"><a href="#cb65-380"></a><span class="in">read_quiz1 &lt;- c("`readxl`", "`reader`", answer = "`readr`", "`readcsv`")</span></span>
<span id="cb65-381"><a href="#cb65-381"></a><span class="in">read_quiz2 &lt;- c(</span></span>
<span id="cb65-382"><a href="#cb65-382"></a><span class="in">  "`message(san_fran_rob)`",</span></span>
<span id="cb65-383"><a href="#cb65-383"></a><span class="in">  "`summary(san_fran_rob)`",</span></span>
<span id="cb65-384"><a href="#cb65-384"></a><span class="in">  "`peak_inside(san_fran_rob)`",</span></span>
<span id="cb65-385"><a href="#cb65-385"></a><span class="in">  answer = "`head(san_fran_rob)`"</span></span>
<span id="cb65-386"><a href="#cb65-386"></a><span class="in">)</span></span>
<span id="cb65-387"><a href="#cb65-387"></a><span class="in">read_quiz3 &lt;- c(</span></span>
<span id="cb65-388"><a href="#cb65-388"></a><span class="in">  "`10` (the number 10)",</span></span>
<span id="cb65-389"><a href="#cb65-389"></a><span class="in">  answer = "`1.414214` (the square root of 2)",</span></span>
<span id="cb65-390"><a href="#cb65-390"></a><span class="in">  "`10.41421` (10 plus the square root of 2)",</span></span>
<span id="cb65-391"><a href="#cb65-391"></a><span class="in">  "`14.14214` (10 times the square root of 2)"</span></span>
<span id="cb65-392"><a href="#cb65-392"></a><span class="in">)</span></span>
<span id="cb65-393"><a href="#cb65-393"></a><span class="in">```</span></span>
<span id="cb65-394"><a href="#cb65-394"></a></span>
<span id="cb65-395"><a href="#cb65-395"></a>**What R package contains the function `read_csv()` to read CSV data?**</span>
<span id="cb65-396"><a href="#cb65-396"></a></span>
<span id="cb65-397"><a href="#cb65-397"></a><span class="in">`r webexercises::longmcq(read_quiz1)`</span></span>
<span id="cb65-398"><a href="#cb65-398"></a></span>
<span id="cb65-399"><a href="#cb65-399"></a>**What R code prints the first few rows of the tibble called `san_fran_rob`?**</span>
<span id="cb65-400"><a href="#cb65-400"></a></span>
<span id="cb65-401"><a href="#cb65-401"></a><span class="in">`r webexercises::longmcq(read_quiz2)`</span></span>
<span id="cb65-402"><a href="#cb65-402"></a></span>
<span id="cb65-403"><a href="#cb65-403"></a>**If we create an object using the code `number_ten &lt;- 10` and then run the code `number_ten &lt;- sqrt(2)`, what value will the object `number_ten` now have?**</span>
<span id="cb65-404"><a href="#cb65-404"></a></span>
<span id="cb65-405"><a href="#cb65-405"></a><span class="in">`r webexercises::longmcq(read_quiz3)`</span></span>
<span id="cb65-406"><a href="#cb65-406"></a>:::</span>
<span id="cb65-407"><a href="#cb65-407"></a></span>
<span id="cb65-408"><a href="#cb65-408"></a></span>
<span id="cb65-409"><a href="#cb65-409"></a></span>
<span id="cb65-410"><a href="#cb65-410"></a><span class="fu">## Selecting columns</span></span>
<span id="cb65-411"><a href="#cb65-411"></a></span>
<span id="cb65-412"><a href="#cb65-412"></a>In this section we will learn how to reduce the size of our data by selecting only the columns we need and discarding the rest. This can be particularly useful if we are working with a very-large dataset, or if we want to produce a table containing only some columns.</span>
<span id="cb65-413"><a href="#cb65-413"></a></span>
<span id="cb65-414"><a href="#cb65-414"></a>&lt;p class="full-width-image"&gt;&lt;img src="../images/dplyr.jpg" alt="Cartoon showing a furry monster with 'dplyr' written on it wrangling a bunch of smaller, unruly, monsters."&gt;&lt;/p&gt;</span>
<span id="cb65-415"><a href="#cb65-415"></a></span>
<span id="cb65-416"><a href="#cb65-416"></a>We can use the <span class="in">`select()`</span> function from the <span class="co">[</span><span class="ot">dplyr package</span><span class="co">](https://dplyr.tidyverse.org/)</span> (one of the packages that is loaded automatically when we call the <span class="in">`pacman::p_load(tidyverse)`</span> function) to select columns.</span>
<span id="cb65-417"><a href="#cb65-417"></a></span>
<span id="cb65-418"><a href="#cb65-418"></a>If we wanted to select just the <span class="in">`date`</span> and <span class="in">`location_type`</span> columns from the <span class="in">`agg_assault_data`</span> we loaded in the previous section, we can use this code:</span>
<span id="cb65-419"><a href="#cb65-419"></a></span>
<span id="cb65-422"><a href="#cb65-422"></a><span class="in">```{r}</span></span>
<span id="cb65-423"><a href="#cb65-423"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-424"><a href="#cb65-424"></a></span>
<span id="cb65-425"><a href="#cb65-425"></a><span class="fu">select</span>(agg_assault_data, date, location_type)</span>
<span id="cb65-426"><a href="#cb65-426"></a><span class="in">```</span></span>
<span id="cb65-427"><a href="#cb65-427"></a></span>
<span id="cb65-428"><a href="#cb65-428"></a>&lt;a href="https://dplyr.tidyverse.org/" title="dplyr website"&gt;&lt;img src="../images/dplyr.png" class="right-side-image"&gt;&lt;/a&gt;</span>
<span id="cb65-429"><a href="#cb65-429"></a></span>
<span id="cb65-430"><a href="#cb65-430"></a>In a previous section, we mentioned that the code needed to run (or *call*) a function in R has two parts: the function name followed by a pair of parentheses, inside which are zero or more *arguments* separated by commas. The arguments in the <span class="in">`select()`</span> function (and many other functions in the <span class="in">`dplyr`</span> package) work in a slightly different way to many other functions. Here, the first argument is the name of the data object that we want to select from. All the remaining arguments (here, <span class="in">`date`</span> and <span class="in">`location_type`</span>) are the names of the columns we want to select from the data. </span>
<span id="cb65-431"><a href="#cb65-431"></a></span>
<span id="cb65-432"><a href="#cb65-432"></a>We can select as many columns as we want, by just adding the names of the columns separated by commas. The columns in our new dataset will appear in the order in which we specify them in the <span class="in">`select()`</span> function.</span>
<span id="cb65-433"><a href="#cb65-433"></a></span>
<span id="cb65-434"><a href="#cb65-434"></a>We can also use <span class="in">`select()`</span> to rename columns at the same time as selecting them. For example, to select the columns <span class="in">`date`</span> and <span class="in">`location_type`</span> while also renaming <span class="in">`location_type`</span> to be called <span class="in">`type`</span>, can use:</span>
<span id="cb65-435"><a href="#cb65-435"></a></span>
<span id="cb65-438"><a href="#cb65-438"></a><span class="in">```{r}</span></span>
<span id="cb65-439"><a href="#cb65-439"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-440"><a href="#cb65-440"></a></span>
<span id="cb65-441"><a href="#cb65-441"></a><span class="fu">select</span>(agg_assault_data, date, <span class="at">type =</span> location_type)</span>
<span id="cb65-442"><a href="#cb65-442"></a><span class="in">```</span></span>
<span id="cb65-443"><a href="#cb65-443"></a></span>
<span id="cb65-444"><a href="#cb65-444"></a><span class="in">`select()`</span> removes any columns that we don't explicitly choose to keep. If we want to rename a column while keeping *all* the existing columns in the data, we can instead use the <span class="in">`rename()`</span> function (also from the dplyr package):</span>
<span id="cb65-445"><a href="#cb65-445"></a></span>
<span id="cb65-448"><a href="#cb65-448"></a><span class="in">```{r}</span></span>
<span id="cb65-449"><a href="#cb65-449"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-450"><a href="#cb65-450"></a></span>
<span id="cb65-451"><a href="#cb65-451"></a><span class="fu">rename</span>(agg_assault_data, <span class="at">type =</span> location_type)</span>
<span id="cb65-452"><a href="#cb65-452"></a><span class="in">```</span></span>
<span id="cb65-453"><a href="#cb65-453"></a></span>
<span id="cb65-454"><a href="#cb65-454"></a>Remember that functions in R generally do not change existing objects, but instead produce (or *return*) new ones. This means if we want to store the result of this function so we can use it later, we have to assign the value returned by the function to a new object (or overwrite the existing object):</span>
<span id="cb65-455"><a href="#cb65-455"></a></span>
<span id="cb65-458"><a href="#cb65-458"></a><span class="in">```{r}</span></span>
<span id="cb65-459"><a href="#cb65-459"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-460"><a href="#cb65-460"></a></span>
<span id="cb65-461"><a href="#cb65-461"></a>agg_assault_locations <span class="ot">&lt;-</span> <span class="fu">select</span>(agg_assault_data, <span class="at">lon =</span> longitude, <span class="at">lat =</span> latitude)</span>
<span id="cb65-462"><a href="#cb65-462"></a></span>
<span id="cb65-463"><a href="#cb65-463"></a><span class="fu">head</span>(agg_assault_locations)</span>
<span id="cb65-464"><a href="#cb65-464"></a><span class="in">```</span></span>
<span id="cb65-465"><a href="#cb65-465"></a></span>
<span id="cb65-466"><a href="#cb65-466"></a></span>
<span id="cb65-467"><a href="#cb65-467"></a>::: {.box .reading}</span>
<span id="cb65-468"><a href="#cb65-468"></a></span>
<span id="cb65-469"><a href="#cb65-469"></a>You can learn more about selecting, filtering and arranging data using the functions in the <span class="in">`dplyr`</span> package by reading this <span class="co">[</span><span class="ot">Introduction to dplyr tutorial</span><span class="co">](https://dplyr.tidyverse.org/articles/dplyr.html)</span>.</span>
<span id="cb65-470"><a href="#cb65-470"></a></span>
<span id="cb65-471"><a href="#cb65-471"></a>:::</span>
<span id="cb65-472"><a href="#cb65-472"></a></span>
<span id="cb65-473"><a href="#cb65-473"></a></span>
<span id="cb65-474"><a href="#cb65-474"></a>::: {.callout-quiz .callout}</span>
<span id="cb65-475"><a href="#cb65-475"></a><span class="fu">#### `select()` and `rename()`</span></span>
<span id="cb65-476"><a href="#cb65-476"></a></span>
<span id="cb65-477"><a href="#cb65-477"></a><span class="in">```{r select-quiz}</span></span>
<span id="cb65-478"><a href="#cb65-478"></a><span class="in">#| echo: false</span></span>
<span id="cb65-479"><a href="#cb65-479"></a></span>
<span id="cb65-480"><a href="#cb65-480"></a><span class="in">select_quiz1 &lt;- c(answer = "`rename()`", "`select()`")</span></span>
<span id="cb65-481"><a href="#cb65-481"></a><span class="in">select_quiz2 &lt;- c("`rename()`", answer = "`select()`")</span></span>
<span id="cb65-482"><a href="#cb65-482"></a><span class="in">```</span></span>
<span id="cb65-483"><a href="#cb65-483"></a></span>
<span id="cb65-484"><a href="#cb65-484"></a>**Which `dplyr` function allows you to change the name of columns while keeping all the columns in the original data**</span>
<span id="cb65-485"><a href="#cb65-485"></a></span>
<span id="cb65-486"><a href="#cb65-486"></a><span class="in">`r webexercises::longmcq(select_quiz1)`</span></span>
<span id="cb65-487"><a href="#cb65-487"></a></span>
<span id="cb65-488"><a href="#cb65-488"></a>**Which `dplyr` function allows you to choose only some columns in the original data?**</span>
<span id="cb65-489"><a href="#cb65-489"></a></span>
<span id="cb65-490"><a href="#cb65-490"></a><span class="in">`r webexercises::longmcq(select_quiz2)`</span></span>
<span id="cb65-491"><a href="#cb65-491"></a>:::</span>
<span id="cb65-492"><a href="#cb65-492"></a></span>
<span id="cb65-493"><a href="#cb65-493"></a></span>
<span id="cb65-494"><a href="#cb65-494"></a></span>
<span id="cb65-495"><a href="#cb65-495"></a><span class="fu">## Filtering rows</span></span>
<span id="cb65-496"><a href="#cb65-496"></a></span>
<span id="cb65-497"><a href="#cb65-497"></a>Often in crime mapping we will only be interested in part of a particular dataset. In the same way that we can *select* particular *columns* in our data, we can *filter* particular *rows* using the <span class="in">`filter()`</span> function from the dplyr package.</span>
<span id="cb65-498"><a href="#cb65-498"></a></span>
<span id="cb65-499"><a href="#cb65-499"></a>&lt;p class="full-width-image"&gt;&lt;img src="../images/filter.jpg" alt="Cartoon showing monsters explaining how the filter() function works."&gt;&lt;/p&gt;</span>
<span id="cb65-500"><a href="#cb65-500"></a></span>
<span id="cb65-501"><a href="#cb65-501"></a>If we were only interested in offences in the <span class="in">`agg_assault_data`</span> dataset that occurred in residences, we could use <span class="in">`filter()`</span>:</span>
<span id="cb65-502"><a href="#cb65-502"></a></span>
<span id="cb65-505"><a href="#cb65-505"></a><span class="in">```{r}</span></span>
<span id="cb65-506"><a href="#cb65-506"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-507"><a href="#cb65-507"></a></span>
<span id="cb65-508"><a href="#cb65-508"></a><span class="fu">filter</span>(agg_assault_data, location_type <span class="sc">==</span> <span class="st">"residence"</span>)</span>
<span id="cb65-509"><a href="#cb65-509"></a><span class="in">```</span></span>
<span id="cb65-510"><a href="#cb65-510"></a></span>
<span id="cb65-511"><a href="#cb65-511"></a>Note that: </span>
<span id="cb65-512"><a href="#cb65-512"></a></span>
<span id="cb65-513"><a href="#cb65-513"></a><span class="ss">  * </span>the column _name_ `location_type` is not surrounded by quotes (because it represents a column in the data) but the column _value_ `"residence"` is (because it represents the _literal_ character value "residence"), and</span>
<span id="cb65-514"><a href="#cb65-514"></a><span class="ss">  * </span>the <span class="in">`==`</span> (equal to) operator is used, since a single equals sign <span class="in">`=`</span> has another meaning in R.</span>
<span id="cb65-515"><a href="#cb65-515"></a></span>
<span id="cb65-516"><a href="#cb65-516"></a>We can filter using the values of more than one column simultaneously. To filter offences in which the <span class="in">`location_category`</span> is 'retail' and the <span class="in">`location_type`</span> is 'convenience store':</span>
<span id="cb65-517"><a href="#cb65-517"></a></span>
<span id="cb65-520"><a href="#cb65-520"></a><span class="in">```{r}</span></span>
<span id="cb65-521"><a href="#cb65-521"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-522"><a href="#cb65-522"></a></span>
<span id="cb65-523"><a href="#cb65-523"></a><span class="fu">filter</span>(agg_assault_data, </span>
<span id="cb65-524"><a href="#cb65-524"></a>  location_category <span class="sc">==</span> <span class="st">"retail"</span>, </span>
<span id="cb65-525"><a href="#cb65-525"></a>  location_type <span class="sc">==</span> <span class="st">"convenience store"</span></span>
<span id="cb65-526"><a href="#cb65-526"></a>)</span>
<span id="cb65-527"><a href="#cb65-527"></a><span class="in">```</span></span>
<span id="cb65-528"><a href="#cb65-528"></a></span>
<span id="cb65-529"><a href="#cb65-529"></a>::: {.callout-important}</span>
<span id="cb65-530"><a href="#cb65-530"></a><span class="fu">#### `filter()` returns rows that meet _all_ the criteria you specify</span></span>
<span id="cb65-531"><a href="#cb65-531"></a></span>
<span id="cb65-532"><a href="#cb65-532"></a>When you run the code above, the result will contain only those rows in the original data for which the <span class="in">`location_category`</span> column has the value 'retail' _and_ the <span class="in">`location_type`</span> column has the value 'convenience store'.</span>
<span id="cb65-533"><a href="#cb65-533"></a>:::</span>
<span id="cb65-534"><a href="#cb65-534"></a></span>
<span id="cb65-535"><a href="#cb65-535"></a>As well as filtering using the <span class="in">`==`</span> (equals) operator, we can filter using the greater-than (<span class="in">`&gt;`</span>), less-than (<span class="in">`&lt;`</span>), greater-than-or-equal-to (<span class="in">`&gt;=`</span>) and less-than-or-equal-to (<span class="in">`&lt;=`</span>) operators. For example, we can choose offences that occurred in residences on or after 1 July 2019:</span>
<span id="cb65-536"><a href="#cb65-536"></a></span>
<span id="cb65-539"><a href="#cb65-539"></a><span class="in">```{r}</span></span>
<span id="cb65-540"><a href="#cb65-540"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-541"><a href="#cb65-541"></a></span>
<span id="cb65-542"><a href="#cb65-542"></a><span class="fu">filter</span>(</span>
<span id="cb65-543"><a href="#cb65-543"></a>  agg_assault_data, </span>
<span id="cb65-544"><a href="#cb65-544"></a>  location_type <span class="sc">==</span> <span class="st">"residence"</span>, </span>
<span id="cb65-545"><a href="#cb65-545"></a>  date <span class="sc">&gt;=</span> <span class="fu">ymd</span>(<span class="st">"2019-07-01"</span>)</span>
<span id="cb65-546"><a href="#cb65-546"></a>)</span>
<span id="cb65-547"><a href="#cb65-547"></a><span class="in">```</span></span>
<span id="cb65-548"><a href="#cb65-548"></a></span>
<span id="cb65-549"><a href="#cb65-549"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb65-550"><a href="#cb65-550"></a><span class="fu">#### What does the `ymd()` function do?</span></span>
<span id="cb65-551"><a href="#cb65-551"></a></span>
<span id="cb65-552"><a href="#cb65-552"></a>The <span class="in">`ymd()`</span> function from the lubridate package (which we will find out more about below) converts a date stored as a text value to a value that R understands represents a calendar date. The function is called <span class="in">`ymd()`</span> because it processes dates that are stored in year-month-date format. We will learn more about working with dates in @sec-mapping-time.</span>
<span id="cb65-553"><a href="#cb65-553"></a>:::</span>
<span id="cb65-554"><a href="#cb65-554"></a></span>
<span id="cb65-555"><a href="#cb65-555"></a>Sometimes we will want to filter rows that are one thing *or* another. We can do this with the <span class="in">`|`</span> (or) operator. For example, we can filter offences that occurred either in leisure facilities _or_ shopping malls on or after 1 July 2019:</span>
<span id="cb65-556"><a href="#cb65-556"></a></span>
<span id="cb65-559"><a href="#cb65-559"></a><span class="in">```{r}</span></span>
<span id="cb65-560"><a href="#cb65-560"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-561"><a href="#cb65-561"></a></span>
<span id="cb65-562"><a href="#cb65-562"></a><span class="fu">filter</span>(</span>
<span id="cb65-563"><a href="#cb65-563"></a>  agg_assault_data, </span>
<span id="cb65-564"><a href="#cb65-564"></a>  location_category <span class="sc">==</span> <span class="st">"leisure"</span> <span class="sc">|</span> location_type <span class="sc">==</span> <span class="st">"mall"</span>, </span>
<span id="cb65-565"><a href="#cb65-565"></a>  date <span class="sc">&gt;=</span> <span class="fu">ymd</span>(<span class="st">"2019-07-01"</span>)</span>
<span id="cb65-566"><a href="#cb65-566"></a>)</span>
<span id="cb65-567"><a href="#cb65-567"></a><span class="in">```</span></span>
<span id="cb65-568"><a href="#cb65-568"></a></span>
<span id="cb65-569"><a href="#cb65-569"></a>If we want to filter offences that have any one of several different values of the same column, we can use the <span class="in">`%in%`</span> (in) operator. To filter offences that occurred in either streets or publicly accessible open spaces:</span>
<span id="cb65-570"><a href="#cb65-570"></a></span>
<span id="cb65-573"><a href="#cb65-573"></a><span class="in">```{r}</span></span>
<span id="cb65-574"><a href="#cb65-574"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-575"><a href="#cb65-575"></a></span>
<span id="cb65-576"><a href="#cb65-576"></a><span class="fu">filter</span>(agg_assault_data, location_category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"open space"</span>, <span class="st">"street"</span>))</span>
<span id="cb65-577"><a href="#cb65-577"></a><span class="in">```</span></span>
<span id="cb65-578"><a href="#cb65-578"></a></span>
<span id="cb65-579"><a href="#cb65-579"></a>The code <span class="in">`c("open space", "street")`</span> produces what is referred to in R as a *vector* (sometimes referred to as an *atomic vector*, especially in error messages). A vector is a one-dimensional sequence of values of the same type (i.e. all numbers, all character strings etc.). For example, a vector might hold several strings of text (as in the vector <span class="in">`c("open space", "street")`</span>) or a series of numbers such as <span class="in">`c(1, 2, 3)`</span>. There is lots we could learn about vectors, but for now it's only necessary to know that we can create vectors with the <span class="in">`c()`</span> or _combine_ function.</span>
<span id="cb65-580"><a href="#cb65-580"></a></span>
<span id="cb65-581"><a href="#cb65-581"></a>If we wanted to re-use a vector of values several times in our code, it might make sense to store the vector as an object. For example:</span>
<span id="cb65-582"><a href="#cb65-582"></a></span>
<span id="cb65-585"><a href="#cb65-585"></a><span class="in">```{r}</span></span>
<span id="cb65-586"><a href="#cb65-586"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-587"><a href="#cb65-587"></a></span>
<span id="cb65-588"><a href="#cb65-588"></a><span class="co"># Create vector of location types we are interested in</span></span>
<span id="cb65-589"><a href="#cb65-589"></a>location_types <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"open space"</span>, <span class="st">"street"</span>)</span>
<span id="cb65-590"><a href="#cb65-590"></a></span>
<span id="cb65-591"><a href="#cb65-591"></a><span class="co"># Filter the data</span></span>
<span id="cb65-592"><a href="#cb65-592"></a><span class="fu">filter</span>(agg_assault_data, location_category <span class="sc">%in%</span> location_types)</span>
<span id="cb65-593"><a href="#cb65-593"></a><span class="in">```</span></span>
<span id="cb65-594"><a href="#cb65-594"></a></span>
<span id="cb65-595"><a href="#cb65-595"></a>Finally, you can filter based on the output of any R function that returns <span class="in">`TRUE`</span> or <span class="in">`FALSE`</span>. For example, missing values are represented in R as <span class="in">`NA`</span>. We can test whether a value is missing using the <span class="in">`is.na()`</span> function. If we wanted to remove rows from our data that had missing location types, we would filter for those rows that are *not* <span class="in">`NA`</span>. We can do this by combining the <span class="in">`is.na()`</span> function with the <span class="in">`!`</span> (not) operator:</span>
<span id="cb65-596"><a href="#cb65-596"></a></span>
<span id="cb65-599"><a href="#cb65-599"></a><span class="in">```{r}</span></span>
<span id="cb65-600"><a href="#cb65-600"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-601"><a href="#cb65-601"></a></span>
<span id="cb65-602"><a href="#cb65-602"></a><span class="fu">filter</span>(agg_assault_data, <span class="sc">!</span><span class="fu">is.na</span>(location_type))</span>
<span id="cb65-603"><a href="#cb65-603"></a><span class="in">```</span></span>
<span id="cb65-604"><a href="#cb65-604"></a></span>
<span id="cb65-605"><a href="#cb65-605"></a>We will see lots more examples of how to use <span class="in">`filter()`</span> in future chapters.</span>
<span id="cb65-606"><a href="#cb65-606"></a></span>
<span id="cb65-607"><a href="#cb65-607"></a></span>
<span id="cb65-608"><a href="#cb65-608"></a>::: {.callout-quiz .callout}</span>
<span id="cb65-609"><a href="#cb65-609"></a><span class="fu">#### `filter()`</span></span>
<span id="cb65-610"><a href="#cb65-610"></a></span>
<span id="cb65-611"><a href="#cb65-611"></a><span class="in">```{r filter-quiz}</span></span>
<span id="cb65-612"><a href="#cb65-612"></a><span class="in">#| echo: false</span></span>
<span id="cb65-613"><a href="#cb65-613"></a></span>
<span id="cb65-614"><a href="#cb65-614"></a><span class="in">filter_quiz1 &lt;- c(</span></span>
<span id="cb65-615"><a href="#cb65-615"></a><span class="in">  "A type of object that stores a tibble or data frame",</span></span>
<span id="cb65-616"><a href="#cb65-616"></a><span class="in">  answer = "A type of object that stores a one-dimensional sequence of values of the same type",</span></span>
<span id="cb65-617"><a href="#cb65-617"></a><span class="in">  "A type of object that stores a one-dimensional sequence of values that can be of different types",</span></span>
<span id="cb65-618"><a href="#cb65-618"></a><span class="in">  "There is no such thing as a vector in R"</span></span>
<span id="cb65-619"><a href="#cb65-619"></a><span class="in">)</span></span>
<span id="cb65-620"><a href="#cb65-620"></a><span class="in">filter_quiz2 &lt;- c(</span></span>
<span id="cb65-621"><a href="#cb65-621"></a><span class="in">  "Offences that occurred in both restaurants *and* in shopping malls (e.g. at restaurants inside shopping malls)", </span></span>
<span id="cb65-622"><a href="#cb65-622"></a><span class="in">  "Offences that occurred anywhere *except* restaurants or shopping malls (e.g. in homes)",</span></span>
<span id="cb65-623"><a href="#cb65-623"></a><span class="in">  "No offences, because the way the two criteria are combined is illogical",</span></span>
<span id="cb65-624"><a href="#cb65-624"></a><span class="in">  answer = "Offences that occurred either in restaurants *or* in shopping malls"</span></span>
<span id="cb65-625"><a href="#cb65-625"></a><span class="in">)</span></span>
<span id="cb65-626"><a href="#cb65-626"></a><span class="in">filter_quiz3 &lt;- c(</span></span>
<span id="cb65-627"><a href="#cb65-627"></a><span class="in">  "greater than",</span></span>
<span id="cb65-628"><a href="#cb65-628"></a><span class="in">  "less than",</span></span>
<span id="cb65-629"><a href="#cb65-629"></a><span class="in">  answer = "less than or equal to",</span></span>
<span id="cb65-630"><a href="#cb65-630"></a><span class="in">  "greater than or equal to"</span></span>
<span id="cb65-631"><a href="#cb65-631"></a><span class="in">)</span></span>
<span id="cb65-632"><a href="#cb65-632"></a><span class="in">```</span></span>
<span id="cb65-633"><a href="#cb65-633"></a></span>
<span id="cb65-634"><a href="#cb65-634"></a>**What is a vector (sometimes known as an atomic vector) in R?**</span>
<span id="cb65-635"><a href="#cb65-635"></a></span>
<span id="cb65-636"><a href="#cb65-636"></a><span class="in">`r webexercises::longmcq(filter_quiz1)`</span></span>
<span id="cb65-637"><a href="#cb65-637"></a></span>
<span id="cb65-638"><a href="#cb65-638"></a>**Which offences (rows) will be returned by the code `filter(agg_assault_data, location_type %in% c("restaurant", "mall"))`?**</span>
<span id="cb65-639"><a href="#cb65-639"></a></span>
<span id="cb65-640"><a href="#cb65-640"></a><span class="in">`r webexercises::longmcq(filter_quiz2)`</span></span>
<span id="cb65-641"><a href="#cb65-641"></a></span>
<span id="cb65-642"><a href="#cb65-642"></a>**What does the `&lt;=` operator mean?**</span>
<span id="cb65-643"><a href="#cb65-643"></a></span>
<span id="cb65-644"><a href="#cb65-644"></a><span class="in">`r webexercises::longmcq(filter_quiz3)`</span></span>
<span id="cb65-645"><a href="#cb65-645"></a></span>
<span id="cb65-646"><a href="#cb65-646"></a>:::</span>
<span id="cb65-647"><a href="#cb65-647"></a></span>
<span id="cb65-648"><a href="#cb65-648"></a></span>
<span id="cb65-649"><a href="#cb65-649"></a></span>
<span id="cb65-650"><a href="#cb65-650"></a><span class="fu">## Transforming values</span></span>
<span id="cb65-651"><a href="#cb65-651"></a></span>
<span id="cb65-652"><a href="#cb65-652"></a>It is often useful to create new columns in our data, or change the values of existing columns. The <span class="in">`mutate()`</span> function in the dplyr package gives us a way to transform existing columns in our dataset using almost any R function.</span>
<span id="cb65-653"><a href="#cb65-653"></a></span>
<span id="cb65-654"><a href="#cb65-654"></a>&lt;p class="full-width-image"&gt;&lt;img src="../images/mutate.jpg" alt="Cartoon showing furry monsters moving columns of data using a crane."&gt;&lt;/p&gt;</span>
<span id="cb65-655"><a href="#cb65-655"></a></span>
<span id="cb65-656"><a href="#cb65-656"></a>&lt;a href="https://lubridate.tidyverse.org/" title="lubridate website"&gt;&lt;img src="../images/lubridate.png" class="right-side-image"&gt;&lt;/a&gt;</span>
<span id="cb65-657"><a href="#cb65-657"></a></span>
<span id="cb65-658"><a href="#cb65-658"></a>For example, say we wanted to create a new column in our aggravated-assault dataset specifying the day of the week on which each crime occurred. We can do this using the <span class="in">`wday()`</span> function from the <span class="co">[</span><span class="ot">lubridate package</span><span class="co">](https://lubridate.tidyverse.org/)</span> (using the <span class="in">`label = TRUE`</span> argument to produce weekday names, rather than numbers):</span>
<span id="cb65-659"><a href="#cb65-659"></a></span>
<span id="cb65-662"><a href="#cb65-662"></a><span class="in">```{r}</span></span>
<span id="cb65-663"><a href="#cb65-663"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-664"><a href="#cb65-664"></a></span>
<span id="cb65-665"><a href="#cb65-665"></a><span class="fu">mutate</span>(agg_assault_data, <span class="at">weekday =</span> <span class="fu">wday</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>))</span>
<span id="cb65-666"><a href="#cb65-666"></a><span class="in">```</span></span>
<span id="cb65-667"><a href="#cb65-667"></a></span>
<span id="cb65-668"><a href="#cb65-668"></a>We can also change existing columns. However (as with objects) there is no way to undo this, so you should only replace columns if you are sure you will not need them. For example, if we wanted to remove the time portion of the <span class="in">`date`</span> variable (which may sometimes be useful, as shown in the next section) using the <span class="in">`as_date()`</span> function (also from the lubridate package) and at the same time create the weekday variable:</span>
<span id="cb65-669"><a href="#cb65-669"></a></span>
<span id="cb65-672"><a href="#cb65-672"></a><span class="in">```{r}</span></span>
<span id="cb65-673"><a href="#cb65-673"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-674"><a href="#cb65-674"></a></span>
<span id="cb65-675"><a href="#cb65-675"></a><span class="fu">mutate</span>(</span>
<span id="cb65-676"><a href="#cb65-676"></a>  agg_assault_data, </span>
<span id="cb65-677"><a href="#cb65-677"></a>  <span class="at">date =</span> <span class="fu">as_date</span>(date),</span>
<span id="cb65-678"><a href="#cb65-678"></a>  <span class="at">weekday =</span> <span class="fu">wday</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-679"><a href="#cb65-679"></a>)</span>
<span id="cb65-680"><a href="#cb65-680"></a><span class="in">```</span></span>
<span id="cb65-681"><a href="#cb65-681"></a></span>
<span id="cb65-682"><a href="#cb65-682"></a>You may sometimes want to change only some values in a column. With a categorical variable, we can change one value to another using the <span class="in">`case_match()`</span> function from the dplyr package. Look at this code and use the comments (lines starting with <span class="in">`# `</span>) to understand how it works.</span>
<span id="cb65-683"><a href="#cb65-683"></a></span>
<span id="cb65-686"><a href="#cb65-686"></a><span class="in">```{r}</span></span>
<span id="cb65-687"><a href="#cb65-687"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-688"><a href="#cb65-688"></a></span>
<span id="cb65-689"><a href="#cb65-689"></a><span class="fu">mutate</span>(</span>
<span id="cb65-690"><a href="#cb65-690"></a>  agg_assault_data,</span>
<span id="cb65-691"><a href="#cb65-691"></a>  <span class="at">location_category =</span> <span class="fu">case_match</span>(</span>
<span id="cb65-692"><a href="#cb65-692"></a>    location_category, </span>
<span id="cb65-693"><a href="#cb65-693"></a>    <span class="co"># We specify which existing values we want to convert into which new values</span></span>
<span id="cb65-694"><a href="#cb65-694"></a>    <span class="co"># by providing the existing value on the left-hand side and the new value</span></span>
<span id="cb65-695"><a href="#cb65-695"></a>    <span class="co"># on the right hand side, separated by a tilde (~) character</span></span>
<span id="cb65-696"><a href="#cb65-696"></a>    <span class="st">"open space"</span> <span class="sc">~</span> <span class="st">"public open space"</span>,</span>
<span id="cb65-697"><a href="#cb65-697"></a>    <span class="st">"street"</span> <span class="sc">~</span> <span class="st">"street or road"</span>,</span>
<span id="cb65-698"><a href="#cb65-698"></a>    <span class="co"># If we want to keep the existing values for any values we have not</span></span>
<span id="cb65-699"><a href="#cb65-699"></a>    <span class="co"># specified, we can do that using the .default argument</span></span>
<span id="cb65-700"><a href="#cb65-700"></a>    <span class="at">.default =</span> location_category</span>
<span id="cb65-701"><a href="#cb65-701"></a>  )</span>
<span id="cb65-702"><a href="#cb65-702"></a>)</span>
<span id="cb65-703"><a href="#cb65-703"></a><span class="in">```</span></span>
<span id="cb65-704"><a href="#cb65-704"></a></span>
<span id="cb65-705"><a href="#cb65-705"></a>We could also make changes based on more-complicated sets of criteria using the <span class="in">`case_when()`</span> function, but we will return to that in a future chapter.</span>
<span id="cb65-706"><a href="#cb65-706"></a></span>
<span id="cb65-707"><a href="#cb65-707"></a>The R functions that you use inside <span class="in">`mutate()`</span> must return the same number of values as there are rows in the dataset. This is true for most R functions (which are referred to as *vectorised* functions), but there are some – such as <span class="in">`mean()`</span> and <span class="in">`max()`</span> – that return a single value. These _summarising functions_ cannot be used inside <span class="in">`mutate()`</span> (you will see an error message if you try) but are instead used with the next data-wrangling function we will learn about: <span class="in">`summarise()`</span>.</span>
<span id="cb65-708"><a href="#cb65-708"></a></span>
<span id="cb65-709"><a href="#cb65-709"></a></span>
<span id="cb65-710"><a href="#cb65-710"></a></span>
<span id="cb65-711"><a href="#cb65-711"></a><span class="fu">## Summarising rows</span></span>
<span id="cb65-712"><a href="#cb65-712"></a></span>
<span id="cb65-713"><a href="#cb65-713"></a>Summarising data is often useful in crime analysis. We can use the <span class="in">`summarise()`</span> function from the dplyr package to produce summaries of different columns in our data. There is an identical function called <span class="in">`summarize()`</span> so that you do not have to remember whether to use the US or British spelling.</span>
<span id="cb65-714"><a href="#cb65-714"></a></span>
<span id="cb65-715"><a href="#cb65-715"></a>By default, <span class="in">`summarise()`</span> collapses data into a single row, with each column summarised using a function that you specify. For example, suppose you want to find out which police station a specialist squad should be based at to most easily respond to reports of serious assaults. You might do this by working out the weighted centre of all the offence locations, i.e. the means of the longitudes and latitudes for all the crimes. You could then base the squad at the police station that was closest to the weighted centre.</span>
<span id="cb65-716"><a href="#cb65-716"></a></span>
<span id="cb65-717"><a href="#cb65-717"></a></span>
<span id="cb65-720"><a href="#cb65-720"></a><span class="in">```{r}</span></span>
<span id="cb65-721"><a href="#cb65-721"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-722"><a href="#cb65-722"></a></span>
<span id="cb65-723"><a href="#cb65-723"></a><span class="fu">summarise</span>(</span>
<span id="cb65-724"><a href="#cb65-724"></a>  agg_assault_data, </span>
<span id="cb65-725"><a href="#cb65-725"></a>  <span class="at">mean_lng =</span> <span class="fu">mean</span>(longitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb65-726"><a href="#cb65-726"></a>  <span class="at">mean_lat =</span> <span class="fu">mean</span>(latitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-727"><a href="#cb65-727"></a>)</span>
<span id="cb65-728"><a href="#cb65-728"></a><span class="in">```</span></span>
<span id="cb65-729"><a href="#cb65-729"></a></span>
<span id="cb65-730"><a href="#cb65-730"></a></span>
<span id="cb65-731"><a href="#cb65-731"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb65-732"><a href="#cb65-732"></a><span class="fu">#### What does the argument `na.rm = TRUE` do?</span></span>
<span id="cb65-733"><a href="#cb65-733"></a></span>
<span id="cb65-734"><a href="#cb65-734"></a>Lots of functions in R have an argument called <span class="in">`na.rm`</span> that can be set to either <span class="in">`TRUE`</span> or <span class="in">`FALSE`</span>. Setting <span class="in">`na.rm = TRUE`</span> in this case specifies that the  <span class="in">`mean()`</span> function should remove (<span class="in">`rm`</span>) any missing (<span class="in">`NA`</span>) values before calculating the mean. </span>
<span id="cb65-735"><a href="#cb65-735"></a></span>
<span id="cb65-736"><a href="#cb65-736"></a>If we do not specify this and our data contain any missing values, the <span class="in">`mean()`</span> function will return <span class="in">`NA`</span>. Functions in R do this because it is not possible to completely answer the question 'what is the mean of these values?' if some of the values are missing. </span>
<span id="cb65-737"><a href="#cb65-737"></a></span>
<span id="cb65-738"><a href="#cb65-738"></a>This logic applies in lots of cases. For example, if you create an R object called <span class="in">`value`</span> with the code <span class="in">`value &lt;- 2`</span> and then run the R code <span class="in">`value &gt; 1`</span>, you will get the answer <span class="in">`TRUE`</span>. But if you set the object <span class="in">`value`</span> to be <span class="in">`NA`</span> using the code <span class="in">`value &lt;- NA`</span>, when you run the R code <span class="in">`value &gt; 1`</span> you will get the answer <span class="in">`NA`</span>. This is because there is no way to know if the missing value represented by <span class="in">`NA`</span> is greater than 1 or not. This is why it is often useful to calculate statistics such as a mean value after removing any missing values using the <span class="in">`na.rm = TRUE`</span> argument.</span>
<span id="cb65-739"><a href="#cb65-739"></a>:::</span>
<span id="cb65-740"><a href="#cb65-740"></a></span>
<span id="cb65-741"><a href="#cb65-741"></a></span>
<span id="cb65-742"><a href="#cb65-742"></a><span class="in">`summarise()`</span> becomes more useful if we first divide our data into groups, since we then get a summary for each group separately. We can use the <span class="in">`.by`</span> argument of the <span class="in">`summarise()`</span> function to specify that we want separate summaries for each unique value of one or more columns in the data. For example, to produce a separate summary for each unique value of <span class="in">`location_category`</span>, we can use this code:</span>
<span id="cb65-743"><a href="#cb65-743"></a></span>
<span id="cb65-746"><a href="#cb65-746"></a><span class="in">```{r}</span></span>
<span id="cb65-747"><a href="#cb65-747"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-748"><a href="#cb65-748"></a></span>
<span id="cb65-749"><a href="#cb65-749"></a><span class="fu">summarise</span>(</span>
<span id="cb65-750"><a href="#cb65-750"></a>  agg_assault_data,</span>
<span id="cb65-751"><a href="#cb65-751"></a>  <span class="at">mean_lng =</span> <span class="fu">mean</span>(longitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb65-752"><a href="#cb65-752"></a>  <span class="at">mean_lat =</span> <span class="fu">mean</span>(latitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb65-753"><a href="#cb65-753"></a>  <span class="at">.by =</span> location_category</span>
<span id="cb65-754"><a href="#cb65-754"></a>)</span>
<span id="cb65-755"><a href="#cb65-755"></a><span class="in">```</span></span>
<span id="cb65-756"><a href="#cb65-756"></a></span>
<span id="cb65-757"><a href="#cb65-757"></a>You can add multiple grouping variables using the <span class="in">`c()`</span> (_combine_) function if you want to generate summary values for groups within groups:</span>
<span id="cb65-758"><a href="#cb65-758"></a></span>
<span id="cb65-761"><a href="#cb65-761"></a><span class="in">```{r}</span></span>
<span id="cb65-762"><a href="#cb65-762"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-763"><a href="#cb65-763"></a></span>
<span id="cb65-764"><a href="#cb65-764"></a><span class="fu">summarise</span>(</span>
<span id="cb65-765"><a href="#cb65-765"></a>  agg_assault_data,</span>
<span id="cb65-766"><a href="#cb65-766"></a>  <span class="at">mean_lng =</span> <span class="fu">mean</span>(longitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb65-767"><a href="#cb65-767"></a>  <span class="at">mean_lat =</span> <span class="fu">mean</span>(latitude, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb65-768"><a href="#cb65-768"></a>  <span class="at">.by =</span> <span class="fu">c</span>(location_category, location_type)</span>
<span id="cb65-769"><a href="#cb65-769"></a>)</span>
<span id="cb65-770"><a href="#cb65-770"></a><span class="in">```</span></span>
<span id="cb65-771"><a href="#cb65-771"></a></span>
<span id="cb65-772"><a href="#cb65-772"></a></span>
<span id="cb65-773"><a href="#cb65-773"></a></span>
<span id="cb65-774"><a href="#cb65-774"></a><span class="fu">### Counting rows</span></span>
<span id="cb65-775"><a href="#cb65-775"></a></span>
<span id="cb65-776"><a href="#cb65-776"></a>One very common way of summarising data is to count the number of rows in a dataset that have each unique value of one or more columns. For example, if we have a dataset of crimes in which each row represents a single crime, we might want to count how many crimes happened on each day of the week, or how many crimes of each type are in the dataset. We can use <span class="in">`summarise()`</span> to do that, together with the <span class="in">`n()`</span> function (from the same dplyr package as <span class="in">`summarise()`</span>). For example, if we wanted to count how many rows in the <span class="in">`agg_assault_data`</span> dataset had each unique combination of <span class="in">`location_category`</span> and <span class="in">`location_type`</span>:</span>
<span id="cb65-777"><a href="#cb65-777"></a></span>
<span id="cb65-780"><a href="#cb65-780"></a><span class="in">```{r}</span></span>
<span id="cb65-781"><a href="#cb65-781"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-782"><a href="#cb65-782"></a></span>
<span id="cb65-783"><a href="#cb65-783"></a><span class="fu">summarise</span>(agg_assault_data, <span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(location_category, location_type))</span>
<span id="cb65-784"><a href="#cb65-784"></a><span class="in">```</span></span>
<span id="cb65-785"><a href="#cb65-785"></a></span>
<span id="cb65-786"><a href="#cb65-786"></a>In this code, the <span class="in">`n()`</span> function simply returns the number of rows of data in each group, i.e. the number of rows with each unique combination of values of <span class="in">`location_category`</span> and <span class="in">`location_type`</span>.</span>
<span id="cb65-787"><a href="#cb65-787"></a></span>
<span id="cb65-788"><a href="#cb65-788"></a>Since counting the number of rows in each group a dataset is a very common task, dplyr includes another function called <span class="in">`count()`</span> that allows you to do the same thing as in the code above, but with slightly less typing:</span>
<span id="cb65-789"><a href="#cb65-789"></a></span>
<span id="cb65-790"><a href="#cb65-790"></a>So if you wanted to know how many aggravated assaults had occurred in each location category and type, you could this code instead of using <span class="in">`summarise()`</span>:</span>
<span id="cb65-791"><a href="#cb65-791"></a></span>
<span id="cb65-794"><a href="#cb65-794"></a><span class="in">```{r}</span></span>
<span id="cb65-795"><a href="#cb65-795"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-796"><a href="#cb65-796"></a></span>
<span id="cb65-797"><a href="#cb65-797"></a><span class="fu">count</span>(agg_assault_data, location_category, location_type)</span>
<span id="cb65-798"><a href="#cb65-798"></a><span class="in">```</span></span>
<span id="cb65-799"><a href="#cb65-799"></a></span>
<span id="cb65-800"><a href="#cb65-800"></a>Note that the first argument of <span class="in">`count()`</span> is the dataset, and every subsequent argument specifies another variable that should be used to group the data.</span>
<span id="cb65-801"><a href="#cb65-801"></a></span>
<span id="cb65-802"><a href="#cb65-802"></a></span>
<span id="cb65-803"><a href="#cb65-803"></a></span>
<span id="cb65-804"><a href="#cb65-804"></a><span class="fu">## Arranging rows</span></span>
<span id="cb65-805"><a href="#cb65-805"></a></span>
<span id="cb65-806"><a href="#cb65-806"></a>It is sometimes useful to be able to place rows in a dataset into a particular order. We can do this using the <span class="in">`arrange()`</span> function from the dplyr package. For example, we can sort the aggravated-assault data by date:</span>
<span id="cb65-807"><a href="#cb65-807"></a></span>
<span id="cb65-810"><a href="#cb65-810"></a><span class="in">```{r}</span></span>
<span id="cb65-811"><a href="#cb65-811"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-812"><a href="#cb65-812"></a></span>
<span id="cb65-813"><a href="#cb65-813"></a><span class="fu">arrange</span>(agg_assault_data, date)</span>
<span id="cb65-814"><a href="#cb65-814"></a><span class="in">```</span></span>
<span id="cb65-815"><a href="#cb65-815"></a></span>
<span id="cb65-816"><a href="#cb65-816"></a>By default, <span class="in">`arrange()`</span> sorts rows in ascending order, i.e. it sorts numeric values from the smallest to the largest, dates from earliest to latest and character values alphabetically. We can instead sort values in descending order by wrapping the name of a column in the <span class="in">`desc()`</span> function:</span>
<span id="cb65-817"><a href="#cb65-817"></a></span>
<span id="cb65-820"><a href="#cb65-820"></a><span class="in">```{r}</span></span>
<span id="cb65-821"><a href="#cb65-821"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-822"><a href="#cb65-822"></a></span>
<span id="cb65-823"><a href="#cb65-823"></a><span class="fu">arrange</span>(agg_assault_data, <span class="fu">desc</span>(date))</span>
<span id="cb65-824"><a href="#cb65-824"></a><span class="in">```</span></span>
<span id="cb65-825"><a href="#cb65-825"></a></span>
<span id="cb65-826"><a href="#cb65-826"></a>We can also sort the data based on multiple columns – the data are sorted first on the first column that you specify, with tied rows then sorted on the subsequent columns in order.</span>
<span id="cb65-827"><a href="#cb65-827"></a></span>
<span id="cb65-830"><a href="#cb65-830"></a><span class="in">```{r}</span></span>
<span id="cb65-831"><a href="#cb65-831"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-832"><a href="#cb65-832"></a></span>
<span id="cb65-833"><a href="#cb65-833"></a><span class="fu">arrange</span>(agg_assault_data, date, <span class="fu">desc</span>(location_type), location_category)</span>
<span id="cb65-834"><a href="#cb65-834"></a><span class="in">```</span></span>
<span id="cb65-835"><a href="#cb65-835"></a></span>
<span id="cb65-836"><a href="#cb65-836"></a></span>
<span id="cb65-837"><a href="#cb65-837"></a>::: {.callout-quiz .callout}</span>
<span id="cb65-838"><a href="#cb65-838"></a><span class="fu">#### Arranging rows in data</span></span>
<span id="cb65-839"><a href="#cb65-839"></a></span>
<span id="cb65-840"><a href="#cb65-840"></a>In the R Console, type the code necessary to arrange <span class="in">`agg_assault_data`</span> in order of latitude, in descending order (from largest to smallest). Once you've tried writing the code, if you need help you can click the 'Solution' button below.</span>
<span id="cb65-841"><a href="#cb65-841"></a></span>
<span id="cb65-842"><a href="#cb65-842"></a><span class="in">`r webexercises::hide()`</span></span>
<span id="cb65-843"><a href="#cb65-843"></a></span>
<span id="cb65-844"><a href="#cb65-844"></a><span class="in">`arrange(agg_assault_data, desc(latitude))`</span></span>
<span id="cb65-845"><a href="#cb65-845"></a></span>
<span id="cb65-846"><a href="#cb65-846"></a><span class="in">`r webexercises::unhide()`</span></span>
<span id="cb65-847"><a href="#cb65-847"></a>:::</span>
<span id="cb65-848"><a href="#cb65-848"></a></span>
<span id="cb65-849"><a href="#cb65-849"></a></span>
<span id="cb65-850"><a href="#cb65-850"></a></span>
<span id="cb65-851"><a href="#cb65-851"></a><span class="fu">## Saving data</span></span>
<span id="cb65-852"><a href="#cb65-852"></a></span>
<span id="cb65-853"><a href="#cb65-853"></a>Once we have finished wrangling a particular dataset, it is often useful to save it to a file so that we can use it again in future without going through all the steps of data wrangling again.</span>
<span id="cb65-854"><a href="#cb65-854"></a></span>
<span id="cb65-855"><a href="#cb65-855"></a>Most R functions that begin with <span class="in">`read_`</span> (like <span class="in">`read_csv()`</span> and <span class="in">`read_excel()`</span>) have equivalent functions that begin <span class="in">`write_`</span> and which save data into a particular file format. In this example, we will use the <span class="in">`write_csv()`</span> function from the readr package, which is loaded when we load the tidyverse package.</span>
<span id="cb65-856"><a href="#cb65-856"></a></span>
<span id="cb65-857"><a href="#cb65-857"></a>Just as <span class="in">`read_csv()`</span> can read files from a variety of different locations, so <span class="in">`write_csv()`</span> can write files to different locations. Look at this code and use the comments (lines beginning with <span class="in">`# `</span>) to understand the different options for saving data.</span>
<span id="cb65-858"><a href="#cb65-858"></a></span>
<span id="cb65-861"><a href="#cb65-861"></a><span class="in">```{r}</span></span>
<span id="cb65-862"><a href="#cb65-862"></a><span class="co">#| eval: false</span></span>
<span id="cb65-863"><a href="#cb65-863"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb65-864"><a href="#cb65-864"></a></span>
<span id="cb65-865"><a href="#cb65-865"></a><span class="co"># We can write data to a file in the same folder as our R script</span></span>
<span id="cb65-866"><a href="#cb65-866"></a><span class="fu">write_csv</span>(agg_assault_data, <span class="st">"fort_worth_agg_assault.csv"</span>)</span>
<span id="cb65-867"><a href="#cb65-867"></a></span>
<span id="cb65-868"><a href="#cb65-868"></a><span class="co"># Or another folder on your computer ('../../' is short for the parent folder of</span></span>
<span id="cb65-869"><a href="#cb65-869"></a><span class="co"># the parent folder of the current folder)</span></span>
<span id="cb65-870"><a href="#cb65-870"></a><span class="fu">write_csv</span>(agg_assault_data, <span class="st">"../../fort_worth_agg_assault.csv"</span>)</span>
<span id="cb65-871"><a href="#cb65-871"></a><span class="in">```</span></span>
<span id="cb65-872"><a href="#cb65-872"></a></span>
<span id="cb65-873"><a href="#cb65-873"></a>There are corresponding write functions for other types of data (which we will come back to when we learn how to handle spatial data), but in this course we will store all non-spatial data in CSV format because it can be read by many different programs.</span>
<span id="cb65-874"><a href="#cb65-874"></a></span>
<span id="cb65-875"><a href="#cb65-875"></a></span>
<span id="cb65-876"><a href="#cb65-876"></a></span>
<span id="cb65-877"><a href="#cb65-877"></a><span class="fu">## Stringing functions together {#sec-pipe-operator}</span></span>
<span id="cb65-878"><a href="#cb65-878"></a></span>
<span id="cb65-879"><a href="#cb65-879"></a>In this chapter we have learned how to use the dplyr functions <span class="in">`select()`</span>, <span class="in">`filter()`</span>, <span class="in">`mutate()`</span>, <span class="in">`summarise()`</span> and <span class="in">`arrange()`</span> to wrangle data from one format to another. Data wrangling is part of almost all data analysis, so these are skills we will use frequently.</span>
<span id="cb65-880"><a href="#cb65-880"></a></span>
<span id="cb65-881"><a href="#cb65-881"></a>Data wrangling often involves multiple steps. For example, we might want to load some data, select certain columns, filter some rows, mutate some of the variables, summarise the dataset and save the result. We can do each of these steps separately, assigning the result of each step to a new object.</span>
<span id="cb65-882"><a href="#cb65-882"></a></span>
<span id="cb65-885"><a href="#cb65-885"></a><span class="in">```{r}</span></span>
<span id="cb65-886"><a href="#cb65-886"></a><span class="co">#| eval: false</span></span>
<span id="cb65-887"><a href="#cb65-887"></a><span class="co">#| filename: "chapter_03a.R"</span></span>
<span id="cb65-888"><a href="#cb65-888"></a></span>
<span id="cb65-889"><a href="#cb65-889"></a><span class="co"># Select only the columns we need</span></span>
<span id="cb65-890"><a href="#cb65-890"></a>robbery2 <span class="ot">&lt;-</span> <span class="fu">select</span>(san_fran_rob, date_time)</span>
<span id="cb65-891"><a href="#cb65-891"></a></span>
<span id="cb65-892"><a href="#cb65-892"></a><span class="co"># Filter only those offences that occurred in the first quarter of 2019</span></span>
<span id="cb65-893"><a href="#cb65-893"></a>robbery3 <span class="ot">&lt;-</span> <span class="fu">filter</span>(robbery2, <span class="fu">as_date</span>(date_time) <span class="sc">&lt;=</span> <span class="fu">ymd</span>(<span class="st">"2019-03-31"</span>))</span>
<span id="cb65-894"><a href="#cb65-894"></a></span>
<span id="cb65-895"><a href="#cb65-895"></a><span class="co"># Create a new weekday variable</span></span>
<span id="cb65-896"><a href="#cb65-896"></a>robbery4 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(robbery3, <span class="at">weekday =</span> <span class="fu">wday</span>(date_time, <span class="at">label =</span> <span class="cn">TRUE</span>))</span>
<span id="cb65-897"><a href="#cb65-897"></a></span>
<span id="cb65-898"><a href="#cb65-898"></a><span class="co"># Count how many offences occurred on each weekday</span></span>
<span id="cb65-899"><a href="#cb65-899"></a>q1_weekday_counts <span class="ot">&lt;-</span> <span class="fu">count</span>(robbery4, weekday)</span>
<span id="cb65-900"><a href="#cb65-900"></a><span class="in">```</span></span>
<span id="cb65-901"><a href="#cb65-901"></a></span>
<span id="cb65-902"><a href="#cb65-902"></a>This code works, but involves creating six new objects, even though we only need the final <span class="in">`q1_weekday_counts`</span> object for our analysis. You may notice that the first argument expected by <span class="in">`select()`</span>, <span class="in">`filter()`</span>, <span class="in">`mutate()`</span> and <span class="in">`count()`</span> is always the data tibble produced by the previous step. For example, the <span class="in">`filter()`</span> function on line 5 of this code uses the <span class="in">`robbery2`</span> object created by line 2 of the code.</span>
<span id="cb65-903"><a href="#cb65-903"></a></span>
<span id="cb65-904"><a href="#cb65-904"></a>Whenever you write code that (a) consists of several sequential steps, and (b) each step uses the data produced by the previous step, there is a better way to do it. This method uses the <span class="in">`|&gt;`</span> (or _pipe_) operator. The pipe operator works by using the result of the code on the left-hand side of the pipe as the first argument to a function on the right-hand side. So the code <span class="in">`x  |&gt; fun1() |&gt; fun2()`</span> starts with an object called <span class="in">`x`</span>, uses that as the input to the function <span class="in">`fun1()`</span>, then passes the result produced by <span class="in">`fun1()`</span> and uses that as the input to <span class="in">`fun2()`</span>.</span>
<span id="cb65-905"><a href="#cb65-905"></a></span>
<span id="cb65-906"><a href="#cb65-906"></a>It may be useful to read the pipe operator as 'and then', since piped code does the first thing *and then* the second thing with the result *and then* the third thing with the </span>
<span id="cb65-907"><a href="#cb65-907"></a>result of that, and so on. Piped code (sometimes called a *pipeline*) is a lot like the series of steps in a recipe.</span>
<span id="cb65-908"><a href="#cb65-908"></a></span>
<span id="cb65-909"><a href="#cb65-909"></a>Delete all the code from the file <span class="in">`chapter_03a.R`</span>, since we are now going to replace it with a piped version of the same code. This pipeline of code is better because it is shorter than the previous code, is easier to maintain and (once you get used to the pipeline) is easier to understand.</span>
<span id="cb65-910"><a href="#cb65-910"></a></span>
<span id="cb65-913"><a href="#cb65-913"></a><span class="in">```{r}</span></span>
<span id="cb65-914"><a href="#cb65-914"></a><span class="co">#| eval: false</span></span>
<span id="cb65-915"><a href="#cb65-915"></a><span class="co">#| filename: "chapter_03a.R"</span></span>
<span id="cb65-916"><a href="#cb65-916"></a></span>
<span id="cb65-917"><a href="#cb65-917"></a><span class="co"># Load packages</span></span>
<span id="cb65-918"><a href="#cb65-918"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span>
<span id="cb65-919"><a href="#cb65-919"></a></span>
<span id="cb65-920"><a href="#cb65-920"></a><span class="co"># Load data</span></span>
<span id="cb65-921"><a href="#cb65-921"></a>san_fran_rob <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/san_francisco_robbery.csv"</span>)</span>
<span id="cb65-922"><a href="#cb65-922"></a></span>
<span id="cb65-923"><a href="#cb65-923"></a><span class="co"># Produce counts of robberies each weekday</span></span>
<span id="cb65-924"><a href="#cb65-924"></a>q1_weekday_counts <span class="ot">&lt;-</span> san_fran_rob <span class="sc">|&gt;</span> </span>
<span id="cb65-925"><a href="#cb65-925"></a>  <span class="fu">select</span>(<span class="sc">-</span>offense_type) <span class="sc">|&gt;</span> </span>
<span id="cb65-926"><a href="#cb65-926"></a>  <span class="fu">filter</span>(<span class="fu">as_date</span>(date_time) <span class="sc">&lt;=</span> <span class="fu">ymd</span>(<span class="st">"2019-03-31"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb65-927"><a href="#cb65-927"></a>  <span class="fu">mutate</span>(<span class="at">weekday =</span> <span class="fu">wday</span>(date_time, <span class="at">label =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb65-928"><a href="#cb65-928"></a>  <span class="fu">count</span>(weekday)</span>
<span id="cb65-929"><a href="#cb65-929"></a><span class="in">```</span></span>
<span id="cb65-930"><a href="#cb65-930"></a></span>
<span id="cb65-933"><a href="#cb65-933"></a><span class="in">```{r}</span></span>
<span id="cb65-934"><a href="#cb65-934"></a><span class="co">#| echo: false</span></span>
<span id="cb65-935"><a href="#cb65-935"></a></span>
<span id="cb65-936"><a href="#cb65-936"></a><span class="co"># Load packages</span></span>
<span id="cb65-937"><a href="#cb65-937"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span>
<span id="cb65-938"><a href="#cb65-938"></a></span>
<span id="cb65-939"><a href="#cb65-939"></a><span class="co"># Load data</span></span>
<span id="cb65-940"><a href="#cb65-940"></a>san_fran_rob <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/san_francisco_robbery.csv"</span>)</span>
<span id="cb65-941"><a href="#cb65-941"></a></span>
<span id="cb65-942"><a href="#cb65-942"></a><span class="co"># Produce counts of robberies each weekday</span></span>
<span id="cb65-943"><a href="#cb65-943"></a>q1_weekday_counts <span class="ot">&lt;-</span> san_fran_rob <span class="sc">|&gt;</span> </span>
<span id="cb65-944"><a href="#cb65-944"></a>  <span class="fu">select</span>(<span class="sc">-</span>offense_type) <span class="sc">|&gt;</span> </span>
<span id="cb65-945"><a href="#cb65-945"></a>  <span class="fu">filter</span>(<span class="fu">as_date</span>(date_time) <span class="sc">&lt;=</span> <span class="fu">ymd</span>(<span class="st">"2019-03-31"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb65-946"><a href="#cb65-946"></a>  <span class="fu">mutate</span>(<span class="at">weekday =</span> <span class="fu">wday</span>(date_time, <span class="at">label =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb65-947"><a href="#cb65-947"></a>  <span class="fu">count</span>(weekday)</span>
<span id="cb65-948"><a href="#cb65-948"></a><span class="in">```</span></span>
<span id="cb65-949"><a href="#cb65-949"></a></span>
<span id="cb65-950"><a href="#cb65-950"></a></span>
<span id="cb65-951"><a href="#cb65-951"></a>You might not find the pipe operator completely intuitive at the moment, but it will become easier as you see more examples in future chapters. </span>
<span id="cb65-952"><a href="#cb65-952"></a></span>
<span id="cb65-953"><a href="#cb65-953"></a></span>
<span id="cb65-954"><a href="#cb65-954"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb65-955"><a href="#cb65-955"></a><span class="fu">#### What about the `%&gt;%` pipe operator?</span></span>
<span id="cb65-956"><a href="#cb65-956"></a></span>
<span id="cb65-957"><a href="#cb65-957"></a>If you have learned any R coding before, you might have learned to use the <span class="in">`%&gt;%`</span> pipe operator from the magrittr package. The <span class="in">`%&gt;%`</span> pipe operator was introduced several years ago to allow people to construct pipelines of code in R. The <span class="in">`%&gt;%`</span> operator was so widely used that the team that writes the R programming language decided to provide the <span class="in">`|&gt;`</span> pipe operator in R itself, to avoid the need to load the magrittr package. You might sometimes see the <span class="in">`|&gt;`</span> referred to as the _native_ pipe operator.</span>
<span id="cb65-958"><a href="#cb65-958"></a></span>
<span id="cb65-959"><a href="#cb65-959"></a>You will still see the <span class="in">`%&gt;%`</span> pipe operator used in lots of R code examples online. In almost all cases, when you see <span class="in">`%&gt;%`</span> you can replace it with the R  pipe operator <span class="in">`|&gt;`</span>, since they both work in very similar ways.</span>
<span id="cb65-960"><a href="#cb65-960"></a>:::</span>
<span id="cb65-961"><a href="#cb65-961"></a></span>
<span id="cb65-962"><a href="#cb65-962"></a></span>
<span id="cb65-963"><a href="#cb65-963"></a>Save the <span class="in">`chapter_03a.R`</span> file, then restart R to start a new session by clicking on the <span class="in">`Session`</span> menu and then clicking <span class="in">`Restart R`</span>. This creates a blank canvas for the next chapter.</span>
<span id="cb65-964"><a href="#cb65-964"></a></span>
<span id="cb65-965"><a href="#cb65-965"></a></span>
<span id="cb65-966"><a href="#cb65-966"></a></span>
<span id="cb65-967"><a href="#cb65-967"></a><span class="fu">## In summary</span></span>
<span id="cb65-968"><a href="#cb65-968"></a></span>
<span id="cb65-969"><a href="#cb65-969"></a></span>
<span id="cb65-970"><a href="#cb65-970"></a>In this chapter, you have learned how to wrangle data in R using functions from packages in the <span class="in">`tidyverse`</span> suite of packages. You can now construct a complete pipeline of R code to take raw data and transform it into the format(s) we need to effectively map crimes.</span>
<span id="cb65-971"><a href="#cb65-971"></a></span>
<span id="cb65-972"><a href="#cb65-972"></a></span>
<span id="cb65-973"><a href="#cb65-973"></a>::: {.box .reading}</span>
<span id="cb65-974"><a href="#cb65-974"></a></span>
<span id="cb65-975"><a href="#cb65-975"></a>Developing your data wrangling skills will help you to produce better, faster</span>
<span id="cb65-976"><a href="#cb65-976"></a>analysis of crime (and other) data. If you would like to develop your skills</span>
<span id="cb65-977"><a href="#cb65-977"></a>further, you might be interested in:</span>
<span id="cb65-978"><a href="#cb65-978"></a></span>
<span id="cb65-979"><a href="#cb65-979"></a><span class="ss">  * </span><span class="co">[</span><span class="ot">Data Wrangling with R</span><span class="co">](https://cengel.github.io/R-data-wrangling/)</span> by</span>
<span id="cb65-980"><a href="#cb65-980"></a>    Claudia Engel, a free online book that explains the functions introduced in</span>
<span id="cb65-981"><a href="#cb65-981"></a>    this tutorial (and some others) in more detail.</span>
<span id="cb65-982"><a href="#cb65-982"></a><span class="ss">  * </span><span class="co">[</span><span class="ot">Data transformation with dplyr cheat sheet</span><span class="co">](https://posit.co/wp-content/uploads/2022/10/data-transformation-1.pdf)</span> </span>
<span id="cb65-983"><a href="#cb65-983"></a>    by the team that makes RStudio, which provides a handy two-page guide to the </span>
<span id="cb65-984"><a href="#cb65-984"></a>    main functions in the <span class="in">`dplyr`</span> package, which is very useful for reminding </span>
<span id="cb65-985"><a href="#cb65-985"></a>    you of the code needed to run each of the functions we have used in this </span>
<span id="cb65-986"><a href="#cb65-986"></a>    tutorial.</span>
<span id="cb65-987"><a href="#cb65-987"></a><span class="ss">  * </span><span class="co">[</span><span class="ot">Data wrangling with R and RStudio</span><span class="co">](https://rstudio.com/resources/webinars/data-wrangling-with-r-and-rstudio/)</span></span>
<span id="cb65-988"><a href="#cb65-988"></a>    by Garrett Grolemund, a recording of a webinar covering the data-wrangling</span>
<span id="cb65-989"><a href="#cb65-989"></a>    functions introduced in this tutorial and some other very-useful related</span>
<span id="cb65-990"><a href="#cb65-990"></a>    functions.</span>
<span id="cb65-991"><a href="#cb65-991"></a><span class="ss">  * </span><span class="co">[</span><span class="ot">R for Data Science</span><span class="co">](https://r4ds.had.co.nz/)</span> by Hadley Wickham and Garrett </span>
<span id="cb65-992"><a href="#cb65-992"></a>    Grolemund, a free online book that is the bible for wrangling data in R.</span>
<span id="cb65-993"><a href="#cb65-993"></a>    </span>
<span id="cb65-994"><a href="#cb65-994"></a>:::</span>
<span id="cb65-995"><a href="#cb65-995"></a></span>
<span id="cb65-996"><a href="#cb65-996"></a></span>
<span id="cb65-997"><a href="#cb65-997"></a>::: {.callout-quiz .callout}</span>
<span id="cb65-998"><a href="#cb65-998"></a><span class="fu">### Revision questions {.unnumbered}</span></span>
<span id="cb65-999"><a href="#cb65-999"></a></span>
<span id="cb65-1000"><a href="#cb65-1000"></a>Answer these questions to check you have understood the main points covered in this chapter. Write between 50 and 100 words to answer each question.</span>
<span id="cb65-1001"><a href="#cb65-1001"></a></span>
<span id="cb65-1002"><a href="#cb65-1002"></a><span class="ss">1. </span>What is data wrangling, and why is it an important step in data analysis?</span>
<span id="cb65-1003"><a href="#cb65-1003"></a><span class="ss">2. </span>Describe the difference between loading data from a CSV file and an Excel file in R. What additional steps are required when working with Excel files?</span>
<span id="cb65-1004"><a href="#cb65-1004"></a><span class="ss">3. </span>What is the purpose of the <span class="in">`select()`</span> function in the dplyr package? How can it be used to both choose and rename columns? Include a brief example in your explanation.</span>
<span id="cb65-1005"><a href="#cb65-1005"></a><span class="ss">4. </span>Explain why should should never include the function <span class="in">`install.packages()`</span> in an R script file.</span>
<span id="cb65-1006"><a href="#cb65-1006"></a><span class="ss">5. </span>What are the benefits of using the pipe (<span class="in">`|&gt;`</span>) operator in R?</span>
<span id="cb65-1007"><a href="#cb65-1007"></a>:::</span>
<span id="cb65-1008"><a href="#cb65-1008"></a></span>
<span id="cb65-1009"><a href="#cb65-1009"></a></span>
<span id="cb65-1010"><a href="#cb65-1010"></a>&lt;p class="credits"&gt;&lt;a href="https://twitter.com/allison_horst"&gt;Artwork by @allison_horst&lt;/a&gt;&lt;/p&gt;</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://creativecommons.org/licenses/by/4.0/">
<p>This book is available under a Creative Commons Attribution 4.0 International licence</p>
</a>
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mpjashby/crimemappingbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>