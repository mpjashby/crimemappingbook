<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Learn crime mapping with R - 6&nbsp; Giving a map context</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../07_handling_bugs/index.html" rel="next">
<link href="../05_your_second_crime_map/index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><!-- START OF INCLUDED HEADER --><!--
This file contains code that will be included in the header of each page of the
quarto book
--><script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script><!-- END OF INCLUDED HEADER --><link rel="stylesheet" href="../css/styles.css">
<meta name="twitter:title" content="Learn crime mapping with R - 6&nbsp; Giving a map context">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../06_map_context/index.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Giving a map context</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Learn crime mapping with R</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mpjashby/crimemappingbook/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../learn_crime_mapping_with_r.epub" title="Download ePub" class="quarto-navigation-tool px-1" aria-label="Download ePub"><i class="bi bi-journal"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00_setup/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Install the software needed for this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_getting_started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_your_first_crime_map/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Your first crime map</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_data_wrangling/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Wrangling data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_code_with_style/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Code with style</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_your_second_crime_map/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Your second crime map</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_map_context/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Giving a map context</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_handling_bugs/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Handling bugs in your code</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08_projects/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Don’t get lost in data analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../09_mapping_areas/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Mapping area data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../10_place_data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Crime Mapping: Using data about places</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../11_mapping_hotspots/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Crime Mapping: Mapping hotspots</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../12_messy_data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Handling messy data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../13_crime_series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Mapping crime series</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../14_writing_reports/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Writing reports in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../15_no_maps/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Presenting spatial data without maps</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../16_mapping_time/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Mapping crime over time</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/read_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Functions for reading data into R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/common_errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Common R errors and how to fix them</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
    <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">In this chapter</h2>
   
  <ul class="collapse">
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">6.1</span> Introduction</a></li>
  <li><a href="#map-choices" id="toc-map-choices" class="nav-link" data-scroll-target="#map-choices"><span class="header-section-number">6.2</span> Map choices</a></li>
  <li><a href="#visual-hierarchy" id="toc-visual-hierarchy" class="nav-link" data-scroll-target="#visual-hierarchy"><span class="header-section-number">6.3</span> Visual hierarchy</a></li>
  <li><a href="#supporting-elements" id="toc-supporting-elements" class="nav-link" data-scroll-target="#supporting-elements"><span class="header-section-number">6.4</span> Supporting elements</a></li>
  <li><a href="#creating-and-storing-a-map" id="toc-creating-and-storing-a-map" class="nav-link" data-scroll-target="#creating-and-storing-a-map"><span class="header-section-number">6.5</span> Creating and storing a map</a></li>
  <li><a href="#titles" id="toc-titles" class="nav-link" data-scroll-target="#titles"><span class="header-section-number">6.6</span> Titles</a></li>
  <li><a href="#legends" id="toc-legends" class="nav-link" data-scroll-target="#legends"><span class="header-section-number">6.7</span> Legends</a></li>
  <li><a href="#scales-and-north-arrows" id="toc-scales-and-north-arrows" class="nav-link" data-scroll-target="#scales-and-north-arrows"><span class="header-section-number">6.8</span> Scales and north arrows</a></li>
  <li><a href="#saving-maps" id="toc-saving-maps" class="nav-link" data-scroll-target="#saving-maps"><span class="header-section-number">6.9</span> Saving maps</a></li>
  <li><a href="#in-summary" id="toc-in-summary" class="nav-link" data-scroll-target="#in-summary"><span class="header-section-number">6.10</span> In summary</a></li>
  </ul><div class="toc-actions"><ul class="collapse"><li><a href="https://github.com/mpjashby/crimemappingbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Giving a map context</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p><strong>Add titles, sources, legends, scale bars and other contextual information to your maps.</strong></p>
<div class="box load-tutorial">
<p>To load the <a href="../#how-to-use-this-book">interactive tutorial</a> for this chapter, copy and paste the following code into the RStudio console:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>crimemapping<span class="sc">::</span><span class="fu">tutorial</span>(<span class="st">"06_map_context"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and press <code>Enter</code>.</p>
</div>
<section id="introduction" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="introduction">
<span class="header-section-number">6.1</span> Introduction</h2>
<p>In this tutorial we will create this map of shootings in the Bronx borough of New York City in 2019. You’ll see that unlike the maps we have made so far, this map includes contextual elements such as a title, a legend and a scale bar.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>shootings_map_final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/final-map-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>In this tutorial we will learn to add important context to our maps using these elements.</p>
</section><section id="map-choices" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="map-choices">
<span class="header-section-number">6.2</span> Map choices</h2>
<p>Among the most important decisions you make when you are creating a map is what information to include and what to leave out. Watch this video to learn more about why this is important and how you can make those decisions.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/2_YOwOmodG0" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>The most important thing to remember when designing a map is to keep in mind the purpose that the map will be used for. Research on how people use maps has repeatedly shown that “<a href="https://doi.org/10.4324/9781315736822.ch3">the nature of the task or function to be performed by the map user is the single most important factor in determining how [someone] processes the information on the map</a>”.</p>
<p>As explained in the video, when you create a crime map you should ask yourself:</p>
<ul>
<li>
<em>What will readers be using this map for?</em> .</li>
<li><em>What information do readers need?</em></li>
<li><em>What do readers already know?</em></li>
<li><em>In what context are people going to use this map?</em></li>
<li><em>How could this map lead the audience to a wrong conclusion?</em></li>
</ul>
<p>Maps are powerful communication tools, which can sometimes knowingly or unknowingly mislead the reader. Watch this video to learn more about how maps can be misleading.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/G0_MBrJnRq0" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>Whenever you make a map, think about your own biases – are your own views on a topic likely to influence the results of your analysis? One way to test your own assumptions about a topic is to test them against other potential assumptions using an approach to crime analysis called hypothesis testing. To find out more about the hypothesis testing approach, read the paper <a href="https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.1012.6309&amp;rep=rep1&amp;type=pdf"><em>Improving the explanatory content of analysis products using hypothesis testing</em></a>.</p>
</section><section id="visual-hierarchy" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="visual-hierarchy">
<span class="header-section-number">6.3</span> Visual hierarchy</h2>
<p>Maps are among the most complex types of data visualisation. Even if we have chosen wisely what to include and what to leave out, there is likely to be lots of information on our map. For all but the simplest maps, there is a risk of readers – especially those in a hurry – might be overwhelmed or mislead by competing pieces of information (such as different layers of data) on a map.</p>
<p>To help readers understand what parts of a map they should focus most of their attention on and which are of less importance, we can establish a visual hierarchy. Watch this video to learn more about visual hierarchies in mapping.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/ezz_SPl0Xr4" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>We have used some of the principles of visual hierarchy in the maps we have already made. For example, in the density map of bike thefts in Vancouver, we used strong colours to represent the data and shades of grey for the base map. This helped readers intuitively understand that they should focus most attention on the data.</p>
<div class="tutorial">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">quiz</span>(</span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="at">caption =</span> <span class="st">""</span>,</span>
<span id="cb3-3"><a href="#cb3-3"></a>  </span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="fu">question</span>(</span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="st">"Which one of these is not a visual element that we can use to establish the visual hierarchy of different elements on our map?"</span>,</span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="fu">answer</span>(<span class="st">"Brand"</span>, <span class="at">correct =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-7"><a href="#cb3-7"></a>    <span class="fu">answer</span>(<span class="st">"Colour"</span>),</span>
<span id="cb3-8"><a href="#cb3-8"></a>    <span class="fu">answer</span>(<span class="st">"Size"</span>),</span>
<span id="cb3-9"><a href="#cb3-9"></a>    <span class="fu">answer</span>(<span class="st">"Isolation"</span>),</span>
<span id="cb3-10"><a href="#cb3-10"></a>    <span class="at">correct =</span> <span class="fu">random_praise</span>(),</span>
<span id="cb3-11"><a href="#cb3-11"></a>    <span class="at">allow_retry =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-12"><a href="#cb3-12"></a>    <span class="at">random_answer_order =</span> <span class="cn">TRUE</span></span>
<span id="cb3-13"><a href="#cb3-13"></a>  ),</span>
<span id="cb3-14"><a href="#cb3-14"></a>  </span>
<span id="cb3-15"><a href="#cb3-15"></a>  <span class="fu">question</span>(</span>
<span id="cb3-16"><a href="#cb3-16"></a>    <span class="st">"Which types of colour are more likely to move an element up the visual hierarchy?"</span>,</span>
<span id="cb3-17"><a href="#cb3-17"></a>    <span class="fu">answer</span>(<span class="st">"Colours that are more saturated"</span>, <span class="at">correct =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-18"><a href="#cb3-18"></a>    <span class="fu">answer</span>(<span class="st">"Colours that are less saturated"</span>),</span>
<span id="cb3-19"><a href="#cb3-19"></a>    <span class="at">correct =</span> <span class="fu">random_praise</span>(),</span>
<span id="cb3-20"><a href="#cb3-20"></a>    <span class="at">allow_retry =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-21"><a href="#cb3-21"></a>    <span class="at">random_answer_order =</span> <span class="cn">TRUE</span></span>
<span id="cb3-22"><a href="#cb3-22"></a>  )</span>
<span id="cb3-23"><a href="#cb3-23"></a>  </span>
<span id="cb3-24"><a href="#cb3-24"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section><section id="supporting-elements" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="supporting-elements">
<span class="header-section-number">6.4</span> Supporting elements</h2>
<p>We can often make our maps much more useful by adding supporting elements that explain the map content, give context or provide extra information. Watch this video to find out what elements you can add to your maps to make them more useful.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/uXUeb-qmgTc" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>We will not need to include every supporting element mentioned in the video in all the maps we make. The visual hierarchy that you establish in your map by use of size, colour, etc. should make it clear which elements are most important. The data should always come first in the visual hierarchy, usually followed by the title and then the legend. Other elements should be lower down the hierarchy. In every map, the supporting elements should be designed so that they do not distract from the data.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Visual hierarchy of elements in a crime map</caption>
<thead><tr class="header">
<th style="text-align: right;">place in hierarchy</th>
<th style="text-align: left;">map element</th>
<th style="text-align: right;">how often needed</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1st</td>
<td style="text-align: left;">data layers</td>
<td style="text-align: right;">always</td>
</tr>
<tr class="even">
<td style="text-align: right;">2nd</td>
<td style="text-align: left;">title</td>
<td style="text-align: right;">virtually always</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3rd</td>
<td style="text-align: left;">legend</td>
<td style="text-align: right;">usually</td>
</tr>
<tr class="even">
<td style="text-align: right;">4th</td>
<td style="text-align: left;">base map</td>
<td style="text-align: right;">almost always</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5th</td>
<td style="text-align: left;">author and date</td>
<td style="text-align: right;">virtually always</td>
</tr>
<tr class="even">
<td style="text-align: right;">=6th</td>
<td style="text-align: left;">scale</td>
<td style="text-align: right;">sometimes</td>
</tr>
<tr class="odd">
<td style="text-align: right;">=6th</td>
<td style="text-align: left;">north arrow</td>
<td style="text-align: right;">sometimes</td>
</tr>
<tr class="even">
<td style="text-align: right;">7th</td>
<td style="text-align: left;">grid</td>
<td style="text-align: right;">rarely</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Elements that are almost always needed on a crime map are not necessarily highest on the visual hierarchy. For example, the author name is virtually always needed but is relatively low on the visual hierarchy. This is because it is important information for readers who need it to judge the reliability of a map, or to get in touch to ask questions, but should not distract from the data for those readers who do not need it.</p>
<div class="tutorial">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">quiz</span>(</span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="at">caption =</span> <span class="st">""</span>,</span>
<span id="cb4-3"><a href="#cb4-3"></a>  </span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="fu">question</span>(</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="st">"Which of these elements should be lowest down the visual hierarchy on most maps?"</span>,</span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="fu">answer</span>(<span class="st">"North arrow"</span>, <span class="at">correct =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-7"><a href="#cb4-7"></a>    <span class="fu">answer</span>(<span class="st">"Author and date"</span>),</span>
<span id="cb4-8"><a href="#cb4-8"></a>    <span class="fu">answer</span>(<span class="st">"Title"</span>),</span>
<span id="cb4-9"><a href="#cb4-9"></a>    <span class="fu">answer</span>(<span class="st">"Data layers"</span>),</span>
<span id="cb4-10"><a href="#cb4-10"></a>    <span class="at">correct =</span> <span class="fu">random_praise</span>(),</span>
<span id="cb4-11"><a href="#cb4-11"></a>    <span class="at">allow_retry =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-12"><a href="#cb4-12"></a>    <span class="at">random_answer_order =</span> <span class="cn">TRUE</span></span>
<span id="cb4-13"><a href="#cb4-13"></a>  ),</span>
<span id="cb4-14"><a href="#cb4-14"></a>  </span>
<span id="cb4-15"><a href="#cb4-15"></a>  <span class="fu">question</span>(</span>
<span id="cb4-16"><a href="#cb4-16"></a>    <span class="st">"How likely is it that our maps will need to include a base map?"</span>,</span>
<span id="cb4-17"><a href="#cb4-17"></a>    <span class="fu">answer</span>(<span class="st">"Almost always"</span>, <span class="at">correct =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-18"><a href="#cb4-18"></a>    <span class="fu">answer</span>(<span class="st">"Usually"</span>),</span>
<span id="cb4-19"><a href="#cb4-19"></a>    <span class="fu">answer</span>(<span class="st">"Occasionally"</span>),</span>
<span id="cb4-20"><a href="#cb4-20"></a>    <span class="fu">answer</span>(<span class="st">"Never"</span>),</span>
<span id="cb4-21"><a href="#cb4-21"></a>    <span class="at">correct =</span> <span class="fu">random_praise</span>(),</span>
<span id="cb4-22"><a href="#cb4-22"></a>    <span class="at">allow_retry =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-23"><a href="#cb4-23"></a>    <span class="at">random_answer_order =</span> <span class="cn">TRUE</span></span>
<span id="cb4-24"><a href="#cb4-24"></a>  )</span>
<span id="cb4-25"><a href="#cb4-25"></a>  </span>
<span id="cb4-26"><a href="#cb4-26"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Before we start learning the code needed to add titles and legends to our maps, watch this video walk-though of the main steps.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/P3L9yHc8H-8" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section><section id="creating-and-storing-a-map" class="level2" data-number="6.5"><h2 data-number="6.5" class="anchored" data-anchor-id="creating-and-storing-a-map">
<span class="header-section-number">6.5</span> Creating and storing a map</h2>
<p>Since we will be adding various elements to a map in this tutorial, we will first create a map and save it as an R object. Any map or chart produced using the <code>ggplot()</code> function can be saved as an object using the assignment operator <code>&lt;-</code>. Just as for the result of any other R function, if we save it to an object the result will not be printed to the screen, but we can easily see the plot by simply typing the object name in the R console.</p>
<!-- We will use a map of shootings in the Bronx borough of New York City in 2019 as -->
<!-- the map to which we will add the supporting map elements. This map does not  -->
<!-- include a base map, but this is only to slightly speed up how this tutorial runs -->
<!-- on computers with slower internet connections -- all the code in this tutorial -->
<!-- is compatible with maps that include a base map. -->
<div class="cell" data-exercise="true" data-exercise.lines="46">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Load packages</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="fu">library</span>(sf)</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="fu">library</span>(sfhotspot)</span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-6"><a href="#cb5-6"></a></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co"># Load shootings data</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>shootings <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb5-9"><a href="#cb5-9"></a>  <span class="st">"https://mpjashby.github.io/crimemappingdata/bronx_shootings.csv"</span>, </span>
<span id="cb5-10"><a href="#cb5-10"></a>  <span class="at">show_col_types =</span> <span class="cn">FALSE</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb5-12"><a href="#cb5-12"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="st">"EPSG:4326"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-13"><a href="#cb5-13"></a>  <span class="fu">st_transform</span>(<span class="st">"EPSG:6538"</span>)</span>
<span id="cb5-14"><a href="#cb5-14"></a></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co"># Load NYC police precincts data</span></span>
<span id="cb5-16"><a href="#cb5-16"></a>precincts <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/nyc_precincts.gpkg"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-17"><a href="#cb5-17"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb5-18"><a href="#cb5-18"></a>  <span class="co"># Filter just those precincts that are in the Bronx (40th to 52nd)</span></span>
<span id="cb5-19"><a href="#cb5-19"></a>  <span class="fu">filter</span>(precinct <span class="sc">%in%</span> <span class="dv">40</span><span class="sc">:</span><span class="dv">52</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-20"><a href="#cb5-20"></a>  <span class="fu">st_transform</span>(<span class="st">"EPSG:6538"</span>)</span>
<span id="cb5-21"><a href="#cb5-21"></a></span>
<span id="cb5-22"><a href="#cb5-22"></a><span class="co"># Calculate KDE</span></span>
<span id="cb5-23"><a href="#cb5-23"></a>shootings_kde <span class="ot">&lt;-</span> shootings <span class="sc">|&gt;</span> </span>
<span id="cb5-24"><a href="#cb5-24"></a>  <span class="fu">hotspot_kde</span>(</span>
<span id="cb5-25"><a href="#cb5-25"></a>    <span class="at">grid =</span> <span class="fu">hotspot_grid</span>(precincts, <span class="at">cell_size =</span> <span class="dv">100</span>), </span>
<span id="cb5-26"><a href="#cb5-26"></a>    <span class="at">bandwidth_adjust =</span> <span class="fl">0.33</span>,</span>
<span id="cb5-27"><a href="#cb5-27"></a>    <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb5-28"><a href="#cb5-28"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb5-29"><a href="#cb5-29"></a>  <span class="fu">st_intersection</span>(precincts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout
all geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Create map object</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>shootings_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="fu">annotation_map_tile</span>(<span class="at">type =</span> <span class="st">"cartolight"</span>, <span class="at">zoomin =</span> <span class="dv">0</span>, <span class="at">progress =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> kde), <span class="at">data =</span> shootings_kde, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">colour =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> precincts, <span class="at">colour =</span> <span class="st">"grey33"</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="fu">geom_sf_label</span>(</span>
<span id="cb7-7"><a href="#cb7-7"></a>    <span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">ordinal</span>(precinct)), </span>
<span id="cb7-8"><a href="#cb7-8"></a>    <span class="at">data =</span> precincts,</span>
<span id="cb7-9"><a href="#cb7-9"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>, </span>
<span id="cb7-10"><a href="#cb7-10"></a>    <span class="at">colour =</span> <span class="st">"grey33"</span>, </span>
<span id="cb7-11"><a href="#cb7-11"></a>    <span class="at">size =</span> <span class="fl">2.5</span>, </span>
<span id="cb7-12"><a href="#cb7-12"></a>    <span class="at">label.size =</span> <span class="cn">NA</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>  ) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"PuBu"</span>, <span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb7-17"><a href="#cb7-17"></a></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co"># Display map</span></span>
<span id="cb7-19"><a href="#cb7-19"></a>shootings_map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/title-exercise1-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>The code used to create this map is very similar to the code we used in one of the previous tutorials to make a map of bike theft in Vancouver, although there are a few differences.</p>
<p>Looking at the code above, we have used the <code>grid</code> argument to the <code>hotspot_kde()</code> function, specifying <code>hotspot_grid(precincts, cell_size = 100)</code>. By default, <code>hotspot_kde()</code> calculates density estimates (KDE values) for every grid cell within the area covered by the crime data. This is fine when at least a few crimes have occurred in all the parts of the area for which we have data. But if crime is heavily concentrated in a few places and there are large areas with no crimes, the density layer will not cover the whole area for which we have data. In this case, it is important to extend the density layer manually to make it clear that the apparent low density of crime in some places is due to a genuine lack of crime there, rather than because we do not have data for those places.</p>
<p>We can do this by creating a grid of cells for which KDE values should be calculated, rather than letting <code>hotspot_kde()</code> do this automatically. In the code above, we have used the <code>hotspot_grid()</code> function to create a grid that covers all the precincts in the Bronx (the area we have data for), and then passed the resulting grid to the <code>grid</code> argument of <code>hotspot_kde()</code>. This ensures that KDE values are calculated for every part of the Bronx.</p>
<p><a href="https://scales.r-lib.org" title="scales website"><img src="images/scales.png" class="right-side-image"></a></p>
<p>The only other difference from the Vancouver map is that we have used the <code>ordinal()</code> function from the <a href="https://scales.r-lib.org"><code>scales</code> package</a> to convert the precinct numbers to ordinal numbers (1st, 2nd, 3rd, etc.) for the map labels. This is because police precincts in New York City are usually referred to using ordinal numbers (e.g.&nbsp;“the 1st Precinct” rather than “Precinct 1”) and it will be easier for people to read the map if it uses terms they are familiar with.</p>
<p>There are many other functions in the <code>scales</code> package that format numbers in different ways, including <code>comma()</code> to add thousands separators to numbers and <code>dollar()</code> to format numbers as values in dollars or other currencies. There is a <a href="https://scales.r-lib.org/reference/">full list of <code>scales</code> functions on the package website</a>.</p>
<p>We now have a basic map of shootings in the Bronx. This map isn’t good enough on its own, but we can use it to learn how to add supporting elements to a map.</p>
</section><section id="titles" class="level2" data-number="6.6"><h2 data-number="6.6" class="anchored" data-anchor-id="titles">
<span class="header-section-number">6.6</span> Titles</h2>
<p>A map title is one of the most important ways to add context to a map. Titles can either be <em>descriptive</em> or <em>declarative</em>. Descriptive titles simply state what data are shown on the map. For example, we might give our map the title “Shootings in the Bronx, 2019”. Declarative titles, on the other hand, state what you think the main conclusion should be that readers remember about the map. For example, we might use the title “Shootings are focused in the South Bronx”.</p>
<p>Declarative titles are usually more useful than descriptive titles because they help the reader to interpret the map. But writing a good declarative title is harder than writing a descriptive title, because it requires you to think about what is the main point that you want to make with the map. To help you come up with a good declarative title, you might want to try several different titles so that you can choose the one that communicates your message most clearly.</p>
<p>We can add a title to our map using the <code>labs()</code> (short for ‘labels’) function from the <code>ggplot2</code> package. We can use <code>labs()</code> to add labels to various different parts of a map or plot, but for now we will just use the argument <code>title</code> to set the title.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>shootings_map <span class="sc">+</span> </span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/title-exercise3-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Sometimes our preferred title might be too long to fit on a map. In this case, we can break the title across two or more lines. We can do this manually by adding the characters <code>\n</code> (the character code for a new line) at the point where we want the text to start a new line. Alternatively, we can use the <code>str_wrap()</code> function from the <code>stringr</code> package to wrap the text automatically into lines of a given maximum length (specified using the <code>wrap</code> argument).</p>
<p>When you use a declarative title for your map, it is often useful to provide a <em>subtitle</em> containing descriptive information. Adding a subtitle is very easy using the <code>subtitle</code> argument to the <code>labs()</code> function. Use the code above as a template to add a subtitle to your map explaining that the map shows fatal and non-fatal shootings in 2019.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Add a `subtitle` argument to the labs() function</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>shootings_map <span class="sc">+</span> </span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/title-exercise4-hint-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>shootings_map <span class="sc">+</span> </span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb10-4"><a href="#cb10-4"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/title-exercise4-hint-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="using-captions-to-add-author-and-other-information" class="level3" data-number="6.6.1"><h3 data-number="6.6.1" class="anchored" data-anchor-id="using-captions-to-add-author-and-other-information">
<span class="header-section-number">6.6.1</span> Using captions to add author and other information</h3>
<p>The <code>labs()</code> function has another argument that we can use to add text to our map for context. The <code>caption</code> argument is used to add information such as the author, date and source of the data to a map or chart. We can put any information we like into the caption, using <code>str_wrap()</code> or the new-line character <code>\n</code> if necessary to stop the text overflowing the map.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>shootings_map <span class="sc">+</span> </span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-3"><a href="#cb11-3"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb11-4"><a href="#cb11-4"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span>,</span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="at">caption =</span> <span class="fu">str_glue</span>(</span>
<span id="cb11-6"><a href="#cb11-6"></a>      <span class="st">"Author: Joe Bloggs, Date produced: {lubridate::today()},</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb11-7"><a href="#cb11-7"></a>      <span class="st">"Data: https://data.cityofnewyork.us/d/833y-fsy8</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb11-8"><a href="#cb11-8"></a>      <span class="st">"Map data from OpenStreetMap"</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>    )</span>
<span id="cb11-10"><a href="#cb11-10"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/title-exercise5-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>This code uses the <code>str_glue()</code> function from the <code>stringr</code> package to incorporate some automatically updated information (in this case, the current date) into the caption. <code>str_glue()</code> glues together any number of character strings separated by commas – in this case, the code includes two strings so that the lines of code do not become too long to easily read.</p>
<p><code>str_glue()</code> can also include the values of R objects and the results of R functions that are placed inside braces <code><a href="https://rdrr.io/r/base/Paren.html">{}</a></code>. So the code <code>{lubridate::today()}</code> runs the function <code>today()</code> from the <code>lubridate</code> package and glues the result (the current date) into the text. If we had already loaded the <code>lubridate</code> library we could have just used the code <code>{today()}</code>, but since we do not need any other functions from <code>lubridate</code> for this analysis, we instead do not load the package but call the function by specifying which package it comes from using the <code>::</code> operator as in the previous tutorial.</p>
<div class="box notewell">
<p>When you use data to make maps, the data provider will often require you to acknowledge the source of that data. This is a legal requirement so it is important that you do this when required.</p>
<p>The base maps we use in this course use data from OpenStreetMap, which <a href="https://wiki.osmfoundation.org/wiki/Licence/Attribution_Guidelines">requires</a> people using its data to acknowledge that they have done so. The easiest way to do this is to add the text “Map data from OpenStreetMap” to the <code>caption</code> of your maps if they use base maps from OpenStreetMap.</p>
</div>
</section><section id="changing-the-appearance-of-titles-and-captions" class="level3" data-number="6.6.2"><h3 data-number="6.6.2" class="anchored" data-anchor-id="changing-the-appearance-of-titles-and-captions">
<span class="header-section-number">6.6.2</span> Changing the appearance of titles and captions</h3>
<p>We have added a title, subtitle and caption to our map, but you might not be happy with their appearance. You might want, for example, to move the caption down the visual hierarchy by making the text smaller and/or a lighter colour, or add some space between the subtitle and the map itself.</p>
<p>We can exercise almost complete control over the supporting elements of maps or charts made with <code>ggplot()</code> using the <code>theme()</code> function. One important thing to remember about <code>theme()</code> is that it only controls the non-data elements of a map – nothing you do with the <code>theme()</code> function will have any effect on the data elements of a map (in this case, the layer showing the density of shootings). To change the appearance of data layers within <code>ggplot()</code> maps, use the <code>geom_</code>, and <code>scale_</code> families of functions as we have learned in previous tutorials.</p>
<p>The <code>theme()</code> function has a lot of potential arguments. If you need help using the <code>theme()</code> function (or any function in R) you can view a manual page (including a list of arguments) for the function by:</p>
<ul>
<li>typing a question mark followed by the function name without parentheses (e.g.&nbsp;<code>?theme</code>) into the R console,</li>
<li>typing the function name without parentheses into the search box in the Help panel in RStudio, or</li>
<li>clicking on the function name anywhere in your R code to place the cursor on the function name, then pressing <code>F1</code> on your keyboard.</li>
</ul>
<p>Try opening the manual page for <code>theme()</code> now to see the list of possible arguments it can take. Fortunately, we will not need most of these arguments most of the time – <code>ggplot()</code> has default values built in for every value that can be changed using <code>theme()</code>, and these defaults will be reasonable in almost all cases.</p>
<p>To reduce the visual prominence of the map caption, we can change the value of the <code>plot.caption</code> argument to <code>theme()</code>. Since the caption is a text element (rather than a polygon, line, etc.), we can use the helper function <code>element_text()</code> to do this. The following code changes the colour of the caption text to a lighter grey and makes the text smaller relative to the default using the helper function <code>rel()</code> (for relative sizing) – <code>0.7</code> means the text will be 70% as big as it would have been by default.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>shootings_map <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">labs</span>(</span>
<span id="cb12-3"><a href="#cb12-3"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span>,</span>
<span id="cb12-5"><a href="#cb12-5"></a>    <span class="at">caption =</span> <span class="fu">str_glue</span>(</span>
<span id="cb12-6"><a href="#cb12-6"></a>      <span class="st">"Author: Joe Bloggs, Date produced: {lubridate::today()},</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb12-7"><a href="#cb12-7"></a>      <span class="st">"Data: https://data.cityofnewyork.us/d/833y-fsy8</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb12-8"><a href="#cb12-8"></a>      <span class="st">"Map data from OpenStreetMap"</span></span>
<span id="cb12-9"><a href="#cb12-9"></a>    )</span>
<span id="cb12-10"><a href="#cb12-10"></a>  ) <span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11"></a>  <span class="fu">theme</span>(</span>
<span id="cb12-12"><a href="#cb12-12"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey67"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>))</span>
<span id="cb12-13"><a href="#cb12-13"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/title-exercise6-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>The helper function <code>element_text()</code> has arguments to control the appearance of text in different ways. As well as <code>colour</code> (or <code>color</code>, either is fine) and <code>size</code>, there are:</p>
<ul>
<li>
<code>family</code> controls the font used, e.g.&nbsp;Times New Roman or Helvetica,</li>
<li>
<code>face</code> controls the style of the font, i.e.&nbsp;‘plain’, ‘italic’, ‘bold’ or ‘bold.italic’,</li>
<li>
<code>hjust</code> controls the horizontal justification of the text, where 0 means left aligned, 0.5 means centred and 1 means right aligned,</li>
<li>
<code>vjust</code> controls the vertical justification, and</li>
<li>
<code>angle</code> controls the angle (in degrees) of the text (0 means horizontal),</li>
<li>
<code>lineheight</code> controls the space between lines if you have created a value that has more than one line (e.g.&nbsp;using <code>\n</code> or <code>str_wrap()</code>).</li>
</ul>
<p>The <code>margin</code> argument controls the space around the text. It is easiest to specify the value of <code>margin</code> using the helper function <code>margin()</code> designed for that purpose. You specify the top, right, bottom and left margin separately in that order – to remember the order, think ‘<strong>tr</strong>ou<strong>bl</strong>e’.</p>
<div class="tutorial">
<p>The following code changes the margin around the map subtitle. Change this code so that it <em>also</em> makes the subtitle 80% of the default size <em>and</em> changes the caption so that it is left aligned.</p>
<div class="cell" data-exercise="true" data-exercise.lines="17">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>shootings_map <span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-3"><a href="#cb13-3"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb13-4"><a href="#cb13-4"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span>,</span>
<span id="cb13-5"><a href="#cb13-5"></a>    <span class="at">caption =</span> <span class="fu">str_glue</span>(</span>
<span id="cb13-6"><a href="#cb13-6"></a>      <span class="st">"Author: Joe Bloggs, Date produced: {lubridate::today()},</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb13-7"><a href="#cb13-7"></a>      <span class="st">"Data: https://data.cityofnewyork.us/d/833y-fsy8</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb13-8"><a href="#cb13-8"></a>      <span class="st">"Map data from OpenStreetMap"</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>    )</span>
<span id="cb13-10"><a href="#cb13-10"></a>  ) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>  <span class="fu">theme</span>(</span>
<span id="cb13-12"><a href="#cb13-12"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">0</span>, <span class="at">unit =</span> <span class="st">"pt"</span>)),</span>
<span id="cb13-13"><a href="#cb13-13"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey50"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>))</span>
<span id="cb13-14"><a href="#cb13-14"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/title-exercise7-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Change the line `plot.subtitle = element_text(margin = margin(3, 0, 6, 0)),`</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="co"># so that it also specifies the text size</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># You can change the size relative to the default using the `rel()` function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Change the line `plot.caption = element_text(colour = "grey50", size = rel(0.7))`</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co"># so that it also specifies the horizontal alignment of the text</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># You can change the horizontal justification of the caption using the `hjust`</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="co"># argument to the `element_text()` function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>shootings_map <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-3"><a href="#cb18-3"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb18-4"><a href="#cb18-4"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span>,</span>
<span id="cb18-5"><a href="#cb18-5"></a>    <span class="at">caption =</span> <span class="fu">str_glue</span>(</span>
<span id="cb18-6"><a href="#cb18-6"></a>      <span class="st">"Author: Joe Bloggs, Date produced: {lubridate::today()},</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb18-7"><a href="#cb18-7"></a>      <span class="st">"Data: https://data.cityofnewyork.us/d/833y-fsy8</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb18-8"><a href="#cb18-8"></a>      <span class="st">"Map data from OpenStreetMap"</span></span>
<span id="cb18-9"><a href="#cb18-9"></a>    )</span>
<span id="cb18-10"><a href="#cb18-10"></a>  ) <span class="sc">+</span></span>
<span id="cb18-11"><a href="#cb18-11"></a>  <span class="fu">theme</span>(</span>
<span id="cb18-12"><a href="#cb18-12"></a>    <span class="co"># Make the plot subtitle smaller and adjust the margin around it</span></span>
<span id="cb18-13"><a href="#cb18-13"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>), <span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">0</span>)),</span>
<span id="cb18-14"><a href="#cb18-14"></a>    <span class="co"># Make the legend caption smaller, left-aligned and a lighter shade of grey</span></span>
<span id="cb18-15"><a href="#cb18-15"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey67"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>), <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb18-16"><a href="#cb18-16"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/title-exercise7-hint-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now that we have finished setting the text elements for our map, we can save it as a new object that we can use as the basis for the other objects we want to add.</p>
<div class="cell" data-exercise="true" data-exercise.lines="17">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>shootings_map_titled <span class="ot">&lt;-</span> shootings_map <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-3"><a href="#cb19-3"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb19-4"><a href="#cb19-4"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span>,</span>
<span id="cb19-5"><a href="#cb19-5"></a>    <span class="at">caption =</span> <span class="fu">str_glue</span>(</span>
<span id="cb19-6"><a href="#cb19-6"></a>      <span class="st">"Author: Joe Bloggs, Date produced: {lubridate::today()},</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb19-7"><a href="#cb19-7"></a>      <span class="st">"Data: https://data.cityofnewyork.us/d/833y-fsy8</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb19-8"><a href="#cb19-8"></a>      <span class="st">"Map data from OpenStreetMap"</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>    )</span>
<span id="cb19-10"><a href="#cb19-10"></a>  ) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11"></a>  <span class="fu">theme</span>(</span>
<span id="cb19-12"><a href="#cb19-12"></a>    <span class="co"># Make the plot subtitle smaller and adjust the margin around it</span></span>
<span id="cb19-13"><a href="#cb19-13"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>), <span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">0</span>)),</span>
<span id="cb19-14"><a href="#cb19-14"></a>    <span class="co"># Make the legend caption smaller, left-aligned and a lighter shade of grey</span></span>
<span id="cb19-15"><a href="#cb19-15"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey67"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>), <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb19-16"><a href="#cb19-16"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="box notewell">
<p>In this tutorial we will store the map we are creating in an object several times as we go through the process of explaining how to add context to a map. When you write your own code, you should not do this. Instead, you should create the map from start to finish in a single block of code. Doing that will make sure your code is easy to read and that you don’t have to keep track of more objects than necessary. For an example of this, see the final page of this tutorial.</p>
</div>
</section></section><section id="legends" class="level2" data-number="6.7"><h2 data-number="6.7" class="anchored" data-anchor-id="legends">
<span class="header-section-number">6.7</span> Legends</h2>
<p>Legends are important for all but the simplest crime maps because they help readers to interpret the points, lines and polygons used to represent data on a particular map. Except for point maps containing only a small number of crimes (such as the map of homicide in downtown Atlanta that we produced in the first tutorial), crime maps will almost always need a legend to help users interpret them.</p>
<p>Producing a legend manually could be quite complicated, but fortunately <code>ggplot()</code> produces legends automatically. The reason the maps we have produced up to now haven’t included legends is that we have been suppressing the legends using the argument <code>legend.position = "none"</code> to the <code>theme()</code> function – look back at the code on the page ‘Creating and storing a map’ in this tutorial to see this code on the final line of the stack of functions added to <code>ggplot()</code>.</p>
<p><code>ggplot()</code> will add a legend to a map or chart whenever one or more layers of data are represented using an aesthetic property such as size, shape, colour or fill. In our current map, the density of shootings is represented using the fill colour of the polygons produced by the <code>hotspot_kde()</code> function, with darker colours representing more shootings.</p>
<p>To reveal the legend automatically generated, we can add another call to the <code>theme()</code> function to our existing <code>ggplot()</code> object. This overrides the previous code that set the legend position to <code>none</code>, instead placing the legend on the right-hand side of the plot. We only need to do this because we previously suppressed the legend – if we had not suppressed it, the legend would have appeared automatically.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>shootings_map_titled <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">theme</span>(</span>
<span id="cb20-3"><a href="#cb20-3"></a>    <span class="co"># Position the legend on the right-hand side of the plot</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/legend-exercise1-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Our map now has a legend, but we may want to adjust its appearance by:</p>
<ul>
<li>changing the default legend title from “kde” to something more meaningful,</li>
<li>moving the legend down the visual hierarchy by making it smaller (at the moment it is almost as visually prominent as the data),</li>
<li>removing the potentially confusing raw density values.</li>
</ul>
<p>We can change the default legend title by once again using the <code>labs()</code> function. Since we want to change the title of the legend, you might reasonably think that we would do this using something like <code>labs(legend = "density")</code> but unfortunately that code would do nothing at all. Instead, we have to set the legend title using the aesthetic (colour, size, shape, etc.) that the legend represents. This makes it possible to specify multiple titles if there are separate legends for different layers that use different aesthetics. For example if a map used lines of different colours to show streets of different types and filled polygons to show the density of crime, it would be possible to have separate legends explaining each aesthetic. In this case, we’ve specified that the <code>kde</code> column in the data should control the fill aesthetic, so we can set the title for that legend using <code>fill = "title we want"</code>.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>shootings_map_titled <span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"kernel density</span><span class="sc">\n</span><span class="st">of shootings"</span>) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="fu">theme</span>(</span>
<span id="cb21-4"><a href="#cb21-4"></a>    <span class="co"># Position the legend on the right-hand side of the plot</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb21-6"><a href="#cb21-6"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/legend-exercise2-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>To make the legend smaller, we can use <code>theme()</code> in the same way as we did to change the appearance of the caption. We use the <code>legend.title</code> argument to format the legend title and the <code>legend.text</code> argument to format the labels for each value in the legend.</p>
<p>We will also make the colour bar in the legend (called the <em>key</em> by <code>ggplot()</code>) slightly smaller using the <code>legend.key.width</code> argument. To do this we will use the helper function <code>unit()</code>, which allows us to specify the size using any of several common units. In this case, we will specify the key size in lines (1 line = the height of one line of text) so that it is relative to the text size we have chosen.</p>
<p>At the same time, we will reduce the size of the legend title and the legend text (the numbers next to the colour bar), using the <code>legend.text</code> and <code>legend.title</code> arguments together with the the helper function <code>element_text()</code>. In both cases, we will set the text size relative to the default text size using the <code>rel()</code> helper function.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>shootings_map_titled <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"kernel density</span><span class="sc">\n</span><span class="st">of shootings"</span>) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="fu">theme</span>(</span>
<span id="cb22-4"><a href="#cb22-4"></a>    <span class="co"># Make the legend colour bar smaller</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>    <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"lines"</span>),</span>
<span id="cb22-6"><a href="#cb22-6"></a>    <span class="co"># Position the legend on the right-hand side of the plot</span></span>
<span id="cb22-7"><a href="#cb22-7"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb22-8"><a href="#cb22-8"></a>    <span class="co"># Make the legend text smaller</span></span>
<span id="cb22-9"><a href="#cb22-9"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>)),</span>
<span id="cb22-10"><a href="#cb22-10"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>))</span>
<span id="cb22-11"><a href="#cb22-11"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/legend-exercise3-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Finally, we want to remove the raw density values, since these are difficult to interpret and might distract readers from the key message that darker colours on the map represent higher densities of shootings.</p>
<p>By default, <code>ggplot()</code> sets the label for each legend key based on the data. To specify our own labels, we can use the <code>labels</code> argument to the <code>scale_fill_distiller()</code> function that we previously used to set the colour scheme of the density layer on the map.</p>
<p>When we set colour bar labels manually, we have to also specify where on the colour bar we want those labels to appear. We do this using the <code>breaks</code> argument to <code>scale_fill_distiller()</code>, making sure the number of values we supply to the <code>breaks</code> argument is the same as the number of labels we’ve given to the <code>labels</code> argument (otherwise R will produce an error).</p>
<p>In this case, we want to add two labels (“higher” and “lower”), one at either end of the colour bar. We could look at <code>kde</code> column of the <code>shootings_kde</code> object to find the minimum and maximum values, but that would introduce the risk of us accidentally entering the wrong values. Instead, we can use the <code>pull()</code> function to extract the <code>kde</code> column from the <code>shootings_kde</code> dataset and then use the <code><a href="https://rdrr.io/r/base/range.html">range()</a></code> function to find the minimum and maximum values. Putting this together, we get <code>breaks = range(pull(shootings_kde, "kde"))</code>.</p>
<div class="cell" data-exercise="true" data-exercise.lines="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>shootings_map_titled <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="fu">scale_fill_distiller</span>(</span>
<span id="cb23-3"><a href="#cb23-3"></a>    <span class="at">palette =</span> <span class="st">"PuBu"</span>, </span>
<span id="cb23-4"><a href="#cb23-4"></a>    <span class="at">direction =</span> <span class="dv">1</span>, </span>
<span id="cb23-5"><a href="#cb23-5"></a>    <span class="co"># Specify label positions as the minimum and maximum KDE values</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>    <span class="at">breaks =</span> <span class="fu">range</span>(<span class="fu">pull</span>(shootings_kde, <span class="st">"kde"</span>)), </span>
<span id="cb23-7"><a href="#cb23-7"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"lower"</span>, <span class="st">"higher"</span>)</span>
<span id="cb23-8"><a href="#cb23-8"></a>  ) <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"kernel density</span><span class="sc">\n</span><span class="st">of shootings"</span>) <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10"></a>  <span class="fu">theme</span>(</span>
<span id="cb23-11"><a href="#cb23-11"></a>    <span class="co"># Make the legend colour bar smaller</span></span>
<span id="cb23-12"><a href="#cb23-12"></a>    <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"lines"</span>),</span>
<span id="cb23-13"><a href="#cb23-13"></a>    <span class="co"># Position the legend on the right-hand side of the plot</span></span>
<span id="cb23-14"><a href="#cb23-14"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb23-15"><a href="#cb23-15"></a>    <span class="co"># Make the legend text smaller</span></span>
<span id="cb23-16"><a href="#cb23-16"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>)),</span>
<span id="cb23-17"><a href="#cb23-17"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>))</span>
<span id="cb23-18"><a href="#cb23-18"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for fill is already present.
Adding another scale for fill, which will replace the existing scale.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/legend-exercise4-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Now that we have finished formatting the legend, we can again store the map as an object that we can build on further.</p>
<div class="cell" data-exercise="true" data-exercise.lines="19">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>shootings_map_legend <span class="ot">&lt;-</span> shootings_map_titled <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="fu">scale_fill_distiller</span>(</span>
<span id="cb25-3"><a href="#cb25-3"></a>    <span class="at">palette =</span> <span class="st">"PuBu"</span>, </span>
<span id="cb25-4"><a href="#cb25-4"></a>    <span class="at">direction =</span> <span class="dv">1</span>, </span>
<span id="cb25-5"><a href="#cb25-5"></a>    <span class="co"># Specify label positions as the minimum and maximum KDE values</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>    <span class="at">breaks =</span> <span class="fu">range</span>(<span class="fu">pull</span>(shootings_kde, <span class="st">"kde"</span>)), </span>
<span id="cb25-7"><a href="#cb25-7"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"lower"</span>, <span class="st">"higher"</span>)</span>
<span id="cb25-8"><a href="#cb25-8"></a>  ) <span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"kernel density</span><span class="sc">\n</span><span class="st">of shootings"</span>) <span class="sc">+</span></span>
<span id="cb25-10"><a href="#cb25-10"></a>  <span class="fu">theme</span>(</span>
<span id="cb25-11"><a href="#cb25-11"></a>    <span class="co"># Make the legend colour bar smaller</span></span>
<span id="cb25-12"><a href="#cb25-12"></a>    <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"lines"</span>),</span>
<span id="cb25-13"><a href="#cb25-13"></a>    <span class="co"># Position the legend on the right-hand side of the plot</span></span>
<span id="cb25-14"><a href="#cb25-14"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb25-15"><a href="#cb25-15"></a>    <span class="co"># Make the legend text smaller</span></span>
<span id="cb25-16"><a href="#cb25-16"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>)),</span>
<span id="cb25-17"><a href="#cb25-17"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>))</span>
<span id="cb25-18"><a href="#cb25-18"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for fill is already present.
Adding another scale for fill, which will replace the existing scale.</code></pre>
</div>
</div>
</section><section id="scales-and-north-arrows" class="level2" data-number="6.8"><h2 data-number="6.8" class="anchored" data-anchor-id="scales-and-north-arrows">
<span class="header-section-number">6.8</span> Scales and north arrows</h2>
<p>The final elements we can add to our map are a scale bar and a north arrow, which can both be added using functions from the <code>ggspatial</code> package.</p>
<section id="scale-bars" class="level3" data-number="6.8.1"><h3 data-number="6.8.1" class="anchored" data-anchor-id="scale-bars">
<span class="header-section-number">6.8.1</span> Scale bars</h3>
<p>To add a scale bar, we can add a call to the <code>annotation_scale()</code> function to our existing <code>ggplot()</code> object.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>shootings_map_legend <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">annotation_scale</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/scales-exercise1-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>The default scale bar is a little too visually dominant for the low place it should have in the visual hierarchy of our map, and the default placement in the bottom-left corner happens to overlap with the highest density of shootings. We can change the scale bar using arguments to the <code>annotation_scale()</code> function:</p>
<ul>
<li>
<code>width_hint = 1/5</code> changes the (approximate) proportion of the map width across which the scale bar stretches,</li>
<li>
<code>style = "ticks"</code> changes the style of the scale bar to the less visually prominent line-and-tick-marks style, and</li>
<li>
<code>location = "br"</code> moves the scale bar to the bottom-right corner of the map.</li>
</ul>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>shootings_map_legend <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">annotation_scale</span>(<span class="at">width_hint =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">style =</span> <span class="st">"ticks"</span>, <span class="at">location =</span> <span class="st">"br"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/scales-exercise2-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="north-arrows" class="level3" data-number="6.8.2"><h3 data-number="6.8.2" class="anchored" data-anchor-id="north-arrows">
<span class="header-section-number">6.8.2</span> North arrows</h3>
<p>We can add a north arrow using the <code>annotation_north_arrow()</code> function. The default arrow is too obtrusive to fit its position in the visual hierarchy, so we will change its appearance using the arguments:</p>
<ul>
<li>
<code>location = "tr"</code> to move the north arrow to the top-right corner, since we have put the scale bar in the bottom-right where the north arrow would be placed by default,</li>
<li>
<code>height = unit(1.5, "lines")</code> to make the arrow smaller, and</li>
<li>
<code>style = north_arrow_minimal(text_size = 8)</code> to use a smaller style of arrow, at the same time reducing the font size (measured in points) of the N symbol.</li>
</ul>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>shootings_map_legend <span class="sc">+</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="fu">annotation_scale</span>(<span class="at">width_hint =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">style =</span> <span class="st">"ticks"</span>, <span class="at">location =</span> <span class="st">"br"</span>) <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb29-4"><a href="#cb29-4"></a>    <span class="at">location =</span> <span class="st">"tr"</span>, </span>
<span id="cb29-5"><a href="#cb29-5"></a>    <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">"lines"</span>), </span>
<span id="cb29-6"><a href="#cb29-6"></a>    <span class="at">style =</span> <span class="fu">north_arrow_minimal</span>(<span class="at">text_size =</span> <span class="dv">8</span>)</span>
<span id="cb29-7"><a href="#cb29-7"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/scales-exercise3-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="saving-maps" class="level2" data-number="6.9"><h2 data-number="6.9" class="anchored" data-anchor-id="saving-maps">
<span class="header-section-number">6.9</span> Saving maps</h2>
<p>Once you have a complete map, it is often useful to save it as an image file so that you can share it with others or embed it into a report or presentation. You can save plots created with <code>ggplot()</code> using the <code>ggsave()</code> function.</p>
<p>Before we do that, lets create a final map that includes a base map as well as some supporting elements. We won’t include a north arrow because north is at the top of the map and it’s unlikely anyone will be using this map for navigation. We will include a scale bar so that people looking at the map can see the approximate size of shooting hotspots. Remember we have already loaded the necessary packages, as well as data stored in the <code>shootings</code>, <code>precincts</code> and <code>shootings_kde</code> objects.</p>
<div class="box notewell">
<p>There is usually no need to save the map into several different objects (e.g.&nbsp; <code>shootings_map_titled</code> or <code>shootings_map_legend</code>) as we have done in this tutorial. We have only done that here so you could learn about the different contextual elements one by one.</p>
<p>It is usually much better to create a whole <code>ggplot()</code> stack in one go, since it is easier to keep track of all the elements that way. In the code below all the elements have been combined into a single <code>ggplot()</code> stack.</p>
</div>
<div class="cell" data-exercise="true" data-exercise.lines="44">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>shootings_map_final <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="fu">annotation_map_tile</span>(<span class="at">type =</span> <span class="st">"cartolight"</span>, <span class="at">zoomin =</span> <span class="dv">0</span>, <span class="at">progress =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> kde), <span class="at">data =</span> shootings_kde, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">colour =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> precincts, <span class="at">colour =</span> <span class="st">"grey33"</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="fu">geom_sf_label</span>(</span>
<span id="cb30-6"><a href="#cb30-6"></a>    <span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">ordinal</span>(precinct)), </span>
<span id="cb30-7"><a href="#cb30-7"></a>    <span class="at">data =</span> precincts,</span>
<span id="cb30-8"><a href="#cb30-8"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>, </span>
<span id="cb30-9"><a href="#cb30-9"></a>    <span class="at">colour =</span> <span class="st">"grey33"</span>, </span>
<span id="cb30-10"><a href="#cb30-10"></a>    <span class="at">size =</span> <span class="fl">2.5</span>, </span>
<span id="cb30-11"><a href="#cb30-11"></a>    <span class="at">label.size =</span> <span class="cn">NA</span></span>
<span id="cb30-12"><a href="#cb30-12"></a>  ) <span class="sc">+</span></span>
<span id="cb30-13"><a href="#cb30-13"></a>  <span class="fu">annotation_scale</span>(<span class="at">width_hint =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">style =</span> <span class="st">"ticks"</span>, <span class="at">location =</span> <span class="st">"br"</span>) <span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14"></a>  <span class="fu">scale_fill_distiller</span>(</span>
<span id="cb30-15"><a href="#cb30-15"></a>    <span class="at">palette =</span> <span class="st">"PuBu"</span>,</span>
<span id="cb30-16"><a href="#cb30-16"></a>    <span class="at">breaks =</span> <span class="fu">range</span>(<span class="fu">pull</span>(shootings_kde, <span class="st">"kde"</span>)), </span>
<span id="cb30-17"><a href="#cb30-17"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"lower"</span>, <span class="st">"higher"</span>),</span>
<span id="cb30-18"><a href="#cb30-18"></a>    <span class="at">direction =</span> <span class="dv">1</span></span>
<span id="cb30-19"><a href="#cb30-19"></a>  ) <span class="sc">+</span></span>
<span id="cb30-20"><a href="#cb30-20"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-21"><a href="#cb30-21"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb30-22"><a href="#cb30-22"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span>,</span>
<span id="cb30-23"><a href="#cb30-23"></a>    <span class="at">caption =</span> <span class="fu">str_glue</span>(</span>
<span id="cb30-24"><a href="#cb30-24"></a>      <span class="st">"Author: Joe Bloggs, Date produced: {lubridate::today()},</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb30-25"><a href="#cb30-25"></a>      <span class="st">"Data: https://data.cityofnewyork.us/d/833y-fsy8</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb30-26"><a href="#cb30-26"></a>      <span class="st">"Map data from OpenStreetMap"</span></span>
<span id="cb30-27"><a href="#cb30-27"></a>    ),</span>
<span id="cb30-28"><a href="#cb30-28"></a>    <span class="at">fill =</span> <span class="st">"kernel density</span><span class="sc">\n</span><span class="st">of shootings"</span></span>
<span id="cb30-29"><a href="#cb30-29"></a>  ) <span class="sc">+</span></span>
<span id="cb30-30"><a href="#cb30-30"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb30-31"><a href="#cb30-31"></a>  <span class="fu">theme</span>(</span>
<span id="cb30-32"><a href="#cb30-32"></a>    <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"lines"</span>),</span>
<span id="cb30-33"><a href="#cb30-33"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>)),</span>
<span id="cb30-34"><a href="#cb30-34"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>)),</span>
<span id="cb30-35"><a href="#cb30-35"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>), <span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">0</span>)),</span>
<span id="cb30-36"><a href="#cb30-36"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey67"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>), <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb30-37"><a href="#cb30-37"></a>  )</span>
<span id="cb30-38"><a href="#cb30-38"></a></span>
<span id="cb30-39"><a href="#cb30-39"></a><span class="co"># Display map</span></span>
<span id="cb30-40"><a href="#cb30-40"></a>shootings_map_final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/save-exercise1-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p><code>ggsave()</code> can create image files in many different formats, including PNG, JPEG and PDF. <code>ggsave()</code> will determine which type of file to create according to the file extension of the file name that you specify. So <code>ggsave("bronx_shootings_2019.pdf", plot = shootings_map_legend)</code> produces a PDF file, while <code>ggsave("bronx_shootings_2019.jpg", plot = shootings_map_legend)</code> produces a JPEG image file.</p>
<p>You can specify the size of the image that will be saved using the <code>height</code> and <code>width</code> arguments. Note that for historical reasons these values are in <em>inches</em> by default, but you can change this to either centimetres (using <code>units = "cm"</code>), millimetres (using <code>units = "mm"</code>) or pixels (using <code>units = "px"</code>).</p>
<p>To share our map with others, lets save it as an A4-size PDF.</p>
<div class="cell" data-exercise="true">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb31-2"><a href="#cb31-2"></a>  <span class="st">"bronx_shootings_2019.pdf"</span>, </span>
<span id="cb31-3"><a href="#cb31-3"></a>  <span class="at">plot =</span> shootings_map_final, </span>
<span id="cb31-4"><a href="#cb31-4"></a>  <span class="at">width =</span> <span class="dv">210</span>,</span>
<span id="cb31-5"><a href="#cb31-5"></a>  <span class="at">height =</span> <span class="dv">297</span>,</span>
<span id="cb31-6"><a href="#cb31-6"></a>  <span class="at">units =</span> <span class="st">"mm"</span></span>
<span id="cb31-7"><a href="#cb31-7"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now use share this file by email, upload it to a website or embed it in another document.</p>
</section><section id="in-summary" class="level2" data-number="6.10"><h2 data-number="6.10" class="anchored" data-anchor-id="in-summary">
<span class="header-section-number">6.10</span> In summary</h2>
<div class="box welldone">
<p>In this tutorial we have learned about the importance of understanding the purpose for which people will use a map when making decisions about map design. We have also learned about how establishing a visual hierarchy on our map can help steer readers towards the most-important elements and how to add titles, legends and scale bars to maps in R.</p>
</div>
<div class="box reading">
<p>You can find out more about the topics we have covered in this tutorial:</p>
<ul>
<li>For a short summary of research into how people read maps and what that tells us about how to design a map, see <a href="https://doi.org/10.4324/9781315736822-5">Cartography, visual perception and cognitive psychology</a> by Amy Griffin.</li>
<li>For a more-detailed explanation of how visual hierarchy can be applied to maps, see <a href="https://gistbok.ucgis.org/bok-topics/visual-hierarchy-and-layout">Visual Hierarchy and Layout</a>.</li>
<li>For more examples of how maps can mislead, read <a href="https://www.ft.com/content/65b5df0e-49ff-11e8-8ee8-cae73aab7ccb">How to lie with maps</a> by Alan Smith.</li>
</ul>
</div>
<p class="full-width-image">
<a href="https://xkcd.com/1472/"><img src="https://imgs.xkcd.com/comics/geography.png" alt="The place I'd least like to live is the farm in the background of those diagrams showing how tornadoes form."></a>
</p>
<p class="credits">
<a href="https://xkcd.com/1459/">XKCD.com comic ‘Geography’</a> licensed under the <a href="https://xkcd.com/license.html">Creative Commons Attribution-NonCommercial license</a>.
</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../05_your_second_crime_map/index.html" class="pagination-link" aria-label="Your second crime map">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Your second crime map</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../07_handling_bugs/index.html" class="pagination-link" aria-label="Handling bugs in your code">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Handling bugs in your code</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
    <a class="nav-link" href="https://creativecommons.org/licenses/by/4.0/">
<p>This book is available under a Creative Commons Attribution 4.0 International licence</p>
</a>
  </li>  
</ul>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mpjashby/crimemappingbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


</body></html>