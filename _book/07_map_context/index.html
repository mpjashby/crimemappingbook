<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; Giving a map context – Learn Crime Mapping with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../08_handling_bugs/index.html" rel="next">
<link href="../06_mapping_crime_patterns/index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- START OF INCLUDED HEADER -->

<!--
This file contains code that will be included in the header of each page of the
quarto book
-->

<script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>

<!-- END OF INCLUDED HEADER -->


<link rel="stylesheet" href="../css/styles.css">
<link rel="stylesheet" href="../include/webex.css">
<meta name="twitter:title" content="7&nbsp; Giving a map context – Learn Crime Mapping with R">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="../images/cover_image.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../07_map_context/index.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Giving a map context</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/cover_image.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Learn Crime Mapping with R</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mpjashby/crimemappingbook/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../learn_crime_mapping_with_r.epub" title="Download ePub" class="quarto-navigation-tool px-1" aria-label="Download ePub"><i class="bi bi-journal"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contents</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Install the software needed for this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_getting_started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_your_first_crime_map/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Your first crime map</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_data_wrangling/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Wrangling data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_your_second_crime_map/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Your second crime map</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_code_with_style/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Code with style</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_mapping_crime_patterns/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Mapping crime patterns</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_map_context/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Giving a map context</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08_handling_bugs/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Handling bugs in your code</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../09_mapping_areas/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Mapping area data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../10_place_data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Using data about places</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../11_mapping_hotspots/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Mapping hotspots</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../12_messy_data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Handling messy data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../13_crime_series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Mapping crime series</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../14_writing_reports/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Writing reports in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../15_no_maps/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Presenting spatial data without maps</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../16_mapping_time/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Mapping crime over time</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/read_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Functions for reading data into R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/map_checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Checklist: Making a good crime map</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/common_errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Common R errors and how to fix them</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/functions_to_avoid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Some R functions you should avoid</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/handling_errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Checklist: handling code errors</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">In this chapter</h2>
   
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">7.1</span> Introduction</a></li>
  <li><a href="#map-choices" id="toc-map-choices" class="nav-link" data-scroll-target="#map-choices"><span class="header-section-number">7.2</span> Map choices</a></li>
  <li><a href="#sec-visual-hierarchy" id="toc-sec-visual-hierarchy" class="nav-link" data-scroll-target="#sec-visual-hierarchy"><span class="header-section-number">7.3</span> Visual hierarchy</a></li>
  <li><a href="#supporting-elements" id="toc-supporting-elements" class="nav-link" data-scroll-target="#supporting-elements"><span class="header-section-number">7.4</span> Supporting elements</a></li>
  <li><a href="#creating-and-storing-a-map" id="toc-creating-and-storing-a-map" class="nav-link" data-scroll-target="#creating-and-storing-a-map"><span class="header-section-number">7.5</span> Creating and storing a map</a></li>
  <li><a href="#ggplot2-themes" id="toc-ggplot2-themes" class="nav-link" data-scroll-target="#ggplot2-themes"><span class="header-section-number">7.6</span> ggplot2 themes</a></li>
  <li><a href="#sec-titles" id="toc-sec-titles" class="nav-link" data-scroll-target="#sec-titles"><span class="header-section-number">7.7</span> Titles</a></li>
  <li><a href="#sec-legends" id="toc-sec-legends" class="nav-link" data-scroll-target="#sec-legends"><span class="header-section-number">7.8</span> Legends</a></li>
  <li><a href="#sec-scale-bars" id="toc-sec-scale-bars" class="nav-link" data-scroll-target="#sec-scale-bars"><span class="header-section-number">7.9</span> Scales and north arrows</a></li>
  <li><a href="#saving-maps" id="toc-saving-maps" class="nav-link" data-scroll-target="#saving-maps"><span class="header-section-number">7.10</span> Saving maps</a></li>
  <li><a href="#in-summary" id="toc-in-summary" class="nav-link" data-scroll-target="#in-summary"><span class="header-section-number">7.11</span> In summary</a></li>
  </ul>
<div class="toc-actions"><ul class="collapse"><li><a href="https://github.com/mpjashby/crimemappingbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-map-context" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Giving a map context</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="abstract">
<p>This chapter focuses on adding essential context to crime maps to make them informative and clear. You’ll learn how to enhance maps with titles, legends, scale bars, and other supporting elements. The chapter emphasizes the importance of visual hierarchy, ensuring that data remains the main focus while contextual information provides necessary clarity. Practical examples guide you through creating maps using the ggplot2 package, selecting effective themes, and tailoring visual elements to your audience. By the end of this chapter, you’ll understand how to balance information and design, creating maps that effectively communicate meaningful insights about crime data.</p>
</div>
<section id="introduction" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">7.1</span> Introduction</h2>
<p>In this chapter we will create this map of shootings in the Bronx borough of New York City in 2019.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/nyc_shootings_map.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>You can see that – unlike the maps we have made so far – this map includes contextual elements such as a title, a legend and a scale bar. In this chapter we will learn how to add each of these elements to a map, and (just as importantly) when you shouldn’t use them.</p>
</section>
<section id="map-choices" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="map-choices"><span class="header-section-number">7.2</span> Map choices</h2>
<p>Among the most important decisions you make when you are creating a map is what information to include and what to leave out. Watch this video to learn more about why this is important and how you can make those decisions.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/2_YOwOmodG0" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Map choices
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<p>The most important thing to remember when designing a map is to keep in mind the purpose that the map will be used for. Research on how people use maps has repeatedly shown that “<a href="https://doi.org/10.4324/9781315736822.ch3">the nature of the task or function to be performed by the map user is the single most important factor in determining how [someone] processes the information on the map</a>”.</p>
<p>As explained in the video, when you create a crime map you should ask yourself:</p>
<ul>
<li><em>What will readers be using this map for?</em></li>
<li><em>What information do readers need?</em></li>
<li><em>What do readers already know?</em></li>
<li><em>In what context are people going to use this map?</em></li>
<li><em>How could this map lead the audience to a wrong conclusion?</em></li>
</ul>
<p>Maps are powerful communication tools, which can sometimes knowingly or unknowingly mislead the reader. Watch this video to learn more about how maps can be misleading.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/G0_MBrJnRq0" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Do maps lie?
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>According to the video, why should we critically evaluate maps?</strong></p>
<div id="radio_CTFNSCBYIV" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_CTFNSCBYIV" value=""> <span>Maps are always based on outdated data</span></label><label><input type="radio" autocomplete="off" name="radio_CTFNSCBYIV" value=""> <span>Maps are neutral and require interpretation</span></label><label><input type="radio" autocomplete="off" name="radio_CTFNSCBYIV" value="answer"> <span>Maps can be created to deliberately influence or mislead viewers</span></label><label><input type="radio" autocomplete="off" name="radio_CTFNSCBYIV" value=""> <span>Maps are only useful for navigation, not analysis</span></label>
</div>
<p><strong>What is the main difference between Jim’s and Anna’s maps of London house prices?</strong></p>
<div id="radio_TZTCNYKYMW" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_TZTCNYKYMW" value=""> <span>Jim uses outdated data, while Anna uses current data</span></label><label><input type="radio" autocomplete="off" name="radio_TZTCNYKYMW" value="answer"> <span>Jim uses an equal interval classification, while Anna compares London prices to the UK average</span></label><label><input type="radio" autocomplete="off" name="radio_TZTCNYKYMW" value=""> <span>Jim’s map shows rental prices, while Anna’s map shows purchase prices</span></label><label><input type="radio" autocomplete="off" name="radio_TZTCNYKYMW" value=""> <span>Jim’s map focuses on urban areas, while Anna’s map focuses on rural areas</span></label>
</div>
<p><strong>What three questions should you ask when evaluating a map?</strong></p>
<div id="radio_GWQNQQYASI" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_GWQNQQYASI" value=""> <span>Where was it made? Who paid for it? What colors are used?</span></label><label><input type="radio" autocomplete="off" name="radio_GWQNQQYASI" value=""> <span>Is the data current? How is it classified? Is it geographically accurate?</span></label><label><input type="radio" autocomplete="off" name="radio_GWQNQQYASI" value=""> <span>What software was used? What is the scale? How many layers does it have?</span></label><label><input type="radio" autocomplete="off" name="radio_GWQNQQYASI" value="answer"> <span>Who made it? Why did they make it? What does it tell us?</span></label>
</div>
</div>
</div>
<p>Whenever you make a map, think about your own biases – are your own views on a topic likely to influence the results of your analysis? One way to test your own assumptions about a topic is to test them against other potential assumptions using an approach to crime analysis called hypothesis testing. To find out more about the hypothesis testing approach, read the paper <a href="https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.1012.6309&amp;rep=rep1&amp;type=pdf"><em>Improving the explanatory content of analysis products using hypothesis testing</em></a>.</p>
</section>
<section id="sec-visual-hierarchy" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="sec-visual-hierarchy"><span class="header-section-number">7.3</span> Visual hierarchy</h2>
<p>Maps are among the most complex types of data visualisation. Even if we have chosen wisely what to include and what to leave out, there is likely to be lots of information on our map. For all but the simplest maps, there is a risk of readers – especially those in a hurry – might be overwhelmed or mislead by competing pieces of information (such as different layers of data) on a map.</p>
<p>To help readers understand what parts of a map they should focus most of their attention on and which are of less importance, we can establish a visual hierarchy. Watch this video to learn more about visual hierarchies in mapping.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/ezz_SPl0Xr4" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Visual hierarchy
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<p>We have used some of the principles of visual hierarchy in the maps we have already made. For example, in the density map of bike thefts in Vancouver, we used strong colours to represent the data and shades of grey for the base map. This helped readers intuitively understand that they should focus most attention on the data.</p>
</section>
<section id="supporting-elements" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="supporting-elements"><span class="header-section-number">7.4</span> Supporting elements</h2>
<p>We can often make our maps much more useful by adding supporting elements that explain the map content, give context or provide extra information. Watch this video to find out what elements you can add to your maps to make them more useful.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/uXUeb-qmgTc" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Supporting elements
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<p>We will not need to include every supporting element mentioned in the video in all the maps we make. The visual hierarchy that you establish in your map by use of size, colour, etc. should make it clear which elements are most important. The data should always come first in the visual hierarchy, usually followed by the title and then the legend. Other elements should be lower down the hierarchy. In every map, the supporting elements should be designed so that they do not distract from the data.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Visual hierarchy of elements in a crime map</caption>
<thead>
<tr class="header">
<th style="text-align: right;">place in hierarchy</th>
<th style="text-align: left;">map element</th>
<th style="text-align: left;">how often needed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1st</td>
<td style="text-align: left;">data layers</td>
<td style="text-align: left;">always</td>
</tr>
<tr class="even">
<td style="text-align: right;">2nd</td>
<td style="text-align: left;">title</td>
<td style="text-align: left;">virtually always</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3rd</td>
<td style="text-align: left;">legend</td>
<td style="text-align: left;">usually</td>
</tr>
<tr class="even">
<td style="text-align: right;">4th</td>
<td style="text-align: left;">base map</td>
<td style="text-align: left;">almost always</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5th</td>
<td style="text-align: left;">author and date</td>
<td style="text-align: left;">virtually always</td>
</tr>
<tr class="even">
<td style="text-align: right;">=6th</td>
<td style="text-align: left;">scale</td>
<td style="text-align: left;">sometimes</td>
</tr>
<tr class="odd">
<td style="text-align: right;">=6th</td>
<td style="text-align: left;">north arrow</td>
<td style="text-align: left;">sometimes</td>
</tr>
<tr class="even">
<td style="text-align: right;">7th</td>
<td style="text-align: left;">grid</td>
<td style="text-align: left;">rarely</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Elements that are almost always needed on a crime map are not necessarily highest on the visual hierarchy. For example, the author name is virtually always needed, but is relatively low on the visual hierarchy. This is because it is important information for readers who need it to judge the reliability of a map, or to get in touch to ask questions, but should not distract from the data for those readers who do not need it.</p>
<p>Before we start learning the code needed to add titles and legends to our maps, watch this video walk-though of the main steps.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/P3L9yHc8H-8" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section>
<section id="creating-and-storing-a-map" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="creating-and-storing-a-map"><span class="header-section-number">7.5</span> Creating and storing a map</h2>
<p>Since we will be adding various elements to a map in this chapter, we will first create a map and save it as an R object. Any map or chart produced using the <code>ggplot()</code> function can be saved as an object using the assignment operator <code>&lt;-</code>. Just as for the result of any other R function, if we save it to an object the result will not be printed to the screen, but we can easily see the plot by simply typing the object name in the R console.</p>
<p>Create a new R script file (in RStudio: <code>File &gt; New File &gt; R Script</code>) and save the file in your project directory as <code>chapter_07.R</code>. Paste this code into it and run that code so that we can use it as the basis for the maps we will make during the rest of the chapter.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter_07.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load packages</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggspatial, sf, sfhotspot, tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># Load shootings data and transform it to use an appropriate co-ordinate system</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>shootings <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="st">"https://mpjashby.github.io/crimemappingdata/bronx_shootings.csv"</span>, </span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="at">show_col_types =</span> <span class="cn">FALSE</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="st">"EPSG:4326"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="fu">st_transform</span>(<span class="st">"EPSG:6538"</span>)</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co"># Load NYC police precincts data</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>precincts <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/nyc_precincts.gpkg"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-14"><a href="#cb1-14"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb1-15"><a href="#cb1-15"></a>  <span class="co"># Filter just those precincts that are in the Bronx (40th to 52nd)</span></span>
<span id="cb1-16"><a href="#cb1-16"></a>  <span class="fu">filter</span>(precinct <span class="sc">%in%</span> <span class="dv">40</span><span class="sc">:</span><span class="dv">52</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-17"><a href="#cb1-17"></a>  <span class="fu">st_transform</span>(<span class="st">"EPSG:6538"</span>)</span>
<span id="cb1-18"><a href="#cb1-18"></a></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co"># Calculate KDE</span></span>
<span id="cb1-20"><a href="#cb1-20"></a>shootings_kde <span class="ot">&lt;-</span> shootings <span class="sc">|&gt;</span> </span>
<span id="cb1-21"><a href="#cb1-21"></a>  <span class="fu">hotspot_kde</span>(</span>
<span id="cb1-22"><a href="#cb1-22"></a>    <span class="at">grid =</span> <span class="fu">hotspot_grid</span>(precincts, <span class="at">cell_size =</span> <span class="dv">100</span>), </span>
<span id="cb1-23"><a href="#cb1-23"></a>    <span class="at">bandwidth_adjust =</span> <span class="fl">0.33</span>,</span>
<span id="cb1-24"><a href="#cb1-24"></a>    <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb1-25"><a href="#cb1-25"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb1-26"><a href="#cb1-26"></a>  <span class="fu">st_intersection</span>(precincts)</span>
<span id="cb1-27"><a href="#cb1-27"></a></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="co"># Create map object</span></span>
<span id="cb1-29"><a href="#cb1-29"></a>shootings_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1-30"><a href="#cb1-30"></a>  <span class="fu">annotation_map_tile</span>(<span class="at">type =</span> <span class="st">"cartolight"</span>, <span class="at">zoomin =</span> <span class="dv">0</span>, <span class="at">progress =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb1-31"><a href="#cb1-31"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> kde), <span class="at">data =</span> shootings_kde, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">colour =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb1-32"><a href="#cb1-32"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> precincts, <span class="at">colour =</span> <span class="st">"grey33"</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb1-33"><a href="#cb1-33"></a>  <span class="fu">geom_sf_label</span>(</span>
<span id="cb1-34"><a href="#cb1-34"></a>    <span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">ordinal</span>(precinct)), </span>
<span id="cb1-35"><a href="#cb1-35"></a>    <span class="at">data =</span> precincts,</span>
<span id="cb1-36"><a href="#cb1-36"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>, </span>
<span id="cb1-37"><a href="#cb1-37"></a>    <span class="at">colour =</span> <span class="st">"grey33"</span>, </span>
<span id="cb1-38"><a href="#cb1-38"></a>    <span class="at">size =</span> <span class="fl">2.5</span>, </span>
<span id="cb1-39"><a href="#cb1-39"></a>    <span class="at">label.size =</span> <span class="cn">NA</span></span>
<span id="cb1-40"><a href="#cb1-40"></a>  ) <span class="sc">+</span></span>
<span id="cb1-41"><a href="#cb1-41"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"PuBu"</span>, <span class="at">direction =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>Warning: attribute variables are assumed to be spatially constant throughout
all geometries</code></pre>
</div>
</div>
<p>To view the map in RStudio, we can just type the name of the map object we have just created into the R Console and press <code>Enter</code>/<code>Return</code>.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>shootings_map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The code used to create this map is very similar to the code we used in one of the previous chapters to make a map of bike theft in Vancouver, although there are a few differences.</p>
<p>Looking at line 22 of the code above, we have used the <code>grid</code> argument to the <code>hotspot_kde()</code> function, specifying <code>hotspot_grid(precincts, cell_size = 100)</code>. By default, <code>hotspot_kde()</code> calculates density estimates (KDE values) for every grid cell within the area covered by the crime data. This is fine when at least a few crimes have occurred in all the parts of the area for which we have data. But if crime is heavily concentrated in a few places and there are large areas with no crimes, the density layer will not cover the whole area for which we have data. In this case, it is important to extend the density layer manually to make it clear that the apparent low density of crime in some places is due to a genuine lack of crime there, rather than because we do not have data for those places.</p>
<p>We can do this by providing <code>hotspot_kde()</code> with a grid of cells for which KDE values should be calculated, rather than letting <code>hotspot_kde()</code> do this automatically. In the code above, we have used the <code>hotspot_grid()</code> function to create a grid that covers all the precincts in the Bronx (the area we have data for), and then passed the resulting grid to the <code>grid</code> argument of <code>hotspot_kde()</code>. This ensures that KDE values are calculated for every part of the Bronx.</p>
<p><a href="https://scales.r-lib.org" title="scales website"><img src="../images/scales.png" class="right-side-image"></a></p>
<p>The only other difference from the Vancouver map is that we have used the <code>ordinal()</code> function from the <a href="https://scales.r-lib.org">scales package</a> to convert the precinct numbers to ordinal numbers (1st, 2nd, 3rd, etc.) for the map labels. This is because police precincts in New York City are usually referred to using ordinal numbers (e.g.&nbsp;“the 1st Precinct” rather than “Precinct 1”) and it will be easier for people to read the map if it uses terms they are familiar with.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Don’t always use ordinal numbers for labels
</div>
</div>
<div class="callout-body-container callout-body">
<p>We are using ordinal numbers (1st, 2nd, etc.) for the labels because that is how police precinct numbers are usually expressed in New York City. That does not mean that we should always use wrap map labels in the <code>ordinal()</code> function. How we present map labels (and every other type of information on a map) depends on what is best for the audience we are making the map for.</p>
</div>
</div>
<p>There are many other functions in the scales package that format numbers in different ways, including <code>comma()</code> to add thousands separators to numbers and <code>dollar()</code> to format numbers as values in dollars or other currencies. There is a <a href="https://scales.r-lib.org/reference/">full list of scales functions on the package website</a>.</p>
<p>We now have a basic map of shootings in the Bronx. This map isn’t good enough on its own, but we can use it to learn how to add supporting elements to a map.</p>
</section>
<section id="ggplot2-themes" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="ggplot2-themes"><span class="header-section-number">7.6</span> ggplot2 themes</h2>
<p>So far we have learned about several families of functions we can add to a <code>ggplot()</code> stack to help construct a map. For example, we have learned about the <code>geom_*()</code> family of functions for adding data layers to a map and the <code>scale_*()</code> family of functions for controlling how different data values are visually represented. Now we need to learn about another family: <em>themes</em>.</p>
<p>Themes in ggplot2 affect how the supporting elements of a map appear. By supporting elements, we mean all the parts of the map that don’t depend on the data. Supporting elements include titles, axes and legends.</p>
<p>There are many different themes that you can add to a <code>ggplot()</code> stack. Some of these are built into the ggplot2 package, and some are part of other packages that extend what ggplot2 can do. Some organisations (such as the BBC) have <a href="https://github.com/bbc/bbplot">their own ggplot2 themes</a> for creating maps and charts that follow their corporate style guide.</p>
<p>Different themes can give maps (and charts) very different appearances, even when they use the same data. For example, these four maps show what happens when different themes are applied to the end of the same <code>ggplot()</code> stack:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>You can see that the differences between <code>theme_grey()</code> (the default theme) and <code>theme_classic()</code> are quite subtle, but in other cases (such as <code>theme_wsj()</code> – a theme following the house style of the <em>Wall Street Journal</em> newspaper) the differences are quite substantial.</p>
<p>Three of the themes shown above add x (horizontal) and y (vertical) axis labels to the map. Axis labels are very useful for most types of plot, but usually not for maps. It’s very unlikely that someone looking at this map of shootings in the Bronx will benefit from knowing that the map covers the area from 40.80 degrees north of the equator to 40.92 degrees north. For this reason, when we make a map we will usually add <code>theme_void()</code> to our <code>ggplot()</code> stacks, since this removes unnecessary elements such as axis labels. Removing these elements is useful because it allows readers to focus more on the parts of the map that convey useful information.</p>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ggplot2 themes
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What parts of the map are controlled by the function we choose from the <code>theme_*()</code> family?</strong></p>
<div id="radio_CJZAIHKYEE" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_CJZAIHKYEE" value=""> <span>The data layers on the map, such as the density layer.</span></label><label><input type="radio" autocomplete="off" name="radio_CJZAIHKYEE" value="answer"> <span>The non-data elements, like titles and axis labels.</span></label><label><input type="radio" autocomplete="off" name="radio_CJZAIHKYEE" value=""> <span>The scale of the map.</span></label><label><input type="radio" autocomplete="off" name="radio_CJZAIHKYEE" value=""> <span>What style of base map will be used in the map.</span></label>
</div>
<p><strong>What does the <code>theme_void()</code> function do in a map created using ggplot2?</strong></p>
<div id="radio_IGMOQUDTZN" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_IGMOQUDTZN" value=""> <span>It removes the title from the map.</span></label><label><input type="radio" autocomplete="off" name="radio_IGMOQUDTZN" value=""> <span>It changes the color of the map background.</span></label><label><input type="radio" autocomplete="off" name="radio_IGMOQUDTZN" value=""> <span>It places gridlines on top of the data layers.</span></label><label><input type="radio" autocomplete="off" name="radio_IGMOQUDTZN" value="answer"> <span>It removes unnecessary elements like axis labels.</span></label>
</div>
</div>
</div>
</section>
<section id="sec-titles" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="sec-titles"><span class="header-section-number">7.7</span> Titles</h2>
<p>A map title is one of the most important ways to add context to a map. Titles can either be <em>descriptive</em> or <em>declarative</em>. Descriptive titles simply state what data are shown on the map. For example, we might give our map the title “Shootings in the Bronx, 2019”. Declarative titles, on the other hand, state what you think the main conclusion should be that readers remember about the map. For example, we might use the title “Shootings are focused in the South Bronx”.</p>
<p>Declarative titles are usually more useful than descriptive titles because they help the reader to interpret the map. But writing a good declarative title is harder than writing a descriptive title, because it requires you to think about what is the main point that you want to make with the map. To help you come up with a good declarative title, you might want to try several different titles so that you can choose the one that communicates your message most clearly.</p>
<p>We can add a title to our map using the <code>labs()</code> (short for ‘labels’) function from the ggplot2 package. We can use <code>labs()</code> to add labels to various different parts of a map or plot, but for now we will just use the argument <code>title</code> to set the title.</p>
<p>To see how this works, run the following code in the R Console. Since we have stored the rest of the <code>ggplot()</code> stack in the <code>shootings_map</code> object, this code is equivalent to adding <code>labs()</code> to the end of the original stack. This code also adds <code>theme_void()</code> to the stack.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>shootings_map <span class="sc">+</span> </span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>) <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Sometimes our preferred title might be too long to fit on a map. In this case, we can break the title across two or more lines. We can do this manually by adding the characters <code>\n</code> (the character code for a new line) at the point where we want the text to start a new line. Alternatively, we can use the <code>str_wrap()</code> function from the stringr package to wrap the text automatically into lines of a given maximum length (specified using the <code>wrap</code> argument).</p>
<p>When you use a declarative title for your map, it is often useful to provide a <em>subtitle</em> containing descriptive information. Adding a subtitle is very easy using the <code>subtitle</code> argument to the <code>labs()</code> function.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>shootings_map <span class="sc">+</span> </span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="fu">labs</span>(</span>
<span id="cb5-3"><a href="#cb5-3"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb5-4"><a href="#cb5-4"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>  ) <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<section id="sec-captions" class="level3" data-number="7.7.1">
<h3 data-number="7.7.1" class="anchored" data-anchor-id="sec-captions"><span class="header-section-number">7.7.1</span> Using captions to add author and other information</h3>
<p>The <code>labs()</code> function has another argument that we can use to add text to our map for context. The <code>caption</code> argument is used to add information such as the author, date and source of the data to a map or chart. We can put any information we like into the caption, using <code>str_wrap()</code> or the new-line character <code>\n</code> if necessary to stop the text overflowing the map.</p>
<p>Run this code in the R Console and see where on the map the new information appears.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>shootings_map <span class="sc">+</span> </span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="fu">labs</span>(</span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span>,</span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="at">caption =</span> <span class="fu">str_glue</span>(</span>
<span id="cb6-6"><a href="#cb6-6"></a>      <span class="st">"Author: Joe Bloggs, Date produced: {today()},</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb6-7"><a href="#cb6-7"></a>      <span class="st">"Data: https://data.cityofnewyork.us/d/833y-fsy8</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb6-8"><a href="#cb6-8"></a>      <span class="st">"Map data from OpenStreetMap"</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>    )</span>
<span id="cb6-10"><a href="#cb6-10"></a>  ) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>You will have seen that the caption appears below the map, in smaller text. The positioning and size of the caption help to move it down the visual hierarchy, since information like the date the map was made is not as important as the (declarative) map title.</p>
<p>The code for the caption also uses the <code>str_glue()</code> function from the <code>stringr</code> package. <code>str_glue()</code> glues together any number of character strings separated by commas – in this case, we have split the caption into two separate character strings (on separate lines) so that the lines of code do not become too long to easily read.</p>
<p><code>str_glue()</code> can also include the values of R objects and the results of R functions that are placed inside braces (<code>{}</code>). So the code <code>{today()}</code> runs the function <code>today()</code> from the lubridate package (part of the tidyverse) and glues the result (the current date) into the text.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Acknowledging the data you use
</div>
</div>
<div class="callout-body-container callout-body">
<p>When you use data to make maps, the data provider will often require you to acknowledge the source of that data. This is a legal requirement so it is important that you do this when required.</p>
<p>The base maps we use in this course use data from OpenStreetMap, which <a href="https://wiki.osmfoundation.org/wiki/Licence/Attribution_Guidelines">requires</a> people using its data to acknowledge that they have done so. The easiest way to do this is to add the text “Map data from OpenStreetMap” to the <code>caption</code> of your maps if they use base maps from OpenStreetMap.</p>
</div>
</div>
</section>
<section id="changing-the-appearance-of-titles-and-captions" class="level3" data-number="7.7.2">
<h3 data-number="7.7.2" class="anchored" data-anchor-id="changing-the-appearance-of-titles-and-captions"><span class="header-section-number">7.7.2</span> Changing the appearance of titles and captions</h3>
<p>We have added a title, subtitle and caption to our map, but you might not be happy with their appearance. You might want, for example, to move the caption further down the visual hierarchy by making the text smaller and/or a lighter colour, or add some space between the subtitle and the map itself.</p>
<p>We can exercise almost complete control over the supporting elements of maps or charts made with <code>ggplot()</code> using the <code>theme()</code> function. <code>theme()</code> allows us to make changes to the settings that are applied by the <code>theme_*()</code> family of functions (such as <code>theme_void()</code>).</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>theme()</code> doesn’t affect data elements
</div>
</div>
<div class="callout-body-container callout-body">
<p>One important thing to remember about <code>theme()</code> is that it only controls the non-data elements of a map – nothing you do with the <code>theme()</code> function will have any effect on the data elements of a map (in this case, the layer showing the density of shootings). To change the appearance of data layers within <code>ggplot()</code> maps, use the <code>geom_</code>, and <code>scale_</code> families of functions as we have learned in <a href="../04_your_second_crime_map/index.html" class="quarto-xref"><span>Chapter 4</span></a> and <a href="../06_mapping_crime_patterns/index.html" class="quarto-xref"><span>Chapter 6</span></a>.</p>
</div>
</div>
<p>The <code>theme()</code> function has a lot of potential arguments. If you need help using the <code>theme()</code> function (or any function in R) you can view a manual page (including a list of arguments) for the function by:</p>
<ul>
<li>typing a question mark followed by the function name without parentheses (e.g.&nbsp;<code>?theme</code>) into the R console,</li>
<li>typing the function name without parentheses into the search box in the Help panel in RStudio, or</li>
<li>clicking on the function name anywhere in your R script file to place the cursor on the function name, then pressing <code>F1</code> on your keyboard.</li>
</ul>
<p>Try opening the manual page for <code>theme()</code> now to see the list of possible arguments it can take. Fortunately, we will not need most of these arguments most of the time – <code>ggplot()</code> has default values built in for every value that can be changed using <code>theme()</code>, and these defaults will be reasonable in almost all cases.</p>
<p>To reduce the visual prominence of the map caption, we can change the value of the <code>plot.caption</code> argument to <code>theme()</code>. Since the caption is a text element (rather than a polygon, line, etc.), we can use the helper function <code>element_text()</code> to do this. The following code changes the colour of the caption text to a lighter grey and makes the text smaller relative to the default using the helper function <code>rel()</code> (for relative sizing) – <code>0.7</code> means the text will be 70% as big as it would have been by default.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>shootings_map <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb7-4"><a href="#cb7-4"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span>,</span>
<span id="cb7-5"><a href="#cb7-5"></a>    <span class="at">caption =</span> <span class="fu">str_glue</span>(</span>
<span id="cb7-6"><a href="#cb7-6"></a>      <span class="st">"Author: Joe Bloggs, Date produced: {lubridate::today()},</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb7-7"><a href="#cb7-7"></a>      <span class="st">"Data: https://data.cityofnewyork.us/d/833y-fsy8</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb7-8"><a href="#cb7-8"></a>      <span class="st">"Map data from OpenStreetMap"</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>    )</span>
<span id="cb7-10"><a href="#cb7-10"></a>  ) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>  <span class="fu">theme</span>(</span>
<span id="cb7-13"><a href="#cb7-13"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey67"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>))</span>
<span id="cb7-14"><a href="#cb7-14"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>The helper function <code>element_text()</code> has arguments to control the appearance of text in different ways. As well as <code>colour</code> (or <code>color</code>, either is fine) and <code>size</code>:</p>
<ul>
<li><code>family</code> controls the font used, e.g.&nbsp;Times New Roman or Helvetica,</li>
<li><code>face</code> controls the style of the font, i.e.&nbsp;‘plain’, ‘italic’, ‘bold’ or ‘bold.italic’,</li>
<li><code>hjust</code> controls the horizontal justification of the text, where 0 means left aligned, 0.5 means centred and 1 means right aligned,</li>
<li><code>vjust</code> controls the vertical justification, and</li>
<li><code>angle</code> controls the angle (in degrees) of the text (0 means horizontal),</li>
<li><code>lineheight</code> controls the space between lines if you have created a value that has more than one line (e.g.&nbsp;using <code>\n</code> or <code>str_wrap()</code>).</li>
</ul>
<p>The <code>margin</code> argument controls the space around the text. It is easiest to specify the value of <code>margin</code> using the helper function <code>margin()</code> designed for that purpose. You specify the top, right, bottom and left margin separately in that order – to remember the order, think ‘<strong>tr</strong>ou<strong>bl</strong>e’. By default, margins are specified in points (the same units that are commonly used to specify font sizes).</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>shootings_map <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-3"><a href="#cb8-3"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb8-4"><a href="#cb8-4"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span>,</span>
<span id="cb8-5"><a href="#cb8-5"></a>    <span class="at">caption =</span> <span class="fu">str_glue</span>(</span>
<span id="cb8-6"><a href="#cb8-6"></a>      <span class="st">"Author: Joe Bloggs, Date produced: {lubridate::today()},</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb8-7"><a href="#cb8-7"></a>      <span class="st">"Data: https://data.cityofnewyork.us/d/833y-fsy8</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb8-8"><a href="#cb8-8"></a>      <span class="st">"Map data from OpenStreetMap"</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>    )</span>
<span id="cb8-10"><a href="#cb8-10"></a>  ) <span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>  <span class="fu">theme</span>(</span>
<span id="cb8-13"><a href="#cb8-13"></a>    <span class="co"># Make the plot subtitle smaller and adjust the margin around it</span></span>
<span id="cb8-14"><a href="#cb8-14"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>), <span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">0</span>)),</span>
<span id="cb8-15"><a href="#cb8-15"></a>    <span class="co"># Make the legend caption smaller, left-aligned and a lighter shade of grey</span></span>
<span id="cb8-16"><a href="#cb8-16"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey67"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>), <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb8-17"><a href="#cb8-17"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Now that we have finished setting the text elements for our map, we can save it as a new object that we can use as the basis for the other objects we want to add. Make sure you run this code, since we will need it for the rest of the code below.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>shootings_map_titled <span class="ot">&lt;-</span> shootings_map <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb9-4"><a href="#cb9-4"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span>,</span>
<span id="cb9-5"><a href="#cb9-5"></a>    <span class="at">caption =</span> <span class="fu">str_glue</span>(</span>
<span id="cb9-6"><a href="#cb9-6"></a>      <span class="st">"Author: Joe Bloggs, Date produced: {lubridate::today()},</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb9-7"><a href="#cb9-7"></a>      <span class="st">"Data: https://data.cityofnewyork.us/d/833y-fsy8</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb9-8"><a href="#cb9-8"></a>      <span class="st">"Map data from OpenStreetMap"</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>    )</span>
<span id="cb9-10"><a href="#cb9-10"></a>  ) <span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb9-12"><a href="#cb9-12"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-13"><a href="#cb9-13"></a>    <span class="co"># Make the plot subtitle smaller and adjust the margin around it</span></span>
<span id="cb9-14"><a href="#cb9-14"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>), <span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">0</span>)),</span>
<span id="cb9-15"><a href="#cb9-15"></a>    <span class="co"># Make the legend caption smaller, left-aligned and a lighter shade of grey</span></span>
<span id="cb9-16"><a href="#cb9-16"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey67"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>), <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb9-17"><a href="#cb9-17"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Create your maps using a single <code>ggplot()</code> stack
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this chapter we will store the map we are creating in an object several times as we go through the process of explaining how to add context to a map. When you write your own code, you should not do this. Instead, you should create the map from start to finish in a single block of code. Doing that will make sure your code is easy to read and that you don’t have to keep track of more objects than necessary. For an example of this, see the final section of this chapter.</p>
</div>
</div>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Titles, subtitles and captions
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What is the main purpose of adding a title to a map in R?</strong></p>
<div id="radio_LEIEMUEUBU" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_LEIEMUEUBU" value=""> <span>To make the map look more professional.</span></label><label><input type="radio" autocomplete="off" name="radio_LEIEMUEUBU" value=""> <span>To provide a reference for the map's source</span></label><label><input type="radio" autocomplete="off" name="radio_LEIEMUEUBU" value=""> <span>To display additional geographic information</span></label><label><input type="radio" autocomplete="off" name="radio_LEIEMUEUBU" value="answer"> <span>To explain the main conclusion that the audience should draw from the map</span></label>
</div>
<p><strong>Which R function is used to add a title to a map created with ggplot2?</strong></p>
<div id="radio_WYHOUTVJMS" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_WYHOUTVJMS" value=""> <span><code>ggtitle()</code></span></label><label><input type="radio" autocomplete="off" name="radio_WYHOUTVJMS" value="answer"> <span><code>labs()</code></span></label><label><input type="radio" autocomplete="off" name="radio_WYHOUTVJMS" value=""> <span><code>title()</code></span></label><label><input type="radio" autocomplete="off" name="radio_WYHOUTVJMS" value=""> <span><code>ggmap()</code></span></label>
</div>
<p><strong>Which of the following is an example of a declarative title for a crime map?</strong></p>
<div id="radio_TOZANLTQYK" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_TOZANLTQYK" value=""> <span>Residential burglary in Philadelphia, 2024</span></label><label><input type="radio" autocomplete="off" name="radio_TOZANLTQYK" value=""> <span>Philadelphia crime map</span></label><label><input type="radio" autocomplete="off" name="radio_TOZANLTQYK" value="answer"> <span>Residential burglary in Philadephia is concentrated in Kensington</span></label><label><input type="radio" autocomplete="off" name="radio_TOZANLTQYK" value=""> <span>Where residential burglaries are most concentrated in Philadephia</span></label>
</div>
<p><strong>Why is it important to acknowledge the source of data used in crime maps?</strong></p>
<div id="radio_SRPMNDIKQS" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_SRPMNDIKQS" value="answer"> <span>It meets legal requirements.</span></label><label><input type="radio" autocomplete="off" name="radio_SRPMNDIKQS" value=""> <span>It helps reduce the size of the data.</span></label><label><input type="radio" autocomplete="off" name="radio_SRPMNDIKQS" value=""> <span>It improves the accuracy of the map.</span></label><label><input type="radio" autocomplete="off" name="radio_SRPMNDIKQS" value=""> <span>It ensures the map looks visually appealing.</span></label>
</div>
</div>
</div>
</section>
</section>
<section id="sec-legends" class="level2" data-number="7.8">
<h2 data-number="7.8" class="anchored" data-anchor-id="sec-legends"><span class="header-section-number">7.8</span> Legends</h2>
<p>Legends are important for all but the simplest crime maps because they help readers to interpret the points, lines and polygons used to represent data on a particular map. Except for point maps containing only a small number of crimes (such as the map of homicide in downtown Atlanta that we produced in <a href="../02_your_first_crime_map/index.html" class="quarto-xref"><span>Chapter 2</span></a>), crime maps will almost always need a legend to help users interpret them.</p>
<p>Producing a legend manually could be quite complicated, but fortunately <code>ggplot()</code> produces legends automatically. <code>ggplot()</code> will add a legend to a map or chart whenever one or more layers of data are represented using an aesthetic property such as size, shape, colour or fill. In our current map, the density of shootings is represented using the fill colour of the polygons produced by the <code>hotspot_kde()</code> function, with darker colours representing more shootings.</p>
<p>Our map already has a legend, but we may want to adjust its appearance by:</p>
<ul>
<li>changing the default legend title from “kde” to something more meaningful,</li>
<li>moving the legend down the visual hierarchy by making it smaller (at the moment it is almost as visually prominent as the data),</li>
<li>removing the potentially confusing raw density values.</li>
</ul>
<p>We can change the default legend title by once again using the <code>labs()</code> function. Since we want to change the title of the legend, you might reasonably think that we would do this using something like <code>labs(legend = "density")</code> but unfortunately that code would do nothing at all. Instead, we have to set the legend title using the aesthetic (colour, size, shape, etc.) that the legend represents. This makes it possible to specify multiple titles if there are separate legends for different layers that use different aesthetics. For example if a map used lines of different colours to show streets of different types and filled polygons to show the density of crime, it would be possible to have separate legends explaining each aesthetic. In this case, we’ve specified that the <code>kde</code> column in the data should control the fill aesthetic, so we can set the title for that legend using <code>fill = "title we want"</code>.</p>
<p>Run this code in the R Console and check to see that the legend title has changed.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>shootings_map_titled <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"kernel density</span><span class="sc">\n</span><span class="st">of shootings"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>To make the legend smaller, we can use <code>theme()</code> in the same way as we did to change the appearance of the caption. We use the <code>legend.title</code> argument to format the legend title and the <code>legend.text</code> argument to format the labels for each value in the legend, again using the <code>element_text()</code> helper function. In both cases, we will set the text size relative to the default text size using the <code>rel()</code> helper function.</p>
<p>We will also make the colour bar in the legend (called the <em>key</em> by <code>ggplot()</code>) slightly smaller using the <code>legend.key.width</code> argument. To do this we will use the helper function <code>unit()</code>, which allows us to specify the size using any of several common units. In this case, we will specify the key size in lines (1 line = the height of one line of text) so that it is relative to the text size we have chosen.</p>
<p>Run this code and check how the appearance of the legend changes.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb11" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>shootings_map_titled <span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"kernel density</span><span class="sc">\n</span><span class="st">of shootings"</span>) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">theme</span>(</span>
<span id="cb11-4"><a href="#cb11-4"></a>    <span class="co"># Make the legend colour bar smaller</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"lines"</span>),</span>
<span id="cb11-6"><a href="#cb11-6"></a>    <span class="co"># Make the legend text smaller</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>)),</span>
<span id="cb11-8"><a href="#cb11-8"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>))</span>
<span id="cb11-9"><a href="#cb11-9"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Finally, we want to remove the raw density values, since these are difficult to interpret and might distract readers from the key message that darker colours on the map represent higher densities of shootings.</p>
<p>By default, <code>ggplot()</code> sets the label for each legend key based on the data. To specify our own labels, we can use the <code>labels</code> argument to the <code>scale_fill_distiller()</code> function that we previously used to set the colour scheme of the density layer on the map.</p>
<p>When we set colour bar labels manually, we have to also specify where on the colour bar we want those labels to appear. We do this using the <code>breaks</code> argument to <code>scale_fill_distiller()</code>, making sure the number of values we supply to the <code>breaks</code> argument is the same as the number of labels we’ve given to the <code>labels</code> argument (otherwise R will produce an error).</p>
<p>In this case, we want to add two labels (“higher” and “lower”), one at either end of the colour bar. We could look at <code>kde</code> column of the <code>shootings_kde</code> object to find the minimum and maximum values, but that would introduce the risk of us accidentally entering the wrong values. Instead, we can use the <code>pull()</code> function to extract the <code>kde</code> column from the <code>shootings_kde</code> dataset and then use the <code>range()</code> function to find the minimum and maximum values. Putting this together, we get <code>breaks = range(pull(shootings_kde, "kde"))</code>. You can read this code starting from the ‘inside’ and working ‘outwards’: the code says “take the <code>shootings_kde</code> object, <code>pull()</code> the ‘kde’ column out of that object and then calculate the <code>range()</code> of numbers in that column.</p>
<p>Run this code to see how the legend labels change.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>shootings_map_titled <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="co"># Specify colours used to show density of crime</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="fu">scale_fill_distiller</span>(</span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="at">palette =</span> <span class="st">"PuBu"</span>, </span>
<span id="cb12-5"><a href="#cb12-5"></a>    <span class="at">direction =</span> <span class="dv">1</span>, </span>
<span id="cb12-6"><a href="#cb12-6"></a>    <span class="co"># Specify label positions as the minimum and maximum KDE values</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>    <span class="at">breaks =</span> <span class="fu">range</span>(<span class="fu">pull</span>(shootings_kde, <span class="st">"kde"</span>)), </span>
<span id="cb12-8"><a href="#cb12-8"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"lower"</span>, <span class="st">"higher"</span>)</span>
<span id="cb12-9"><a href="#cb12-9"></a>  ) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"kernel density</span><span class="sc">\n</span><span class="st">of shootings"</span>) <span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11"></a>  <span class="fu">theme</span>(</span>
<span id="cb12-12"><a href="#cb12-12"></a>    <span class="co"># Make the legend colour bar smaller</span></span>
<span id="cb12-13"><a href="#cb12-13"></a>    <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"lines"</span>),</span>
<span id="cb12-14"><a href="#cb12-14"></a>    <span class="co"># Make the legend text smaller</span></span>
<span id="cb12-15"><a href="#cb12-15"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>)),</span>
<span id="cb12-16"><a href="#cb12-16"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>))</span>
<span id="cb12-17"><a href="#cb12-17"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Now that we have finished formatting the legend, we can again store the map as an object that we can build on further.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb13" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>shootings_map_legend <span class="ot">&lt;-</span> shootings_map_titled <span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="co"># Specify colours used to show density of crime</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">scale_fill_distiller</span>(</span>
<span id="cb13-4"><a href="#cb13-4"></a>    <span class="at">palette =</span> <span class="st">"PuBu"</span>, </span>
<span id="cb13-5"><a href="#cb13-5"></a>    <span class="at">direction =</span> <span class="dv">1</span>, </span>
<span id="cb13-6"><a href="#cb13-6"></a>    <span class="co"># Specify label positions as the minimum and maximum KDE values</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>    <span class="at">breaks =</span> <span class="fu">range</span>(<span class="fu">pull</span>(shootings_kde, <span class="st">"kde"</span>)), </span>
<span id="cb13-8"><a href="#cb13-8"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"lower"</span>, <span class="st">"higher"</span>)</span>
<span id="cb13-9"><a href="#cb13-9"></a>  ) <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"kernel density</span><span class="sc">\n</span><span class="st">of shootings"</span>) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>  <span class="fu">theme</span>(</span>
<span id="cb13-12"><a href="#cb13-12"></a>    <span class="co"># Make the legend colour bar smaller</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>    <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"lines"</span>),</span>
<span id="cb13-14"><a href="#cb13-14"></a>    <span class="co"># Make the legend text smaller</span></span>
<span id="cb13-15"><a href="#cb13-15"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>)),</span>
<span id="cb13-16"><a href="#cb13-16"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>))</span>
<span id="cb13-17"><a href="#cb13-17"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Legends
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What is the role of a legend on a map?</strong></p>
<div id="radio_XTDUAQOWPB" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_XTDUAQOWPB" value=""> <span>To display the map’s title.</span></label><label><input type="radio" autocomplete="off" name="radio_XTDUAQOWPB" value="answer"> <span>To explain the meaning of different symbols or colors on the map.</span></label><label><input type="radio" autocomplete="off" name="radio_XTDUAQOWPB" value=""> <span>To display the coordinates of map locations.</span></label><label><input type="radio" autocomplete="off" name="radio_XTDUAQOWPB" value=""> <span>To add gridlines to the map.</span></label>
</div>
<p><strong>What is one advantage of using <code>str_glue()</code> to format text on in maps made with R?</strong></p>
<div id="radio_TZTSZQPPPI" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_TZTSZQPPPI" value="answer"> <span>It combines multiple strings into one caption, including dynamic values.</span></label><label><input type="radio" autocomplete="off" name="radio_TZTSZQPPPI" value=""> <span>It helps with data filtering.</span></label><label><input type="radio" autocomplete="off" name="radio_TZTSZQPPPI" value=""> <span>It allows you to change map colors.</span></label><label><input type="radio" autocomplete="off" name="radio_TZTSZQPPPI" value=""> <span>It removes unwanted data points.</span></label>
</div>
<p><strong>Which ggplot2 function is commonly used to add a legend to a map?</strong></p>
<div id="radio_EPYHQBSSCV" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_EPYHQBSSCV" value=""> <span><code>geom_sf()</code></span></label><label><input type="radio" autocomplete="off" name="radio_EPYHQBSSCV" value=""> <span><code>theme_void()</code></span></label><label><input type="radio" autocomplete="off" name="radio_EPYHQBSSCV" value="answer"> <span><code>scale_fill_*()</code></span></label><label><input type="radio" autocomplete="off" name="radio_EPYHQBSSCV" value=""> <span><code>labs()</code></span></label>
</div>
<p><strong>Which of the following statements best describes how map legends should be designed?</strong></p>
<div id="radio_JQDZKYRTQE" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_JQDZKYRTQE" value=""> <span><code>geom_sf()</code></span></label><label><input type="radio" autocomplete="off" name="radio_JQDZKYRTQE" value=""> <span><code>theme_void()</code></span></label><label><input type="radio" autocomplete="off" name="radio_JQDZKYRTQE" value="answer"> <span><code>scale_fill_*()</code></span></label><label><input type="radio" autocomplete="off" name="radio_JQDZKYRTQE" value=""> <span><code>labs()</code></span></label>
</div>
</div>
</div>
</section>
<section id="sec-scale-bars" class="level2" data-number="7.9">
<h2 data-number="7.9" class="anchored" data-anchor-id="sec-scale-bars"><span class="header-section-number">7.9</span> Scales and north arrows</h2>
<p>The final elements we can add to our map are a scale bar and a north arrow, which can both be added using functions from the <code>ggspatial</code> package. If you check the <code>chapter_07.R</code> code file, you will see that you have already loaded this package.</p>
<section id="scale-bars" class="level3" data-number="7.9.1">
<h3 data-number="7.9.1" class="anchored" data-anchor-id="scale-bars"><span class="header-section-number">7.9.1</span> Scale bars</h3>
<p>To add a scale bar, we can add a call to the <code>annotation_scale()</code> function to our existing <code>ggplot()</code> object.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>shootings_map_legend <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="co"># Add scale bar</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">annotation_scale</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>The default scale bar is a little too visually dominant for the low place it should have in the visual hierarchy of our map, and the default placement in the bottom-left corner happens to overlap with the highest density of shootings. We can change the scale bar using arguments to the <code>annotation_scale()</code> function:</p>
<ul>
<li><code>width_hint = 1/5</code> changes the (approximate) proportion of the map width across which the scale bar stretches,</li>
<li><code>style = "ticks"</code> changes the style of the scale bar to the less visually prominent line-and-tick-marks style, and</li>
<li><code>location = "br"</code> moves the scale bar to the bottom-right corner of the map.</li>
</ul>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb15" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>shootings_map_legend <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="co"># Add scale bar</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">annotation_scale</span>(<span class="at">width_hint =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">style =</span> <span class="st">"ticks"</span>, <span class="at">location =</span> <span class="st">"br"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-north-arrows" class="level3" data-number="7.9.2">
<h3 data-number="7.9.2" class="anchored" data-anchor-id="sec-north-arrows"><span class="header-section-number">7.9.2</span> North arrows</h3>
<p>We can add a north arrow using the <code>annotation_north_arrow()</code> function. The default arrow is too obtrusive to fit its position in the visual hierarchy, so we will change its appearance using the arguments:</p>
<ul>
<li><code>location = "tr"</code> to move the north arrow to the top-right corner, since we have put the scale bar in the bottom-right where the north arrow would be placed by default,</li>
<li><code>height = unit(1.5, "lines")</code> to make the arrow smaller, and</li>
<li><code>style = north_arrow_minimal(text_size = 8)</code> to use a smaller style of arrow, at the same time reducing the font size (measured in points) of the N symbol.</li>
</ul>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R Console</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb16" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>shootings_map_legend <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="co"># Add scale bar</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">annotation_scale</span>(<span class="at">width_hint =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">style =</span> <span class="st">"ticks"</span>, <span class="at">location =</span> <span class="st">"br"</span>) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="co"># Add north arrow</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb16-6"><a href="#cb16-6"></a>    <span class="at">location =</span> <span class="st">"tr"</span>, </span>
<span id="cb16-7"><a href="#cb16-7"></a>    <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">"lines"</span>), </span>
<span id="cb16-8"><a href="#cb16-8"></a>    <span class="at">style =</span> <span class="fu">north_arrow_minimal</span>(<span class="at">text_size =</span> <span class="dv">8</span>)</span>
<span id="cb16-9"><a href="#cb16-9"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Not all maps need north arrows
</div>
</div>
<div class="callout-body-container callout-body">
<p>If a map is going to be used for navigation (e.g.&nbsp;a road map or a nautical chart), it is vital that the map includes a north arrow. But if the map is going to be used to understand concentrations of crime in an area, a north arrow is much less important.</p>
<p>You may choose to omit including a north arrow in your crime maps. However, you <em>must</em> include a north arrow if (for whatever reason) north is not at a the top of the map. People expect north to be at the top of a map, so if your map does not follow your convention then it is important to make sure your readers can work that out.</p>
<p>Most of the crime maps in the rest of this book do not have north arrows, because those maps follow the convention of having north at the top of the map.</p>
</div>
</div>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Scale bars and north arrows
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Which of the following is a recommended practice when adding a north arrow or scale bar to a crime map?</strong></p>
<div id="radio_FQGNHVKOZX" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_FQGNHVKOZX" value=""> <span>They should be placed in the center of the map to ensure the map is balanced.</span></label><label><input type="radio" autocomplete="off" name="radio_FQGNHVKOZX" value=""> <span>They should be made as large as possible to dominate the map.</span></label><label><input type="radio" autocomplete="off" name="radio_FQGNHVKOZX" value="answer"> <span>They should be placed in a corner where they do not interfere with the map’s data.</span></label><label><input type="radio" autocomplete="off" name="radio_FQGNHVKOZX" value=""> <span>They should be included in every map, regardless of the map’s scale or orientation.</span></label>
</div>
<p><strong>What is the purpose of a scale bar in a crime map?</strong></p>
<div id="radio_BDCHVLUEUA" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_BDCHVLUEUA" value=""> <span>To show the geographical boundaries of the map.</span></label><label><input type="radio" autocomplete="off" name="radio_BDCHVLUEUA" value="answer"> <span>To provide a reference for the actual size of features on the map.</span></label><label><input type="radio" autocomplete="off" name="radio_BDCHVLUEUA" value=""> <span>To indicate the direction of the map.</span></label><label><input type="radio" autocomplete="off" name="radio_BDCHVLUEUA" value=""> <span>To highlight the most significant data points.</span></label>
</div>
<p><strong>When should a north arrow be included on a crime map?</strong></p>
<div id="radio_HMFODMLUQK" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_HMFODMLUQK" value=""> <span>Only when the map has multiple layers.</span></label><label><input type="radio" autocomplete="off" name="radio_HMFODMLUQK" value=""> <span>Always, as it is necessary for orientation in every map.</span></label><label><input type="radio" autocomplete="off" name="radio_HMFODMLUQK" value=""> <span>Only for maps showing detailed geographical features.</span></label><label><input type="radio" autocomplete="off" name="radio_HMFODMLUQK" value="answer"> <span>When north is not at the top of the map.</span></label>
</div>
</div>
</div>
<p>We now have the complete code needed to make the full map. Copy this code into the <code>chapter_07.R</code> file, replacing the existing <code>ggplot()</code> stack.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter_07.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb17" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>shootings_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="co"># Add base map</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="fu">annotation_map_tile</span>(<span class="at">type =</span> <span class="st">"cartolight"</span>, <span class="at">zoomin =</span> <span class="dv">0</span>, <span class="at">progress =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="co"># Add density layer</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> kde), <span class="at">data =</span> shootings_kde, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">colour =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>  <span class="co"># Add precinct boundaries</span></span>
<span id="cb17-7"><a href="#cb17-7"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> precincts, <span class="at">colour =</span> <span class="st">"grey33"</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>  <span class="co"># Add precinct labels</span></span>
<span id="cb17-9"><a href="#cb17-9"></a>  <span class="fu">geom_sf_label</span>(</span>
<span id="cb17-10"><a href="#cb17-10"></a>    <span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">ordinal</span>(precinct)), </span>
<span id="cb17-11"><a href="#cb17-11"></a>    <span class="at">data =</span> precincts,</span>
<span id="cb17-12"><a href="#cb17-12"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>, </span>
<span id="cb17-13"><a href="#cb17-13"></a>    <span class="at">colour =</span> <span class="st">"grey33"</span>, </span>
<span id="cb17-14"><a href="#cb17-14"></a>    <span class="at">size =</span> <span class="fl">2.5</span>, </span>
<span id="cb17-15"><a href="#cb17-15"></a>    <span class="at">label.size =</span> <span class="cn">NA</span></span>
<span id="cb17-16"><a href="#cb17-16"></a>  ) <span class="sc">+</span></span>
<span id="cb17-17"><a href="#cb17-17"></a>  <span class="co"># Add scale bar</span></span>
<span id="cb17-18"><a href="#cb17-18"></a>  <span class="fu">annotation_scale</span>(<span class="at">width_hint =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">style =</span> <span class="st">"ticks"</span>, <span class="at">location =</span> <span class="st">"br"</span>) <span class="sc">+</span></span>
<span id="cb17-19"><a href="#cb17-19"></a>  <span class="co"># Specify colours used to show density of crime</span></span>
<span id="cb17-20"><a href="#cb17-20"></a>  <span class="fu">scale_fill_distiller</span>(</span>
<span id="cb17-21"><a href="#cb17-21"></a>    <span class="at">palette =</span> <span class="st">"PuBu"</span>,</span>
<span id="cb17-22"><a href="#cb17-22"></a>    <span class="at">breaks =</span> <span class="fu">range</span>(<span class="fu">pull</span>(shootings_kde, <span class="st">"kde"</span>)), </span>
<span id="cb17-23"><a href="#cb17-23"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"lower"</span>, <span class="st">"higher"</span>),</span>
<span id="cb17-24"><a href="#cb17-24"></a>    <span class="at">direction =</span> <span class="dv">1</span></span>
<span id="cb17-25"><a href="#cb17-25"></a>  ) <span class="sc">+</span></span>
<span id="cb17-26"><a href="#cb17-26"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-27"><a href="#cb17-27"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb17-28"><a href="#cb17-28"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span>,</span>
<span id="cb17-29"><a href="#cb17-29"></a>    <span class="at">caption =</span> <span class="fu">str_glue</span>(</span>
<span id="cb17-30"><a href="#cb17-30"></a>      <span class="st">"Author: Joe Bloggs, Date produced: {lubridate::today()},</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb17-31"><a href="#cb17-31"></a>      <span class="st">"Data: https://data.cityofnewyork.us/d/833y-fsy8</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb17-32"><a href="#cb17-32"></a>      <span class="st">"Map data from OpenStreetMap"</span></span>
<span id="cb17-33"><a href="#cb17-33"></a>    ),</span>
<span id="cb17-34"><a href="#cb17-34"></a>    <span class="at">fill =</span> <span class="st">"kernel density</span><span class="sc">\n</span><span class="st">of shootings"</span></span>
<span id="cb17-35"><a href="#cb17-35"></a>  ) <span class="sc">+</span></span>
<span id="cb17-36"><a href="#cb17-36"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb17-37"><a href="#cb17-37"></a>  <span class="fu">theme</span>(</span>
<span id="cb17-38"><a href="#cb17-38"></a>    <span class="co"># Make the legend colour bar smaller</span></span>
<span id="cb17-39"><a href="#cb17-39"></a>    <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"lines"</span>),</span>
<span id="cb17-40"><a href="#cb17-40"></a>    <span class="co"># Make the legend text smaller</span></span>
<span id="cb17-41"><a href="#cb17-41"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>)),</span>
<span id="cb17-42"><a href="#cb17-42"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>)),</span>
<span id="cb17-43"><a href="#cb17-43"></a>    <span class="co"># Make the plot subtitle smaller and adjust the margin around it</span></span>
<span id="cb17-44"><a href="#cb17-44"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>), <span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">0</span>)),</span>
<span id="cb17-45"><a href="#cb17-45"></a>    <span class="co"># Make the legend caption smaller, left-aligned and a lighter shade of grey</span></span>
<span id="cb17-46"><a href="#cb17-46"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey67"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>), <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb17-47"><a href="#cb17-47"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>This code looks quite complicated, but you can understand each part of it using the comments included in the code.</p>
</section>
</section>
<section id="saving-maps" class="level2" data-number="7.10">
<h2 data-number="7.10" class="anchored" data-anchor-id="saving-maps"><span class="header-section-number">7.10</span> Saving maps</h2>
<p>Until now, the maps we have produced have appeared in the RStudio Plots panel. But it is often useful to save a map as an image file so that you can share it with others or embed it into a report or presentation. You can save plots created with <code>ggplot()</code> using the <code>ggsave()</code> function.</p>
<p><code>ggsave()</code> can create image files in many different formats, including PNG, JPEG and PDF. <code>ggsave()</code> will determine which type of file to create according to the file extension of the file name that you specify. So <code>ggsave("bronx_shootings_2019.pdf", plot = shootings_map)</code> produces a PDF file, while <code>ggsave("bronx_shootings_2019.jpg", plot = shootings_map)</code> produces a JPEG image file.</p>
<p>You can specify the size of the image that will be saved using the <code>height</code> and <code>width</code> arguments. Note that for historical reasons these values are in <em>inches</em> by default, but you can change this to either centimetres (using <code>units = "cm"</code>), millimetres (using <code>units = "mm"</code>) or pixels (using <code>units = "px"</code>).</p>
<p>To share our map with others, lets save it as an A4-size PDF. Add this code to the <code>chapter_07.R</code> script file.</p>
<div class="cell" data-exercise="true">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>chapter_07.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb18" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="st">"bronx_shootings_2019.pdf"</span>, </span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="at">plot =</span> shootings_map, </span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="at">width =</span> <span class="dv">210</span>,</span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="at">height =</span> <span class="dv">297</span>,</span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="at">units =</span> <span class="st">"mm"</span></span>
<span id="cb18-7"><a href="#cb18-7"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Since we are working inside a project in RStudio, the file will by default be saved in the package directory we created in <a href="../01_getting_started/index.html#sec-create-project" class="quarto-xref"><span>Section 1.4.2</span></a>. You can view this directory in the RStudio Files panel: open the Files panel (in the bottom-right of the RStudio window) and click the small icon that shows a letter R inside a translucent blue box.</p>
<p>Save the <code>chapter_07.R</code> file, then restart R to start a new session by clicking on the <code>Session</code> menu and then clicking <code>Restart R</code>. This creates a blank canvas for the next chapter.</p>
</section>
<section id="in-summary" class="level2" data-number="7.11">
<h2 data-number="7.11" class="anchored" data-anchor-id="in-summary"><span class="header-section-number">7.11</span> In summary</h2>
<p>In this chapter we have learned about the importance of understanding the purpose for which people will use a map when making decisions about map design. We have also learned about how establishing a visual hierarchy on our map can help steer readers towards the most-important elements and how to add titles, legends and scale bars to maps in R.</p>
<div class="box reading">
<p>You can find out more about the topics we have covered in this chapter:</p>
<ul>
<li>For a short summary of research into how people read maps and what that tells us about how to design a map, see <a href="https://doi.org/10.4324/9781315736822-5">Cartography, visual perception and cognitive psychology</a> by Amy Griffin.</li>
<li>For a more-detailed explanation of how visual hierarchy can be applied to maps, see <a href="https://gistbok.ucgis.org/bok-topics/visual-hierarchy-and-layout">Visual Hierarchy and Layout</a>.</li>
<li>For more examples of how maps can mislead, read <a href="https://www.ft.com/content/65b5df0e-49ff-11e8-8ee8-cae73aab7ccb">How to lie with maps</a> by Alan Smith.</li>
</ul>
</div>
<div class="callout callout-style-default callout-quiz callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Revision questions
</div>
</div>
<div class="callout-body-container callout-body">
<p>Answer these questions to check you have understood the main points covered in this chapter. Write between 50 and 100 words to answer each question.</p>
<ol type="1">
<li>What is visual hierarchy in mapping, and why is it important to establish one when designing a map? Provide an example of how visual hierarchy affects map readability</li>
<li>Why is it important to add titles, legends, and other supporting elements to a crime map? How do these elements enhance the map’s usefulness and clarity?</li>
<li>What is the difference between a descriptive and a declarative map title? Provide an example of each for a map showing crime patterns.</li>
<li>Why is it important to acknowledge data sources and authorship on your map? How can the caption argument in labs() be used to include this information?</li>
<li>What factors should you consider when deciding whether to include a scale bar or north arrow on your map? How do these elements contribute to the map’s context?</li>
</ol>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../06_mapping_crime_patterns/index.html" class="pagination-link" aria-label="Mapping crime patterns">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Mapping crime patterns</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../08_handling_bugs/index.html" class="pagination-link" aria-label="Handling bugs in your code">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Handling bugs in your code</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb19" data-shortcodes="false" data-code-line-numbers=""><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu"># Giving a map context {#sec-map-context}</span></span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a>::: {.abstract}</span>
<span id="cb19-4"><a href="#cb19-4"></a>This chapter focuses on adding essential context to crime maps to make them informative and clear. You’ll learn how to enhance maps with titles, legends, scale bars, and other supporting elements. The chapter emphasizes the importance of visual hierarchy, ensuring that data remains the main focus while contextual information provides necessary clarity. Practical examples guide you through creating maps using the ggplot2 package, selecting effective themes, and tailoring visual elements to your audience. By the end of this chapter, you’ll understand how to balance information and design, creating maps that effectively communicate meaningful insights about crime data.</span>
<span id="cb19-5"><a href="#cb19-5"></a>:::</span>
<span id="cb19-6"><a href="#cb19-6"></a></span>
<span id="cb19-7"><a href="#cb19-7"></a></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="in">```{r setup}</span></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="in">#| echo: false</span></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="in">#| include: false</span></span>
<span id="cb19-11"><a href="#cb19-11"></a></span>
<span id="cb19-12"><a href="#cb19-12"></a><span class="in">pacman::p_load(ggspatial, sf, sfhotspot, tidyverse)</span></span>
<span id="cb19-13"><a href="#cb19-13"></a><span class="in">```</span></span>
<span id="cb19-14"><a href="#cb19-14"></a></span>
<span id="cb19-15"><a href="#cb19-15"></a></span>
<span id="cb19-16"><a href="#cb19-16"></a></span>
<span id="cb19-17"><a href="#cb19-17"></a><span class="fu">## Introduction</span></span>
<span id="cb19-18"><a href="#cb19-18"></a></span>
<span id="cb19-19"><a href="#cb19-19"></a>In this chapter we will create this map of shootings in the Bronx borough of New York City in 2019. </span>
<span id="cb19-20"><a href="#cb19-20"></a></span>
<span id="cb19-21"><a href="#cb19-21"></a><span class="in">```{r final-map-prep}</span></span>
<span id="cb19-22"><a href="#cb19-22"></a><span class="in">#| eval: false</span></span>
<span id="cb19-23"><a href="#cb19-23"></a><span class="in">#| echo: false</span></span>
<span id="cb19-24"><a href="#cb19-24"></a></span>
<span id="cb19-25"><a href="#cb19-25"></a><span class="in"># Load shootings data</span></span>
<span id="cb19-26"><a href="#cb19-26"></a><span class="in">shootings &lt;- read_csv("https://mpjashby.github.io/crimemappingdata/bronx_shootings.csv") |&gt; </span></span>
<span id="cb19-27"><a href="#cb19-27"></a><span class="in">  st_as_sf(coords = c("longitude", "latitude"), crs = "EPSG:4326") |&gt; </span></span>
<span id="cb19-28"><a href="#cb19-28"></a><span class="in">  st_transform("EPSG:6538")</span></span>
<span id="cb19-29"><a href="#cb19-29"></a></span>
<span id="cb19-30"><a href="#cb19-30"></a><span class="in"># Load NYC police precincts data</span></span>
<span id="cb19-31"><a href="#cb19-31"></a><span class="in">precincts &lt;- read_sf("https://mpjashby.github.io/crimemappingdata/nyc_precincts.gpkg") |&gt; </span></span>
<span id="cb19-32"><a href="#cb19-32"></a><span class="in">  janitor::clean_names() |&gt; </span></span>
<span id="cb19-33"><a href="#cb19-33"></a><span class="in">  # Filter just those precincts that are in the Bronx (40th to 52nd)</span></span>
<span id="cb19-34"><a href="#cb19-34"></a><span class="in">  filter(precinct %in% 40:52) |&gt; </span></span>
<span id="cb19-35"><a href="#cb19-35"></a><span class="in">  st_transform("EPSG:6538")</span></span>
<span id="cb19-36"><a href="#cb19-36"></a></span>
<span id="cb19-37"><a href="#cb19-37"></a><span class="in"># Calculate KDE</span></span>
<span id="cb19-38"><a href="#cb19-38"></a><span class="in">shootings_kde &lt;- shootings |&gt; </span></span>
<span id="cb19-39"><a href="#cb19-39"></a><span class="in">  hotspot_kde(</span></span>
<span id="cb19-40"><a href="#cb19-40"></a><span class="in">    grid = hotspot_grid(precincts, cell_size = 100), </span></span>
<span id="cb19-41"><a href="#cb19-41"></a><span class="in">    bandwidth_adjust = 0.33</span></span>
<span id="cb19-42"><a href="#cb19-42"></a><span class="in">  ) |&gt; </span></span>
<span id="cb19-43"><a href="#cb19-43"></a><span class="in">  st_intersection(precincts)</span></span>
<span id="cb19-44"><a href="#cb19-44"></a></span>
<span id="cb19-45"><a href="#cb19-45"></a><span class="in"># Create map object</span></span>
<span id="cb19-46"><a href="#cb19-46"></a><span class="in">shootings_map_final &lt;- ggplot() +</span></span>
<span id="cb19-47"><a href="#cb19-47"></a><span class="in">  annotation_map_tile(type = "cartolight", zoomin = 0, progress = "none") +</span></span>
<span id="cb19-48"><a href="#cb19-48"></a><span class="in">  geom_sf(aes(fill = kde), data = shootings_kde, alpha = 0.75, colour = NA) +</span></span>
<span id="cb19-49"><a href="#cb19-49"></a><span class="in">  geom_sf(data = precincts, colour = "grey33", fill = NA) +</span></span>
<span id="cb19-50"><a href="#cb19-50"></a><span class="in">  geom_sf_label(</span></span>
<span id="cb19-51"><a href="#cb19-51"></a><span class="in">    aes(label = scales::ordinal(precinct)), </span></span>
<span id="cb19-52"><a href="#cb19-52"></a><span class="in">    data = precincts,</span></span>
<span id="cb19-53"><a href="#cb19-53"></a><span class="in">    alpha = 0.5, </span></span>
<span id="cb19-54"><a href="#cb19-54"></a><span class="in">    colour = "grey33", </span></span>
<span id="cb19-55"><a href="#cb19-55"></a><span class="in">    size = 2.5, </span></span>
<span id="cb19-56"><a href="#cb19-56"></a><span class="in">    label.size = NA</span></span>
<span id="cb19-57"><a href="#cb19-57"></a><span class="in">  ) + </span></span>
<span id="cb19-58"><a href="#cb19-58"></a><span class="in">  annotation_scale(width_hint = 1/5, style = "ticks", location = "br") +</span></span>
<span id="cb19-59"><a href="#cb19-59"></a><span class="in">  scale_fill_distiller(</span></span>
<span id="cb19-60"><a href="#cb19-60"></a><span class="in">    palette = "PuBu",</span></span>
<span id="cb19-61"><a href="#cb19-61"></a><span class="in">    breaks = range(pull(shootings_kde, "kde")), </span></span>
<span id="cb19-62"><a href="#cb19-62"></a><span class="in">    labels = c("lower", "higher"),</span></span>
<span id="cb19-63"><a href="#cb19-63"></a><span class="in">    direction = 1</span></span>
<span id="cb19-64"><a href="#cb19-64"></a><span class="in">  ) +</span></span>
<span id="cb19-65"><a href="#cb19-65"></a><span class="in">  labs(</span></span>
<span id="cb19-66"><a href="#cb19-66"></a><span class="in">    title = "Shootings are focused in the South Bronx",</span></span>
<span id="cb19-67"><a href="#cb19-67"></a><span class="in">    subtitle = "Fatal and non-fatal shootings recorded by NYC Police, 2019",</span></span>
<span id="cb19-68"><a href="#cb19-68"></a><span class="in">    caption = str_glue(</span></span>
<span id="cb19-69"><a href="#cb19-69"></a><span class="in">      "Author: Joe Bloggs, Date produced: {lubridate::today()},\n",</span></span>
<span id="cb19-70"><a href="#cb19-70"></a><span class="in">      "Data: https://data.cityofnewyork.us/d/833y-fsy8\n",</span></span>
<span id="cb19-71"><a href="#cb19-71"></a><span class="in">      "Map data from OpenStreetMap"</span></span>
<span id="cb19-72"><a href="#cb19-72"></a><span class="in">    ),</span></span>
<span id="cb19-73"><a href="#cb19-73"></a><span class="in">    fill = "kernel density\nof shootings"</span></span>
<span id="cb19-74"><a href="#cb19-74"></a><span class="in">  ) +</span></span>
<span id="cb19-75"><a href="#cb19-75"></a><span class="in">  theme_void() +</span></span>
<span id="cb19-76"><a href="#cb19-76"></a><span class="in">  theme(</span></span>
<span id="cb19-77"><a href="#cb19-77"></a><span class="in">    legend.key.width = unit(0.8, "lines"),</span></span>
<span id="cb19-78"><a href="#cb19-78"></a><span class="in">    legend.text = element_text(size = rel(0.7)),</span></span>
<span id="cb19-79"><a href="#cb19-79"></a><span class="in">    legend.title = element_text(size = rel(0.8)),</span></span>
<span id="cb19-80"><a href="#cb19-80"></a><span class="in">    plot.title.position = "plot",</span></span>
<span id="cb19-81"><a href="#cb19-81"></a><span class="in">    plot.subtitle = element_text(size = rel(0.8), margin = margin(3, 0, 6, 0)),</span></span>
<span id="cb19-82"><a href="#cb19-82"></a><span class="in">    plot.caption = element_text(colour = "grey67", size = rel(0.7), hjust = 0)</span></span>
<span id="cb19-83"><a href="#cb19-83"></a><span class="in">  )</span></span>
<span id="cb19-84"><a href="#cb19-84"></a></span>
<span id="cb19-85"><a href="#cb19-85"></a><span class="in">ggsave(</span></span>
<span id="cb19-86"><a href="#cb19-86"></a><span class="in">  here::here("images/nyc_shootings_map.jpg"), </span></span>
<span id="cb19-87"><a href="#cb19-87"></a><span class="in">  shootings_map_final, </span></span>
<span id="cb19-88"><a href="#cb19-88"></a><span class="in">  width = 800 / 150, </span></span>
<span id="cb19-89"><a href="#cb19-89"></a><span class="in">  height = 800 / 150, </span></span>
<span id="cb19-90"><a href="#cb19-90"></a><span class="in">  dpi = 150</span></span>
<span id="cb19-91"><a href="#cb19-91"></a><span class="in">)</span></span>
<span id="cb19-92"><a href="#cb19-92"></a><span class="in">```</span></span>
<span id="cb19-93"><a href="#cb19-93"></a></span>
<span id="cb19-94"><a href="#cb19-94"></a><span class="in">```{r final-map}</span></span>
<span id="cb19-95"><a href="#cb19-95"></a><span class="in">#| echo: false</span></span>
<span id="cb19-96"><a href="#cb19-96"></a><span class="in">#| fig.align: center</span></span>
<span id="cb19-97"><a href="#cb19-97"></a><span class="in">#| out.width: 100%</span></span>
<span id="cb19-98"><a href="#cb19-98"></a></span>
<span id="cb19-99"><a href="#cb19-99"></a><span class="in">knitr::include_graphics(here::here("images/nyc_shootings_map.jpg"))</span></span>
<span id="cb19-100"><a href="#cb19-100"></a><span class="in">```</span></span>
<span id="cb19-101"><a href="#cb19-101"></a></span>
<span id="cb19-102"><a href="#cb19-102"></a>You can see that -- unlike the maps we have made so far -- this map includes contextual elements such as a title, a legend and a scale bar. In this chapter we will learn how to add each of these elements to a map, and (just as importantly) when you shouldn't use them.</span>
<span id="cb19-103"><a href="#cb19-103"></a></span>
<span id="cb19-104"><a href="#cb19-104"></a></span>
<span id="cb19-105"><a href="#cb19-105"></a></span>
<span id="cb19-106"><a href="#cb19-106"></a><span class="fu">## Map choices</span></span>
<span id="cb19-107"><a href="#cb19-107"></a></span>
<span id="cb19-108"><a href="#cb19-108"></a>Among the most important decisions you make when you are creating a map is what information to include and what to leave out. Watch this video to learn more about why this is important and how you can make those decisions.</span>
<span id="cb19-109"><a href="#cb19-109"></a></span>
<span id="cb19-110"><a href="#cb19-110"></a>{{&lt; video https://youtu.be/2_YOwOmodG0 &gt;}}</span>
<span id="cb19-111"><a href="#cb19-111"></a></span>
<span id="cb19-112"><a href="#cb19-112"></a></span>
<span id="cb19-113"><a href="#cb19-113"></a>::: {.callout-quiz .callout}</span>
<span id="cb19-114"><a href="#cb19-114"></a><span class="fu">#### Map choices</span></span>
<span id="cb19-115"><a href="#cb19-115"></a></span>
<span id="cb19-116"><a href="#cb19-116"></a><span class="in">```{r map-choices-quiz}</span></span>
<span id="cb19-117"><a href="#cb19-117"></a><span class="in">#| echo: false</span></span>
<span id="cb19-118"><a href="#cb19-118"></a></span>
<span id="cb19-119"><a href="#cb19-119"></a><span class="in">```</span></span>
<span id="cb19-120"><a href="#cb19-120"></a></span>
<span id="cb19-121"><a href="#cb19-121"></a>:::</span>
<span id="cb19-122"><a href="#cb19-122"></a></span>
<span id="cb19-123"><a href="#cb19-123"></a></span>
<span id="cb19-124"><a href="#cb19-124"></a>The most important thing to remember when designing a map is to keep in mind the purpose that the map will be used for. Research on how people use maps has repeatedly shown that "<span class="co">[</span><span class="ot">the nature of the task or function to be performed by the map user is the single most important factor in determining how [someone] processes the information on the map</span><span class="co">](https://doi.org/10.4324/9781315736822.ch3)</span>".</span>
<span id="cb19-125"><a href="#cb19-125"></a></span>
<span id="cb19-126"><a href="#cb19-126"></a>As explained in the video, when you create a crime map you should ask yourself:</span>
<span id="cb19-127"><a href="#cb19-127"></a></span>
<span id="cb19-128"><a href="#cb19-128"></a><span class="ss">  * </span>*What will readers be using this map for?*</span>
<span id="cb19-129"><a href="#cb19-129"></a><span class="ss">  * </span>*What information do readers need?*</span>
<span id="cb19-130"><a href="#cb19-130"></a><span class="ss">  * </span>*What do readers already know?*</span>
<span id="cb19-131"><a href="#cb19-131"></a><span class="ss">  * </span>*In what context are people going to use this map?*</span>
<span id="cb19-132"><a href="#cb19-132"></a><span class="ss">  * </span>*How could this map lead the audience to a wrong conclusion?*</span>
<span id="cb19-133"><a href="#cb19-133"></a>    </span>
<span id="cb19-134"><a href="#cb19-134"></a>Maps are powerful communication tools, which can sometimes knowingly or unknowingly mislead the reader. Watch this video to learn more about how maps can be misleading.</span>
<span id="cb19-135"><a href="#cb19-135"></a></span>
<span id="cb19-136"><a href="#cb19-136"></a>{{&lt; video https://youtu.be/G0_MBrJnRq0 &gt;}}</span>
<span id="cb19-137"><a href="#cb19-137"></a></span>
<span id="cb19-138"><a href="#cb19-138"></a></span>
<span id="cb19-139"><a href="#cb19-139"></a>::: {.callout-quiz .callout}</span>
<span id="cb19-140"><a href="#cb19-140"></a><span class="fu">#### Do maps lie?</span></span>
<span id="cb19-141"><a href="#cb19-141"></a></span>
<span id="cb19-142"><a href="#cb19-142"></a><span class="in">```{r maps-lie-quiz}</span></span>
<span id="cb19-143"><a href="#cb19-143"></a><span class="in">#| echo: false</span></span>
<span id="cb19-144"><a href="#cb19-144"></a></span>
<span id="cb19-145"><a href="#cb19-145"></a><span class="in">maps_lie_quiz1 &lt;- c(</span></span>
<span id="cb19-146"><a href="#cb19-146"></a><span class="in">  "Maps are always based on outdated data",</span></span>
<span id="cb19-147"><a href="#cb19-147"></a><span class="in">  "Maps are neutral and require interpretation",</span></span>
<span id="cb19-148"><a href="#cb19-148"></a><span class="in">  answer = "Maps can be created to deliberately influence or mislead viewers",</span></span>
<span id="cb19-149"><a href="#cb19-149"></a><span class="in">  "Maps are only useful for navigation, not analysis"</span></span>
<span id="cb19-150"><a href="#cb19-150"></a><span class="in">)</span></span>
<span id="cb19-151"><a href="#cb19-151"></a></span>
<span id="cb19-152"><a href="#cb19-152"></a><span class="in">maps_lie_quiz2 &lt;- c(</span></span>
<span id="cb19-153"><a href="#cb19-153"></a><span class="in">  "Jim uses outdated data, while Anna uses current data",</span></span>
<span id="cb19-154"><a href="#cb19-154"></a><span class="in">  answer = "Jim uses an equal interval classification, while Anna compares London prices to the UK average",</span></span>
<span id="cb19-155"><a href="#cb19-155"></a><span class="in">  "Jim’s map shows rental prices, while Anna’s map shows purchase prices",</span></span>
<span id="cb19-156"><a href="#cb19-156"></a><span class="in">  "Jim’s map focuses on urban areas, while Anna’s map focuses on rural areas"</span></span>
<span id="cb19-157"><a href="#cb19-157"></a><span class="in">)</span></span>
<span id="cb19-158"><a href="#cb19-158"></a></span>
<span id="cb19-159"><a href="#cb19-159"></a><span class="in">maps_lie_quiz3 &lt;- c(</span></span>
<span id="cb19-160"><a href="#cb19-160"></a><span class="in">  "Where was it made? Who paid for it? What colors are used?",</span></span>
<span id="cb19-161"><a href="#cb19-161"></a><span class="in">  "Is the data current? How is it classified? Is it geographically accurate?",</span></span>
<span id="cb19-162"><a href="#cb19-162"></a><span class="in">  "What software was used? What is the scale? How many layers does it have?",</span></span>
<span id="cb19-163"><a href="#cb19-163"></a><span class="in">  answer = "Who made it? Why did they make it? What does it tell us?"</span></span>
<span id="cb19-164"><a href="#cb19-164"></a><span class="in">)</span></span>
<span id="cb19-165"><a href="#cb19-165"></a><span class="in">```</span></span>
<span id="cb19-166"><a href="#cb19-166"></a></span>
<span id="cb19-167"><a href="#cb19-167"></a></span>
<span id="cb19-168"><a href="#cb19-168"></a>**According to the video, why should we critically evaluate maps?**</span>
<span id="cb19-169"><a href="#cb19-169"></a></span>
<span id="cb19-170"><a href="#cb19-170"></a><span class="in">`r webexercises::longmcq(maps_lie_quiz1)`</span></span>
<span id="cb19-171"><a href="#cb19-171"></a></span>
<span id="cb19-172"><a href="#cb19-172"></a></span>
<span id="cb19-173"><a href="#cb19-173"></a>**What is the main difference between Jim’s and Anna’s maps of London house prices?**</span>
<span id="cb19-174"><a href="#cb19-174"></a></span>
<span id="cb19-175"><a href="#cb19-175"></a><span class="in">`r webexercises::longmcq(maps_lie_quiz2)`</span></span>
<span id="cb19-176"><a href="#cb19-176"></a></span>
<span id="cb19-177"><a href="#cb19-177"></a></span>
<span id="cb19-178"><a href="#cb19-178"></a>**What three questions should you ask when evaluating a map?**</span>
<span id="cb19-179"><a href="#cb19-179"></a></span>
<span id="cb19-180"><a href="#cb19-180"></a><span class="in">`r webexercises::longmcq(maps_lie_quiz3)`</span></span>
<span id="cb19-181"><a href="#cb19-181"></a></span>
<span id="cb19-182"><a href="#cb19-182"></a></span>
<span id="cb19-183"><a href="#cb19-183"></a>:::</span>
<span id="cb19-184"><a href="#cb19-184"></a></span>
<span id="cb19-185"><a href="#cb19-185"></a></span>
<span id="cb19-186"><a href="#cb19-186"></a>Whenever you make a map, think about your own biases -- are your own views on a topic likely to influence the results of your analysis? One way to test your own assumptions about a topic is to test them against other potential assumptions using an approach to crime analysis called hypothesis testing. To find out more about the hypothesis testing approach, read the paper <span class="co">[</span><span class="ot">*Improving the explanatory content of analysis products using hypothesis testing*</span><span class="co">](https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.1012.6309&amp;rep=rep1&amp;type=pdf)</span>.</span>
<span id="cb19-187"><a href="#cb19-187"></a></span>
<span id="cb19-188"><a href="#cb19-188"></a></span>
<span id="cb19-189"><a href="#cb19-189"></a></span>
<span id="cb19-190"><a href="#cb19-190"></a><span class="fu">## Visual hierarchy {#sec-visual-hierarchy}</span></span>
<span id="cb19-191"><a href="#cb19-191"></a></span>
<span id="cb19-192"><a href="#cb19-192"></a>Maps are among the most complex types of data visualisation. Even if we have chosen wisely what to include and what to leave out, there is likely to be lots of information on our map. For all but the simplest maps, there is a risk of readers -- especially those in a hurry -- might be overwhelmed or mislead by competing pieces of information (such as different layers of data) on a map.</span>
<span id="cb19-193"><a href="#cb19-193"></a></span>
<span id="cb19-194"><a href="#cb19-194"></a>To help readers understand what parts of a map they should focus most of their attention on and which are of less importance, we can establish a visual hierarchy. Watch this video to learn more about visual hierarchies in mapping.</span>
<span id="cb19-195"><a href="#cb19-195"></a></span>
<span id="cb19-196"><a href="#cb19-196"></a>{{&lt; video https://youtu.be/ezz_SPl0Xr4 &gt;}}</span>
<span id="cb19-197"><a href="#cb19-197"></a></span>
<span id="cb19-198"><a href="#cb19-198"></a></span>
<span id="cb19-199"><a href="#cb19-199"></a>::: {.callout-quiz .callout}</span>
<span id="cb19-200"><a href="#cb19-200"></a><span class="fu">#### Visual hierarchy</span></span>
<span id="cb19-201"><a href="#cb19-201"></a></span>
<span id="cb19-202"><a href="#cb19-202"></a><span class="in">```{r visual-hierarchy-quiz}</span></span>
<span id="cb19-203"><a href="#cb19-203"></a><span class="in">#| echo: false</span></span>
<span id="cb19-204"><a href="#cb19-204"></a></span>
<span id="cb19-205"><a href="#cb19-205"></a><span class="in">```</span></span>
<span id="cb19-206"><a href="#cb19-206"></a></span>
<span id="cb19-207"><a href="#cb19-207"></a>:::</span>
<span id="cb19-208"><a href="#cb19-208"></a></span>
<span id="cb19-209"><a href="#cb19-209"></a></span>
<span id="cb19-210"><a href="#cb19-210"></a>We have used some of the principles of visual hierarchy in the maps we have already made. For example, in the density map of bike thefts in Vancouver, we used strong colours to represent the data and shades of grey for the base map. This helped readers intuitively understand that they should focus most attention on the data.</span>
<span id="cb19-211"><a href="#cb19-211"></a></span>
<span id="cb19-212"><a href="#cb19-212"></a></span>
<span id="cb19-213"><a href="#cb19-213"></a></span>
<span id="cb19-214"><a href="#cb19-214"></a><span class="fu">## Supporting elements</span></span>
<span id="cb19-215"><a href="#cb19-215"></a></span>
<span id="cb19-216"><a href="#cb19-216"></a>We can often make our maps much more useful by adding supporting elements that explain the map content, give context or provide extra information. Watch this video to find out what elements you can add to your maps to make them more useful.</span>
<span id="cb19-217"><a href="#cb19-217"></a></span>
<span id="cb19-218"><a href="#cb19-218"></a>{{&lt; video https://youtu.be/uXUeb-qmgTc &gt;}}</span>
<span id="cb19-219"><a href="#cb19-219"></a></span>
<span id="cb19-220"><a href="#cb19-220"></a></span>
<span id="cb19-221"><a href="#cb19-221"></a>::: {.callout-quiz .callout}</span>
<span id="cb19-222"><a href="#cb19-222"></a><span class="fu">#### Supporting elements</span></span>
<span id="cb19-223"><a href="#cb19-223"></a></span>
<span id="cb19-224"><a href="#cb19-224"></a><span class="in">```{r supporting-elements-quiz}</span></span>
<span id="cb19-225"><a href="#cb19-225"></a><span class="in">#| echo: false</span></span>
<span id="cb19-226"><a href="#cb19-226"></a></span>
<span id="cb19-227"><a href="#cb19-227"></a><span class="in">```</span></span>
<span id="cb19-228"><a href="#cb19-228"></a></span>
<span id="cb19-229"><a href="#cb19-229"></a>:::</span>
<span id="cb19-230"><a href="#cb19-230"></a></span>
<span id="cb19-231"><a href="#cb19-231"></a></span>
<span id="cb19-232"><a href="#cb19-232"></a>We will not need to include every supporting element mentioned in the video in all the maps we make. The visual hierarchy that you establish in your map by use of size, colour, etc. should make it clear which elements are most important. The data should always come first in the visual hierarchy, usually followed by the title and then the legend. Other elements should be lower down the hierarchy. In every map, the supporting elements should be designed so that they do not distract from the data.</span>
<span id="cb19-233"><a href="#cb19-233"></a></span>
<span id="cb19-234"><a href="#cb19-234"></a></span>
<span id="cb19-235"><a href="#cb19-235"></a><span class="in">```{r hierarchy-table}</span></span>
<span id="cb19-236"><a href="#cb19-236"></a><span class="in">#| echo: false</span></span>
<span id="cb19-237"><a href="#cb19-237"></a></span>
<span id="cb19-238"><a href="#cb19-238"></a><span class="in">tribble(</span></span>
<span id="cb19-239"><a href="#cb19-239"></a><span class="in">  ~"place in hierarchy", ~"map element", ~"how often needed",</span></span>
<span id="cb19-240"><a href="#cb19-240"></a><span class="in">  "1st", "data layers", "always",</span></span>
<span id="cb19-241"><a href="#cb19-241"></a><span class="in">  "2nd", "title", "virtually always",</span></span>
<span id="cb19-242"><a href="#cb19-242"></a><span class="in">  "3rd", "legend", "usually",</span></span>
<span id="cb19-243"><a href="#cb19-243"></a><span class="in">  "4th", "base map", "almost always",</span></span>
<span id="cb19-244"><a href="#cb19-244"></a><span class="in">  "5th", "author and date", "virtually always",</span></span>
<span id="cb19-245"><a href="#cb19-245"></a><span class="in">  "=6th", "scale", "sometimes",</span></span>
<span id="cb19-246"><a href="#cb19-246"></a><span class="in">  "=6th", "north arrow", "sometimes",</span></span>
<span id="cb19-247"><a href="#cb19-247"></a><span class="in">  "7th", "grid",  "rarely"</span></span>
<span id="cb19-248"><a href="#cb19-248"></a><span class="in">) |&gt; </span></span>
<span id="cb19-249"><a href="#cb19-249"></a><span class="in">  knitr::kable(</span></span>
<span id="cb19-250"><a href="#cb19-250"></a><span class="in">    align = "rll", </span></span>
<span id="cb19-251"><a href="#cb19-251"></a><span class="in">    caption = "Visual hierarchy of elements in a crime map"</span></span>
<span id="cb19-252"><a href="#cb19-252"></a><span class="in">  )</span></span>
<span id="cb19-253"><a href="#cb19-253"></a><span class="in">```</span></span>
<span id="cb19-254"><a href="#cb19-254"></a></span>
<span id="cb19-255"><a href="#cb19-255"></a>Elements that are almost always needed on a crime map are not necessarily highest on the visual hierarchy. For example, the author name is virtually always needed, but is relatively low on the visual hierarchy. This is because it is important information for readers who need it to judge the reliability of a map, or to get in touch to ask questions, but should not distract from the data for those readers who do not need it.</span>
<span id="cb19-256"><a href="#cb19-256"></a></span>
<span id="cb19-257"><a href="#cb19-257"></a>Before we start learning the code needed to add titles and legends to our maps, watch this video walk-though of the main steps.</span>
<span id="cb19-258"><a href="#cb19-258"></a></span>
<span id="cb19-259"><a href="#cb19-259"></a>{{&lt; video https://youtu.be/P3L9yHc8H-8 &gt;}}</span>
<span id="cb19-260"><a href="#cb19-260"></a></span>
<span id="cb19-261"><a href="#cb19-261"></a></span>
<span id="cb19-262"><a href="#cb19-262"></a></span>
<span id="cb19-263"><a href="#cb19-263"></a><span class="fu">## Creating and storing a map</span></span>
<span id="cb19-264"><a href="#cb19-264"></a></span>
<span id="cb19-265"><a href="#cb19-265"></a>Since we will be adding various elements to a map in this chapter, we will first create a map and save it as an R object. Any map or chart produced using the <span class="in">`ggplot()`</span> function can be saved as an object using the assignment operator <span class="in">`&lt;-`</span>. Just as for the result of any other R function, if we save it to an object the result will not be printed to the screen, but we can easily see the plot by simply typing the object name in the R console.</span>
<span id="cb19-266"><a href="#cb19-266"></a></span>
<span id="cb19-267"><a href="#cb19-267"></a>Create a new R script file (in RStudio: <span class="in">`File &gt; New File &gt; R Script`</span>) and save the file in your project directory as <span class="in">`chapter_07.R`</span>. Paste this code into it and run that code so that we can use it as the basis for the maps we will make during the rest of the chapter.</span>
<span id="cb19-268"><a href="#cb19-268"></a></span>
<span id="cb19-271"><a href="#cb19-271"></a><span class="in">```{r}</span></span>
<span id="cb19-272"><a href="#cb19-272"></a><span class="co">#| eval: false</span></span>
<span id="cb19-273"><a href="#cb19-273"></a><span class="co">#| filename: "chapter_07.R"</span></span>
<span id="cb19-274"><a href="#cb19-274"></a></span>
<span id="cb19-275"><a href="#cb19-275"></a><span class="co"># Load packages</span></span>
<span id="cb19-276"><a href="#cb19-276"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggspatial, sf, sfhotspot, tidyverse)</span>
<span id="cb19-277"><a href="#cb19-277"></a></span>
<span id="cb19-278"><a href="#cb19-278"></a><span class="co"># Load shootings data and transform it to use an appropriate co-ordinate system</span></span>
<span id="cb19-279"><a href="#cb19-279"></a>shootings <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb19-280"><a href="#cb19-280"></a>  <span class="st">"https://mpjashby.github.io/crimemappingdata/bronx_shootings.csv"</span>, </span>
<span id="cb19-281"><a href="#cb19-281"></a>  <span class="at">show_col_types =</span> <span class="cn">FALSE</span></span>
<span id="cb19-282"><a href="#cb19-282"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb19-283"><a href="#cb19-283"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="st">"EPSG:4326"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-284"><a href="#cb19-284"></a>  <span class="fu">st_transform</span>(<span class="st">"EPSG:6538"</span>)</span>
<span id="cb19-285"><a href="#cb19-285"></a></span>
<span id="cb19-286"><a href="#cb19-286"></a><span class="co"># Load NYC police precincts data</span></span>
<span id="cb19-287"><a href="#cb19-287"></a>precincts <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/nyc_precincts.gpkg"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-288"><a href="#cb19-288"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb19-289"><a href="#cb19-289"></a>  <span class="co"># Filter just those precincts that are in the Bronx (40th to 52nd)</span></span>
<span id="cb19-290"><a href="#cb19-290"></a>  <span class="fu">filter</span>(precinct <span class="sc">%in%</span> <span class="dv">40</span><span class="sc">:</span><span class="dv">52</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-291"><a href="#cb19-291"></a>  <span class="fu">st_transform</span>(<span class="st">"EPSG:6538"</span>)</span>
<span id="cb19-292"><a href="#cb19-292"></a></span>
<span id="cb19-293"><a href="#cb19-293"></a><span class="co"># Calculate KDE</span></span>
<span id="cb19-294"><a href="#cb19-294"></a>shootings_kde <span class="ot">&lt;-</span> shootings <span class="sc">|&gt;</span> </span>
<span id="cb19-295"><a href="#cb19-295"></a>  <span class="fu">hotspot_kde</span>(</span>
<span id="cb19-296"><a href="#cb19-296"></a>    <span class="at">grid =</span> <span class="fu">hotspot_grid</span>(precincts, <span class="at">cell_size =</span> <span class="dv">100</span>), </span>
<span id="cb19-297"><a href="#cb19-297"></a>    <span class="at">bandwidth_adjust =</span> <span class="fl">0.33</span>,</span>
<span id="cb19-298"><a href="#cb19-298"></a>    <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb19-299"><a href="#cb19-299"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb19-300"><a href="#cb19-300"></a>  <span class="fu">st_intersection</span>(precincts)</span>
<span id="cb19-301"><a href="#cb19-301"></a></span>
<span id="cb19-302"><a href="#cb19-302"></a><span class="co"># Create map object</span></span>
<span id="cb19-303"><a href="#cb19-303"></a>shootings_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-304"><a href="#cb19-304"></a>  <span class="fu">annotation_map_tile</span>(<span class="at">type =</span> <span class="st">"cartolight"</span>, <span class="at">zoomin =</span> <span class="dv">0</span>, <span class="at">progress =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb19-305"><a href="#cb19-305"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> kde), <span class="at">data =</span> shootings_kde, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">colour =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb19-306"><a href="#cb19-306"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> precincts, <span class="at">colour =</span> <span class="st">"grey33"</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb19-307"><a href="#cb19-307"></a>  <span class="fu">geom_sf_label</span>(</span>
<span id="cb19-308"><a href="#cb19-308"></a>    <span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">ordinal</span>(precinct)), </span>
<span id="cb19-309"><a href="#cb19-309"></a>    <span class="at">data =</span> precincts,</span>
<span id="cb19-310"><a href="#cb19-310"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>, </span>
<span id="cb19-311"><a href="#cb19-311"></a>    <span class="at">colour =</span> <span class="st">"grey33"</span>, </span>
<span id="cb19-312"><a href="#cb19-312"></a>    <span class="at">size =</span> <span class="fl">2.5</span>, </span>
<span id="cb19-313"><a href="#cb19-313"></a>    <span class="at">label.size =</span> <span class="cn">NA</span></span>
<span id="cb19-314"><a href="#cb19-314"></a>  ) <span class="sc">+</span></span>
<span id="cb19-315"><a href="#cb19-315"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"PuBu"</span>, <span class="at">direction =</span> <span class="dv">1</span>)</span>
<span id="cb19-316"><a href="#cb19-316"></a><span class="in">```</span></span>
<span id="cb19-317"><a href="#cb19-317"></a></span>
<span id="cb19-320"><a href="#cb19-320"></a><span class="in">```{r}</span></span>
<span id="cb19-321"><a href="#cb19-321"></a><span class="co">#| echo: false</span></span>
<span id="cb19-322"><a href="#cb19-322"></a></span>
<span id="cb19-323"><a href="#cb19-323"></a><span class="co"># Load packages</span></span>
<span id="cb19-324"><a href="#cb19-324"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggspatial, sf, sfhotspot, tidyverse)</span>
<span id="cb19-325"><a href="#cb19-325"></a></span>
<span id="cb19-326"><a href="#cb19-326"></a><span class="co"># Load shootings data and transform it to use an appropriate co-ordinate system</span></span>
<span id="cb19-327"><a href="#cb19-327"></a>shootings <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb19-328"><a href="#cb19-328"></a>  <span class="st">"https://mpjashby.github.io/crimemappingdata/bronx_shootings.csv"</span>, </span>
<span id="cb19-329"><a href="#cb19-329"></a>  <span class="at">show_col_types =</span> <span class="cn">FALSE</span></span>
<span id="cb19-330"><a href="#cb19-330"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb19-331"><a href="#cb19-331"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="st">"EPSG:4326"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-332"><a href="#cb19-332"></a>  <span class="fu">st_transform</span>(<span class="st">"EPSG:6538"</span>)</span>
<span id="cb19-333"><a href="#cb19-333"></a></span>
<span id="cb19-334"><a href="#cb19-334"></a><span class="co"># Load NYC police precincts data</span></span>
<span id="cb19-335"><a href="#cb19-335"></a>precincts <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"https://mpjashby.github.io/crimemappingdata/nyc_precincts.gpkg"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-336"><a href="#cb19-336"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb19-337"><a href="#cb19-337"></a>  <span class="co"># Filter just those precincts that are in the Bronx (40th to 52nd)</span></span>
<span id="cb19-338"><a href="#cb19-338"></a>  <span class="fu">filter</span>(precinct <span class="sc">%in%</span> <span class="dv">40</span><span class="sc">:</span><span class="dv">52</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-339"><a href="#cb19-339"></a>  <span class="fu">st_transform</span>(<span class="st">"EPSG:6538"</span>)</span>
<span id="cb19-340"><a href="#cb19-340"></a></span>
<span id="cb19-341"><a href="#cb19-341"></a><span class="co"># Calculate KDE</span></span>
<span id="cb19-342"><a href="#cb19-342"></a>shootings_kde <span class="ot">&lt;-</span> shootings <span class="sc">|&gt;</span> </span>
<span id="cb19-343"><a href="#cb19-343"></a>  <span class="fu">hotspot_kde</span>(</span>
<span id="cb19-344"><a href="#cb19-344"></a>    <span class="at">grid =</span> <span class="fu">hotspot_grid</span>(precincts, <span class="at">cell_size =</span> <span class="dv">100</span>), </span>
<span id="cb19-345"><a href="#cb19-345"></a>    <span class="at">bandwidth_adjust =</span> <span class="fl">0.33</span>,</span>
<span id="cb19-346"><a href="#cb19-346"></a>    <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb19-347"><a href="#cb19-347"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb19-348"><a href="#cb19-348"></a>  <span class="fu">st_intersection</span>(precincts)</span>
<span id="cb19-349"><a href="#cb19-349"></a></span>
<span id="cb19-350"><a href="#cb19-350"></a><span class="co"># Create map object</span></span>
<span id="cb19-351"><a href="#cb19-351"></a>shootings_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-352"><a href="#cb19-352"></a>  <span class="co"># Add base map</span></span>
<span id="cb19-353"><a href="#cb19-353"></a>  <span class="fu">annotation_map_tile</span>(<span class="at">type =</span> <span class="st">"cartolight"</span>, <span class="at">zoomin =</span> <span class="dv">0</span>, <span class="at">progress =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb19-354"><a href="#cb19-354"></a>  <span class="co"># Add density layer</span></span>
<span id="cb19-355"><a href="#cb19-355"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> kde), <span class="at">data =</span> shootings_kde, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">colour =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb19-356"><a href="#cb19-356"></a>  <span class="co"># Add precinct boundaries</span></span>
<span id="cb19-357"><a href="#cb19-357"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> precincts, <span class="at">colour =</span> <span class="st">"grey33"</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb19-358"><a href="#cb19-358"></a>  <span class="co"># Add precinct labels</span></span>
<span id="cb19-359"><a href="#cb19-359"></a>  <span class="fu">geom_sf_label</span>(</span>
<span id="cb19-360"><a href="#cb19-360"></a>    <span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">ordinal</span>(precinct)), </span>
<span id="cb19-361"><a href="#cb19-361"></a>    <span class="at">data =</span> precincts,</span>
<span id="cb19-362"><a href="#cb19-362"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>, </span>
<span id="cb19-363"><a href="#cb19-363"></a>    <span class="at">colour =</span> <span class="st">"grey33"</span>, </span>
<span id="cb19-364"><a href="#cb19-364"></a>    <span class="at">size =</span> <span class="fl">2.5</span>, </span>
<span id="cb19-365"><a href="#cb19-365"></a>    <span class="at">label.size =</span> <span class="cn">NA</span></span>
<span id="cb19-366"><a href="#cb19-366"></a>  ) <span class="sc">+</span></span>
<span id="cb19-367"><a href="#cb19-367"></a>  <span class="co"># Specify colours used to show density of crime</span></span>
<span id="cb19-368"><a href="#cb19-368"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"PuBu"</span>, <span class="at">direction =</span> <span class="dv">1</span>)</span>
<span id="cb19-369"><a href="#cb19-369"></a><span class="in">```</span></span>
<span id="cb19-370"><a href="#cb19-370"></a></span>
<span id="cb19-371"><a href="#cb19-371"></a>To view the map in RStudio, we can just type the name of the map object we have just created into the R Console and press <span class="in">`Enter`</span>/<span class="in">`Return`</span>.</span>
<span id="cb19-372"><a href="#cb19-372"></a></span>
<span id="cb19-375"><a href="#cb19-375"></a><span class="in">```{r}</span></span>
<span id="cb19-376"><a href="#cb19-376"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb19-377"><a href="#cb19-377"></a></span>
<span id="cb19-378"><a href="#cb19-378"></a>shootings_map</span>
<span id="cb19-379"><a href="#cb19-379"></a><span class="in">```</span></span>
<span id="cb19-380"><a href="#cb19-380"></a></span>
<span id="cb19-381"><a href="#cb19-381"></a>The code used to create this map is very similar to the code we used in one of the previous chapters to make a map of bike theft in Vancouver, although there are a few differences.</span>
<span id="cb19-382"><a href="#cb19-382"></a></span>
<span id="cb19-383"><a href="#cb19-383"></a>Looking at line 22 of the code above, we have used the <span class="in">`grid`</span> argument to the <span class="in">`hotspot_kde()`</span> function, specifying <span class="in">`hotspot_grid(precincts, cell_size = 100)`</span>. By default, <span class="in">`hotspot_kde()`</span> calculates density estimates (KDE values) for every grid cell within the area covered by the crime data. This is fine when at least a few crimes have occurred in all the parts of the area for which we have data. But if crime is heavily concentrated in a few places and there are large areas with no crimes, the density layer will not cover the whole area for which we have data. In this case, it is important to extend the density layer manually to make it clear that the apparent low density of crime in some places is due to a genuine lack of crime there, rather than because we do not have data for those places.</span>
<span id="cb19-384"><a href="#cb19-384"></a></span>
<span id="cb19-385"><a href="#cb19-385"></a>We can do this by providing <span class="in">`hotspot_kde()`</span> with a grid of cells for which KDE values should be calculated, rather than letting <span class="in">`hotspot_kde()`</span> do this automatically. In the code above, we have used the <span class="in">`hotspot_grid()`</span> function to create a grid that covers all the precincts in the Bronx (the area we have data for), and then passed the resulting grid to the <span class="in">`grid`</span> argument of <span class="in">`hotspot_kde()`</span>. This ensures that KDE values are calculated for every part of the Bronx.</span>
<span id="cb19-386"><a href="#cb19-386"></a></span>
<span id="cb19-387"><a href="#cb19-387"></a>&lt;a href="https://scales.r-lib.org" title="scales website"&gt;&lt;img src="../images/scales.png" class="right-side-image"&gt;&lt;/a&gt;</span>
<span id="cb19-388"><a href="#cb19-388"></a></span>
<span id="cb19-389"><a href="#cb19-389"></a>The only other difference from the Vancouver map is that we have used the <span class="in">`ordinal()`</span> function from the <span class="co">[</span><span class="ot">scales package</span><span class="co">](https://scales.r-lib.org)</span> to convert the precinct numbers to ordinal numbers (1st, 2nd, 3rd, etc.) for the map labels. This is because police precincts in New York City are usually referred to using ordinal numbers (e.g. "the 1st Precinct" rather than "Precinct 1") and it will be easier for people to read the map if it uses terms they are familiar with.</span>
<span id="cb19-390"><a href="#cb19-390"></a></span>
<span id="cb19-391"><a href="#cb19-391"></a></span>
<span id="cb19-392"><a href="#cb19-392"></a>::: {.callout-important}</span>
<span id="cb19-393"><a href="#cb19-393"></a><span class="fu">#### Don't always use ordinal numbers for labels</span></span>
<span id="cb19-394"><a href="#cb19-394"></a></span>
<span id="cb19-395"><a href="#cb19-395"></a>We are using ordinal numbers (1st, 2nd, etc.) for the labels because that is how police precinct numbers are usually expressed in New York City. That does not mean that we should always use wrap map labels in the <span class="in">`ordinal()`</span> function. How we present map labels (and every other type of information on a map) depends on what is best for the audience we are making the map for.</span>
<span id="cb19-396"><a href="#cb19-396"></a>:::</span>
<span id="cb19-397"><a href="#cb19-397"></a></span>
<span id="cb19-398"><a href="#cb19-398"></a></span>
<span id="cb19-399"><a href="#cb19-399"></a>There are many other functions in the scales package that format numbers in different ways, including <span class="in">`comma()`</span> to add thousands separators to numbers and <span class="in">`dollar()`</span> to format numbers as values in dollars or other currencies. There is a <span class="co">[</span><span class="ot">full list of scales functions on the package website</span><span class="co">](https://scales.r-lib.org/reference/)</span>.</span>
<span id="cb19-400"><a href="#cb19-400"></a></span>
<span id="cb19-401"><a href="#cb19-401"></a>We now have a basic map of shootings in the Bronx. This map isn't good enough on its own, but we can use it to learn how to add supporting elements to a map.</span>
<span id="cb19-402"><a href="#cb19-402"></a></span>
<span id="cb19-403"><a href="#cb19-403"></a></span>
<span id="cb19-404"><a href="#cb19-404"></a></span>
<span id="cb19-405"><a href="#cb19-405"></a><span class="fu">## ggplot2 themes</span></span>
<span id="cb19-406"><a href="#cb19-406"></a></span>
<span id="cb19-407"><a href="#cb19-407"></a>So far we have learned about several families of functions we can add to a <span class="in">`ggplot()`</span> stack to help construct a map. For example, we have learned about the <span class="in">`geom_*()`</span> family of functions for adding data layers to a map and the <span class="in">`scale_*()`</span> family of functions for controlling how different data values are visually represented. Now we need to learn about another family: _themes_.</span>
<span id="cb19-408"><a href="#cb19-408"></a></span>
<span id="cb19-409"><a href="#cb19-409"></a>Themes in ggplot2 affect how the supporting elements of a map appear. By supporting elements, we mean all the parts of the map that don't depend on the data. Supporting elements include titles, axes and legends.</span>
<span id="cb19-410"><a href="#cb19-410"></a></span>
<span id="cb19-411"><a href="#cb19-411"></a>There are many different themes that you can add to a <span class="in">`ggplot()`</span> stack. Some of these are built into the ggplot2 package, and some are part of other packages that extend what ggplot2 can do. Some organisations (such as the BBC) have <span class="co">[</span><span class="ot">their own ggplot2 themes</span><span class="co">](https://github.com/bbc/bbplot)</span> for creating maps and charts that follow their corporate style guide.</span>
<span id="cb19-412"><a href="#cb19-412"></a></span>
<span id="cb19-413"><a href="#cb19-413"></a>Different themes can give maps (and charts) very different appearances, even when they use the same data. For example, these four maps show what happens when different themes are applied to the end of the same <span class="in">`ggplot()`</span> stack:</span>
<span id="cb19-414"><a href="#cb19-414"></a></span>
<span id="cb19-417"><a href="#cb19-417"></a><span class="in">```{r}</span></span>
<span id="cb19-418"><a href="#cb19-418"></a><span class="co">#| echo: false</span></span>
<span id="cb19-419"><a href="#cb19-419"></a><span class="co">#| fig-asp: 1</span></span>
<span id="cb19-420"><a href="#cb19-420"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb19-421"><a href="#cb19-421"></a></span>
<span id="cb19-422"><a href="#cb19-422"></a><span class="co"># Create map object</span></span>
<span id="cb19-423"><a href="#cb19-423"></a>shootings_map_themes <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-424"><a href="#cb19-424"></a>  <span class="fu">annotation_map_tile</span>(<span class="at">type =</span> <span class="st">"cartolight"</span>, <span class="at">zoomin =</span> <span class="dv">0</span>, <span class="at">progress =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb19-425"><a href="#cb19-425"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> kde), <span class="at">data =</span> shootings_kde, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">colour =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb19-426"><a href="#cb19-426"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> precincts, <span class="at">colour =</span> <span class="st">"grey33"</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb19-427"><a href="#cb19-427"></a>  <span class="fu">scale_fill_distiller</span>(</span>
<span id="cb19-428"><a href="#cb19-428"></a>    <span class="at">palette =</span> <span class="st">"PuBu"</span>,</span>
<span id="cb19-429"><a href="#cb19-429"></a>    <span class="at">breaks =</span> <span class="fu">range</span>(<span class="fu">pull</span>(shootings_kde, <span class="st">"kde"</span>)), </span>
<span id="cb19-430"><a href="#cb19-430"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"lower"</span>, <span class="st">"higher"</span>),</span>
<span id="cb19-431"><a href="#cb19-431"></a>    <span class="at">direction =</span> <span class="dv">1</span></span>
<span id="cb19-432"><a href="#cb19-432"></a>  )</span>
<span id="cb19-433"><a href="#cb19-433"></a></span>
<span id="cb19-434"><a href="#cb19-434"></a>custom_theme_elements <span class="ot">&lt;-</span> <span class="fu">theme</span>(</span>
<span id="cb19-435"><a href="#cb19-435"></a>  <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb19-436"><a href="#cb19-436"></a>  <span class="at">plot.title.position =</span> <span class="st">"plot"</span></span>
<span id="cb19-437"><a href="#cb19-437"></a>)</span>
<span id="cb19-438"><a href="#cb19-438"></a></span>
<span id="cb19-439"><a href="#cb19-439"></a>plot_theme1 <span class="ot">&lt;-</span> shootings_map_themes <span class="sc">+</span> </span>
<span id="cb19-440"><a href="#cb19-440"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"theme_grey()"</span>) <span class="sc">+</span> </span>
<span id="cb19-441"><a href="#cb19-441"></a>  <span class="fu">theme_grey</span>() <span class="sc">+</span></span>
<span id="cb19-442"><a href="#cb19-442"></a>  custom_theme_elements</span>
<span id="cb19-443"><a href="#cb19-443"></a>plot_theme2 <span class="ot">&lt;-</span> shootings_map_themes <span class="sc">+</span> </span>
<span id="cb19-444"><a href="#cb19-444"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"theme_classic()"</span>) <span class="sc">+</span> </span>
<span id="cb19-445"><a href="#cb19-445"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb19-446"><a href="#cb19-446"></a>  custom_theme_elements</span>
<span id="cb19-447"><a href="#cb19-447"></a>plot_theme3 <span class="ot">&lt;-</span> shootings_map_themes <span class="sc">+</span> </span>
<span id="cb19-448"><a href="#cb19-448"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"theme_wsj()"</span>) <span class="sc">+</span> </span>
<span id="cb19-449"><a href="#cb19-449"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_wsj</span>() <span class="sc">+</span></span>
<span id="cb19-450"><a href="#cb19-450"></a>  custom_theme_elements</span>
<span id="cb19-451"><a href="#cb19-451"></a>plot_theme4 <span class="ot">&lt;-</span> shootings_map_themes <span class="sc">+</span> </span>
<span id="cb19-452"><a href="#cb19-452"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"theme_void()"</span>) <span class="sc">+</span> </span>
<span id="cb19-453"><a href="#cb19-453"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb19-454"><a href="#cb19-454"></a>  custom_theme_elements</span>
<span id="cb19-455"><a href="#cb19-455"></a></span>
<span id="cb19-456"><a href="#cb19-456"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb19-457"><a href="#cb19-457"></a>  plot_theme1, </span>
<span id="cb19-458"><a href="#cb19-458"></a>  plot_theme2, </span>
<span id="cb19-459"><a href="#cb19-459"></a>  plot_theme3, </span>
<span id="cb19-460"><a href="#cb19-460"></a>  plot_theme4,</span>
<span id="cb19-461"><a href="#cb19-461"></a>  <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb19-462"><a href="#cb19-462"></a>)</span>
<span id="cb19-463"><a href="#cb19-463"></a><span class="in">```</span></span>
<span id="cb19-464"><a href="#cb19-464"></a></span>
<span id="cb19-465"><a href="#cb19-465"></a>You can see that the differences between <span class="in">`theme_grey()`</span> (the default theme) and <span class="in">`theme_classic()`</span> are quite subtle, but in other cases (such as <span class="in">`theme_wsj()`</span> -- a theme following the house style of the _Wall Street Journal_ newspaper) the differences are quite substantial.</span>
<span id="cb19-466"><a href="#cb19-466"></a></span>
<span id="cb19-467"><a href="#cb19-467"></a>Three of the themes shown above add x (horizontal) and y (vertical) axis labels to the map. Axis labels are very useful for most types of plot, but usually not for maps. It's very unlikely that someone looking at this map of shootings in the Bronx will benefit from knowing that the map covers the area from 40.80 degrees north of the equator to 40.92 degrees north. For this reason, when we make a map we will usually add <span class="in">`theme_void()`</span> to our <span class="in">`ggplot()`</span> stacks, since this removes unnecessary elements such as axis labels. Removing these elements is useful because it allows readers to focus more on the parts of the map that convey useful information.</span>
<span id="cb19-468"><a href="#cb19-468"></a></span>
<span id="cb19-469"><a href="#cb19-469"></a></span>
<span id="cb19-470"><a href="#cb19-470"></a>::: {.callout-quiz .callout}</span>
<span id="cb19-471"><a href="#cb19-471"></a><span class="fu">#### ggplot2 themes</span></span>
<span id="cb19-472"><a href="#cb19-472"></a></span>
<span id="cb19-473"><a href="#cb19-473"></a><span class="in">```{r themes-quiz}</span></span>
<span id="cb19-474"><a href="#cb19-474"></a><span class="in">#| echo: false</span></span>
<span id="cb19-475"><a href="#cb19-475"></a></span>
<span id="cb19-476"><a href="#cb19-476"></a><span class="in">themes_quiz1 &lt;- c(</span></span>
<span id="cb19-477"><a href="#cb19-477"></a><span class="in">  "The data layers on the map, such as the density layer.",</span></span>
<span id="cb19-478"><a href="#cb19-478"></a><span class="in">  answer = "The non-data elements, like titles and axis labels.",</span></span>
<span id="cb19-479"><a href="#cb19-479"></a><span class="in">  "The scale of the map.",</span></span>
<span id="cb19-480"><a href="#cb19-480"></a><span class="in">  "What style of base map will be used in the map."</span></span>
<span id="cb19-481"><a href="#cb19-481"></a><span class="in">)</span></span>
<span id="cb19-482"><a href="#cb19-482"></a></span>
<span id="cb19-483"><a href="#cb19-483"></a><span class="in">themes_quiz2 &lt;- c(</span></span>
<span id="cb19-484"><a href="#cb19-484"></a><span class="in">  "It removes the title from the map.",</span></span>
<span id="cb19-485"><a href="#cb19-485"></a><span class="in">  "It changes the color of the map background.",</span></span>
<span id="cb19-486"><a href="#cb19-486"></a><span class="in">  "It places gridlines on top of the data layers.",</span></span>
<span id="cb19-487"><a href="#cb19-487"></a><span class="in">  answer = "It removes unnecessary elements like axis labels."</span></span>
<span id="cb19-488"><a href="#cb19-488"></a><span class="in">)</span></span>
<span id="cb19-489"><a href="#cb19-489"></a><span class="in">```</span></span>
<span id="cb19-490"><a href="#cb19-490"></a></span>
<span id="cb19-491"><a href="#cb19-491"></a></span>
<span id="cb19-492"><a href="#cb19-492"></a>**What parts of the map are controlled by the function we choose from the `theme_*()` family?**</span>
<span id="cb19-493"><a href="#cb19-493"></a></span>
<span id="cb19-494"><a href="#cb19-494"></a><span class="in">`r webexercises::longmcq(themes_quiz1)`</span></span>
<span id="cb19-495"><a href="#cb19-495"></a></span>
<span id="cb19-496"><a href="#cb19-496"></a></span>
<span id="cb19-497"><a href="#cb19-497"></a>**What does the `theme_void()` function do in a map created using ggplot2?**</span>
<span id="cb19-498"><a href="#cb19-498"></a></span>
<span id="cb19-499"><a href="#cb19-499"></a><span class="in">`r webexercises::longmcq(themes_quiz2)`</span></span>
<span id="cb19-500"><a href="#cb19-500"></a></span>
<span id="cb19-501"><a href="#cb19-501"></a></span>
<span id="cb19-502"><a href="#cb19-502"></a>:::</span>
<span id="cb19-503"><a href="#cb19-503"></a></span>
<span id="cb19-504"><a href="#cb19-504"></a></span>
<span id="cb19-505"><a href="#cb19-505"></a><span class="fu">## Titles {#sec-titles}</span></span>
<span id="cb19-506"><a href="#cb19-506"></a></span>
<span id="cb19-507"><a href="#cb19-507"></a>A map title is one of the most important ways to add context to a map. Titles can either be _descriptive_ or _declarative_. Descriptive titles simply state what data are shown on the map. For example, we might give our map the title "Shootings in the Bronx, 2019". Declarative titles, on the other hand, state what you think the main conclusion should be that readers remember about the map. For example, we might use the title "Shootings are focused in the South Bronx".</span>
<span id="cb19-508"><a href="#cb19-508"></a></span>
<span id="cb19-509"><a href="#cb19-509"></a>Declarative titles are usually more useful than descriptive titles because they help the reader to interpret the map. But writing a good declarative title is harder than writing a descriptive title, because it requires you to think about what is the main point that you want to make with the map. To help you come up with a good declarative title, you might want to try several different titles so that you can choose the one that communicates your message most clearly.</span>
<span id="cb19-510"><a href="#cb19-510"></a></span>
<span id="cb19-511"><a href="#cb19-511"></a>We can add a title to our map using the <span class="in">`labs()`</span> (short for 'labels') function from the ggplot2 package. We can use <span class="in">`labs()`</span> to add labels to various different parts of a map or plot, but for now we will just use the argument <span class="in">`title`</span> to set the title. </span>
<span id="cb19-512"><a href="#cb19-512"></a></span>
<span id="cb19-513"><a href="#cb19-513"></a>To see how this works, run the following code in the R Console. Since we have stored the rest of the <span class="in">`ggplot()`</span> stack in the <span class="in">`shootings_map`</span> object, this code is equivalent to adding <span class="in">`labs()`</span> to the end of the original stack. This code also adds <span class="in">`theme_void()`</span> to the stack.</span>
<span id="cb19-514"><a href="#cb19-514"></a></span>
<span id="cb19-517"><a href="#cb19-517"></a><span class="in">```{r}</span></span>
<span id="cb19-518"><a href="#cb19-518"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb19-519"><a href="#cb19-519"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb19-520"><a href="#cb19-520"></a></span>
<span id="cb19-521"><a href="#cb19-521"></a>shootings_map <span class="sc">+</span> </span>
<span id="cb19-522"><a href="#cb19-522"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>) <span class="sc">+</span></span>
<span id="cb19-523"><a href="#cb19-523"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb19-524"><a href="#cb19-524"></a><span class="in">```</span></span>
<span id="cb19-525"><a href="#cb19-525"></a></span>
<span id="cb19-526"><a href="#cb19-526"></a>Sometimes our preferred title might be too long to fit on a map. In this case, we can break the title across two or more lines. We can do this manually by adding the characters <span class="in">`\n`</span> (the character code for a new line) at the point where we want the text to start a new line. Alternatively, we can use the <span class="in">`str_wrap()`</span> function from the stringr package to wrap the text automatically into lines of a given maximum length (specified using the <span class="in">`wrap`</span> argument).</span>
<span id="cb19-527"><a href="#cb19-527"></a></span>
<span id="cb19-528"><a href="#cb19-528"></a>When you use a declarative title for your map, it is often useful to provide a _subtitle_ containing descriptive information. Adding a subtitle is very easy using the <span class="in">`subtitle`</span> argument to the <span class="in">`labs()`</span> function. </span>
<span id="cb19-529"><a href="#cb19-529"></a></span>
<span id="cb19-532"><a href="#cb19-532"></a><span class="in">```{r}</span></span>
<span id="cb19-533"><a href="#cb19-533"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb19-534"><a href="#cb19-534"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb19-535"><a href="#cb19-535"></a></span>
<span id="cb19-536"><a href="#cb19-536"></a>shootings_map <span class="sc">+</span> </span>
<span id="cb19-537"><a href="#cb19-537"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-538"><a href="#cb19-538"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb19-539"><a href="#cb19-539"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span></span>
<span id="cb19-540"><a href="#cb19-540"></a>  ) <span class="sc">+</span></span>
<span id="cb19-541"><a href="#cb19-541"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb19-542"><a href="#cb19-542"></a><span class="in">```</span></span>
<span id="cb19-543"><a href="#cb19-543"></a></span>
<span id="cb19-544"><a href="#cb19-544"></a></span>
<span id="cb19-545"><a href="#cb19-545"></a></span>
<span id="cb19-546"><a href="#cb19-546"></a><span class="fu">### Using captions to add author and other information {#sec-captions}</span></span>
<span id="cb19-547"><a href="#cb19-547"></a></span>
<span id="cb19-548"><a href="#cb19-548"></a>The <span class="in">`labs()`</span> function has another argument that we can use to add text to our map for context. The <span class="in">`caption`</span> argument is used to add information such as the author, date and source of the data to a map or chart. We can put any information we like into the caption, using <span class="in">`str_wrap()`</span> or the new-line character <span class="in">`\n`</span> if necessary to stop the text overflowing the map.</span>
<span id="cb19-549"><a href="#cb19-549"></a></span>
<span id="cb19-550"><a href="#cb19-550"></a>Run this code in the R Console and see where on the map the new information appears.</span>
<span id="cb19-551"><a href="#cb19-551"></a></span>
<span id="cb19-554"><a href="#cb19-554"></a><span class="in">```{r}</span></span>
<span id="cb19-555"><a href="#cb19-555"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb19-556"><a href="#cb19-556"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb19-557"><a href="#cb19-557"></a></span>
<span id="cb19-558"><a href="#cb19-558"></a>shootings_map <span class="sc">+</span> </span>
<span id="cb19-559"><a href="#cb19-559"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-560"><a href="#cb19-560"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb19-561"><a href="#cb19-561"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span>,</span>
<span id="cb19-562"><a href="#cb19-562"></a>    <span class="at">caption =</span> <span class="fu">str_glue</span>(</span>
<span id="cb19-563"><a href="#cb19-563"></a>      <span class="st">"Author: Joe Bloggs, Date produced: {today()},</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb19-564"><a href="#cb19-564"></a>      <span class="st">"Data: https://data.cityofnewyork.us/d/833y-fsy8</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb19-565"><a href="#cb19-565"></a>      <span class="st">"Map data from OpenStreetMap"</span></span>
<span id="cb19-566"><a href="#cb19-566"></a>    )</span>
<span id="cb19-567"><a href="#cb19-567"></a>  ) <span class="sc">+</span></span>
<span id="cb19-568"><a href="#cb19-568"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb19-569"><a href="#cb19-569"></a><span class="in">```</span></span>
<span id="cb19-570"><a href="#cb19-570"></a></span>
<span id="cb19-571"><a href="#cb19-571"></a>You will have seen that the caption appears below the map, in smaller text. The positioning and size of the caption help to move it down the visual hierarchy, since information like the date the map was made is not as important as the (declarative) map title.</span>
<span id="cb19-572"><a href="#cb19-572"></a></span>
<span id="cb19-573"><a href="#cb19-573"></a>The code for the caption also uses the <span class="in">`str_glue()`</span> function from the <span class="in">`stringr`</span> package. <span class="in">`str_glue()`</span> glues together any number of character strings separated by commas -- in this case, we have split the caption into two separate character strings (on separate lines) so that the lines of code do not become too long to easily read.</span>
<span id="cb19-574"><a href="#cb19-574"></a></span>
<span id="cb19-575"><a href="#cb19-575"></a><span class="in">`str_glue()`</span> can also include the values of R objects and the results of R functions that are placed inside braces (<span class="in">`{}`</span>). So the code <span class="in">`{today()}`</span> runs the function <span class="in">`today()`</span> from the lubridate package (part of the tidyverse) and glues the result (the current date) into the text.</span>
<span id="cb19-576"><a href="#cb19-576"></a></span>
<span id="cb19-577"><a href="#cb19-577"></a></span>
<span id="cb19-578"><a href="#cb19-578"></a>::: {.callout-important}</span>
<span id="cb19-579"><a href="#cb19-579"></a><span class="fu">#### Acknowledging the data you use</span></span>
<span id="cb19-580"><a href="#cb19-580"></a></span>
<span id="cb19-581"><a href="#cb19-581"></a>When you use data to make maps, the data provider will often require you to acknowledge the source of that data. This is a legal requirement so it is important that you do this when required.</span>
<span id="cb19-582"><a href="#cb19-582"></a></span>
<span id="cb19-583"><a href="#cb19-583"></a>The base maps we use in this course use data from OpenStreetMap, which  <span class="co">[</span><span class="ot">requires</span><span class="co">](https://wiki.osmfoundation.org/wiki/Licence/Attribution_Guidelines)</span> people using its data to acknowledge that they have done so. The easiest way to do this is to add the text "Map data from OpenStreetMap" to the <span class="in">`caption`</span> of your maps if they use base maps from OpenStreetMap.</span>
<span id="cb19-584"><a href="#cb19-584"></a></span>
<span id="cb19-585"><a href="#cb19-585"></a>:::</span>
<span id="cb19-586"><a href="#cb19-586"></a></span>
<span id="cb19-587"><a href="#cb19-587"></a></span>
<span id="cb19-588"><a href="#cb19-588"></a><span class="fu">### Changing the appearance of titles and captions</span></span>
<span id="cb19-589"><a href="#cb19-589"></a></span>
<span id="cb19-590"><a href="#cb19-590"></a>We have added a title, subtitle and caption to our map, but you might not be happy with their appearance. You might want, for example, to move the caption further down the visual hierarchy by making the text smaller and/or a lighter colour, or add some space between the subtitle and the map itself.</span>
<span id="cb19-591"><a href="#cb19-591"></a></span>
<span id="cb19-592"><a href="#cb19-592"></a>We can exercise almost complete control over the supporting elements of maps or charts made with <span class="in">`ggplot()`</span> using the <span class="in">`theme()`</span> function. <span class="in">`theme()`</span> allows us to make changes to the settings that are applied by the <span class="in">`theme_*()`</span> family of functions (such as <span class="in">`theme_void()`</span>). </span>
<span id="cb19-593"><a href="#cb19-593"></a></span>
<span id="cb19-594"><a href="#cb19-594"></a></span>
<span id="cb19-595"><a href="#cb19-595"></a>::: {.callout-important}</span>
<span id="cb19-596"><a href="#cb19-596"></a><span class="fu">#### `theme()` doesn't affect data elements</span></span>
<span id="cb19-597"><a href="#cb19-597"></a></span>
<span id="cb19-598"><a href="#cb19-598"></a>One important thing to remember about <span class="in">`theme()`</span> is that it only controls the non-data elements of a map -- nothing you do with the <span class="in">`theme()`</span> function will have any effect on the data elements of a map (in this case, the layer showing the density of shootings). To change the appearance of data layers within <span class="in">`ggplot()`</span> maps, use the <span class="in">`geom_`</span>, and <span class="in">`scale_`</span> families of functions as we have learned in @sec-second-map and @sec-mapping-patterns.</span>
<span id="cb19-599"><a href="#cb19-599"></a></span>
<span id="cb19-600"><a href="#cb19-600"></a>:::</span>
<span id="cb19-601"><a href="#cb19-601"></a></span>
<span id="cb19-602"><a href="#cb19-602"></a></span>
<span id="cb19-603"><a href="#cb19-603"></a>The <span class="in">`theme()`</span> function has a lot of potential arguments. If you need help using the <span class="in">`theme()`</span> function (or any function in R) you can view a manual page (including a list of arguments) for the function by: </span>
<span id="cb19-604"><a href="#cb19-604"></a></span>
<span id="cb19-605"><a href="#cb19-605"></a><span class="ss">  * </span>typing a question mark followed by the function name without parentheses (e.g. <span class="in">`?theme`</span>) into the R console,</span>
<span id="cb19-606"><a href="#cb19-606"></a><span class="ss">  * </span>typing the function name without parentheses into the search box in the Help panel in RStudio, or</span>
<span id="cb19-607"><a href="#cb19-607"></a><span class="ss">  * </span>clicking on the function name anywhere in your R script file to place the cursor on the function name, then pressing <span class="in">`F1`</span> on your keyboard.</span>
<span id="cb19-608"><a href="#cb19-608"></a></span>
<span id="cb19-609"><a href="#cb19-609"></a>Try opening the manual page for <span class="in">`theme()`</span> now to see the list of possible arguments it can take. Fortunately, we will not need most of these arguments most of the time -- <span class="in">`ggplot()`</span> has default values built in for every value that can be changed using <span class="in">`theme()`</span>, and these defaults will be reasonable in almost all cases.</span>
<span id="cb19-610"><a href="#cb19-610"></a></span>
<span id="cb19-611"><a href="#cb19-611"></a>To reduce the visual prominence of the map caption, we can change the value of the <span class="in">`plot.caption`</span> argument to <span class="in">`theme()`</span>. Since the caption is a text element (rather than a polygon, line, etc.), we can use the helper function <span class="in">`element_text()`</span> to do this. The following code changes the colour of the caption text to a lighter grey and makes the text smaller relative to the default using the helper function <span class="in">`rel()`</span> (for relative sizing) -- <span class="in">`0.7`</span> means the text will be 70% as big as it would have been by default.</span>
<span id="cb19-612"><a href="#cb19-612"></a></span>
<span id="cb19-613"><a href="#cb19-613"></a></span>
<span id="cb19-616"><a href="#cb19-616"></a><span class="in">```{r}</span></span>
<span id="cb19-617"><a href="#cb19-617"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb19-618"><a href="#cb19-618"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb19-619"><a href="#cb19-619"></a></span>
<span id="cb19-620"><a href="#cb19-620"></a>shootings_map <span class="sc">+</span></span>
<span id="cb19-621"><a href="#cb19-621"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-622"><a href="#cb19-622"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb19-623"><a href="#cb19-623"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span>,</span>
<span id="cb19-624"><a href="#cb19-624"></a>    <span class="at">caption =</span> <span class="fu">str_glue</span>(</span>
<span id="cb19-625"><a href="#cb19-625"></a>      <span class="st">"Author: Joe Bloggs, Date produced: {lubridate::today()},</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb19-626"><a href="#cb19-626"></a>      <span class="st">"Data: https://data.cityofnewyork.us/d/833y-fsy8</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb19-627"><a href="#cb19-627"></a>      <span class="st">"Map data from OpenStreetMap"</span></span>
<span id="cb19-628"><a href="#cb19-628"></a>    )</span>
<span id="cb19-629"><a href="#cb19-629"></a>  ) <span class="sc">+</span></span>
<span id="cb19-630"><a href="#cb19-630"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb19-631"><a href="#cb19-631"></a>  <span class="fu">theme</span>(</span>
<span id="cb19-632"><a href="#cb19-632"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey67"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>))</span>
<span id="cb19-633"><a href="#cb19-633"></a>  )</span>
<span id="cb19-634"><a href="#cb19-634"></a><span class="in">```</span></span>
<span id="cb19-635"><a href="#cb19-635"></a></span>
<span id="cb19-636"><a href="#cb19-636"></a></span>
<span id="cb19-637"><a href="#cb19-637"></a>The helper function <span class="in">`element_text()`</span> has arguments to control the appearance of text in different ways. As well as <span class="in">`colour`</span> (or <span class="in">`color`</span>, either is fine) and <span class="in">`size`</span>:</span>
<span id="cb19-638"><a href="#cb19-638"></a></span>
<span id="cb19-639"><a href="#cb19-639"></a><span class="ss">  * </span><span class="in">`family`</span> controls the font used, e.g. Times New Roman or Helvetica,</span>
<span id="cb19-640"><a href="#cb19-640"></a><span class="ss">  * </span><span class="in">`face`</span> controls the style of the font, i.e. 'plain', 'italic', 'bold' or 'bold.italic',</span>
<span id="cb19-641"><a href="#cb19-641"></a><span class="ss">  * </span><span class="in">`hjust`</span> controls the horizontal justification of the text, where 0 means left aligned, 0.5 means centred and 1 means right aligned,</span>
<span id="cb19-642"><a href="#cb19-642"></a><span class="ss">  * </span><span class="in">`vjust`</span> controls the vertical justification, and</span>
<span id="cb19-643"><a href="#cb19-643"></a><span class="ss">  * </span><span class="in">`angle`</span> controls the angle (in degrees) of the text (0 means horizontal),</span>
<span id="cb19-644"><a href="#cb19-644"></a><span class="ss">  * </span><span class="in">`lineheight`</span> controls the space between lines if you have created a value that has more than one line (e.g. using <span class="in">`\n`</span> or <span class="in">`str_wrap()`</span>).</span>
<span id="cb19-645"><a href="#cb19-645"></a></span>
<span id="cb19-646"><a href="#cb19-646"></a>The <span class="in">`margin`</span> argument controls the space around the text. It is easiest to specify the value of <span class="in">`margin`</span> using the helper function <span class="in">`margin()`</span> designed for that purpose. You specify the top, right, bottom and left margin separately in that order -- to remember the order, think '**tr**ou**bl**e'. By default, margins are specified in points (the same units that are commonly used to specify font sizes).</span>
<span id="cb19-647"><a href="#cb19-647"></a></span>
<span id="cb19-648"><a href="#cb19-648"></a></span>
<span id="cb19-651"><a href="#cb19-651"></a><span class="in">```{r}</span></span>
<span id="cb19-652"><a href="#cb19-652"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb19-653"><a href="#cb19-653"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb19-654"><a href="#cb19-654"></a></span>
<span id="cb19-655"><a href="#cb19-655"></a>shootings_map <span class="sc">+</span></span>
<span id="cb19-656"><a href="#cb19-656"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-657"><a href="#cb19-657"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb19-658"><a href="#cb19-658"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span>,</span>
<span id="cb19-659"><a href="#cb19-659"></a>    <span class="at">caption =</span> <span class="fu">str_glue</span>(</span>
<span id="cb19-660"><a href="#cb19-660"></a>      <span class="st">"Author: Joe Bloggs, Date produced: {lubridate::today()},</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb19-661"><a href="#cb19-661"></a>      <span class="st">"Data: https://data.cityofnewyork.us/d/833y-fsy8</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb19-662"><a href="#cb19-662"></a>      <span class="st">"Map data from OpenStreetMap"</span></span>
<span id="cb19-663"><a href="#cb19-663"></a>    )</span>
<span id="cb19-664"><a href="#cb19-664"></a>  ) <span class="sc">+</span></span>
<span id="cb19-665"><a href="#cb19-665"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb19-666"><a href="#cb19-666"></a>  <span class="fu">theme</span>(</span>
<span id="cb19-667"><a href="#cb19-667"></a>    <span class="co"># Make the plot subtitle smaller and adjust the margin around it</span></span>
<span id="cb19-668"><a href="#cb19-668"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>), <span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">0</span>)),</span>
<span id="cb19-669"><a href="#cb19-669"></a>    <span class="co"># Make the legend caption smaller, left-aligned and a lighter shade of grey</span></span>
<span id="cb19-670"><a href="#cb19-670"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey67"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>), <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb19-671"><a href="#cb19-671"></a>  )</span>
<span id="cb19-672"><a href="#cb19-672"></a><span class="in">```</span></span>
<span id="cb19-673"><a href="#cb19-673"></a></span>
<span id="cb19-674"><a href="#cb19-674"></a></span>
<span id="cb19-675"><a href="#cb19-675"></a>Now that we have finished setting the text elements for our map, we can save it as a new object that we can use as the basis for the other objects we want to add. Make sure you run this code, since we will need it for the rest of the code below.</span>
<span id="cb19-676"><a href="#cb19-676"></a></span>
<span id="cb19-679"><a href="#cb19-679"></a><span class="in">```{r}</span></span>
<span id="cb19-680"><a href="#cb19-680"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb19-681"><a href="#cb19-681"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb19-682"><a href="#cb19-682"></a></span>
<span id="cb19-683"><a href="#cb19-683"></a>shootings_map_titled <span class="ot">&lt;-</span> shootings_map <span class="sc">+</span></span>
<span id="cb19-684"><a href="#cb19-684"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-685"><a href="#cb19-685"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb19-686"><a href="#cb19-686"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span>,</span>
<span id="cb19-687"><a href="#cb19-687"></a>    <span class="at">caption =</span> <span class="fu">str_glue</span>(</span>
<span id="cb19-688"><a href="#cb19-688"></a>      <span class="st">"Author: Joe Bloggs, Date produced: {lubridate::today()},</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb19-689"><a href="#cb19-689"></a>      <span class="st">"Data: https://data.cityofnewyork.us/d/833y-fsy8</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb19-690"><a href="#cb19-690"></a>      <span class="st">"Map data from OpenStreetMap"</span></span>
<span id="cb19-691"><a href="#cb19-691"></a>    )</span>
<span id="cb19-692"><a href="#cb19-692"></a>  ) <span class="sc">+</span></span>
<span id="cb19-693"><a href="#cb19-693"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb19-694"><a href="#cb19-694"></a>  <span class="fu">theme</span>(</span>
<span id="cb19-695"><a href="#cb19-695"></a>    <span class="co"># Make the plot subtitle smaller and adjust the margin around it</span></span>
<span id="cb19-696"><a href="#cb19-696"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>), <span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">0</span>)),</span>
<span id="cb19-697"><a href="#cb19-697"></a>    <span class="co"># Make the legend caption smaller, left-aligned and a lighter shade of grey</span></span>
<span id="cb19-698"><a href="#cb19-698"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey67"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>), <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb19-699"><a href="#cb19-699"></a>  )</span>
<span id="cb19-700"><a href="#cb19-700"></a><span class="in">```</span></span>
<span id="cb19-701"><a href="#cb19-701"></a></span>
<span id="cb19-702"><a href="#cb19-702"></a></span>
<span id="cb19-703"><a href="#cb19-703"></a>::: {.callout-important}</span>
<span id="cb19-704"><a href="#cb19-704"></a><span class="fu">#### Create your maps using a single `ggplot()` stack</span></span>
<span id="cb19-705"><a href="#cb19-705"></a></span>
<span id="cb19-706"><a href="#cb19-706"></a>In this chapter we will store the map we are creating in an object several times as we go through the process of explaining how to add context to a map. When you write your own code, you should not do this. Instead, you should create the map from start to finish in a single block of code. Doing that will make sure your code is easy to read and that you don't have to keep track of more objects than necessary. For an example of this, see the final section of this chapter.</span>
<span id="cb19-707"><a href="#cb19-707"></a></span>
<span id="cb19-708"><a href="#cb19-708"></a>:::</span>
<span id="cb19-709"><a href="#cb19-709"></a></span>
<span id="cb19-710"><a href="#cb19-710"></a></span>
<span id="cb19-711"><a href="#cb19-711"></a>::: {.callout-quiz .callout}</span>
<span id="cb19-712"><a href="#cb19-712"></a><span class="fu">#### Titles, subtitles and captions</span></span>
<span id="cb19-713"><a href="#cb19-713"></a></span>
<span id="cb19-714"><a href="#cb19-714"></a><span class="in">```{r titles-quiz}</span></span>
<span id="cb19-715"><a href="#cb19-715"></a><span class="in">#| echo: false</span></span>
<span id="cb19-716"><a href="#cb19-716"></a></span>
<span id="cb19-717"><a href="#cb19-717"></a><span class="in">titles_quiz1 &lt;- c(</span></span>
<span id="cb19-718"><a href="#cb19-718"></a><span class="in">  "To make the map look more professional.",</span></span>
<span id="cb19-719"><a href="#cb19-719"></a><span class="in">  "To provide a reference for the map's source",</span></span>
<span id="cb19-720"><a href="#cb19-720"></a><span class="in">  "To display additional geographic information",</span></span>
<span id="cb19-721"><a href="#cb19-721"></a><span class="in">  answer = "To explain the main conclusion that the audience should draw from the map"</span></span>
<span id="cb19-722"><a href="#cb19-722"></a><span class="in">)</span></span>
<span id="cb19-723"><a href="#cb19-723"></a></span>
<span id="cb19-724"><a href="#cb19-724"></a><span class="in">titles_quiz2 &lt;- c("`ggtitle()`", answer = "`labs()`", "`title()`", "`ggmap()`")</span></span>
<span id="cb19-725"><a href="#cb19-725"></a></span>
<span id="cb19-726"><a href="#cb19-726"></a><span class="in">titles_quiz3 &lt;- c(</span></span>
<span id="cb19-727"><a href="#cb19-727"></a><span class="in">  "Residential burglary in Philadelphia, 2024",</span></span>
<span id="cb19-728"><a href="#cb19-728"></a><span class="in">  "Philadelphia crime map",</span></span>
<span id="cb19-729"><a href="#cb19-729"></a><span class="in">  answer = "Residential burglary in Philadephia is concentrated in Kensington",</span></span>
<span id="cb19-730"><a href="#cb19-730"></a><span class="in">  "Where residential burglaries are most concentrated in Philadephia"</span></span>
<span id="cb19-731"><a href="#cb19-731"></a><span class="in">)</span></span>
<span id="cb19-732"><a href="#cb19-732"></a></span>
<span id="cb19-733"><a href="#cb19-733"></a><span class="in">titles_quiz4 &lt;- c(</span></span>
<span id="cb19-734"><a href="#cb19-734"></a><span class="in">  answer = "It meets legal requirements.",</span></span>
<span id="cb19-735"><a href="#cb19-735"></a><span class="in">  "It helps reduce the size of the data.",</span></span>
<span id="cb19-736"><a href="#cb19-736"></a><span class="in">  "It improves the accuracy of the map.",</span></span>
<span id="cb19-737"><a href="#cb19-737"></a><span class="in">  "It ensures the map looks visually appealing."</span></span>
<span id="cb19-738"><a href="#cb19-738"></a><span class="in">)</span></span>
<span id="cb19-739"><a href="#cb19-739"></a><span class="in">```</span></span>
<span id="cb19-740"><a href="#cb19-740"></a></span>
<span id="cb19-741"><a href="#cb19-741"></a></span>
<span id="cb19-742"><a href="#cb19-742"></a>**What is the main purpose of adding a title to a map in R?**</span>
<span id="cb19-743"><a href="#cb19-743"></a></span>
<span id="cb19-744"><a href="#cb19-744"></a><span class="in">`r webexercises::longmcq(titles_quiz1)`</span></span>
<span id="cb19-745"><a href="#cb19-745"></a></span>
<span id="cb19-746"><a href="#cb19-746"></a></span>
<span id="cb19-747"><a href="#cb19-747"></a>**Which R function is used to add a title to a map created with ggplot2?**</span>
<span id="cb19-748"><a href="#cb19-748"></a></span>
<span id="cb19-749"><a href="#cb19-749"></a><span class="in">`r webexercises::longmcq(titles_quiz2)`</span></span>
<span id="cb19-750"><a href="#cb19-750"></a></span>
<span id="cb19-751"><a href="#cb19-751"></a></span>
<span id="cb19-752"><a href="#cb19-752"></a>**Which of the following is an example of a declarative title for a crime map?**</span>
<span id="cb19-753"><a href="#cb19-753"></a></span>
<span id="cb19-754"><a href="#cb19-754"></a><span class="in">`r webexercises::longmcq(titles_quiz3)`</span></span>
<span id="cb19-755"><a href="#cb19-755"></a></span>
<span id="cb19-756"><a href="#cb19-756"></a></span>
<span id="cb19-757"><a href="#cb19-757"></a>**Why is it important to acknowledge the source of data used in crime maps?**</span>
<span id="cb19-758"><a href="#cb19-758"></a></span>
<span id="cb19-759"><a href="#cb19-759"></a><span class="in">`r webexercises::longmcq(titles_quiz4)`</span></span>
<span id="cb19-760"><a href="#cb19-760"></a></span>
<span id="cb19-761"><a href="#cb19-761"></a></span>
<span id="cb19-762"><a href="#cb19-762"></a>:::</span>
<span id="cb19-763"><a href="#cb19-763"></a></span>
<span id="cb19-764"><a href="#cb19-764"></a></span>
<span id="cb19-765"><a href="#cb19-765"></a></span>
<span id="cb19-766"><a href="#cb19-766"></a><span class="fu">## Legends {#sec-legends}</span></span>
<span id="cb19-767"><a href="#cb19-767"></a></span>
<span id="cb19-768"><a href="#cb19-768"></a>Legends are important for all but the simplest crime maps because they help readers to interpret the points, lines and polygons used to represent data on a particular map. Except for point maps containing only a small number of crimes (such as the map of homicide in downtown Atlanta that we produced in @sec-first-map), crime maps will almost always need a legend to help users interpret them.</span>
<span id="cb19-769"><a href="#cb19-769"></a></span>
<span id="cb19-770"><a href="#cb19-770"></a>Producing a legend manually could be quite complicated, but fortunately <span class="in">`ggplot()`</span> produces legends automatically. <span class="in">`ggplot()`</span> will add a legend to a map or chart whenever one or more layers of data are represented using an aesthetic property such as size, shape, colour or fill. In our current map, the density of shootings is represented using the fill colour of the polygons produced by the <span class="in">`hotspot_kde()`</span> function, with darker colours representing more shootings.</span>
<span id="cb19-771"><a href="#cb19-771"></a></span>
<span id="cb19-772"><a href="#cb19-772"></a>Our map already has a legend, but we may want to adjust its appearance by:</span>
<span id="cb19-773"><a href="#cb19-773"></a></span>
<span id="cb19-774"><a href="#cb19-774"></a><span class="ss">  * </span>changing the default legend title from "kde" to something more meaningful,</span>
<span id="cb19-775"><a href="#cb19-775"></a><span class="ss">  * </span>moving the legend down the visual hierarchy by making it smaller (at the moment it is almost as visually prominent as the data),</span>
<span id="cb19-776"><a href="#cb19-776"></a><span class="ss">  * </span>removing the potentially confusing raw density values.</span>
<span id="cb19-777"><a href="#cb19-777"></a></span>
<span id="cb19-778"><a href="#cb19-778"></a>We can change the default legend title by once again using the <span class="in">`labs()`</span> function. Since we want to change the title of the legend, you might reasonably think that we would do this using something like <span class="in">`labs(legend = "density")`</span> but unfortunately that code would do nothing at all. Instead, we have to set the legend title using the aesthetic (colour, size, shape, etc.) that the legend represents. This makes it possible to specify multiple titles if there are separate legends for different layers that use different aesthetics. For example if a map used lines of different colours to show streets of different types and filled polygons to show the density of crime, it would be possible to have separate legends explaining each aesthetic. In this case, we've specified that the <span class="in">`kde`</span> column in the data should control the fill aesthetic, so we can set the title for that legend using <span class="in">`fill = "title we want"`</span>.</span>
<span id="cb19-779"><a href="#cb19-779"></a></span>
<span id="cb19-780"><a href="#cb19-780"></a>Run this code in the R Console and check to see that the legend title has changed.</span>
<span id="cb19-781"><a href="#cb19-781"></a></span>
<span id="cb19-784"><a href="#cb19-784"></a><span class="in">```{r}</span></span>
<span id="cb19-785"><a href="#cb19-785"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb19-786"><a href="#cb19-786"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb19-787"><a href="#cb19-787"></a></span>
<span id="cb19-788"><a href="#cb19-788"></a>shootings_map_titled <span class="sc">+</span></span>
<span id="cb19-789"><a href="#cb19-789"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"kernel density</span><span class="sc">\n</span><span class="st">of shootings"</span>)</span>
<span id="cb19-790"><a href="#cb19-790"></a><span class="in">```</span></span>
<span id="cb19-791"><a href="#cb19-791"></a></span>
<span id="cb19-792"><a href="#cb19-792"></a>To make the legend smaller, we can use <span class="in">`theme()`</span> in the same way as we did to change the appearance of the caption. We use the <span class="in">`legend.title`</span> argument to format the legend title and the <span class="in">`legend.text`</span> argument to format the labels for each value in the legend, again using the <span class="in">`element_text()`</span> helper function. In both cases, we will set the text size relative to the default text size using the <span class="in">`rel()`</span> helper function.</span>
<span id="cb19-793"><a href="#cb19-793"></a></span>
<span id="cb19-794"><a href="#cb19-794"></a>We will also make the colour bar in the legend (called the *key* by <span class="in">`ggplot()`</span>) slightly smaller using the <span class="in">`legend.key.width`</span> argument. To do this we will use the helper function <span class="in">`unit()`</span>, which allows us to specify the size using any of several common units. In this case, we will specify the key size in lines (1 line = the height of one line of text) so that it is relative to the text size we have chosen.</span>
<span id="cb19-795"><a href="#cb19-795"></a></span>
<span id="cb19-796"><a href="#cb19-796"></a>Run this code and check how the appearance of the legend changes.</span>
<span id="cb19-797"><a href="#cb19-797"></a></span>
<span id="cb19-798"><a href="#cb19-798"></a></span>
<span id="cb19-801"><a href="#cb19-801"></a><span class="in">```{r}</span></span>
<span id="cb19-802"><a href="#cb19-802"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb19-803"><a href="#cb19-803"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb19-804"><a href="#cb19-804"></a></span>
<span id="cb19-805"><a href="#cb19-805"></a>shootings_map_titled <span class="sc">+</span></span>
<span id="cb19-806"><a href="#cb19-806"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"kernel density</span><span class="sc">\n</span><span class="st">of shootings"</span>) <span class="sc">+</span></span>
<span id="cb19-807"><a href="#cb19-807"></a>  <span class="fu">theme</span>(</span>
<span id="cb19-808"><a href="#cb19-808"></a>    <span class="co"># Make the legend colour bar smaller</span></span>
<span id="cb19-809"><a href="#cb19-809"></a>    <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"lines"</span>),</span>
<span id="cb19-810"><a href="#cb19-810"></a>    <span class="co"># Make the legend text smaller</span></span>
<span id="cb19-811"><a href="#cb19-811"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>)),</span>
<span id="cb19-812"><a href="#cb19-812"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>))</span>
<span id="cb19-813"><a href="#cb19-813"></a>  )</span>
<span id="cb19-814"><a href="#cb19-814"></a><span class="in">```</span></span>
<span id="cb19-815"><a href="#cb19-815"></a></span>
<span id="cb19-816"><a href="#cb19-816"></a>Finally, we want to remove the raw density values, since these are difficult to interpret and might distract readers from the key message that darker colours on the map represent higher densities of shootings.</span>
<span id="cb19-817"><a href="#cb19-817"></a></span>
<span id="cb19-818"><a href="#cb19-818"></a>By default, <span class="in">`ggplot()`</span> sets the label for each legend key based on the data. To specify our own labels, we can use the <span class="in">`labels`</span> argument to the <span class="in">`scale_fill_distiller()`</span> function that we previously used to set the colour scheme of the density layer on the map. </span>
<span id="cb19-819"><a href="#cb19-819"></a></span>
<span id="cb19-820"><a href="#cb19-820"></a>When we set colour bar labels manually, we have to also specify where on the colour bar we want those labels to appear. We do this using the <span class="in">`breaks`</span> argument to <span class="in">`scale_fill_distiller()`</span>, making sure the number of values we supply to the <span class="in">`breaks`</span> argument is the same as the number of labels we've given to the <span class="in">`labels`</span> argument (otherwise R will produce an error).</span>
<span id="cb19-821"><a href="#cb19-821"></a></span>
<span id="cb19-822"><a href="#cb19-822"></a>In this case, we want to add two labels ("higher" and "lower"), one at either end of the colour bar. We could look at <span class="in">`kde`</span> column of the <span class="in">`shootings_kde`</span> object to find the minimum and maximum values, but that would introduce the risk of us accidentally entering the wrong values. Instead, we can use the <span class="in">`pull()`</span> function to extract the <span class="in">`kde`</span> column from the <span class="in">`shootings_kde`</span> dataset and then use the <span class="in">`range()`</span> function to find the minimum and maximum values. Putting this together, we get <span class="in">`breaks = range(pull(shootings_kde, "kde"))`</span>. You can read this code starting from the 'inside' and working 'outwards': the code says "take the <span class="in">`shootings_kde`</span> object, <span class="in">`pull()`</span> the 'kde' column out of that object and then calculate the <span class="in">`range()`</span> of numbers in that column.</span>
<span id="cb19-823"><a href="#cb19-823"></a></span>
<span id="cb19-824"><a href="#cb19-824"></a>Run this code to see how the legend labels change.</span>
<span id="cb19-825"><a href="#cb19-825"></a></span>
<span id="cb19-826"><a href="#cb19-826"></a></span>
<span id="cb19-829"><a href="#cb19-829"></a><span class="in">```{r}</span></span>
<span id="cb19-830"><a href="#cb19-830"></a><span class="co">#| message: false</span></span>
<span id="cb19-831"><a href="#cb19-831"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb19-832"><a href="#cb19-832"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb19-833"><a href="#cb19-833"></a></span>
<span id="cb19-834"><a href="#cb19-834"></a>shootings_map_titled <span class="sc">+</span></span>
<span id="cb19-835"><a href="#cb19-835"></a>  <span class="co"># Specify colours used to show density of crime</span></span>
<span id="cb19-836"><a href="#cb19-836"></a>  <span class="fu">scale_fill_distiller</span>(</span>
<span id="cb19-837"><a href="#cb19-837"></a>    <span class="at">palette =</span> <span class="st">"PuBu"</span>, </span>
<span id="cb19-838"><a href="#cb19-838"></a>    <span class="at">direction =</span> <span class="dv">1</span>, </span>
<span id="cb19-839"><a href="#cb19-839"></a>    <span class="co"># Specify label positions as the minimum and maximum KDE values</span></span>
<span id="cb19-840"><a href="#cb19-840"></a>    <span class="at">breaks =</span> <span class="fu">range</span>(<span class="fu">pull</span>(shootings_kde, <span class="st">"kde"</span>)), </span>
<span id="cb19-841"><a href="#cb19-841"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"lower"</span>, <span class="st">"higher"</span>)</span>
<span id="cb19-842"><a href="#cb19-842"></a>  ) <span class="sc">+</span></span>
<span id="cb19-843"><a href="#cb19-843"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"kernel density</span><span class="sc">\n</span><span class="st">of shootings"</span>) <span class="sc">+</span></span>
<span id="cb19-844"><a href="#cb19-844"></a>  <span class="fu">theme</span>(</span>
<span id="cb19-845"><a href="#cb19-845"></a>    <span class="co"># Make the legend colour bar smaller</span></span>
<span id="cb19-846"><a href="#cb19-846"></a>    <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"lines"</span>),</span>
<span id="cb19-847"><a href="#cb19-847"></a>    <span class="co"># Make the legend text smaller</span></span>
<span id="cb19-848"><a href="#cb19-848"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>)),</span>
<span id="cb19-849"><a href="#cb19-849"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>))</span>
<span id="cb19-850"><a href="#cb19-850"></a>  )</span>
<span id="cb19-851"><a href="#cb19-851"></a><span class="in">```</span></span>
<span id="cb19-852"><a href="#cb19-852"></a></span>
<span id="cb19-853"><a href="#cb19-853"></a></span>
<span id="cb19-854"><a href="#cb19-854"></a>Now that we have finished formatting the legend, we can again store the map as an object that we can build on further.</span>
<span id="cb19-855"><a href="#cb19-855"></a></span>
<span id="cb19-856"><a href="#cb19-856"></a></span>
<span id="cb19-859"><a href="#cb19-859"></a><span class="in">```{r}</span></span>
<span id="cb19-860"><a href="#cb19-860"></a><span class="co">#| message: false</span></span>
<span id="cb19-861"><a href="#cb19-861"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb19-862"><a href="#cb19-862"></a></span>
<span id="cb19-863"><a href="#cb19-863"></a>shootings_map_legend <span class="ot">&lt;-</span> shootings_map_titled <span class="sc">+</span></span>
<span id="cb19-864"><a href="#cb19-864"></a>  <span class="co"># Specify colours used to show density of crime</span></span>
<span id="cb19-865"><a href="#cb19-865"></a>  <span class="fu">scale_fill_distiller</span>(</span>
<span id="cb19-866"><a href="#cb19-866"></a>    <span class="at">palette =</span> <span class="st">"PuBu"</span>, </span>
<span id="cb19-867"><a href="#cb19-867"></a>    <span class="at">direction =</span> <span class="dv">1</span>, </span>
<span id="cb19-868"><a href="#cb19-868"></a>    <span class="co"># Specify label positions as the minimum and maximum KDE values</span></span>
<span id="cb19-869"><a href="#cb19-869"></a>    <span class="at">breaks =</span> <span class="fu">range</span>(<span class="fu">pull</span>(shootings_kde, <span class="st">"kde"</span>)), </span>
<span id="cb19-870"><a href="#cb19-870"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"lower"</span>, <span class="st">"higher"</span>)</span>
<span id="cb19-871"><a href="#cb19-871"></a>  ) <span class="sc">+</span></span>
<span id="cb19-872"><a href="#cb19-872"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"kernel density</span><span class="sc">\n</span><span class="st">of shootings"</span>) <span class="sc">+</span></span>
<span id="cb19-873"><a href="#cb19-873"></a>  <span class="fu">theme</span>(</span>
<span id="cb19-874"><a href="#cb19-874"></a>    <span class="co"># Make the legend colour bar smaller</span></span>
<span id="cb19-875"><a href="#cb19-875"></a>    <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"lines"</span>),</span>
<span id="cb19-876"><a href="#cb19-876"></a>    <span class="co"># Make the legend text smaller</span></span>
<span id="cb19-877"><a href="#cb19-877"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>)),</span>
<span id="cb19-878"><a href="#cb19-878"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>))</span>
<span id="cb19-879"><a href="#cb19-879"></a>  )</span>
<span id="cb19-880"><a href="#cb19-880"></a><span class="in">```</span></span>
<span id="cb19-881"><a href="#cb19-881"></a></span>
<span id="cb19-882"><a href="#cb19-882"></a></span>
<span id="cb19-883"><a href="#cb19-883"></a>::: {.callout-quiz .callout}</span>
<span id="cb19-884"><a href="#cb19-884"></a><span class="fu">#### Legends</span></span>
<span id="cb19-885"><a href="#cb19-885"></a></span>
<span id="cb19-886"><a href="#cb19-886"></a><span class="in">```{r legends-quiz}</span></span>
<span id="cb19-887"><a href="#cb19-887"></a><span class="in">#| echo: false</span></span>
<span id="cb19-888"><a href="#cb19-888"></a></span>
<span id="cb19-889"><a href="#cb19-889"></a><span class="in">legends_quiz1 &lt;- c(</span></span>
<span id="cb19-890"><a href="#cb19-890"></a><span class="in"> "To display the map’s title.",</span></span>
<span id="cb19-891"><a href="#cb19-891"></a><span class="in"> answer = "To explain the meaning of different symbols or colors on the map.",</span></span>
<span id="cb19-892"><a href="#cb19-892"></a><span class="in"> "To display the coordinates of map locations.",</span></span>
<span id="cb19-893"><a href="#cb19-893"></a><span class="in">  "To add gridlines to the map."</span></span>
<span id="cb19-894"><a href="#cb19-894"></a><span class="in">)</span></span>
<span id="cb19-895"><a href="#cb19-895"></a></span>
<span id="cb19-896"><a href="#cb19-896"></a><span class="in">legends_quiz2 &lt;- c(</span></span>
<span id="cb19-897"><a href="#cb19-897"></a><span class="in">  answer = "It combines multiple strings into one caption, including dynamic values.",</span></span>
<span id="cb19-898"><a href="#cb19-898"></a><span class="in">  "It helps with data filtering.",</span></span>
<span id="cb19-899"><a href="#cb19-899"></a><span class="in">  "It allows you to change map colors.",</span></span>
<span id="cb19-900"><a href="#cb19-900"></a><span class="in">  "It removes unwanted data points."</span></span>
<span id="cb19-901"><a href="#cb19-901"></a><span class="in">)</span></span>
<span id="cb19-902"><a href="#cb19-902"></a></span>
<span id="cb19-903"><a href="#cb19-903"></a><span class="in">legends_quiz3 &lt;- c(</span></span>
<span id="cb19-904"><a href="#cb19-904"></a><span class="in">  "`geom_sf()`", </span></span>
<span id="cb19-905"><a href="#cb19-905"></a><span class="in">  "`theme_void()`",</span></span>
<span id="cb19-906"><a href="#cb19-906"></a><span class="in">  answer = "`scale_fill_*()`", </span></span>
<span id="cb19-907"><a href="#cb19-907"></a><span class="in">  "`labs()`"</span></span>
<span id="cb19-908"><a href="#cb19-908"></a><span class="in">)</span></span>
<span id="cb19-909"><a href="#cb19-909"></a></span>
<span id="cb19-910"><a href="#cb19-910"></a><span class="in">legends_quiz4 &lt;- c(</span></span>
<span id="cb19-911"><a href="#cb19-911"></a><span class="in">  "The legend should be as large as possible to fill space.",</span></span>
<span id="cb19-912"><a href="#cb19-912"></a><span class="in">  "The legend should be placed in the most prominent position to attract attention.",</span></span>
<span id="cb19-913"><a href="#cb19-913"></a><span class="in">  "The legend should always be hidden to avoid distraction.",</span></span>
<span id="cb19-914"><a href="#cb19-914"></a><span class="in">  answer = "The legend should be simple and positioned where it does not obstruct important data on the map."</span></span>
<span id="cb19-915"><a href="#cb19-915"></a><span class="in">)</span></span>
<span id="cb19-916"><a href="#cb19-916"></a><span class="in">```</span></span>
<span id="cb19-917"><a href="#cb19-917"></a></span>
<span id="cb19-918"><a href="#cb19-918"></a></span>
<span id="cb19-919"><a href="#cb19-919"></a>**What is the role of a legend on a map?**</span>
<span id="cb19-920"><a href="#cb19-920"></a></span>
<span id="cb19-921"><a href="#cb19-921"></a><span class="in">`r webexercises::longmcq(legends_quiz1)`</span></span>
<span id="cb19-922"><a href="#cb19-922"></a></span>
<span id="cb19-923"><a href="#cb19-923"></a></span>
<span id="cb19-924"><a href="#cb19-924"></a>**What is one advantage of using `str_glue()` to format text on in maps made with R?**</span>
<span id="cb19-925"><a href="#cb19-925"></a></span>
<span id="cb19-926"><a href="#cb19-926"></a><span class="in">`r webexercises::longmcq(legends_quiz2)`</span></span>
<span id="cb19-927"><a href="#cb19-927"></a></span>
<span id="cb19-928"><a href="#cb19-928"></a></span>
<span id="cb19-929"><a href="#cb19-929"></a>**Which ggplot2 function is commonly used to add a legend to a map?**</span>
<span id="cb19-930"><a href="#cb19-930"></a></span>
<span id="cb19-931"><a href="#cb19-931"></a><span class="in">`r webexercises::longmcq(legends_quiz3)`</span></span>
<span id="cb19-932"><a href="#cb19-932"></a></span>
<span id="cb19-933"><a href="#cb19-933"></a></span>
<span id="cb19-934"><a href="#cb19-934"></a>**Which of the following statements best describes how map legends should be designed?**</span>
<span id="cb19-935"><a href="#cb19-935"></a></span>
<span id="cb19-936"><a href="#cb19-936"></a><span class="in">`r webexercises::longmcq(legends_quiz3)`</span></span>
<span id="cb19-937"><a href="#cb19-937"></a></span>
<span id="cb19-938"><a href="#cb19-938"></a></span>
<span id="cb19-939"><a href="#cb19-939"></a>:::</span>
<span id="cb19-940"><a href="#cb19-940"></a></span>
<span id="cb19-941"><a href="#cb19-941"></a></span>
<span id="cb19-942"><a href="#cb19-942"></a></span>
<span id="cb19-943"><a href="#cb19-943"></a><span class="fu">## Scales and north arrows {#sec-scale-bars}</span></span>
<span id="cb19-944"><a href="#cb19-944"></a></span>
<span id="cb19-945"><a href="#cb19-945"></a>The final elements we can add to our map are a scale bar and a north arrow, which can both be added using functions from the <span class="in">`ggspatial`</span> package. If you check the <span class="in">`chapter_07.R`</span> code file, you will see that you have already loaded this package.</span>
<span id="cb19-946"><a href="#cb19-946"></a></span>
<span id="cb19-947"><a href="#cb19-947"></a></span>
<span id="cb19-948"><a href="#cb19-948"></a><span class="fu">### Scale bars</span></span>
<span id="cb19-949"><a href="#cb19-949"></a></span>
<span id="cb19-950"><a href="#cb19-950"></a>To add a scale bar, we can add a call to the <span class="in">`annotation_scale()`</span> function to our existing <span class="in">`ggplot()`</span> object.</span>
<span id="cb19-951"><a href="#cb19-951"></a></span>
<span id="cb19-954"><a href="#cb19-954"></a><span class="in">```{r}</span></span>
<span id="cb19-955"><a href="#cb19-955"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb19-956"><a href="#cb19-956"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb19-957"><a href="#cb19-957"></a></span>
<span id="cb19-958"><a href="#cb19-958"></a>shootings_map_legend <span class="sc">+</span></span>
<span id="cb19-959"><a href="#cb19-959"></a>  <span class="co"># Add scale bar</span></span>
<span id="cb19-960"><a href="#cb19-960"></a>  <span class="fu">annotation_scale</span>()</span>
<span id="cb19-961"><a href="#cb19-961"></a><span class="in">```</span></span>
<span id="cb19-962"><a href="#cb19-962"></a></span>
<span id="cb19-963"><a href="#cb19-963"></a>The default scale bar is a little too visually dominant for the low place it should have in the visual hierarchy of our map, and the default placement in the bottom-left corner happens to overlap with the highest density of shootings. We can change the scale bar using arguments to the <span class="in">`annotation_scale()`</span> function:</span>
<span id="cb19-964"><a href="#cb19-964"></a></span>
<span id="cb19-965"><a href="#cb19-965"></a><span class="ss">  * </span><span class="in">`width_hint = 1/5`</span> changes the (approximate) proportion of the map width across which the scale bar stretches, </span>
<span id="cb19-966"><a href="#cb19-966"></a><span class="ss">  * </span><span class="in">`style = "ticks"`</span> changes the style of the scale bar to the less visually prominent line-and-tick-marks style, and</span>
<span id="cb19-967"><a href="#cb19-967"></a><span class="ss">  * </span><span class="in">`location = "br"`</span> moves the scale bar to the bottom-right corner of the map.</span>
<span id="cb19-968"><a href="#cb19-968"></a></span>
<span id="cb19-971"><a href="#cb19-971"></a><span class="in">```{r}</span></span>
<span id="cb19-972"><a href="#cb19-972"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb19-973"><a href="#cb19-973"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb19-974"><a href="#cb19-974"></a></span>
<span id="cb19-975"><a href="#cb19-975"></a>shootings_map_legend <span class="sc">+</span></span>
<span id="cb19-976"><a href="#cb19-976"></a>  <span class="co"># Add scale bar</span></span>
<span id="cb19-977"><a href="#cb19-977"></a>  <span class="fu">annotation_scale</span>(<span class="at">width_hint =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">style =</span> <span class="st">"ticks"</span>, <span class="at">location =</span> <span class="st">"br"</span>)</span>
<span id="cb19-978"><a href="#cb19-978"></a><span class="in">```</span></span>
<span id="cb19-979"><a href="#cb19-979"></a></span>
<span id="cb19-980"><a href="#cb19-980"></a></span>
<span id="cb19-981"><a href="#cb19-981"></a><span class="fu">### North arrows {#sec-north-arrows}</span></span>
<span id="cb19-982"><a href="#cb19-982"></a></span>
<span id="cb19-983"><a href="#cb19-983"></a>We can add a north arrow using the <span class="in">`annotation_north_arrow()`</span> function. The default arrow is too obtrusive to fit its position in the visual hierarchy, so we will change its appearance using the arguments:</span>
<span id="cb19-984"><a href="#cb19-984"></a></span>
<span id="cb19-985"><a href="#cb19-985"></a><span class="ss">  * </span><span class="in">`location = "tr"`</span> to move the north arrow to the top-right corner, since we have put the scale bar in the bottom-right where the north arrow would be placed by default,</span>
<span id="cb19-986"><a href="#cb19-986"></a><span class="ss">  * </span><span class="in">`height = unit(1.5, "lines")`</span> to make the arrow smaller, and</span>
<span id="cb19-987"><a href="#cb19-987"></a><span class="ss">  * </span><span class="in">`style = north_arrow_minimal(text_size = 8)`</span> to use a smaller style of arrow, at the same time reducing the font size (measured in points) of the N symbol.</span>
<span id="cb19-988"><a href="#cb19-988"></a></span>
<span id="cb19-991"><a href="#cb19-991"></a><span class="in">```{r}</span></span>
<span id="cb19-992"><a href="#cb19-992"></a><span class="co">#| filename: "R Console"</span></span>
<span id="cb19-993"><a href="#cb19-993"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb19-994"><a href="#cb19-994"></a></span>
<span id="cb19-995"><a href="#cb19-995"></a>shootings_map_legend <span class="sc">+</span></span>
<span id="cb19-996"><a href="#cb19-996"></a>  <span class="co"># Add scale bar</span></span>
<span id="cb19-997"><a href="#cb19-997"></a>  <span class="fu">annotation_scale</span>(<span class="at">width_hint =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">style =</span> <span class="st">"ticks"</span>, <span class="at">location =</span> <span class="st">"br"</span>) <span class="sc">+</span></span>
<span id="cb19-998"><a href="#cb19-998"></a>  <span class="co"># Add north arrow</span></span>
<span id="cb19-999"><a href="#cb19-999"></a>  <span class="fu">annotation_north_arrow</span>(</span>
<span id="cb19-1000"><a href="#cb19-1000"></a>    <span class="at">location =</span> <span class="st">"tr"</span>, </span>
<span id="cb19-1001"><a href="#cb19-1001"></a>    <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">"lines"</span>), </span>
<span id="cb19-1002"><a href="#cb19-1002"></a>    <span class="at">style =</span> <span class="fu">north_arrow_minimal</span>(<span class="at">text_size =</span> <span class="dv">8</span>)</span>
<span id="cb19-1003"><a href="#cb19-1003"></a>  )</span>
<span id="cb19-1004"><a href="#cb19-1004"></a><span class="in">```</span></span>
<span id="cb19-1005"><a href="#cb19-1005"></a></span>
<span id="cb19-1006"><a href="#cb19-1006"></a></span>
<span id="cb19-1007"><a href="#cb19-1007"></a>::: {.callout-important}</span>
<span id="cb19-1008"><a href="#cb19-1008"></a><span class="fu">#### Not all maps need north arrows</span></span>
<span id="cb19-1009"><a href="#cb19-1009"></a></span>
<span id="cb19-1010"><a href="#cb19-1010"></a>If a map is going to be used for navigation (e.g. a road map or a nautical chart), it is vital that the map includes a north arrow. But if the map is going to be used to understand concentrations of crime in an area, a north arrow is much less important. </span>
<span id="cb19-1011"><a href="#cb19-1011"></a></span>
<span id="cb19-1012"><a href="#cb19-1012"></a>You may choose to omit including a north arrow in your crime maps. However, you _must_ include a north arrow if (for whatever reason) north is not at a the top of the map. People expect north to be at the top of a map, so if your map does not follow your convention then it is important to make sure your readers can work that out.</span>
<span id="cb19-1013"><a href="#cb19-1013"></a></span>
<span id="cb19-1014"><a href="#cb19-1014"></a>Most of the crime maps in the rest of this book do not have north arrows, because those maps follow the convention of having north at the top of the map.</span>
<span id="cb19-1015"><a href="#cb19-1015"></a>:::</span>
<span id="cb19-1016"><a href="#cb19-1016"></a></span>
<span id="cb19-1017"><a href="#cb19-1017"></a></span>
<span id="cb19-1018"><a href="#cb19-1018"></a>::: {.callout-quiz .callout}</span>
<span id="cb19-1019"><a href="#cb19-1019"></a><span class="fu">#### Scale bars and north arrows</span></span>
<span id="cb19-1020"><a href="#cb19-1020"></a></span>
<span id="cb19-1021"><a href="#cb19-1021"></a><span class="in">```{r scale_bars_quiz1}</span></span>
<span id="cb19-1022"><a href="#cb19-1022"></a><span class="in">#| echo: false</span></span>
<span id="cb19-1023"><a href="#cb19-1023"></a></span>
<span id="cb19-1024"><a href="#cb19-1024"></a><span class="in">scale_bars_quiz1 &lt;- c(</span></span>
<span id="cb19-1025"><a href="#cb19-1025"></a><span class="in">  "They should be placed in the center of the map to ensure the map is balanced.",</span></span>
<span id="cb19-1026"><a href="#cb19-1026"></a><span class="in">  "They should be made as large as possible to dominate the map.",</span></span>
<span id="cb19-1027"><a href="#cb19-1027"></a><span class="in">  answer = "They should be placed in a corner where they do not interfere with the map’s data.",</span></span>
<span id="cb19-1028"><a href="#cb19-1028"></a><span class="in">  "They should be included in every map, regardless of the map’s scale or orientation."</span></span>
<span id="cb19-1029"><a href="#cb19-1029"></a><span class="in">)</span></span>
<span id="cb19-1030"><a href="#cb19-1030"></a></span>
<span id="cb19-1031"><a href="#cb19-1031"></a><span class="in">scale_bars_quiz2 &lt;- c(</span></span>
<span id="cb19-1032"><a href="#cb19-1032"></a><span class="in">  "To show the geographical boundaries of the map.",</span></span>
<span id="cb19-1033"><a href="#cb19-1033"></a><span class="in">  answer = "To provide a reference for the actual size of features on the map.",</span></span>
<span id="cb19-1034"><a href="#cb19-1034"></a><span class="in">  "To indicate the direction of the map.",</span></span>
<span id="cb19-1035"><a href="#cb19-1035"></a><span class="in">  "To highlight the most significant data points."</span></span>
<span id="cb19-1036"><a href="#cb19-1036"></a><span class="in">)</span></span>
<span id="cb19-1037"><a href="#cb19-1037"></a></span>
<span id="cb19-1038"><a href="#cb19-1038"></a><span class="in">scale_bars_quiz3 &lt;- c(</span></span>
<span id="cb19-1039"><a href="#cb19-1039"></a><span class="in">  "Only when the map has multiple layers.",</span></span>
<span id="cb19-1040"><a href="#cb19-1040"></a><span class="in">  "Always, as it is necessary for orientation in every map.",</span></span>
<span id="cb19-1041"><a href="#cb19-1041"></a><span class="in">  "Only for maps showing detailed geographical features.",</span></span>
<span id="cb19-1042"><a href="#cb19-1042"></a><span class="in">  answer = "When north is not at the top of the map."</span></span>
<span id="cb19-1043"><a href="#cb19-1043"></a><span class="in">)</span></span>
<span id="cb19-1044"><a href="#cb19-1044"></a><span class="in">```</span></span>
<span id="cb19-1045"><a href="#cb19-1045"></a></span>
<span id="cb19-1046"><a href="#cb19-1046"></a></span>
<span id="cb19-1047"><a href="#cb19-1047"></a>**Which of the following is a recommended practice when adding a north arrow or scale bar to a crime map?**</span>
<span id="cb19-1048"><a href="#cb19-1048"></a></span>
<span id="cb19-1049"><a href="#cb19-1049"></a><span class="in">`r webexercises::longmcq(scale_bars_quiz1)`</span></span>
<span id="cb19-1050"><a href="#cb19-1050"></a></span>
<span id="cb19-1051"><a href="#cb19-1051"></a></span>
<span id="cb19-1052"><a href="#cb19-1052"></a>**What is the purpose of a scale bar in a crime map?**</span>
<span id="cb19-1053"><a href="#cb19-1053"></a></span>
<span id="cb19-1054"><a href="#cb19-1054"></a><span class="in">`r webexercises::longmcq(scale_bars_quiz2)`</span></span>
<span id="cb19-1055"><a href="#cb19-1055"></a></span>
<span id="cb19-1056"><a href="#cb19-1056"></a></span>
<span id="cb19-1057"><a href="#cb19-1057"></a>**When should a north arrow be included on a crime map?**</span>
<span id="cb19-1058"><a href="#cb19-1058"></a></span>
<span id="cb19-1059"><a href="#cb19-1059"></a><span class="in">`r webexercises::longmcq(scale_bars_quiz3)`</span></span>
<span id="cb19-1060"><a href="#cb19-1060"></a></span>
<span id="cb19-1061"><a href="#cb19-1061"></a></span>
<span id="cb19-1062"><a href="#cb19-1062"></a>:::</span>
<span id="cb19-1063"><a href="#cb19-1063"></a></span>
<span id="cb19-1064"><a href="#cb19-1064"></a></span>
<span id="cb19-1065"><a href="#cb19-1065"></a>We now have the complete code needed to make the full map. Copy this code into the <span class="in">`chapter_07.R`</span> file, replacing the existing <span class="in">`ggplot()`</span> stack.</span>
<span id="cb19-1066"><a href="#cb19-1066"></a></span>
<span id="cb19-1067"><a href="#cb19-1067"></a></span>
<span id="cb19-1070"><a href="#cb19-1070"></a><span class="in">```{r}</span></span>
<span id="cb19-1071"><a href="#cb19-1071"></a><span class="co">#| filename: "chapter_07.R"</span></span>
<span id="cb19-1072"><a href="#cb19-1072"></a></span>
<span id="cb19-1073"><a href="#cb19-1073"></a>shootings_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-1074"><a href="#cb19-1074"></a>  <span class="co"># Add base map</span></span>
<span id="cb19-1075"><a href="#cb19-1075"></a>  <span class="fu">annotation_map_tile</span>(<span class="at">type =</span> <span class="st">"cartolight"</span>, <span class="at">zoomin =</span> <span class="dv">0</span>, <span class="at">progress =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb19-1076"><a href="#cb19-1076"></a>  <span class="co"># Add density layer</span></span>
<span id="cb19-1077"><a href="#cb19-1077"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> kde), <span class="at">data =</span> shootings_kde, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">colour =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb19-1078"><a href="#cb19-1078"></a>  <span class="co"># Add precinct boundaries</span></span>
<span id="cb19-1079"><a href="#cb19-1079"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> precincts, <span class="at">colour =</span> <span class="st">"grey33"</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb19-1080"><a href="#cb19-1080"></a>  <span class="co"># Add precinct labels</span></span>
<span id="cb19-1081"><a href="#cb19-1081"></a>  <span class="fu">geom_sf_label</span>(</span>
<span id="cb19-1082"><a href="#cb19-1082"></a>    <span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">ordinal</span>(precinct)), </span>
<span id="cb19-1083"><a href="#cb19-1083"></a>    <span class="at">data =</span> precincts,</span>
<span id="cb19-1084"><a href="#cb19-1084"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>, </span>
<span id="cb19-1085"><a href="#cb19-1085"></a>    <span class="at">colour =</span> <span class="st">"grey33"</span>, </span>
<span id="cb19-1086"><a href="#cb19-1086"></a>    <span class="at">size =</span> <span class="fl">2.5</span>, </span>
<span id="cb19-1087"><a href="#cb19-1087"></a>    <span class="at">label.size =</span> <span class="cn">NA</span></span>
<span id="cb19-1088"><a href="#cb19-1088"></a>  ) <span class="sc">+</span></span>
<span id="cb19-1089"><a href="#cb19-1089"></a>  <span class="co"># Add scale bar</span></span>
<span id="cb19-1090"><a href="#cb19-1090"></a>  <span class="fu">annotation_scale</span>(<span class="at">width_hint =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">style =</span> <span class="st">"ticks"</span>, <span class="at">location =</span> <span class="st">"br"</span>) <span class="sc">+</span></span>
<span id="cb19-1091"><a href="#cb19-1091"></a>  <span class="co"># Specify colours used to show density of crime</span></span>
<span id="cb19-1092"><a href="#cb19-1092"></a>  <span class="fu">scale_fill_distiller</span>(</span>
<span id="cb19-1093"><a href="#cb19-1093"></a>    <span class="at">palette =</span> <span class="st">"PuBu"</span>,</span>
<span id="cb19-1094"><a href="#cb19-1094"></a>    <span class="at">breaks =</span> <span class="fu">range</span>(<span class="fu">pull</span>(shootings_kde, <span class="st">"kde"</span>)), </span>
<span id="cb19-1095"><a href="#cb19-1095"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"lower"</span>, <span class="st">"higher"</span>),</span>
<span id="cb19-1096"><a href="#cb19-1096"></a>    <span class="at">direction =</span> <span class="dv">1</span></span>
<span id="cb19-1097"><a href="#cb19-1097"></a>  ) <span class="sc">+</span></span>
<span id="cb19-1098"><a href="#cb19-1098"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-1099"><a href="#cb19-1099"></a>    <span class="at">title =</span> <span class="st">"Shootings are focused in the South Bronx"</span>,</span>
<span id="cb19-1100"><a href="#cb19-1100"></a>    <span class="at">subtitle =</span> <span class="st">"Fatal and non-fatal shootings recorded by NYC Police, 2019"</span>,</span>
<span id="cb19-1101"><a href="#cb19-1101"></a>    <span class="at">caption =</span> <span class="fu">str_glue</span>(</span>
<span id="cb19-1102"><a href="#cb19-1102"></a>      <span class="st">"Author: Joe Bloggs, Date produced: {lubridate::today()},</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb19-1103"><a href="#cb19-1103"></a>      <span class="st">"Data: https://data.cityofnewyork.us/d/833y-fsy8</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb19-1104"><a href="#cb19-1104"></a>      <span class="st">"Map data from OpenStreetMap"</span></span>
<span id="cb19-1105"><a href="#cb19-1105"></a>    ),</span>
<span id="cb19-1106"><a href="#cb19-1106"></a>    <span class="at">fill =</span> <span class="st">"kernel density</span><span class="sc">\n</span><span class="st">of shootings"</span></span>
<span id="cb19-1107"><a href="#cb19-1107"></a>  ) <span class="sc">+</span></span>
<span id="cb19-1108"><a href="#cb19-1108"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb19-1109"><a href="#cb19-1109"></a>  <span class="fu">theme</span>(</span>
<span id="cb19-1110"><a href="#cb19-1110"></a>    <span class="co"># Make the legend colour bar smaller</span></span>
<span id="cb19-1111"><a href="#cb19-1111"></a>    <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"lines"</span>),</span>
<span id="cb19-1112"><a href="#cb19-1112"></a>    <span class="co"># Make the legend text smaller</span></span>
<span id="cb19-1113"><a href="#cb19-1113"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>)),</span>
<span id="cb19-1114"><a href="#cb19-1114"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>)),</span>
<span id="cb19-1115"><a href="#cb19-1115"></a>    <span class="co"># Make the plot subtitle smaller and adjust the margin around it</span></span>
<span id="cb19-1116"><a href="#cb19-1116"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>), <span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">0</span>)),</span>
<span id="cb19-1117"><a href="#cb19-1117"></a>    <span class="co"># Make the legend caption smaller, left-aligned and a lighter shade of grey</span></span>
<span id="cb19-1118"><a href="#cb19-1118"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey67"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>), <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb19-1119"><a href="#cb19-1119"></a>  )</span>
<span id="cb19-1120"><a href="#cb19-1120"></a><span class="in">```</span></span>
<span id="cb19-1121"><a href="#cb19-1121"></a></span>
<span id="cb19-1122"><a href="#cb19-1122"></a>This code looks quite complicated, but you can understand each part of it using the comments included in the code.</span>
<span id="cb19-1123"><a href="#cb19-1123"></a></span>
<span id="cb19-1124"><a href="#cb19-1124"></a></span>
<span id="cb19-1125"><a href="#cb19-1125"></a></span>
<span id="cb19-1126"><a href="#cb19-1126"></a><span class="fu">## Saving maps</span></span>
<span id="cb19-1127"><a href="#cb19-1127"></a></span>
<span id="cb19-1128"><a href="#cb19-1128"></a>Until now, the maps we have produced have appeared in the RStudio Plots panel. But it is often useful to save a map as an image file so that you can share it with others or embed it into a report or presentation. You can save plots created with <span class="in">`ggplot()`</span> using the <span class="in">`ggsave()`</span> function.</span>
<span id="cb19-1129"><a href="#cb19-1129"></a></span>
<span id="cb19-1130"><a href="#cb19-1130"></a><span class="in">`ggsave()`</span> can create image files in many different formats, including PNG, JPEG and PDF. <span class="in">`ggsave()`</span> will determine which type of file to create according to the file extension of the file name that you specify. So <span class="in">`ggsave("bronx_shootings_2019.pdf", plot = shootings_map)`</span> produces a PDF file, while <span class="in">`ggsave("bronx_shootings_2019.jpg", plot = shootings_map)`</span> produces a JPEG image file.</span>
<span id="cb19-1131"><a href="#cb19-1131"></a></span>
<span id="cb19-1132"><a href="#cb19-1132"></a>You can specify the size of the image that will be saved using the <span class="in">`height`</span> and <span class="in">`width`</span> arguments. Note that for historical reasons these values are in *inches* by default, but you can change this to either centimetres (using <span class="in">`units = "cm"`</span>), millimetres (using <span class="in">`units = "mm"`</span>) or pixels (using <span class="in">`units = "px"`</span>).</span>
<span id="cb19-1133"><a href="#cb19-1133"></a></span>
<span id="cb19-1134"><a href="#cb19-1134"></a>To share our map with others, lets save it as an A4-size PDF. Add this code to the <span class="in">`chapter_07.R`</span> script file.</span>
<span id="cb19-1135"><a href="#cb19-1135"></a></span>
<span id="cb19-1136"><a href="#cb19-1136"></a><span class="in">```{r save-exercise2, exercise=TRUE, warning=FALSE, message=FALSE}</span></span>
<span id="cb19-1137"><a href="#cb19-1137"></a><span class="in">#| eval: false</span></span>
<span id="cb19-1138"><a href="#cb19-1138"></a><span class="in">#| filename: "chapter_07.R"</span></span>
<span id="cb19-1139"><a href="#cb19-1139"></a></span>
<span id="cb19-1140"><a href="#cb19-1140"></a><span class="in">ggsave(</span></span>
<span id="cb19-1141"><a href="#cb19-1141"></a><span class="in">  "bronx_shootings_2019.pdf", </span></span>
<span id="cb19-1142"><a href="#cb19-1142"></a><span class="in">  plot = shootings_map, </span></span>
<span id="cb19-1143"><a href="#cb19-1143"></a><span class="in">  width = 210,</span></span>
<span id="cb19-1144"><a href="#cb19-1144"></a><span class="in">  height = 297,</span></span>
<span id="cb19-1145"><a href="#cb19-1145"></a><span class="in">  units = "mm"</span></span>
<span id="cb19-1146"><a href="#cb19-1146"></a><span class="in">)</span></span>
<span id="cb19-1147"><a href="#cb19-1147"></a><span class="in">```</span></span>
<span id="cb19-1148"><a href="#cb19-1148"></a></span>
<span id="cb19-1149"><a href="#cb19-1149"></a>Since we are working inside a project in RStudio, the file will by default be saved in the package directory we created in @sec-create-project. You can view this directory in the RStudio Files panel: open the Files panel (in the bottom-right of the RStudio window) and click the small icon that shows a letter R inside a translucent blue box.</span>
<span id="cb19-1150"><a href="#cb19-1150"></a></span>
<span id="cb19-1151"><a href="#cb19-1151"></a>Save the <span class="in">`chapter_07.R`</span> file, then restart R to start a new session by clicking on the <span class="in">`Session`</span> menu and then clicking <span class="in">`Restart R`</span>. This creates a blank canvas for the next chapter.</span>
<span id="cb19-1152"><a href="#cb19-1152"></a></span>
<span id="cb19-1153"><a href="#cb19-1153"></a></span>
<span id="cb19-1154"><a href="#cb19-1154"></a><span class="fu">## In summary</span></span>
<span id="cb19-1155"><a href="#cb19-1155"></a></span>
<span id="cb19-1156"><a href="#cb19-1156"></a>In this chapter we have learned about the importance of understanding the purpose for which people will use a map when making decisions about map design. We have also learned about how establishing a visual hierarchy on our map can help steer readers towards the most-important elements and how to add titles, legends and scale bars to maps in R.</span>
<span id="cb19-1157"><a href="#cb19-1157"></a></span>
<span id="cb19-1158"><a href="#cb19-1158"></a></span>
<span id="cb19-1159"><a href="#cb19-1159"></a>::: {.box .reading}</span>
<span id="cb19-1160"><a href="#cb19-1160"></a></span>
<span id="cb19-1161"><a href="#cb19-1161"></a>You can find out more about the topics we have covered in this chapter:</span>
<span id="cb19-1162"><a href="#cb19-1162"></a></span>
<span id="cb19-1163"><a href="#cb19-1163"></a><span class="ss">  * </span>For a short summary of research into how people read maps and what that </span>
<span id="cb19-1164"><a href="#cb19-1164"></a>    tells us about how to design a map, see <span class="co">[</span><span class="ot">Cartography, visual perception and cognitive psychology</span><span class="co">](https://doi.org/10.4324/9781315736822-5)</span></span>
<span id="cb19-1165"><a href="#cb19-1165"></a>    by Amy Griffin.</span>
<span id="cb19-1166"><a href="#cb19-1166"></a><span class="ss">  * </span>For a more-detailed explanation of how visual hierarchy can be applied to</span>
<span id="cb19-1167"><a href="#cb19-1167"></a>    maps, see <span class="co">[</span><span class="ot">Visual Hierarchy and Layout</span><span class="co">](https://gistbok.ucgis.org/bok-topics/visual-hierarchy-and-layout)</span>.</span>
<span id="cb19-1168"><a href="#cb19-1168"></a><span class="ss">  * </span>For more examples of how maps can mislead, read <span class="co">[</span><span class="ot">How to lie with maps</span><span class="co">](https://www.ft.com/content/65b5df0e-49ff-11e8-8ee8-cae73aab7ccb)</span></span>
<span id="cb19-1169"><a href="#cb19-1169"></a>    by Alan Smith.</span>
<span id="cb19-1170"><a href="#cb19-1170"></a>    </span>
<span id="cb19-1171"><a href="#cb19-1171"></a>:::</span>
<span id="cb19-1172"><a href="#cb19-1172"></a></span>
<span id="cb19-1173"><a href="#cb19-1173"></a></span>
<span id="cb19-1174"><a href="#cb19-1174"></a>::: {.callout-quiz .callout}</span>
<span id="cb19-1175"><a href="#cb19-1175"></a><span class="fu">### Revision questions {.unnumbered}</span></span>
<span id="cb19-1176"><a href="#cb19-1176"></a></span>
<span id="cb19-1177"><a href="#cb19-1177"></a>Answer these questions to check you have understood the main points covered in this chapter. Write between 50 and 100 words to answer each question.</span>
<span id="cb19-1178"><a href="#cb19-1178"></a></span>
<span id="cb19-1179"><a href="#cb19-1179"></a><span class="ss">1. </span>What is visual hierarchy in mapping, and why is it important to establish one when designing a map? Provide an example of how visual hierarchy affects map readability</span>
<span id="cb19-1180"><a href="#cb19-1180"></a><span class="ss">2. </span>Why is it important to add titles, legends, and other supporting elements to a crime map? How do these elements enhance the map’s usefulness and clarity?</span>
<span id="cb19-1181"><a href="#cb19-1181"></a><span class="ss">3. </span>What is the difference between a descriptive and a declarative map title? Provide an example of each for a map showing crime patterns.</span>
<span id="cb19-1182"><a href="#cb19-1182"></a><span class="ss">4. </span>Why is it important to acknowledge data sources and authorship on your map? How can the caption argument in labs() be used to include this information?</span>
<span id="cb19-1183"><a href="#cb19-1183"></a><span class="ss">5. </span>What factors should you consider when deciding whether to include a scale bar or north arrow on your map? How do these elements contribute to the map’s context?</span>
<span id="cb19-1184"><a href="#cb19-1184"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://creativecommons.org/licenses/by/4.0/">
<p>This book is available under a Creative Commons Attribution 4.0 International licence</p>
</a>
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mpjashby/crimemappingbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>